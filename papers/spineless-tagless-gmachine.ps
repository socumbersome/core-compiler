%!PS-Adobe-2.0
%%Creator: dvips, version 5.4 (C) 1986-90 Radical Eye Software
%%Title: spineless-tagless-gmachine.dvi
%%Pages: 87 1
%%BoundingBox: 0 0 596 843
%%EndComments
%%BeginProcSet: tex.pro
/TeXDict 200 dict def TeXDict begin /N /def load def /B{bind def}N /S /exch
load def /X{S N}B /TR /translate load N /isls false N /vsize 10 N /@rigin{
isls{[0 1 -1 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
Resolution VResolution vsize neg mul TR matrix currentmatrix dup dup 4 get
round 4 exch put dup dup 5 get round 5 exch put setmatrix}N /@letter{/vsize 10
N}B /@landscape{/isls true N /vsize -1 N}B /@a4{/vsize 10.6929133858 N}B /@a3{
/vsize 15.5531 N}B /@ledger{/vsize 16 N}B /@legal{/vsize 13 N}B /@manualfeed{
statusdict /manualfeed true put}B /@copies{/#copies X}B /FMat[1 0 0 -1 0 0]N
/FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{/nn 8 dict N nn begin
/FontType 3 N /FontMatrix fntrx N /FontBBox FBB N string /base X array
/BitMaps X /BuildChar{CharBuilder}N /Encoding IE N end dup{/foo setfont}2
array copy cvx N load 0 nn put /ctr 0 N[}B /df{/sf 1 N /fntrx FMat N df-tail}
B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]N df-tail}B /E{pop nn dup definefont
setfont}B /ch-width{ch-data dup length 5 sub get}B /ch-height{ch-data dup
length 4 sub get}B /ch-xoff{128 ch-data dup length 3 sub get sub}B /ch-yoff{
ch-data dup length 2 sub get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B
/ch-image{ch-data dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0
N /rw 0 N /rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S
dup /base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx 0
ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff setcachedevice
ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff .1 add]{ch-image}
imagemask restore}B /D{/cc X dup type /stringtype ne{]}if nn /base get cc ctr
put nn /BitMaps get S ctr S sf 1 ne{dup dup length 1 sub dup 2 index S get sf
div put}if put /ctr ctr 1 add N}B /I{cc 1 add D}B /bop{userdict /bop-hook
known{bop-hook}if /SI save N @rigin 0 0 moveto}N /eop{clear SI restore
showpage userdict /eop-hook known{eop-hook}if}N /@start{userdict /start-hook
known{start-hook}if /VResolution X /Resolution X 1000 div /DVImag X /IE 256
array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for}N /p /show load N
/RMat[1 0 0 -1 0 0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X
/rulex X V}B /V statusdict begin /product where{pop product dup length 7 ge{0
7 getinterval(Display)eq}{pop false}ifelse}{false}ifelse end{{gsave TR -.1 -.1
TR 1 1 scale rulex ruley false RMat{BDot}imagemask grestore}}{{gsave TR -.1
-.1 TR rulex ruley scale 1 1 false RMat{BDot}imagemask grestore}}ifelse B /a{
moveto}B /delta 0 N /tail{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{
S p tail}B /c{-4 M}B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B
/j{3 M}B /k{4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w
}B /q{p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{clear SS restore}B end
%%EndProcSet
TeXDict begin 1000 300 300 @start /Fa 6 116 df<FFF07FF80F0007800F0007800F0007
800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F00
07800FFFFF800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F
0007800F0007800F0007800F0007800F0007800F0007800F000780FFF07FF81D1F7C9E25>72
D<001800001800003C00003C00003C00004E00004E0000CF000087000087000103800103800303
C00201C00201C007FFE00400E00400E0080070080070180038380078FE01FF18177F961C>97
D<FFFFC01C01C01C00C01C00401C00601C00201C00201C08201C08001C08001C18001FF8001C18
001C08001C08101C08101C00101C00301C00201C00201C00601C01E0FFFFE014177E9619>101
D<FF80FE1C00781C00601C00401C00801C01001C06001C08001C10001C38001C78001C9C001D0E
001E0E001C07001C03801C01C01C01C01C00E01C00701C00781C007CFF80FF18177E961D>107
D<FFC0001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00
001C00001C00401C00401C00401C00C01C00C01C00801C01801C0780FFFF8012177E9617>I<0F
C4302C601C400CC004C004C004E00070007F003FE00FF801FC001C000E0006800680068006C004
E008D81087E00F177E9615>115 D E /Fb 56 124 df<0006000C00100030006000C000800180
0300030006000E000C000C0018001800380038003000300070007000600060006000E000E000E0
00E000E000E000E000E00060006000600060006000300030001000180008000C00040002000F2E
7AA112>40 D<008000C00040002000300030001800180018000C000C000C000C000C000C000C00
0C000C000C000C000C000C001C001C001C0018001800380038003000300070006000E000C000C0
01800100030006000400080018003000400080000E2E80A112>I<183C7C7C3C04040808101020
4080060E7D840D>44 D<FFF0FFF00C027E8A0F>I<007E0001C3000301800701C00E00C00E00E0
1C00E01C00E03C01E03801E07801E07801E07801E07801E07801E0F003C0F003C0F003C0F003C0
F003C0F00380F00780E00780E00700E00700E00E00600E00701C003038003870000FC000131F7C
9D17>48 D<0018003801F80E700070007000700070007000E000E000E000E000E000E001C001C0
01C001C001C001C003800380038003800380038007000780FFFC0E1E7B9D17>I<000060000060
0000E00001C00003C00005C0000DC00009C00011C000238000438000C380008380010380020380
040700080700180700100700200700400700FFFFF0000E00000E00000E00000E00000E00001C00
001E0001FFC0141E7E9D17>52 D<01803003FFE003FFC003FF0003FC0002000002000004000004
0000040000040000047C000587000A03800C01800801C00001C00001E00001E00001E00001E070
03C0F803C0F003C0E00380800780400700400E00201C001070000FC000141F7D9D17>I<003F00
00C1C00100600200200400300C00300C00300C00300E00600E00600F80C00FC18007F60003FC00
01FC0001FF00063F800C1F801007C03003C06001C06000C0C000C0C000C0C000C0C00080C00100
60030030040018180007E000141F7D9D17>56 D<007E0001C3000301800601C00E01C01C00C03C
00E03C00E03C01E07801E07801E07801E07801E07803E07803E03803C03807C01C0BC00C13C003
E380000780000780000700000F00600E00F01C00F01800E0300080600041C0003F0000131F7C9D
17>I<0E1F1F1E0C000000000000000000003078F8787008147C930D>I<0000080000000C000000
1C0000003C0000003C0000007C0000007E0000009E0000009E0000011E0000011E0000021E0000
020F0000040F0000040F0000080F0000080F0000100F80001007800020078000200780007FFF80
004007C0008003C0008003C0010003C0010003C0020003C0020001E0060001E01F0003E0FF801F
FE1F207F9F22>65 D<07FFFF0000F803C0007801E0007800F000F000F800F000F800F000F800F0
00F800F000F800F000F001E001F001E003E001E003C001E00F8001FFFE0001E00F8003C003C003
C001E003C001F003C001F003C000F003C000F0078000F0078001F0078001F0078001E0078003E0
078007C00F000F800F003E00FFFFF0001D1F7E9E20>I<0000FE0200070186001C004E0070003E
00E0001E01C0001C0380000C0780000C0F00000C1F00000C1E00000C3E0000083C0000007C0000
007C0000007C0000007C000000F8000000F8000000F8000000F800000078000000780000107800
0020780000203C0000203C0000401C0000800E0001000700020003800C0000E03000003FC0001F
217C9F21>I<07FFFF800000F801E0000078007000007800380000F0001C0000F0001E0000F000
0E0000F0000F0000F0000F0000F0000F0001E0000F8001E0000F8001E0000F8001E0000F8001E0
000F8001E0000F8003C0000F0003C0001F0003C0001F0003C0001F0003C0001E0003C0003E0007
80003C0007800078000780007800078000F000078001E000078003C0000F000F00000F003C0000
FFFFF00000211F7E9E23>I<07FFFFFC00F8007C0078001C0078000C00F0000C00F0000400F000
0400F0000400F0000400F0040401E0080001E0080001E0080001E0380001FFF80001E0380003C0
100003C0100003C0100003C0100003C0000803C000100780001007800010078000200780002007
800060078000C00F0001C00F0007C0FFFFFF801E1F7E9E1F>I<07FFFFF800F800780078003800
78001800F0001800F0000800F0000800F0000800F0000800F0000801E0080001E0080001E00800
01E0180001E0380001FFF80003C0300003C0100003C0100003C0100003C0100003C00000078000
0007800000078000000780000007800000078000000F0000000F800000FFFC00001D1F7E9E1E>
I<0000FE0200070186001C004E0070003E00E0001E01C0001C0380000C0780000C0F00000C1F00
000C1E00000C3E0000083C0000007C0000007C0000007C0000007C000000F8000000F8000000F8
003FFEF80001F0780000F0780000F0780001E0780001E03C0001E03C0001E01C0001E00E0003E0
070005C0038008C000E03040003FC0001F217C9F24>I<07FF83FFC000F8007C000078003C0000
78003C0000F000780000F000780000F000780000F000780000F000780000F000780001E000F000
01E000F00001E000F00001E000F00001FFFFF00001E000F00003C001E00003C001E00003C001E0
0003C001E00003C001E00003C001E000078003C000078003C000078003C000078003C000078003
C000078003C0000F000780000F8007C000FFF07FF800221F7E9E22>I<07FF8000F80000780000
780000F00000F00000F00000F00000F00000F00001E00001E00001E00001E00001E00001E00003
C00003C00003C00003C00003C00003C0000780000780000780000780000780000780000F00000F
8000FFF000111F7E9E10>I<007FFC0003E00001E00001E00003C00003C00003C00003C00003C0
0003C0000780000780000780000780000780000780000F00000F00000F00000F00000F00000F00
001E00301E00781E00F81E00F81C00F03C0080380040700020E0001F800016207E9E17>I<07FF
E00000FC0000007800000078000000F0000000F0000000F0000000F0000000F0000000F0000001
E0000001E0000001E0000001E0000001E0000001E0000003C0000003C0000003C0000003C00000
03C0008003C00100078001000780010007800300078002000780060007800E000F001E000F007C
00FFFFFC00191F7E9E1C>76 D<07F800007FE000F800007C0000780000BC0000780000BC00009C
00017800009C00017800009C00027800009C00027800008E00047800008E00087800010E0008F0
00010E0010F000010E0010F00001070020F00001070020F00001070040F00002070041E0000203
8081E00002038101E00002038101E00002038201E00002038201E0000401C403C0000401C403C0
000401C803C0000401C803C0000400F003C0000C00E003C0000C00E00780001E00C007C000FFC0
C07FFC002B1F7E9E2A>I<07F8007FC0007C001F00007C000C00005E000400009E000800008F00
0800008F000800008780080000878008000083C008000103C010000101E010000101E010000100
F010000100F010000100781000020078200002003C200002003C200002001E200002001E200002
000F200004000F4000040007C000040007C000040003C000040003C000040001C0000C00018000
1E00008000FF80008000221F7E9E22>I<0001FC00000E0700003801C0007000E001E000F003C0
0078078000780780003C0F00003C1F00003C1E00003E3E00003E3C00003E7C00003E7C00003E7C
00003E7C00003EF800007CF800007CF800007CF8000078F80000F8780000F8780001F07C0001E0
7C0003E03C0003C01C0007801E000F000F001E000780380001C0E000007F80001F217C9F23>I<
07FFFF0000F803C0007800F00078007800F0007800F0007C00F0007C00F0007C00F0007C00F000
7801E000F801E000F001E001E001E003C001E00F0001FFFC0003C0000003C0000003C0000003C0
000003C0000003C000000780000007800000078000000780000007800000078000000F0000000F
800000FFF800001E1F7E9E1F>I<07FFFE0000F80780007801E0007800F000F000F000F000F800
F000F800F000F800F000F800F000F001E001F001E001E001E003C001E0078001E01E0001FFF000
03C0380003C01C0003C01E0003C00E0003C00E0003C00F0007801F0007801F0007801F0007801F
0007801F0007801F020F001F040F800F04FFF00788000001F01F207E9E21>82
D<001F8200706600C01E01800E03000E07000C0600040E00040E00040E00040F00000F00000F80
0007F00007FF0003FFC001FFE0003FF00003F80000F800007800003C00003C4000384000384000
38400030600070600060F000C0E80180C6030081FC0017217E9F19>I<3FFFFFF03C0780F03007
803060078030400F0010400F0010C00F0010800F0010800F0010800F0010001E0000001E000000
1E0000001E0000001E0000001E0000003C0000003C0000003C0000003C0000003C0000003C0000
00780000007800000078000000780000007800000078000000F0000000F800003FFFE0001C1F7A
9E21>I<FFF07FF81FF01F000FC007C01E00078003801F00078001000F00078002000F000F8002
000F000F8004000F0017C004000F0013C008000F0023C008000F8023C01000078043C010000780
43C020000780C3C02000078083E04000078081E04000078101E0800007C101E0800003C201E180
0003C201E1000003C401E1000003C401F2000003C800F2000003C800F4000001F000F4000001F0
00F8000001E000F8000001E000F0000001C000F0000001C0006000000180006000000080004000
002C207A9E2F>87 D<FFF001FF1F8000780F0000600F8000400780008007C0018003C0010003E0
020003E0040001E0040001F0080000F0100000F8200000782000007C4000003C8000003F000000
1F0000001E0000001E0000001E0000001C0000003C0000003C0000003C0000003C0000003C0000
0038000000780000007C000007FF8000201F7A9E22>89 D<07F8000C0C001E06001E07001C0700
00070000070000070000FF0007C7001E07003C0E00780E00F00E10F00E10F00E10F01E10F02E20
784F401F878014147D9317>97 D<0700003F00000F00000700000700000E00000E00000E00000E
00000E00000E00001C00001C7C001D83001E01801C01C01C00E03800E03800F03800F03800F038
00F03800F07001E07001E07001C07003C0700380700700E80E00CC380083E00014207B9F19>I<
00FE000383000E07801C0780380700380000780000F00000F00000F00000F00000E00000E00000
E00000F00000F001007002003804001C180007E00011147D9314>I<0000380001F80000780000
380000380000700000700000700000700000700000700000E000FCE00382E00601E01C01E03C00
E03801C07801C0F001C0F001C0F001C0F001C0E00380E00380E00380E00380F00380700780380F
001C378007C7E015207D9F19>I<00F800070E000E07001C0700380380780380700380F00380F0
0380FFFF80F00000E00000E00000E00000E00000F001007002003004001C180007E00011147D93
14>I<0007C0001C600030F00060F000E0E000C00001C00001C00001C00001C00001C000038000
3FFC000380000380000380000380000700000700000700000700000700000700000E00000E0000
0E00000E00000E00000E00001C00001E0000FFC00014207F9F0E>I<00000E003E1100E1A301C1
C20381E00780E00701E00F01E00F01E00F01E00703C007038007870004FC000800000800001800
001C00000FFF000FFFC00FFFE01800F0300030600030C00030C00030C000306000603000C01C07
0007FC00181F809417>I<00E00007E00001E00000E00000E00001C00001C00001C00001C00001
C00001C000038000038F800390E003A0E003C0600380600780E00700E00700E00700E00700E007
00E00E01C00E01C00E01C00E01C00E01C00E01C01C03801E03C0FF8FF014207E9F19>I<01C003
E003E003C0018000000000000000000000000003801F8007800380038007000700070007000700
07000E000E000E000E000E000E001C001E00FF800B1F7F9E0C>I<00E00007E00001E00000E000
00E00001C00001C00001C00001C00001C00001C0000380000381FC0380F00380C0038180038100
070400070800071800073800077C00071C000E1C000E0E000E0E000E0F000E07000E07801C0380
1E07C0FF8FF016207E9F18>107 D<00E007E001E000E000E001C001C001C001C001C001C00380
038003800380038003800700070007000700070007000E000E000E000E000E000E001C001E00FF
800B207F9F0C>I<0387C07C001F9861860007A072070003C03403000380380300078078070007
0070070007007007000700700700070070070007007007000E00E00E000E00E00E000E00E00E00
0E00E00E000E00E00E000E00E00E001C01C01C001E01E01E00FFCFFCFFC022147E9326>I<038F
801F90E007A0E003C0600380600780E00700E00700E00700E00700E00700E00E01C00E01C00E01
C00E01C00E01C00E01C01C03801E03C0FF8FF014147E9319>I<00FC000387000E01801C00C038
00E03800E07000F0F000F0F000F0F000F0F000F0E001E0E001E0E001C0E003C0F0038070070038
0E001C1C0007E00014147D9317>I<00E3E00007EC380000F01C0000E00E0000E00F0001C00700
01C0078001C0078001C0078001C0078001C0078003800F0003800F0003800E0003801E0003801C
0003803800074070000761C000071F00000700000007000000070000000E0000000E0000000E00
00000E0000001E000000FFC00000191D809319>I<038E001FB38007C78003C780038300078000
0700000700000700000700000700000E00000E00000E00000E00000E00000E00001C00001E0000
FFC00011147E9312>114 D<01F9060708031803180138023C001F001FF007FC01FE001F400740
03400360036006F004C81887E010147F9312>I<0080010001000100030007000F001E00FFF80E
000E000E000E001C001C001C001C001C001C00380038103810381038103820382018400F800D1C
7C9B12>I<1C0380FC1F803C07801C03801C038038070038070038070038070038070038070070
0E00700E00700E00700E00701E00701E00703C00305E001F9F8011147B9319>I<FF83F81E00E0
1C00C01C00801E00800E01000E03000E02000E040007040007080007080007100003900003A000
03E00003C00003800001800001000015147C9318>I<FF9FE1FC3C0780701C0300601C0380601C
0380401C0380800E0780800E0D81000E0981000E19C2000E11C2000F21C4000720C4000740C800
0740E8000780F0000780F0000300E00003006000020040001E147C9321>I<1FF0FF03C07801C0
7001C04000E0C000E180007300007600003C00003C00001C00002E00004E000087000107000203
800403800C01C03C03E0FE07FC18147F9318>I<0FF83F8001E00E0001C00C0001C0080001E008
0000E0100000E0300000E0200000E040000070400000708000007080000071000000390000003A
0000003E0000003C00000038000000180000001000000010000000200000002000000040000070
C00000F0800000F1000000E600000078000000191D809318>I<0FFFE00E01E00C01C008038008
0700100E00101C0000380000700000700000E00001C0000380800700800E00801C01001C010038
0300700E00FFFE0013147F9314>I<FFFFFC16017E8C17>I E /Fc 6 84
df<FFFE001C03801C00E01C00601C00701C00701C00701C00701C00E01C01C01FFF801FFFC01C
00E01C00701C00301C00381C00381C00381C00381C00701C00E01C01C0FFFF0015177F9619>66
D<00FC100383300E00B01C0070380030300030700010600010E00010E00000E00000E00000E000
00E00000E000106000107000103000203800201C00400E008003830000FC0014177E9619>I<FF
83FE1C00701C00701C00701C00701C00701C00701C00701C00701C00701C00701FFFF01C00701C
00701C00701C00701C00701C00701C00701C00701C00701C0070FF83FE17177F961A>72
D<FFE00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E00
0E000E000E00FFE00B177F960D>I<FFC0001C00001C00001C00001C00001C00001C00001C0000
1C00001C00001C00001C00001C00001C00001C00201C00201C00201C00601C00601C00401C00C0
1C03C0FFFFC013177F9616>76 D<0FC4302C601C400CC004C004C004E00070007F003FE00FF801
FC001C000E0006800680068006C004E008D81087E00F177E9614>83 D E
/Fd 1 117 df<00FC0007FF800FFFC01FFFE03FFFF07FFFF87FFFF8FFFFFCFFFFFCFFFFFCFFFF
FCFFFFFCFFFFFCFFFFFCFFFFFC7FFFF87FFFF83FFFF01FFFE00FFFC007FF8000FC0016168B8A15
>116 D E /Fe 9 117 df<0038007800F001E003C007800F000E001C001C003800380070007000
7000E000E000E000E000E000E000E000E000E000E000700070007000380038001C001C000E000F
00078003C001E000F8007800380D2878A21A>40 D<6000F00078003C001E000F000780038001C0
01C000E000E0007000700070003800380038003800380038003800380038003800700070007000
E000E001C001C0038007800F001E003C007800F00060000D287CA21A>I<1FF0003FFC007FFE00
780F00300700000380000380007F8007FF801FFF803F8380780380700380E00380E00380E00380
700780780F803FFFFC1FFDFC07F0FC16157D941A>97 D<00FF8003FFC00FFFE01F01E03C00C078
0000700000700000E00000E00000E00000E00000E000007000007000007800703C00701F01F00F
FFE003FFC000FE0014157D941A>99 D<01F80007FF000FFF801E07C03C01C07800E07000E0E000
70E00070FFFFF0FFFFF0FFFFF0E000007000007000007800703C00701F01F00FFFE003FF8000FE
0014157D941A>101 D<7FE000FFE0007FE00000E00000E00000E00000E00000E00000E00000E0
0000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E0
0000E00000E00000E00000E0007FFFC0FFFFE07FFFC0131E7D9D1A>108
D<7F81F8FF8FFC7F9FFE03FE1E03F80C03E00003E00003C0000380000380000380000380000380
000380000380000380000380000380007FFF00FFFF007FFF0017157F941A>114
D<07FB801FFF807FFF80780780E00380E00380E003807800007FC0001FFC0007FE00003F800007
806001C0E001C0E001C0F003C0FC0780FFFF00EFFE00E3F80012157C941A>I<01800003800003
80000380000380000380000380007FFFE0FFFFE0FFFFE003800003800003800003800003800003
800003800003800003800003800003807003807003807003807001C1E001FFE000FF80003F0014
1C7F9B1A>I E /Ff 1 49 df<040E0E1C1C1C38383070706060C0C0070F7F8F0A>48
D E /Fg 14 68 df<FFF0FFF0FFF0E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000FFF0FFF0FFF00C7C758118>34
D<FFF0FFF0FFF00070007000700070007000700070007000700070007000700070007000700070
007000700070007000700070007000700070007000700070007000700070007000700070007000
700070007000700070007000700070007000700070007000700070007000700070007000700070
007000700070007000700070007000700070007000700070007000700070007000700070007000
700070007000700070007000700070007000700070007000700070007000700070007000700070
007000700070007000700070007000700070007000700070007000700070007000700070007000
700070007000700070FFF0FFF0FFF00C7C808118>I<00000C0000180000380000300000600000
E00000C00001C0000380000380000700000700000E00000E00001C00001C000038000038000078
0000700000F00000F00000E00001E00001E00003C00003C00003C00003C0000780000780000780
000F80000F00000F00000F00001F00001F00001E00001E00001E00003E00003E00003E00003E00
003C00003C00003C00007C00007C00007C00007C00007C00007C00007C00007C00007800007800
00F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F800
00F80000F80000F80000F80000164B748024>48 D<C000006000007000003000001800001C0000
0C00000E000007000007000003800003800001C00001C00000E00000E000007000007000007800
003800003C00003C00001C00001E00001E00000F00000F00000F00000F00000780000780000780
0007C00003C00003C00003C00003E00003E00001E00001E00001E00001F00001F00001F00001F0
0000F00000F00000F00000F80000F80000F80000F80000F80000F80000F80000F8000078000078
00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C
00007C00007C00007C00007C164B7F8024>I<FFFCFFFCFFFCE000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E0000E4A73801C>I<FFFCFFFCFFFC001C001C001C001C001C001C001C00
1C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C00
1C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001C001C001C001C001C0E4A80801C>I<E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000FFFCFFFCFFFC0E4A73811C>I<001C001C001C001C001C001C001C001C001C001C001C00
1C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C00
1C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001CFFFCFFFCFFFC0E4A80811C>I<E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0
E0E0E0031B73801C>I<E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0031B
75801C>I<F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F8
0000F80000F80000F80000F80000F800007800007800007C00007C00007C00007C00007C00007C
00007C00007C00003C00003C00003C00003E00003E00003E00003E00001E00001E00001E00001F
00001F00000F00000F00000F00000F800007800007800007800003C00003C00003C00003C00001
E00001E00000E00000F00000F000007000007800003800003800001C00001C00000E00000E0000
07000007000003800003800001C00000C00000E000006000003000003800001800000C164B7482
24>64 D<00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C0000
7C00007C00007C00007C00007C00007C0000780000780000F80000F80000F80000F80000F80000
F80000F80000F80000F00000F00000F00001F00001F00001F00001F00001E00001E00001E00003
E00003E00003C00003C00003C00007C0000780000780000780000F00000F00000F00000F00001E
00001E00001C00003C00003C0000380000780000700000700000E00000E00001C00001C0000380
000380000700000700000E00000C00001C0000180000300000700000600000C00000164B7F8224
>I<F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8051B748024>I<F8F8F8F8
F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8051B6E8024>I
E /Fh 4 116 df<1FC0007FF000707800201800001C00001C0007FC001FFC003C1C00701C00E0
1C00E01C00E01C00707C003FFF800F8F8011107E8F14>97 D<03F80FFE1C0E380470006000E000
E000E000E00060007000380E1C1E0FFC03F00F107E8F14>99 D<07E00FF01C38301C700CE00EE0
0EFFFEFFFEE00060007000380E1C1E0FFC03F00F107E8F14>101 D<0FD83FF86038C038C038F0
007F803FF007F8001C6006E006F006F81CFFF8CFE00F107E8F14>115 D
E /Fi 3 64 df<00000000001800000000003C00000000007C0000000000F80000000001F00000
000003E00000000007C0000000000F80000000001F00000000003E00000000007C0000000000F8
0000000001F00000000003E00000000007C0000000000F80000000001F00000000003E00000000
007C0000000000F80000000001F00000000003E00000000007C0000000000F80000000001F0000
0000003E00000000007C0000000000F80000000001F00000000003E00000000007C0000000000F
80000000001F00000000003E00000000007C0000000000F80000000001F00000000003E0000000
0007C0000000000F80000000001F00000000003E00000000007C0000000000F80000000000F000
000000006000000000002E2E82AB2A>0 D<800000E00000F80000FF0000FFC000FFF800FFFF00
FFFFE0FFFFFEFFFFFEFFFFE0FFFF00FFF800FFC000FF0000F80000E0000080000017126F882A>
45 D<FFFFC07FFF807FFF803FFF003FFF001FFE001FFE001FFE000FFC000FFC0007F80007F800
07F80003F00003F00003F00001E00001E00001E00000C00000C00000C00000C000121789982A>
63 D E /Fj 25 121 df<387CFEFEFE7C38000000000000000000000000000000000000000000
0000387CFEFEFE7C38072579A415>58 D<FFFFFFFFFFF0FFFFFFFFFFF003FC00003FF001F80000
07F001F8000001F001F8000000F801F80000007801F80000007801F80000003801F80000003801
F80000001801F80000001801F80000001801F80000001801F80000001C01F80000000C01F80000
000C01F80003000C01F80003000C01F80003000001F80003000001F80003000001F80003000001
F80007000001F80007000001F8000F000001F8003F000001FFFFFF000001FFFFFF000001F8003F
000001F8000F000001F80007000001F80007000001F80003000001F80003000001F80003000001
F80003000001F80003000301F80003000301F80000000301F80000000301F80000000601F80000
000601F80000000601F80000000601F80000000601F80000000E01F80000000E01F80000000C01
F80000001C01F80000001C01F80000003C01F80000003C01F80000007C01F8000001FC01F80000
07F803FC00003FF8FFFFFFFFFFF8FFFFFFFFFFF8303B7CBA36>69 D<FFFFF0FFFFF003FC0001F8
0001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F8
0001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F8
0001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F8
0001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F8
0003FC00FFFFF0FFFFF0143B7CBA1C>73 D<FFF8000000001FFF80FFFC000000003FFF8003FC00
0000003FE00001FC000000003FC00001BE000000006FC00001BE000000006FC00001BE00000000
6FC000019F00000000CFC000019F00000000CFC000019F00000000CFC000018F800000018FC000
018F800000018FC0000187C00000030FC0000187C00000030FC0000187C00000030FC0000183E0
0000060FC0000183E00000060FC0000183E00000060FC0000181F000000C0FC0000181F000000C
0FC0000181F000000C0FC0000180F80000180FC0000180F80000180FC00001807C0000300FC000
01807C0000300FC00001807C0000300FC00001803E0000600FC00001803E0000600FC00001803E
0000600FC00001801F0000C00FC00001801F0000C00FC00001801F0000C00FC00001800F800180
0FC00001800F8001800FC000018007C003000FC000018007C003000FC000018007C003000FC000
018003E006000FC000018003E006000FC000018003E006000FC000018001F00C000FC000018001
F00C000FC000018001F00C000FC000018000F818000FC000018000F818000FC0000180007C3000
0FC0000180007C30000FC0000180007C30000FC0000180003E60000FC0000180003E60000FC000
0180003E60000FC0000180001FC0000FC0000180001FC0000FC0000180001FC0000FC00003C000
0F80000FC00007E0000F80000FC0000FF0000700001FE000FFFF00070007FFFF80FFFF00070007
FFFF80413B7CBA49>77 D<FFFFFFFF0000FFFFFFFFE00003FC0003F80001F800007E0001F80000
3F0001F800000F8001F8000007C001F8000007E001F8000003F001F8000003F001F8000003F801
F8000001F801F8000001FC01F8000001FC01F8000001FC01F8000001FC01F8000001FC01F80000
01FC01F8000001FC01F8000001F801F8000003F801F8000003F001F8000003F001F8000007E001
F800000FC001F800000F8001F800003F0001F80000FC0001F80003F00001FFFFFFC00001F80000
000001F80000000001F80000000001F80000000001F80000000001F80000000001F80000000001
F80000000001F80000000001F80000000001F80000000001F80000000001F80000000001F80000
000001F80000000001F80000000001F80000000001F80000000001F80000000001F80000000001
F80000000001F80000000001F80000000001F80000000001F80000000001F80000000003FC0000
0000FFFFF0000000FFFFF00000002E3B7CBA36>80 D<7FFFFFFFFFFFC07FFFFFFFFFFFC07FC003
FC003FC07E0001F8000FC07C0001F80003C0780001F80001C0700001F80001C0700001F80000C0
600001F80000C0600001F80000C0E00001F80000E0E00001F80000E0C00001F8000060C00001F8
000060C00001F8000060C00001F8000060C00001F8000060C00001F8000060C00001F800006000
0001F8000000000001F8000000000001F8000000000001F8000000000001F8000000000001F800
0000000001F8000000000001F8000000000001F8000000000001F8000000000001F80000000000
01F8000000000001F8000000000001F8000000000001F8000000000001F8000000000001F80000
00000001F8000000000001F8000000000001F8000000000001F8000000000001F8000000000001
F8000000000001F8000000000001F8000000000001F8000000000001F8000000000001F8000000
000001F8000000000001F8000000000001F8000000000001F8000000000001F8000000000001F8
000000000001F8000000000001F8000000000001F8000000000007FE0000000007FFFFFE000000
07FFFFFE0000333B7DBA39>84 D<003F80000001C0F0000003003C000004001E00000C000F0000
18000780001C0007C0003E0003C0003F0003E0003F0003E0003F0003E0001E0003E000000003E0
00000003E000000003E00000003FE000000FF3E000007E03E00001F803E00003E003E0000FC003
E0001F8003E0003F0003E0003E0003E0007E0003E0007E0003E060FC0003E060FC0003E060FC00
03E060FC0007E060FC0007E0607C000BE0607E000BE0603E0011F0C01F0060F0C007C1807F8000
FE003E0023257CA427>97 D<03E0000000FFE0000000FFE000000007E000000003E000000003E0
00000003E000000003E000000003E000000003E000000003E000000003E000000003E000000003
E000000003E000000003E000000003E000000003E000000003E000000003E000000003E0000000
03E000000003E000000003E03FC00003E0E0780003E3001C0003E6000F0003E800078003F80003
C003F00001E003E00001F003E00000F003E00000F803E00000F803E00000FC03E000007C03E000
007C03E000007E03E000007E03E000007E03E000007E03E000007E03E000007E03E000007E03E0
00007E03E000007E03E000007C03E000007C03E00000FC03E00000F803E00000F803E00001F003
E00001E003F00003E003D80003C003C80007800384000E000383001C000381C0F00003003F8000
273C7EBB2C>I<0007F800003C0E0000F0018001E000C003C00060078000300F0000701F0000F8
1F0001F83E0001F83E0001F87E0000F07C0000007C000000FC000000FC000000FC000000FC0000
00FC000000FC000000FC000000FC000000FC0000007C0000007C0000007E0000003E0000003E00
000C1F00000C1F0000180F8000180780003003C0006001E000C000F00180003C0E000007F8001E
257DA423>I<0000000F80000003FF80000003FF800000001F800000000F800000000F80000000
0F800000000F800000000F800000000F800000000F800000000F800000000F800000000F800000
000F800000000F800000000F800000000F800000000F800000000F800000000F800000000F8000
00000F800003F80F80001E070F800070018F8000E0004F8003C0002F800780001F800F80001F80
0F00000F801F00000F803E00000F803E00000F807E00000F807C00000F807C00000F80FC00000F
80FC00000F80FC00000F80FC00000F80FC00000F80FC00000F80FC00000F80FC00000F80FC0000
0F807C00000F807C00000F807E00000F803E00000F803E00000F801E00000F801F00000F800F00
001F800780003F8003C0006F8001E000CF800070018FC0003C0E0FFE0007F00FFE273C7DBB2C>
I<0007F800003C1E0000F0078001C003C003C001E0078000F00F0000F81F0000781E00007C3E00
007C3E00007C7E00003E7C00003E7C00003EFC00003EFC00003EFFFFFFFEFC000000FC000000FC
000000FC000000FC000000FC0000007C0000007C0000007E0000003E0000003E0000061F000006
0F00000C0F80000C0780001803C0003000E00060007000C0001E07000003FC001F257EA423>I<
00000007C0000FE01860003838207000F01E40F001E00F80F003C007806007C007C0000F8003E0
000F8003E0000F8003E0001F8003F0001F8003F0001F8003F0001F8003F0001F8003F0001F8003
F0000F8003E0000F8003E0000F8003E00007C007C00003C007800001E00F000002F01E00000238
380000060FE00000040000000004000000000C000000000C000000000E000000000E0000000007
00000000078000000003FFFF000003FFFFF00001FFFFFC0000FFFFFE00078000FF000E00001F80
1C000007C038000003C078000003C070000001E0F0000001E0F0000001E0F0000001E0F0000001
E0F0000001E078000003C038000003803C000007801E00000F000700001C0003C0007800007803
C000000FFE000024387EA527>103 D<03E0000000FFE0000000FFE000000007E000000003E000
000003E000000003E000000003E000000003E000000003E000000003E000000003E000000003E0
00000003E000000003E000000003E000000003E000000003E000000003E000000003E000000003
E000000003E000000003E000000003E01FE00003E0607C0003E0801E0003E3000F0003E4000F80
03E4000F8003E800078003E80007C003F00007C003F00007C003E00007C003E00007C003E00007
C003E00007C003E00007C003E00007C003E00007C003E00007C003E00007C003E00007C003E000
07C003E00007C003E00007C003E00007C003E00007C003E00007C003E00007C003E00007C003E0
0007C003E00007C003E00007C003E00007C003E00007C003E00007C007F0000FE0FFFF81FFFFFF
FF81FFFF283C7EBB2C>I<07000F801FC01FC01FC00F8007000000000000000000000000000000
00000000000000000000000007C0FFC0FFC00FC007C007C007C007C007C007C007C007C007C007
C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C0
07C00FE0FFFEFFFE0F397DB815>I<03E0000000FFE0000000FFE000000007E000000003E00000
0003E000000003E000000003E000000003E000000003E000000003E000000003E000000003E000
000003E000000003E000000003E000000003E000000003E000000003E000000003E000000003E0
00000003E000000003E000000003E003FFE003E003FFE003E001FF0003E000FC0003E000F00003
E000E00003E001C00003E003800003E007000003E00E000003E01C000003E038000003E0700000
03E0F0000003E1F0000003E3F8000003E7F8000003EEFC000003FC7E000003F83E000003F03F00
0003E01F800003E01F800003E00FC00003E007C00003E007E00003E003F00003E001F00003E001
F80003E000FC0003E000FC0003E0007E0003E0007F0003E0007F8007F0007FC0FFFF81FFF8FFFF
81FFF8253C7DBB2A>107 D<07C0FFC0FFC00FC007C007C007C007C007C007C007C007C007C007
C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C0
07C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007C007
C007C007C007C007C00FE0FFFEFFFE0F3C7DBB15>I<03E01FE0003FC000FFE0607C00C0F800FF
E0801E01003C0007E3000F06001E0003E4000F88001F0003E4000F88001F0003E8000790000F00
03E80007D0000F8003F00007E0000F8003F00007E0000F8003E00007C0000F8003E00007C0000F
8003E00007C0000F8003E00007C0000F8003E00007C0000F8003E00007C0000F8003E00007C000
0F8003E00007C0000F8003E00007C0000F8003E00007C0000F8003E00007C0000F8003E00007C0
000F8003E00007C0000F8003E00007C0000F8003E00007C0000F8003E00007C0000F8003E00007
C0000F8003E00007C0000F8003E00007C0000F8003E00007C0000F8003E00007C0000F8003E000
07C0000F8003E00007C0000F8003E00007C0000F8007F0000FE0001FC0FFFF81FFFF03FFFEFFFF
81FFFF03FFFE3F257EA443>I<03E01FE000FFE0607C00FFE0801E0007E3000F0003E4000F8003
E4000F8003E800078003E80007C003F00007C003F00007C003E00007C003E00007C003E00007C0
03E00007C003E00007C003E00007C003E00007C003E00007C003E00007C003E00007C003E00007
C003E00007C003E00007C003E00007C003E00007C003E00007C003E00007C003E00007C003E000
07C003E00007C003E00007C003E00007C003E00007C003E00007C007F0000FE0FFFF81FFFFFFFF
81FFFF28257EA42C>I<0007FC0000001C070000007001C00001E000F00003C00078000780003C
000F00001E001F00001F001E00000F003E00000F803E00000F807C000007C07C000007C07C0000
07C0FC000007E0FC000007E0FC000007E0FC000007E0FC000007E0FC000007E0FC000007E0FC00
0007E0FC000007E07C000007C07C000007C07E00000FC03E00000F803E00000F801E00000F001F
00001F000F00001E000780003C0003C000780001E000F000007001C000001C0700000007FC0000
23257EA427>I<03E03FC000FFE0E07800FFE3001C0007E6000F0003E800078003F80003C003F0
0003E003E00001F003E00001F003E00000F803E00000F803E00000FC03E00000FC03E000007C03
E000007E03E000007E03E000007E03E000007E03E000007E03E000007E03E000007E03E000007E
03E000007E03E000007C03E00000FC03E00000FC03E00000F803E00001F803E00001F003E00003
E003F00003E003F80007C003E8000F8003E4000E0003E3003C0003E1C0F00003E03F800003E000
000003E000000003E000000003E000000003E000000003E000000003E000000003E000000003E0
00000003E000000003E000000003E000000003E000000003E000000007F0000000FFFF800000FF
FF80000027367EA42C>I<03E03E00FFE0C300FFE1078007E20FC003E40FC003E80FC003E80780
03E8030003F0000003F0000003F0000003E0000003E0000003E0000003E0000003E0000003E000
0003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0
000003E0000003E0000003E0000003E0000003E0000003E0000003E0000007F00000FFFFC000FF
FFC0001A257EA41E>114 D<00FF02000700C6000C002E0010001E0030001E0060000E0060000E
00E0000600E0000600E0000600F0000600F8000600FC0000007F0000003FF000003FFF80000FFF
E00007FFF00001FFFC00003FFE000001FE0000003F00C0001F00C0000F80C0000780E0000380E0
000380E0000380E0000380F0000300F0000300F8000700F8000600E4000C00E2001800C1807000
807F800019257DA41F>I<00300000003000000030000000300000003000000030000000700000
00700000007000000070000000F0000000F0000001F0000001F0000003F0000007F000001FFFFE
00FFFFFE0001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0
000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001
F0000001F0018001F0018001F0018001F0018001F0018001F0018001F0018001F0018001F00180
00F0010000F8030000F8030000780200003C0400000E08000003F00019357FB41E>I<FFFE0FFF
C03FFEFFFE0FFFC03FFE0FF000FE0007F007E0007C0003E003E0007C0003C003E0003C00018003
E0003E00018001F0003E00030001F0003E00030001F0003F00030000F8003F00060000F8006F00
060000F8006F800600007C006F800C00007C00C7800C00007C00C7C00C00003E01C7C01800003E
0183C01800003E0183E01800001F0383E03000001F0301E03000001F0301F03000000F8701F060
00000F8600F06000000F8600F860000007CE00F8C0000007CC0078C0000007CC007CC0000003FC
007D80000003F8003D80000003F8003F80000001F8003F00000001F0001F00000001F0001F0000
0000F0001E00000000E0000E00000000E0000E000037257FA439>119 D<FFFE003FFE00FFFE00
3FFE0007FC001FF00003F8000F800001F8000F000000F8000E0000007C001C0000007E00180000
003F00300000001F00600000000F80E00000000FC1C000000007E18000000003E30000000003F7
0000000001FE0000000000FC00000000007C00000000007E00000000007F00000000007F000000
0000CF8000000001CFC00000000387E00000000703E00000000601F00000000C01F80000001C00
FC00000038007C00000030003E00000060003F000000E0001F800001E0000F800007E0000FC000
1FF0001FF000FFF8007FFF80FFF8007FFF8029257FA42A>I E /Fk 4 53
df<0080018003001F000300030006000600060006000C000C000C000C001800FF0009107D8F0F>
49 D<078008601420243024302830306000C00180060008003020202070409FC087000C107D8F
0F>I<07C00820143024302430186000C00F80018000C000C000C0C0C0818083007C000C107D8F
0F>I<0030003000600060006000C000C0018001000300064004C008C010C07F8081F001800180
0300030003000C157F8F0F>I E /Fl 16 118 df<0020004000C003C00CC00180018001800180
030003000300030006000600060006000C00FFC00B137C9212>49 D<01F00618080C120C110C22
0C220C240C181800300060018006000800100420047C18C7F081E00E137D9212>I<00F0030C04
040A0609060A0C0C0C0018007003E00030003000300030C0308030806041C03F000F137D9212>
I<00080018001800180030003000300060004000C000800180031002300430083010307F6080FE
0060006000C000C000C000800F197F9212>I<07B00C7010703060606060606060C0C0C0C8C0C8
41C862D03C700D0D7C8C12>97 D<003C000C0018001800180018003007B00C7010703060606060
606060C0C0C0C8C0C841C862D03C700E147C9312>100 D<001C00660064006000C000C000C007
F800C001800180018001800180030003000300030003000200060006000600C400C80070000F1A
81930B>102 D<1E0006000C000C000C000C00180019E01E301830383030303030303060606064
60C460C8C0C8C0700E147D9312>104 D<02060000000000384C4C8C9818183032326464380714
7D930B>I<001800100000000000000000000001C002600430046008600060006000C000C000C0
00C001800180018001800300C300C60078000D1A81930B>I<30F878590D8C4E0E0C9C0E0C980C
0C180C0C180C0C30181830181930183130183260303260301C180D7D8C1C>109
D<30F05B184C189C189818181818183030303230323064606460380F0D7D8C13>I<31F05A184C
109C009800180018003000300030003000600060000D0D7D8C0F>114 D<0700188018C0308038
001E001F0003800180C180810082007C000A0D7D8C0E>I<04000C000C000C001800FF80180018
00300030003000300060006100610062006400380009127D910C>I<38184C184C188C30983018
30183030603064306430E411E80E300E0D7D8C12>I E /Fm 58 123 df<000FF000007FFC0001
F80E0003E01F0007C03F000F803F000F803F000F801E000F800C000F8000000F8000000F800000
0F800000FFFFFF00FFFFFF000F801F000F801F000F801F000F801F000F801F000F801F000F801F
000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F80
1F000F801F007FF0FFE07FF0FFE01B237FA21F>12 D<000FFF00007FFF0001F83F0003E03F0007
C03F000F803F000F801F000F801F000F801F000F801F000F801F000F801F000F801F00FFFFFF00
FFFFFF000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F
000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F000F801F007FF0
FFE07FF0FFE01B237FA21F>I<FFFCFFFCFFFCFFFC0E047F8C13>45 D<387CFEFEFE7C3807077C
8610>I<00FE0007FFC00F83E01F01F03E00F83E00F87C007C7C007C7C007CFC007CFC007EFC00
7EFC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007EFC007E7C007C7C00
7C7C007C3E00F83E00F81F01F00F83E007FFC000FE0017207E9F1C>48 D<00180000780001F800
FFF800FFF80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F800
01F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F80001F800
01F8007FFFE07FFFE013207C9F1C>I<03FC000FFF003C1FC07007E07C07F0FE03F0FE03F8FE03
F8FE01F87C01F83803F80003F80003F00003F00007E00007C0000F80001F00003E000038000070
0000E01801C0180380180700180E00380FFFF01FFFF03FFFF07FFFF0FFFFF0FFFFF015207D9F1C
>I<00FE0007FFC00F07E01E03F03F03F03F81F83F81F83F81F81F03F81F03F00003F00003E000
07C0001F8001FE0001FF000007C00001F00001F80000FC0000FC3C00FE7E00FEFF00FEFF00FEFF
00FEFF00FC7E01FC7801F81E07F00FFFC001FE0017207E9F1C>I<0000E00001E00003E00003E0
0007E0000FE0001FE0001FE00037E00077E000E7E001C7E00187E00307E00707E00E07E00C07E0
1807E03807E07007E0E007E0FFFFFFFFFFFF0007E00007E00007E00007E00007E00007E00007E0
00FFFF00FFFF18207E9F1C>I<3000203E01E03FFFC03FFF803FFF003FFE003FF80033C0003000
0030000030000030000031FC0037FF003E0FC03807E03003E00003F00003F00003F80003F83803
F87C03F8FE03F8FE03F8FC03F0FC03F07007E03007C03C1F800FFF0003F80015207D9F1C>I<00
1F8000FFE003E07007C0F00F01F81F01F83E01F83E01F87E00F07C00007C0000FC0800FC7FC0FC
FFE0FD80F0FF00F8FE007CFE007CFC007EFC007EFC007EFC007E7C007E7C007E7C007E3C007C3E
007C1E00F80F00F00783E003FFC000FF0017207E9F1C>I<6000007800007FFFFE7FFFFE7FFFFC
7FFFF87FFFF87FFFF0E00060E000C0C00180C00300C00300000600000C00001C00001800003800
00780000780000F00000F00000F00001F00001F00001F00003F00003F00003F00003F00003F000
03F00003F00001E00017227DA11C>I<00FE0003FFC00703E00E00F01C00F01C00783C00783E00
783F00783F80783FE0F01FF9E01FFFC00FFF8007FFC003FFE007FFF01E7FF83C1FFC7807FC7801
FEF000FEF0003EF0001EF0001EF0001EF8001C7800383C00381F00F00FFFC001FF0017207E9F1C
>I<01FE0007FF800F83E01E01F03E00F07C00F87C0078FC007CFC007CFC007CFC007EFC007EFC
007EFC007E7C00FE7C00FE3E01FE1E037E0FFE7E07FC7E00207E00007C00007C1E007C3F00F83F
00F83F00F03F01E01E03C01C0F800FFE0003F80017207E9F1C>I<387CFEFEFE7C380000000000
000000387CFEFEFE7C3807167C9510>I<07FC001FFF00380F807007C0F807E0FC07E0FC07E0FC
07E07807E0000FC0001F80001F00003C0000780000700000E00000E00000C00000C00000C00000
C00000C00000C00000000000000000000000000000000001C00003E00007F00007F00007F00003
E00001C00013237DA21A>63 D<000070000000007000000000F800000000F800000000F8000000
01FC00000001FC00000003FE00000003FE00000003FE000000067F000000067F0000000C7F8000
000C3F8000000C3F800000181FC00000181FC00000301FE00000300FE00000700FF000006007F0
00006007F00000C007F80000FFFFF80001FFFFFC00018001FC00018001FC00030001FE00030000
FE00070000FF000600007F000600007F00FFE007FFF8FFE007FFF825227EA12A>65
D<FFFFFF8000FFFFFFF00007F001F80007F000FC0007F0007E0007F0007E0007F0007F0007F000
7F0007F0007F0007F0007F0007F0007F0007F0007E0007F000FE0007F000FC0007F003F80007FF
FFF00007FFFFF00007F001FC0007F0007E0007F0003F0007F0003F8007F0001F8007F0001FC007
F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0003F8007F0003F8007F0007F00
07F001FE00FFFFFFF800FFFFFFC00022227EA128>I<0003FE0080001FFF818000FF01E38001F8
003F8003E0001F8007C0000F800F800007801F800007803F000003803F000003807F000001807E
000001807E00000180FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000
FE00000000FE000000007E000000007E000001807F000001803F000001803F000003801F800003
000F8000030007C000060003F0000C0001F800380000FF00F000001FFFC0000003FE000021227D
A128>I<FFFFFF8000FFFFFFF00007F003FC0007F0007E0007F0003F0007F0001F8007F0000FC0
07F00007E007F00007E007F00007F007F00003F007F00003F007F00003F007F00003F807F00003
F807F00003F807F00003F807F00003F807F00003F807F00003F807F00003F807F00003F807F000
03F007F00003F007F00003F007F00007E007F00007E007F0000FC007F0001F8007F0003F0007F0
007E0007F003FC00FFFFFFF000FFFFFF800025227EA12B>I<FFFFFFF8FFFFFFF807F001F807F0
007807F0003807F0001807F0001C07F0001C07F0000C07F0000C07F0180C07F0180C07F0180007
F0180007F0380007F0780007FFF80007FFF80007F0780007F0380007F0180007F0180007F01800
07F0180007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F00000FFFFC0
00FFFFC0001E227EA123>70 D<0003FE0040001FFFC0C0007F00F1C001F8003FC003F0000FC007
C00007C00FC00003C01F800003C03F000001C03F000001C07F000000C07E000000C07E000000C0
FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE00000000FE000FFF
FC7E000FFFFC7F00001FC07F00001FC03F00001FC03F00001FC01F80001FC00FC0001FC007E000
1FC003F0001FC001FC003FC0007F80E7C0001FFFC3C00003FF00C026227DA12C>I<FFFF83FFFE
FFFF83FFFE07F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001F
C007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007FFFFFFC007FFFF
FFC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0
001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC007F0001FC0FF
FF83FFFEFFFF83FFFE27227EA12C>I<FFFF80FFFF8007F00007F00007F00007F00007F00007F0
0007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F0
0007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F000FFFF80FFFF
8011227EA115>I<FFFFC000FFFFC00007F0000007F0000007F0000007F0000007F0000007F000
0007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0
000007F0000007F0000007F0000007F0001807F0001807F0001807F0001807F0003807F0003807
F0007007F0007007F000F007F001F007F007F0FFFFFFF0FFFFFFF01D227EA122>76
D<FFF000000FFFFFF800001FFF07F800001FE006FC000037E006FC000037E006FC000037E0067E
000067E0067E000067E0063F0000C7E0063F0000C7E0061F800187E0061F800187E0060FC00307
E0060FC00307E0060FC00307E00607E00607E00607E00607E00603F00C07E00603F00C07E00601
F81807E00601F81807E00601F81807E00600FC3007E00600FC3007E006007E6007E006007E6007
E006003FC007E006003FC007E006001F8007E006001F8007E006001F8007E006000F0007E0FFF0
0F00FFFFFFF00600FFFF30227EA135>I<0007FC0000003FFF800000FC07E00003F001F80007E0
00FC000FC0007E001F80003F001F80003F003F00001F803F00001F807F00001FC07E00000FC07E
00000FC0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0
FE00000FE0FE00000FE07E00000FC07F00001FC07F00001FC03F00001F803F80003F801F80003F
000FC0007E0007E000FC0003F001F80000FC07E000003FFF80000007FC000023227DA12A>79
D<FFFFFF00FFFFFFE007F007F007F001FC07F000FC07F0007E07F0007E07F0007F07F0007F07F0
007F07F0007F07F0007F07F0007E07F0007E07F000FC07F001FC07F007F007FFFFE007FFFF0007
F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F00000
07F0000007F0000007F00000FFFF8000FFFF800020227EA126>I<FFFFFE0000FFFFFFC00007F0
07F00007F001F80007F000FC0007F0007E0007F0007F0007F0007F0007F0007F0007F0007F0007
F0007F0007F0007F0007F0007E0007F000FC0007F001F80007F007F00007FFFFC00007FFFF8000
07F00FE00007F007F00007F003F80007F001FC0007F001FC0007F001FC0007F001FC0007F001FC
0007F001FC0007F001FC0007F001FC0007F001FC0607F000FE0607F000FF0CFFFF803FF8FFFF80
0FF027227EA12A>82 D<01FE0207FF861F01FE3C007E7C001E78000E78000EF80006F80006FC00
06FC0000FF0000FFE0007FFF007FFFC03FFFF01FFFF80FFFFC03FFFE003FFE0003FE00007F0000
3F00003FC0001FC0001FC0001FE0001EE0001EF0003CFC003CFF00F8C7FFE080FF8018227DA11F
>I<7FFFFFFF807FFFFFFF807E03F80F807803F807807003F803806003F80180E003F801C0E003
F801C0C003F800C0C003F800C0C003F800C0C003F800C00003F800000003F800000003F8000000
03F800000003F800000003F800000003F800000003F800000003F800000003F800000003F80000
0003F800000003F800000003F800000003F800000003F800000003F800000003F800000003F800
000003F8000001FFFFF00001FFFFF00022227EA127>I<FFFF803FFCFFFF803FFC07F000018007
F000018007F000018007F000018007F000018007F000018007F000018007F000018007F0000180
07F000018007F000018007F000018007F000018007F000018007F000018007F000018007F00001
8007F000018007F000018007F000018007F000018007F000018007F000018007F000018003F000
030003F800030001F800060000FC000E00007E001C00003F80F800000FFFE0000001FF00002622
7EA12B>I<FFFF000FFEFFFF000FFE07F00000C007F00000C003F800018003F800018003FC0003
8001FC00030001FE00030000FE00060000FF000600007F000C00007F000C00007F801C00003F80
1800003FC03800001FC03000001FE03000000FE06000000FE060000007F0C0000007F0C0000007
F9C0000003F980000003FD80000001FF00000001FF00000000FE00000000FE00000000FE000000
007C000000007C00000000380000000038000027227FA12A>I<0FFC003FFF807E07C07E03E07E
01E07E01F03C01F00001F00001F0003FF003FDF01FC1F03F01F07E01F0FC01F0FC01F0FC01F0FC
01F07E02F07E0CF81FF87F07E03F18167E951B>97 D<FF000000FF0000001F0000001F0000001F
0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0FE000
1F3FF8001FE07C001F803E001F001F001F000F801F000F801F000FC01F000FC01F000FC01F000F
C01F000FC01F000FC01F000FC01F000FC01F000F801F001F801F801F001FC03E001EE07C001C3F
F800180FC0001A237EA21F>I<00FF8007FFE00F83F01F03F03E03F07E03F07C01E07C0000FC00
00FC0000FC0000FC0000FC0000FC00007C00007E00007E00003E00181F00300FC06007FFC000FF
0015167E9519>I<0001FE000001FE0000003E0000003E0000003E0000003E0000003E0000003E
0000003E0000003E0000003E0000003E0000003E0001FC3E0007FFBE000F81FE001F007E003E00
3E007E003E007C003E00FC003E00FC003E00FC003E00FC003E00FC003E00FC003E00FC003E00FC
003E007C003E007C003E003E007E001F00FE000F83BE0007FF3FC001FC3FC01A237EA21F>I<00
FE0007FF800F87C01E01E03E01F07C00F07C00F8FC00F8FC00F8FFFFF8FFFFF8FC0000FC0000FC
00007C00007C00007E00003E00181F00300FC07003FFC000FF0015167E951A>I<001FC0007FE0
00F1F001E3F003E3F007C3F007C1E007C00007C00007C00007C00007C00007C000FFFE00FFFE00
07C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C000
07C00007C00007C00007C00007C0003FFC003FFC00142380A211>I<01FE0F0007FFBF800F87C7
801F03E7801E01E0003E01F0003E01F0003E01F0003E01F0003E01F0001E01E0001F03E0000F87
C0000FFF800009FE000018000000180000001C0000001FFFE0000FFFF80007FFFE001FFFFF003C
003F0078000F80F0000780F0000780F0000780F000078078000F003C001E001F007C000FFFF800
01FFC00019217F951C>I<FF000000FF0000001F0000001F0000001F0000001F0000001F000000
1F0000001F0000001F0000001F0000001F0000001F0000001F07E0001F1FF8001F307C001F403C
001F803E001F803E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F00
3E001F003E001F003E001F003E001F003E001F003E001F003E00FFE1FFC0FFE1FFC01A237EA21F
>I<1C003E007F007F007F003E001C000000000000000000000000000000FF00FF001F001F001F
001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F00FFE0FFE00B247EA3
10>I<0038007C00FE00FE00FE007C0038000000000000000000000000000003FE03FE003E003E
003E003E003E003E003E003E003E003E003E003E003E003E003E003E003E003E003E003E003E00
3E003E783EFC3EFC3CFC7C78F87FE01F800F2E83A311>I<FF000000FF0000001F0000001F0000
001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F0000001F00
FF801F00FF801F0038001F0060001F01C0001F0380001F0700001F0E00001F1C00001F7E00001F
FF00001FCF00001F0F80001F07C0001F03E0001F01E0001F01F0001F00F8001F007C001F003C00
FFE0FFC0FFE0FFC01A237EA21E>I<FF00FF001F001F001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F
001F00FFE0FFE00B237EA210>I<FF07F007F000FF1FFC1FFC001F303E303E001F403E403E001F
801F801F001F801F801F001F001F001F001F001F001F001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F
001F001F001F001F001F001F001F001F00FFE0FFE0FFE0FFE0FFE0FFE02B167E9530>I<FF07E0
00FF1FF8001F307C001F403C001F803E001F803E001F003E001F003E001F003E001F003E001F00
3E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E00FF
E1FFC0FFE1FFC01A167E951F>I<00FE0007FFC00F83E01E00F03E00F87C007C7C007C7C007CFC
007EFC007EFC007EFC007EFC007EFC007EFC007E7C007C7C007C3E00F81F01F00F83E007FFC000
FE0017167E951C>I<FF0FE000FF3FF8001FE07C001F803E001F001F001F001F801F001F801F00
0FC01F000FC01F000FC01F000FC01F000FC01F000FC01F000FC01F000FC01F001F801F001F801F
803F001FC03E001FE0FC001F3FF8001F0FC0001F0000001F0000001F0000001F0000001F000000
1F0000001F0000001F000000FFE00000FFE000001A207E951F>I<FE1F00FE3FC01E67E01EC7E0
1E87E01E87E01F83C01F00001F00001F00001F00001F00001F00001F00001F00001F00001F0000
1F00001F00001F0000FFF000FFF00013167E9517>114 D<0FF3003FFF00781F00600700E00300
E00300F00300FC00007FE0007FF8003FFE000FFF0001FF00000F80C00780C00380E00380E00380
F00700FC0E00EFFC00C7F00011167E9516>I<0180000180000180000180000380000380000780
000780000F80003F8000FFFF00FFFF000F80000F80000F80000F80000F80000F80000F80000F80
000F80000F80000F80000F81800F81800F81800F81800F81800F830007C30003FE0000F8001120
7F9F16>I<FF01FE00FF01FE001F003E001F003E001F003E001F003E001F003E001F003E001F00
3E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F003E001F007E001F
00FE000F81BE0007FF3FC001FC3FC01A167E951F>I<FFE01FE0FFE01FE01F8007000F8006000F
C00E0007C00C0007E00C0003E0180003E0180001F0300001F0300000F8600000F86000007CC000
007CC000007FC000003F8000003F8000001F0000001F0000000E0000000E00001B167F951E>I<
FFE3FF07F8FFE3FF07F81F007800C01F807C01C00F807C01800F807C018007C07E030007C0DE03
0007C0DE070003E1DF060003E18F060001F18F8C0001F3078C0001F3078C0000FF07D80000FE03
D80000FE03F800007C01F000007C01F000003C01E000003800E000003800E00025167F9528>I<
FFE07FC0FFE07FC00F801C0007C0380003E0700003F0600001F8C00000F98000007F8000003F00
00001F0000001F8000003FC0000037C0000063E00000C1F00001C0F8000380FC0007007E000E00
3E00FF80FFE0FF80FFE01B167F951E>I<FFE01FE0FFE01FE01F8007000F8006000FC00E0007C0
0C0007E00C0003E0180003E0180001F0300001F0300000F8600000F86000007CC000007CC00000
7FC000003F8000003F8000001F0000001F0000000E0000000E0000000C0000000C000000180000
78180000FC380000FC300000FC60000069C000007F8000001F0000001B207F951E>I<7FFFF07F
FFF07C03E07007C0600FC0E01F80C01F00C03E00C07E0000FC0000F80001F00003F03007E03007
C0300F80701F80703F00603E00E07C03E0FFFFE0FFFFE014167E9519>I
E /Fn 54 123 df<00003F03E00000C384700001878CF000038798F00003033860000700380000
0700380000070038000007007000000E007000000E007000000E00700000FFFFFF00000E00E000
001C00E000001C00E000001C00E000001C00E000001C01C000003801C000003801C000003801C0
00003801C000003801C0000070038000007003800000700380000070038000007003800000E007
000000E007000000E007000000E007000000C00E000001C00E000001C00C000031860C0000798F
180000F31E100000620C6000003C07C000002429829F1C>11 D<00003FE00000E0100001803800
0380780003807800070030000700000007000000070000000E0000000E0000000E000000FFFFE0
000E00E0001C01C0001C01C0001C01C0001C01C0001C0380003803800038038000380380003807
0000380700007807000070071000700E2000700E2000700E2000600E2000E0064000E0038000E0
000000C0000000C0000001C000003180000079800000F3000000620000003C0000001D29829F1A
>I<00003FCE0000E0EE000181FC000381FC000300DC0007001C00070038000700380007003800
0E0038000E0070000E007000FFFFF0000E0070001C00E0001C00E0001C00E0001C00E0001C01C0
003801C0003801C0003801C0003803800038038000700380007003880070071000700710007007
1000E0071000E0032000E001C000E0000000C0000001C0000001C000003180000079800000F300
0000620000003C0000001F29829F1B>I<00E001F001F003E003E003E003C003C003C003800780
0700070007000600060006000C000C000C00080008000800000000000000000000007000F800F8
00F000E0000C217BA00E>33 D<1C3E7E7E3A020404080810204080070E769F0E>39
D<000100020004000800100020006000C0018001800300070006000E000C001C00180038003800
30007000700060006000E000E000C000C000C000C000C000C000C000C000C000C000C000C000C0
004000600060002000100010000800102E79A113>I<0010000008000004000006000002000003
000003000003000001000001800001800001800001800001800001800001800003800003800003
80000300000300000300000700000700000600000600000E00000C00000C00001C000018000038
0000300000700000600000E00000C0000180000100000300000600000C00001800003000006000
00800000112E80A113>I<1C3C3C3C3C040408081020204080060E7D840E>44
D<7FF0FFE07FE00C037D8A10>I<70F8F8F0E005057B840E>I<000F800030E000E07001C0700380
300380380700380F00780F00780E00781E00781E00703C00F03C00F03C00F03C00F07801E07801
E07801E07801C07003C0F003C0F00380F00780F00700700700700E00701C003038001870000FC0
00151F7C9D17>48 D<000200020006000E003C00DC031C001C0038003800380038007000700070
007000E000E000E000E001C001C001C001C003800380038003800780FFF80F1E7B9D17>I<070F
1F1F0E0000000000000000000070F8F8F0E008147B930E>58 D<00000200000006000000060000
000E0000001E0000001E0000003F0000002F0000004F000000CF0000008F0000010F0000010F00
00020F0000020F0000040F0000080F0000080F0000100F800010078000200780003FFF80004007
80008007800080078001000780010007800200078006000780040007801E0007C0FF807FF81D20
7E9F22>65 D<0000FE0200078186001C004C0038003C0060003C00C0001C01C000180380001807
0000180F0000181E0000101E0000103C0000003C00000078000000780000007800000078000000
F0000000F0000000F0000000F0000000F000008070000080700000807000010038000100380002
00180004000C001800060020000381C00000FE00001F217A9F21>67 D<00FFFF80001E00E0001E
0070001E0038001E001C003C001C003C000E003C000E003C000E0078000E0078000E0078000E00
78000E00F0001E00F0001E00F0001E00F0001E01E0003C01E0003C01E0003C01E0007803C00070
03C0007003C000E003C001C0078003C00780038007800E0007801C000F007000FFFFC0001F1F7D
9E22>I<01FFFFFE001E001C001E000C001E0004001E0004003C0004003C0004003C0004003C00
0400780408007804000078040000780C0000F0180000FFF80000F0180000F0180001E0100001E0
100001E0100001E0001003C0002003C0002003C0004003C0004007800080078001800780010007
8007000F001F00FFFFFE001F1F7D9E1F>I<01FFFFFC001E0038001E0018001E0008001E000800
3C0008003C0008003C0008003C00080078001000780800007808000078080000F0100000F03000
00FFF00000F0300001E0200001E0200001E0200001E0200003C0000003C0000003C0000003C000
00078000000780000007800000078000000F800000FFF800001E1F7D9E1E>I<0000FC04000703
0C001C00980030007800E0007801C000380380003003800030070000300E0000301E0000201E00
00203C0000003C00000078000000780000007800000078000000F0000000F000FFF0F0000780F0
000780F0000F0070000F0070000F0070000F0070001E0038001E0018003E001C002E000E00CC00
0383040000FC00001E217A9F23>I<00FFF1FFE0001F003E00001E003C00001E003C00001E003C
00003C007800003C007800003C007800003C007800007800F000007800F000007800F000007800
F00000F001E00000FFFFE00000F001E00000F001E00001E003C00001E003C00001E003C00001E0
03C00003C007800003C007800003C007800003C007800007800F000007800F000007800F000007
800F00000F801F0000FFF1FFE000231F7D9E22>I<01FFF0001F00001E00001E00001E00003C00
003C00003C00003C0000780000780000780000780000F00000F00000F00000F00001E00001E000
01E00001E00003C00003C00003C00003C0000780000780000780000780000F8000FFF000141F7D
9E12>I<01FFF800001F0000001E0000001E0000001E0000003C0000003C0000003C0000003C00
000078000000780000007800000078000000F0000000F0000000F0000000F0000001E0000001E0
000001E0000001E0008003C0010003C0010003C0030003C00200078006000780060007800C0007
801C000F007800FFFFF800191F7D9E1D>76 D<0001FC0000070700001C01C0003000E000E00060
01C000700380007007800038070000380E0000381E0000381C0000383C0000383C000038780000
78780000787800007878000078F00000F0F00000F0F00000E0F00001E0F00001C0F00003C07000
03807000070078000F0038001E0038003C001C0070000E00E0000783800001FC00001D217A9F23
>79 D<01FFFF80001E00E0001E0070001E0038001E003C003C003C003C003C003C003C003C003C
0078007800780078007800F0007800E000F003C000F00F0000FFFC0000F0000001E0000001E000
0001E0000001E0000003C0000003C0000003C0000003C000000780000007800000078000000780
00000F800000FFF000001E1F7D9E1F>I<00FFFF00001E03C0001E00E0001E0070001E0078003C
0078003C0078003C0078003C0078007800F0007800F0007801E0007801C000F0070000F01E0000
FFF00000F01C0001E00E0001E00F0001E0070001E0078003C00F0003C00F0003C00F0003C00F00
07801E0007801E0807801E0807801E100F800E10FFF00E20000003C01D207D9E21>82
D<0007E040001C18C0003005800060038000C0038001C001800180010003800100038001000380
01000380000003C0000003C0000003F8000001FF800001FFE000007FF000001FF0000001F80000
00780000007800000038000000380020003800200038002000300060007000600060006000E000
7000C000E8038000C606000081F800001A217D9F1A>I<0FFFFFFC1E03C0381803C0181003C008
2003C00820078008600780084007800840078008800F0010000F0000000F0000000F0000001E00
00001E0000001E0000001E0000003C0000003C0000003C0000003C000000780000007800000078
00000078000000F0000000F0000000F0000000F0000001F000007FFF80001E1F799E21>I<3FFC
0FF807C003C00780010007800100078001000F0002000F0002000F0002000F0002001E0004001E
0004001E0004001E0004003C0008003C0008003C0008003C000800780010007800100078001000
78001000F0002000F0002000F0002000F0004000F0004000700080007001000030020000380400
000C18000007E000001D20779E22>I<00F1800389C00707800E03801C03803C03803807007807
00780700780700F00E00F00E00F00E00F00E20F01C40F01C40703C40705C40308C800F07001314
7C9317>97 D<07803F8007000700070007000E000E000E000E001C001C001CF01D0C3A0E3C0E38
0F380F700F700F700F700FE01EE01EE01EE01CE03CE038607060E031C01F0010207B9F15>I<00
7E0001C1000300800E07801E07801C07003C0200780000780000780000F00000F00000F00000F0
0000F0000070010070020030040018380007C00011147C9315>I<0000780003F8000070000070
0000700000700000E00000E00000E00000E00001C00001C000F1C00389C00707800E03801C0380
3C0380380700780700780700780700F00E00F00E00F00E00F00E20F01C40F01C40703C40705C40
308C800F070015207C9F17>I<007C01C207010E011C013C013802780C7BF07C00F000F000F000
F0007000700170023804183807C010147C9315>I<00007800019C00033C00033C000718000700
000700000E00000E00000E00000E00000E0000FFE0001C00001C00001C00001C00003800003800
00380000380000380000700000700000700000700000700000E00000E00000E00000E00000E000
01C00001C00001C0000180003180007B0000F300006600003C00001629829F0E>I<001E300071
3800E0F001C0700380700780700700E00F00E00F00E00F00E01E01C01E01C01E01C01E01C01E03
801E03800E07800E0B8006170001E700000700000700000E00000E00300E00781C00F038006070
003FC000151D7F9315>I<01E0000FE00001C00001C00001C00001C00003800003800003800003
8000070000070000071E000763000E81800F01C00E01C00E01C01C03801C03801C03801C038038
0700380700380700380E10700E20700E20701C20700C40E00C8060070014207D9F17>I<00C001
E001E001C000000000000000000000000000000E001300230043804700470087000E000E000E00
1C001C001C003840388038807080310032001C000B1F7C9E0E>I<0001800003C00003C0000380
000000000000000000000000000000000000000000003C00004600008700008700010700010700
020E00000E00000E00000E00001C00001C00001C00001C00003800003800003800003800007000
00700000700000700000E00000E00030E00079C000F180006300003C00001228829E0E>I<01E0
000FE00001C00001C00001C00001C0000380000380000380000380000700000700000703C00704
200E08E00E11E00E21E00E40C01C80001D00001E00001FC00038E0003870003870003838407070
80707080707080703100E03100601E0013207D9F15>I<03C01FC0038003800380038007000700
070007000E000E000E000E001C001C001C001C0038003800380038007000700070007100E200E2
00E200E200640038000A207C9F0C>I<1C0F80F0002630C318004740640C004780680E00470070
0E004700700E008E00E01C000E00E01C000E00E01C000E00E01C001C01C038001C01C038001C01
C038001C01C0708038038071003803807100380380E10038038062007007006400300300380021
147C9325>I<1C0F802630C04740604780604700704700708E00E00E00E00E00E00E00E01C01C0
1C01C01C01C01C03843803883803883807083803107003303001C016147C931A>I<007C0001C3
000301800E01C01E01C01C01E03C01E07801E07801E07801E0F003C0F003C0F003C0F00780F007
00700F00700E0030180018700007C00013147C9317>I<01C1E002621804741C04781C04701E04
701E08E01E00E01E00E01E00E01E01C03C01C03C01C03C01C0380380780380700380E003C1C007
2380071E000700000700000E00000E00000E00000E00001C00001C0000FF8000171D809317>I<
00F0400388C00705800E03801C03803C0380380700780700780700780700F00E00F00E00F00E00
F00E00F01C00F01C00703C00705C0030B8000F3800003800003800007000007000007000007000
00E00000E0000FFE00121D7C9315>I<1C1E002661002783804787804707804703008E00000E00
000E00000E00001C00001C00001C00001C00003800003800003800003800007000003000001114
7C9313>I<00FC030206010C030C070C060C000F800FF007F803FC003E000E700EF00CF00CE008
401020601F8010147D9313>I<018001C0038003800380038007000700FFF007000E000E000E00
0E001C001C001C001C003800380038003820704070407080708031001E000C1C7C9B0F>I<0E00
C01300E02301C04381C04701C04701C08703800E03800E03800E03801C07001C07001C07001C07
101C0E20180E20180E201C1E400C264007C38014147C9318>I<0E03801307802307C04383C047
01C04700C08700800E00800E00800E00801C01001C01001C01001C02001C02001C04001C04001C
08000E300003C00012147C9315>I<0E00C1C01300E3C02301C3E04381C1E04701C0E04701C060
870380400E0380400E0380400E0380401C0700801C0700801C0700801C0701001C0701001C0601
001C0F02000C0F04000E13080003E1F0001B147C931E>I<0383800CC4401068E01071E02071E0
2070C040E00000E00000E00000E00001C00001C00001C00001C040638080F38080F38100E58100
84C60078780013147D9315>I<0E00C01300E02301C04381C04701C04701C08703800E03800E03
800E03801C07001C07001C07001C07001C0E00180E00180E001C1E000C3C0007DC00001C00001C
00003800F03800F07000E06000C0C0004380003E0000131D7C9316>I<01C04003E08007F1800C
1F000802000004000008000010000020000040000080000100000200000401000802001002003E
0C0063FC0041F80080E00012147D9313>I E /Fo 15 107 df<FFFFFFC0FFFFFFC01A027C8B23>
0 D<000FC000007138000181060002010100040100800801004010010020100100202001001040
0100084001000840010008800100048001000480010004FFFFFFFC800100048001000480010004
800100044001000840010008400100082001001010010020100100200801004004010080020101
000181060000713800000FC0001E207E9A23>8 D<03F0000FFC001FFE003FFF007FFF807FFF80
FFFFC0FFFFC0FFFFC0FFFFC0FFFFC0FFFFC07FFF807FFF803FFF001FFE000FFC0003F00012127E
9317>15 D<000000C0000003C000000F0000003C000000F0000003C00000070000001C00000078
000001E00000078000001E00000078000000E0000000780000001E0000000780000001E0000000
780000001C0000000700000003C0000000F00000003C0000000F00000003C0000000C000000000
0000000000000000000000000000000000000000000000007FFFFF80FFFFFFC01A247C9C23>20
D<C0000000F00000003C0000000F00000003C0000000F0000000380000000E0000000780000001
E0000000780000001E0000000780000001C00000078000001E00000078000001E0000007800000
0E00000038000000F0000003C000000F0000003C00000070000000C00000000000000000000000
00000000000000000000000000000000000000007FFFFF80FFFFFFC01A247C9C23>I<00000006
0000000006000000000600000000030000000003000000000380000000018000000000C0000000
006000000000700000000018FFFFFFFFFFFFFFFFFFFF0000000018000000007000000000600000
0000C0000000018000000003800000000300000000030000000006000000000600000000060028
187E962D>33 D<000000C000000000C00000000060000000006000000000300000000018000000
000C007FFFFFFE00FFFFFFFF0000000001C000000000E0000000003C000000000F000000003C00
0000007000000001C00000000380FFFFFFFE007FFFFFFC00000000180000000018000000003000
00000060000000006000000000C000000000C000281A7E972D>41 D<003FF800FFF803C0000700
000C0000180000300000300000600000600000C00000C00000C00000FFFFF8FFFFF8C00000C000
00C000006000006000003000003000001800000C000007000003C00000FFF8003FF8151C7C981E
>50 D<00000C00000C0000180000180000300000300000600000600000C00000C0000180000180
000180000300000300000600000600000C00000C00001800001800003000003000006000006000
00C00000C0000180000180000300000300000600000600000600000C00000C0000180000180000
300000300000600000600000C00000400000162C7AA000>54 D<C0C0C0C0C0C0C0E0E0C0C0C0C0
C0C0C003107E9200>I<000F0038006000E001C001C001C001C001C001C001C001C001C001C001
C001C001C001C001C0038007001E00F8001E000700038001C001C001C001C001C001C001C001C0
01C001C001C001C001C001C001C000E000600038000F102D7DA117>102
D<F8001E000700038001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C0
00E000600038000F0038006000E001C001C001C001C001C001C001C001C001C001C001C001C001
C001C001C0038007001E00F800102D7DA117>I<0020006000C000C000C0018001800300030003
00060006000C000C0018001800180030003000600060006000C000C00060006000600030003000
1800180018000C000C00060006000300030003000180018000C000C000C0006000200B2E7CA112
>I<C000C000600060006000300030001800180018000C000C0006000600030003000300018001
8000C000C000C00060006000C000C000C001800180030003000300060006000C000C0018001800
180030003000600060006000C000C0000B2E7EA112>I<C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0022D7BA10D>I
E /Fp 87 126 df<030600078F00078F00078F00078F00078F00078F007FFFC0FFFFE0FFFFE07F
FFC00F1E000F1E000F1E000F1E000F1E000F1E007FFFC0FFFFE0FFFFE07FFFC01E3C001E3C001E
3C001E3C001E3C001E3C000C1800131C7E9B18>35 D<00C00001C00001C00001C00003F0000FFC
003FFE007DCF0071C700E1C380E1C780E1C780E1C780F1C00079C0003FC0001FE0000FF80001FC
0001DE0001CF0001C70061C380F1C380F1C380E1C380E1C70071C70079DE003FFE001FF80007E0
0001C00001C00001C00000C00011247D9F18>I<3803007C07807C0780EE0F80EE0F00EE0F00EE
1F00EE1E00EE1E00EE3E007C3C007C3C00387C0000780000780000F80000F00001F00001E00001
E00003E00003C00003C00007C0000783800787C00F87C00F0EE00F0EE01F0EE01E0EE01E0EE03E
0EE03C07C03C07C018038013247E9F18>I<01C00007E0000FF0000E70001C38001C38001C3800
1C38001C73F81CF3F81CE3F80FC1C00FC3800F83800F03801F07003F87007B8E0071CE00E1FC00
E0FC00E07C00E07870E0787070FE707FFFE03FC7E00F03C0151C7F9B18>I<387C7C7E3E0E0E0E
1C1C38F8F0C0070E789B18>I<007000F001E003C007800F001E001C0038003800700070007000
7000E000E000E000E000E000E000E000E0007000700070007000380038001C001E000F00078003
C001F000F000700C24799F18>I<6000F00078003C001E000F000780038001C001C000E000E000
E000E00070007000700070007000700070007000E000E000E000E001C001C0038007800F001E00
3C007800F00060000C247C9F18>I<01C00001C00001C00001C00041C100F1C780FDDF807FFF00
1FFC0007F00007F0001FFC007FFF00FDDF80F1C78041C10001C00001C00001C00001C00011147D
9718>I<00600000F00000F00000F00000F00000F00000F00000F0007FFFC0FFFFE0FFFFE07FFF
C000F00000F00000F00000F00000F00000F00000F00000600013147E9718>I<1C3E7E7F3F1F07
0E1E7CF860080C788518>I<7FFFC0FFFFE0FFFFE07FFFC013047E8F18>I<3078FCFC7830060677
8518>I<000300000780000780000F80000F00001F00001E00001E00003E00003C00007C000078
0000780000F80000F00001F00001E00003E00003C00003C00007C0000780000F80000F00000F00
001F00001E00003E00003C00003C00007C0000780000F80000F00000F0000060000011247D9F18
>I<01F00007FC000FFE001F1F001C07003803807803C07001C07001C0E000E0E000E0E000E0E0
00E0E000E0E000E0E000E0E000E0E000E0F001E07001C07001C07803C03803801C07001F1F000F
FE0007FC0001F000131C7E9B18>I<01800380038007800F803F80FF80FB804380038003800380
03800380038003800380038003800380038003800380038003807FFCFFFE7FFC0F1C7B9B18>I<
03F0000FFE003FFF007C0F807003C0E001C0F000E0F000E06000E00000E00000E00001C00001C0
0003C0000780000F00001E00003C0000780000F00001E00007C0000F80001E00E03C00E07FFFE0
FFFFE07FFFE0131C7E9B18>I<07F8001FFE003FFF007807807803C07801C03001C00001C00003
80000380000F0003FF0003FE0003FF000007800003C00001C00000E00000E00000E0F000E0F000
E0F001C0F003C07C07803FFF001FFE0003F800131C7E9B18>I<001F00003F0000770000770000
E70001E70001C7000387000787000707000E07001E07003C0700380700780700F00700FFFFF8FF
FFF8FFFFF8000700000700000700000700000700000700007FF0007FF0007FF0151C7F9B18>I<
3FFF803FFF803FFF803800003800003800003800003800003800003800003800003BF8003FFE00
3FFF003C07803003C00001C00000E00000E06000E0F000E0F000E0E001C07003C07C0F803FFF00
1FFC0003F000131C7E9B18>I<007E0001FF0007FF800F83C01E03C01C03C03801803800007000
00700000E1F800E7FE00FFFF00FE0780F803C0F001C0F000E0E000E0F000E07000E07000E07000
E03801C03C03C01E07800FFF0007FE0001F800131C7E9B18>I<E00000FFFFE0FFFFE0FFFFC0E0
0380E00700000F00001E00001C0000380000380000700000F00000E00000E00001C00001C00001
C000038000038000038000038000070000070000070000070000070000070000070000131D7E9C
18>I<03F8000FFE001FFF003E0F803803807001C07001C07001C07001C03803803C07801FFF00
07FC000FFE001F1F003C07807001C0F001E0E000E0E000E0E000E0E000E07001C07803C03E0F80
1FFF000FFE0003F800131C7E9B18>I<03F0000FFC001FFE003C0F00780780700380E001C0E001
C0E001C0E001E0E001E07001E07803E03C0FE01FFFE00FFEE003F0E00000E00001C00001C00001
C0300380780780780F00783E003FFC001FF00007C000131C7E9B18>I<3078FCFC783000000000
000000003078FCFC78300614779318>I<183C7E7E3C180000000000000000183C7E7E3E1E0E1C
3C78F060071A789318>I<0000C00003E00007E0001FC0003F8000FE0001FC0007F0000FE0003F
80007F0000FC0000FC00007F00003F80000FE00007F00001FC0000FE00003F80001FC00007E000
03E00000C013187E9918>I<7FFFC0FFFFE0FFFFE0FFFFE0000000000000000000000000FFFFE0
FFFFE0FFFFE07FFFC0130C7E9318>I<600000F80000FC00007F00003F80000FE00007F00001FC
0000FE00003F80001FC00007E00007E0001FC0003F8000FE0001FC0007F0000FE0003F80007F00
00FC0000F8000060000013187E9918>I<007C0001FE0007FF000F87801E03C03C1DC0387FC070
FFE071E3E071C1E0E1C1E0E380E0E380E0E380E0E380E0E380E0E380E0E1C1C071C1C071E3C070
FF80387F003C1C001E00E00F83E007FFC001FF80007E00131C7E9B18>64
D<00700000F80000F80000D80000D80001DC0001DC0001DC00018C00038E00038E00038E00038E
000707000707000707000707000707000FFF800FFF800FFF800E03801C01C01C01C01C01C07F07
F0FF07F87F07F0151C7F9B18>I<7FFC00FFFF007FFF801C03C01C01C01C00E01C00E01C00E01C
00E01C01E01C01C01C07C01FFF801FFF001FFFC01C03C01C00E01C00F01C00701C00701C00701C
00701C00F01C00E01C03E07FFFC0FFFF807FFE00141C7F9B18>I<00F8E003FEE007FFE00F07E0
1E03E03C01E03800E07000E07000E0700000E00000E00000E00000E00000E00000E00000E00000
E000007000007000E07000E03800E03C00E01E01C00F07C007FF8003FE0000F800131C7E9B18>
I<7FF800FFFE007FFF001C0F801C03C01C03C01C01E01C00E01C00E01C00F01C00701C00701C00
701C00701C00701C00701C00701C00701C00F01C00E01C00E01C01E01C01C01C03C01C0F807FFF
00FFFE007FF800141C7F9B18>I<FFFFF0FFFFF0FFFFF01C00701C00701C00701C00701C00001C
00001C0E001C0E001C0E001FFE001FFE001FFE001C0E001C0E001C0E001C00001C00001C00381C
00381C00381C00381C0038FFFFF8FFFFF8FFFFF8151C7F9B18>I<FFFFF8FFFFF8FFFFF81C0038
1C00381C00381C00381C00001C00001C07001C07001C07001FFF001FFF001FFF001C07001C0700
1C07001C00001C00001C00001C00001C00001C00001C0000FFC000FFC000FFC000151C7F9B18>
I<01F1C003FDC00FFFC01F0FC01C03C03803C03801C07001C07001C0700000E00000E00000E000
00E00000E00000E00FF0E01FF0E00FF07001C07001C07003C03803C03803C01C07C01F0FC00FFF
C003FDC001F1C0141C7E9B18>I<7F07F0FF8FF87F07F01C01C01C01C01C01C01C01C01C01C01C
01C01C01C01C01C01C01C01FFFC01FFFC01FFFC01C01C01C01C01C01C01C01C01C01C01C01C01C
01C01C01C01C01C01C01C07F07F0FF8FF87F07F0151C7F9B18>I<7FFF00FFFF807FFF0001C000
01C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C000
01C00001C00001C00001C00001C00001C00001C00001C0007FFF00FFFF807FFF00111C7D9B18>
I<01FFC001FFC001FFC0000E00000E00000E00000E00000E00000E00000E00000E00000E00000E
00000E00000E00000E00000E00000E00000E00000E00000E00000E00F00E00F00E00F03C007FFC
003FF0000FC000121C7D9B18>I<7F07F0FF87F87F07F01C03C01C07801C07001C0E001C1E001C
3C001C38001C70001CF0001DF0001DF0001FB8001FB8001F1C001E1C001C0E001C0E001C07001C
07001C03801C03801C01C07F03F0FF87F87F03F0151C7F9B18>I<FFC000FFC000FFC0001C0000
1C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C0000
1C00001C00001C00001C00E01C00E01C00E01C00E01C00E0FFFFE0FFFFE0FFFFE0131C7E9B18>
I<FC01F8FE03F8FE03F83B06E03B06E03B06E03B06E03B8EE03B8EE0398CE0398CE039DCE039DC
E039DCE038D8E038D8E038F8E03870E03870E03800E03800E03800E03800E03800E03800E0FE03
F8FE03F8FE03F8151C7F9B18>I<7E07F0FF0FF87F07F01D81C01D81C01D81C01DC1C01CC1C01C
C1C01CE1C01CE1C01CE1C01C61C01C71C01C71C01C31C01C39C01C39C01C39C01C19C01C19C01C
1DC01C0DC01C0DC01C0DC07F07C0FF87C07F03C0151C7F9B18>I<0FFE003FFF807FFFC07803C0
7001C0F001E0E000E0E000E0E000E0E000E0E000E0E000E0E000E0E000E0E000E0E000E0E000E0
E000E0E000E0E000E0E000E0E000E0F001E07001C07C07C07FFFC03FFF800FFE00131C7E9B18>
I<FFFE00FFFF80FFFFC01C03C01C01E01C00E01C00701C00701C00701C00701C00701C00E01C01
E01C03C01FFFC01FFF801FFE001C00001C00001C00001C00001C00001C00001C00001C0000FF80
00FF8000FF8000141C7F9B18>I<7FF800FFFE007FFF001C0F801C03801C03C01C01C01C01C01C
01C01C03C01C03801C0F801FFF001FFE001FFE001C0F001C07001C03801C03801C03801C03801C
03801C039C1C039C1C039C7F01F8FF81F87F00F0161C7F9B18>82 D<03F1C01FFFC03FFFC07C0F
C07003C0E001C0E001C0E001C0E000007000007800003F00001FF00007FE0000FF00000F800003
C00001C00000E00000E06000E0E000E0E001E0F001C0F80780FFFF80FFFE00E7F800131C7E9B18
>I<7FFFF8FFFFF8FFFFF8E07038E07038E07038E0703800700000700000700000700000700000
700000700000700000700000700000700000700000700000700000700000700000700000700007
FF0007FF0007FF00151C7F9B18>I<FF83FEFF83FEFF83FE1C00701C00701C00701C00701C0070
1C00701C00701C00701C00701C00701C00701C00701C00701C00701C00701C00701C00701C0070
1C00700E00E00F01E00783C003FF8001FF00007C00171C809B18>I<FE03F8FF07F8FE03F83C01
E01C01C01C01C01C01C01E03C00E03800E03800E03800E0380070700070700070700070700038E
00038E00038E00038E00018C0001DC0001DC0001DC0000D80000F80000F800007000151C7F9B18
>I<FE03F8FE03F8FE03F87000707000707000703800E03800E03800E03800E03800E038F8E039
FCE039DCE039DCE019DCC019DCC019DCC0198CC0198CC01D8DC01D8DC01D8DC01D05C00D05800F
07800F07800E0380151C7F9B18>I<7F0FE07F9FE07F0FE00E07000F0700070E00078E00039C00
03DC0001F80001F80000F80000F00000700000F00000F80001FC0001DC00039E00038E00070F00
0707000E07800E03801E03C07F07F0FF07F87F07F0151C7F9B18>I<FE03F8FF07F8FE03F81C01
C01E03C00E03800F0780070700070700038E00038E0001DC0001DC0001DC0000F80000F8000070
0000700000700000700000700000700000700000700000700001FC0003FE0001FC00151C7F9B18
>I<3FFFE07FFFE07FFFE07001C07003C0700780700700000F00001E00001C00003C0000780000
700000F00001E00001C00003C0000780000700000F00001E00E01C00E03C00E07800E07000E0FF
FFE0FFFFE0FFFFE0131C7E9B18>I<FFF8FFF8FFF8E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000FFF8FFF8FFF80D24779F18>I<600000F00000F00000F800007800007C00003C00003C00
003E00001E00001F00000F00000F00000F800007800007C00003C00003C00003E00001E00001F0
0000F00000F800007800007800007C00003C00003E00001E00001E00001F00000F00000F800007
8000078000030011247D9F18>I<FFF8FFF8FFF800380038003800380038003800380038003800
380038003800380038003800380038003800380038003800380038003800380038003800380038
0038FFF8FFF8FFF80D247F9F18>I<7FFFC0FFFFE0FFFFE07FFFC013047E7F18>95
D<0FF0001FFC003FFE003C0F0018070000038000038000FF8007FF801FFF807F0380780380E003
80E00380E00380F00780780F803FFFF81FFDF807F0F815147E9318>97 D<7E0000FE00007E0000
0E00000E00000E00000E00000E00000E3E000EFF800FFFC00FC1E00F80E00F00700E00700E0038
0E00380E00380E00380E00380E00380F00700F00700F80E00FC1E00FFFC00EFF80063E00151C80
9B18>I<01FE0007FF001FFF803E0780380300700000700000E00000E00000E00000E00000E000
00E000007000007001C03801C03E03C01FFF8007FF0001FC0012147D9318>I<001F80003F8000
1F8000038000038000038000038000038003E3800FFB801FFF803C1F80380F80700780700380E0
0380E00380E00380E00380E00380E00380700780700780380F803C1F801FFFF00FFBF803E3F015
1C7E9B18>I<01F00007FC001FFE003E0F00380780700380700380E001C0E001C0FFFFC0FFFFC0
FFFFC0E000007000007001C03801C03E07C01FFF8007FF0001F80012147D9318>I<001F80007F
C000FFE000E1E001C0C001C00001C00001C0007FFFC0FFFFC0FFFFC001C00001C00001C00001C0
0001C00001C00001C00001C00001C00001C00001C00001C00001C00001C0007FFF007FFF007FFF
00131C7F9B18>I<01E1F007FFF80FFFF81E1E301C0E003807003807003807003807003807001C
0E001E1E001FFC001FF80039E0003800001C00001FFE001FFFC03FFFE07801F0700070E00038E0
0038E00038E000387800F07E03F01FFFC00FFF8001FC00151F7F9318>I<7E0000FE00007E0000
0E00000E00000E00000E00000E00000E3E000EFF800FFFC00FC1C00F80E00F00E00E00E00E00E0
0E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E07FC7FCFFE7FE7FC7FC171C80
9B18>I<038007C007C007C0038000000000000000007FC0FFC07FC001C001C001C001C001C001
C001C001C001C001C001C001C001C001C0FFFFFFFFFFFF101D7C9C18>I<0038007C007C007C00
3800000000000000000FFC0FFC0FFC001C001C001C001C001C001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C6038F078FFF07FE03F800E277E9C18>I<7E00
00FE00007E00000E00000E00000E00000E00000E00000E3FF00E3FF00E3FF00E07800E0F000E1E
000E3C000E78000EF0000FF8000FFC000F9C000F0E000E0F000E07000E03800E03C07FC7F8FFC7
F87FC7F8151C7F9B18>I<FFC000FFC000FFC00001C00001C00001C00001C00001C00001C00001
C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001
C00001C00001C000FFFF80FFFF80FFFF80111C7D9B18>I<F9C1C0FFF7F0FFFFF03E3E383C3C38
3C3C38383838383838383838383838383838383838383838383838383838383838383838FE3E3E
FE7E7EFE3E3E1714809318>I<7E3E00FEFF807FFFC00FC1C00F80E00F00E00E00E00E00E00E00
E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E07FC7FCFFE7FE7FC7FC1714809318
>I<01F0000FFE001FFF003E0F803803807001C07001C0E000E0E000E0E000E0E000E0E000E0F0
01E07001C07803C03C07803E0F801FFF000FFE0001F00013147E9318>I<7E3E00FEFF807FFFC0
0FC1E00F80E00F00700E00700E00380E00380E00380E00380E00380E00380F00700F00700F80E0
0FC1E00FFFC00EFF800E3E000E00000E00000E00000E00000E00000E00000E00007FC000FFE000
7FC000151E809318>I<01F38007FB801FFF803E1F80380F80700780700780E00380E00380E003
80E00380E00380E00380700780700780380F803C1F801FFF800FFB8003E3800003800003800003
80000380000380000380000380001FF0003FF8001FF0151E7E9318>I<FF0FC0FF3FE0FF7FF007
F0F007E06007C00007800007800007000007000007000007000007000007000007000007000007
0000FFFC00FFFE00FFFC0014147E9318>I<07F7003FFF007FFF00780F00E00700E00700E00700
7C00007FE0001FFC0003FE00001F00600780E00380E00380F00380F80F00FFFF00FFFC00E7F000
11147D9318>I<0180000380000380000380000380007FFFC0FFFFC0FFFFC00380000380000380
000380000380000380000380000380000380000380400380E00380E00380E001C1C001FFC000FF
80003E0013197F9818>I<7E07E0FE0FE07E07E00E00E00E00E00E00E00E00E00E00E00E00E00E
00E00E00E00E00E00E00E00E00E00E00E00E01E00F03E007FFFC03FFFE01FCFC1714809318>I<
7F8FF0FF8FF87F8FF01C01C00E03800E03800E0380070700070700070700078F00038E00038E00
038E0001DC0001DC0001DC0000F80000F80000700015147F9318>I<FF07F8FF8FF8FF07F83800
E03800E03800E03800E01C01C01C71C01CF9C01CF9C01CD9C01DDDC00DDD800DDD800DDD800D8D
800F8F800F8F8007070015147F9318>I<7F8FF07F9FF07F8FF00F0700078E00039E0001DC0001
F80000F80000700000F00000F80001DC00039E00038E000707000E07807F8FF0FF8FF87F8FF015
147F9318>I<7F8FF0FF8FF87F8FF00E01C00E03800E0380070380070700070700038700038700
038E0001CE0001CE0001CC0000CC0000DC0000780000780000780000700000700000700000F000
00E00079E0007BC0007F80003F00001E0000151E7F9318>I<3FFFF07FFFF07FFFF07001E07003
C0700780000F00001E00003C0000F80001F00003C0000780000F00701E00703C0070780070FFFF
F0FFFFF0FFFFF014147F9318>I<0007E0001FE0007FE000780000E00000E00000E00000E00000
E00000E00000E00000E00000E00000E00000E00001E0007FC000FF8000FF80007FC00001E00000
E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000007800007FE000
1FE00007E013247E9F18>I<60F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0
F0F0F0F0F0F0F0F0600424769F18>I<7C0000FF0000FFC00003C00000E00000E00000E00000E0
0000E00000E00000E00000E00000E00000E00000E00000F000007FC0003FE0003FE0007FC000F0
0000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00003C000FFC0
00FF00007C000013247E9F18>I E /Fq 9 61 df<1E07C023186023A03043C030438038438038
8700700700700700700700700E00E00E00E00E00E00E00E01C01C01C01C01C01C01C01C0380380
180380000380000380000700000700000700000700000E00000E00000E00000C00151E7E9317>
17 D<07000001C00001E00000E00000F000007000007000007800003800003800003C00001C00
001C00001E00000E00000E00000F00000700001F0000378000638000C3800183C00381C00701C0
0E01E01C00E03800E0700070F00070E00078C0003815207D9F1B>21 D<0F00307F00380E00700E
00700E00700E00E01C00E01C01C01C01C01C0380380300380600380C0038180070300070600071
C000730000FC0000E0000015147E9316>23 D<0FFFFC1FFFFE3FFFFC608200C082008182000106
00010400030400030400020400060C00060E000C0E000C0E001C0E001C0E00180F003807003006
0017147E931A>25 D<000F800038C000606000C07001C070038078038078070078070078070078
0E00F00E00F00E00F00E01E01C01C01C01C01E03801E0700390C0038F000380000380000700000
700000700000700000E00000E00000E00000C00000151E7F9318>I<007FFE01FFFE07FFFE0F07
801E03801C01C03801C07001C07001C07001C0E00380E00380E00380E00700E00700E00E00600C
003018001860000F800017147E931A>I<70F8F8F87005057C840D>58 D<70F0F8F87808080810
1010202040050E7C840D>I<000001C00000078000001E00000078000001E00000078000000E00
000038000000F0000003C000000F0000003C000000F0000000F00000003C0000000F00000003C0
000000F0000000380000000E0000000780000001E0000000780000001E0000000780000001C01A
1A7C9723>I E /Fr 58 128 df<000FE000007FF80000F81C0001E07C0003E07C0007C07C0007
C07C0007C0380007C0000007C0000007C0000007C1FE00FFFFFE00FFFFFE0007C03E0007C03E00
07C03E0007C03E0007C03E0007C03E0007C03E0007C03E0007C03E0007C03E0007C03E0007C03E
0007C03E0007C03E0007C03E0007C03E003FF9FFC03FF9FFC01A20809F1D>12
D<000FFE00007FFE0000F87E0001E0FE0003E0FE0007C07E0007C07E0007C03E0007C03E0007C0
3E0007C03E0007C03E00FFFFFE00FFFFFE0007C03E0007C03E0007C03E0007C03E0007C03E0007
C03E0007C03E0007C03E0007C03E0007C03E0007C03E0007C03E0007C03E0007C03E0007C03E00
07C03E003FF9FFC03FF9FFC01A20809F1D>I<FF00FF001F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F001F00FFE0FFE00B147E930E>16 D<387CFEFFFF7F3B03030606
0E0C18302008107C860F>44 D<FFF0FFF0FFF0FFF00C047F8B11>I<387CFEFEFE7C3807077C86
0F>I<01FC0007FF001F07C01E03C03E03E07C01F07C01F07C01F0FC01F8FC01F8FC01F8FC01F8
FC01F8FC01F8FC01F8FC01F8FC01F8FC01F8FC01F8FC01F8FC01F87C01F07C01F07C01F03E03E0
1E03C01F8FC007FF0001FC00151D7E9C1A>48 D<00700000F00007F000FFF000F9F00001F00001
F00001F00001F00001F00001F00001F00001F00001F00001F00001F00001F00001F00001F00001
F00001F00001F00001F00001F00001F00001F00001F0007FFFC07FFFC0121D7D9C1A>I<03FC00
1FFF80381FC07C07E0FE03F0FE03F0FE03F8FE01F87C01F83801F80003F80003F00003F00007E0
000FC0000F00001E00003C0000700000E00001C0180380180600180C00381FFFF03FFFF07FFFF0
FFFFF0FFFFF0151D7E9C1A>I<03FC000FFF801C0FC03C07E07E03F07E03F07E03F07E07F03C07
E00007E0000FC0003F8003FE0003FC00000F800007C00003E00003F00003F83803F87C03F8FE03
F8FE03F8FE03F0FC03F07807E03C0FC01FFF8003FC00151D7E9C1A>I<0001C00003C00007C000
07C0000FC0001FC0003BC00073C00063C000C3C00183C00383C00703C00E03C00C03C01803C038
03C07003C0E003C0FFFFFEFFFFFE0007C00007C00007C00007C00007C00007C000FFFE00FFFE17
1D7F9C1A>I<1C00E01FFFE01FFFC01FFF801FFF001FFC001FC000180000180000180000180000
19FE001FFF801E07C01803E01001F00001F00001F80001F87801F8FC01F8FC01F8FC01F8FC01F0
7803F07003E03C0FC00FFF0003FC00151D7E9C1A>I<003F0001FFC007C0E00F81E01F03F01E03
F03E03F07C03F07C01E07C0000FC1000FCFF00FDFFC0FD03E0FE01F0FE01F0FC01F8FC01F8FC01
F8FC01F87C01F87C01F87C01F83C01F03E01F01E03E00F07C007FF8001FE00151D7E9C1A>I<60
00007FFFF87FFFF87FFFF07FFFE07FFFC0E00180C00300C00300C00600000C0000180000380000
300000700000F00000F00001E00001E00003E00003E00003E00003E00007E00007E00007E00007
E00007E00003C000018000151E7D9D1A>I<01FE000FFF801E07C03801E03800F07800F07800F0
7C00F07F00F07FC1E03FE3C01FFF800FFE0007FF8007FFC01FFFE03C3FF0780FF07803F8F001F8
F000F8F00078F00078F000707800707C00E03E03C00FFF8003FC00151D7E9C1A>I<01FC000FFF
001F07803E03C07C03E07C01E0FC01F0FC01F0FC01F0FC01F8FC01F8FC01F8FC01F87C03F87C03
F83E05F81FFDF807F9F80041F80001F03C01F07E01F07E03E07E03E07E03C03C0780381F001FFC
0007F000151D7E9C1A>I<0000E000000000E000000001F000000001F000000001F000000003F8
00000003F800000006FC00000006FC0000000EFE0000000C7E0000000C7E000000183F00000018
3F000000303F800000301F800000701FC00000600FC00000600FC00000C007E00000FFFFE00001
FFFFF000018003F000038003F800030001F800030001F800060000FC00060000FC000E0000FE00
FFE00FFFE0FFE00FFFE0231F7E9E28>65 D<FFFFFE00FFFFFFC007C007E007C003F007C001F807
C001FC07C001FC07C001FC07C001FC07C001FC07C001F807C003F807C003F007C00FE007FFFF80
07FFFFC007C003F007C001F807C001FC07C000FC07C000FE07C000FE07C000FE07C000FE07C000
FE07C000FC07C001FC07C003F807C007F0FFFFFFE0FFFFFF001F1F7E9E25>I<0007FC02003FFF
0E00FE03DE03F000FE07E0003E0FC0001E1F80001E3F00000E3F00000E7F0000067E0000067E00
0006FE000000FE000000FE000000FE000000FE000000FE000000FE0000007E0000007E0000067F
0000063F0000063F00000C1F80000C0FC0001807E0003803F0007000FE01C0003FFF800007FC00
1F1F7D9E26>I<FFFFFFE0FFFFFFE007E007E007E001E007E000E007E0006007E0007007E00030
07E0003007E0303007E0303007E0300007E0700007E0F00007FFF00007FFF00007E0F00007E070
0007E0300007E0300C07E0300C07E0000C07E0001807E0001807E0001807E0003807E0007807E0
00F807E003F0FFFFFFF0FFFFFFF01E1F7E9E22>69 D<FFFFFFE0FFFFFFE007E007E007E001E007
E000E007E0006007E0007007E0003007E0003007E0303007E0303007E0300007E0700007E0F000
07FFF00007FFF00007E0F00007E0700007E0300007E0300007E0300007E0000007E0000007E000
0007E0000007E0000007E0000007E0000007E00000FFFF8000FFFF80001C1F7E9E21>I<0007FC
0200003FFF0E0000FE03DE0003F000FE0007E0003E000FC0001E001F80001E003F00000E003F00
000E007F000006007E000006007E00000600FE00000000FE00000000FE00000000FE00000000FE
00000000FE001FFFE0FE001FFFE07E00007E007E00007E007F00007E003F00007E003F00007E00
1F80007E000FC0007E0007E0007E0003F000FE0000FE01FE00003FFF8E000007FC0600231F7D9E
29>I<FFFF0FFFF0FFFF0FFFF007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007
E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007FFFFFE00
07FFFFFE0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E
0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E0007E00FFFF0FFFF0FFFF0F
FFF0241F7E9E29>I<FFFFFFFF07E007E007E007E007E007E007E007E007E007E007E007E007E0
07E007E007E007E007E007E007E007E007E007E007E007E007E007E0FFFFFFFF101F7E9E14>I<
FFE000003FF8FFF000007FF807F000007F0006F80000DF0006F80000DF0006F80000DF00067C00
019F00067C00019F00063E00031F00063E00031F00061F00061F00061F00061F00060F800C1F00
060F800C1F000607C0181F000607C0181F000607C0181F000603E0301F000603E0301F000601F0
601F000601F0601F000600F8C01F000600F8C01F0006007D801F0006007D801F0006003F001F00
06003F001F0006003F001F0006001E001F00FFF01E03FFF8FFF00C03FFF82D1F7E9E32>77
D<FFE000FFF0FFF000FFF007F000060007F800060006FC000600067E000600063F000600063F80
0600061F800600060FC006000607E006000603F006000601F806000601FC06000600FC06000600
7E060006003F060006001F860006001FC60006000FE600060007E600060003F600060001FE0006
0000FE00060000FE000600007E000600003E000600001E000600000E00FFF0000600FFF0000600
241F7E9E29>I<001FF80000FFFF0001F81F8007E007E00FC003F01F8001F81F0000F83F0000FC
7F0000FE7E00007E7E00007EFE00007FFE00007FFE00007FFE00007FFE00007FFE00007FFE0000
7FFE00007FFE00007F7E00007E7F0000FE7F0000FE3F0000FC3F8001FC1F8001F80FC003F007E0
07E001F81F8000FFFF00001FF800201F7D9E27>I<FFFFFE00FFFFFF8007E00FE007E003F007E0
01F807E001F807E001FC07E001FC07E001FC07E001FC07E001FC07E001F807E001F807E003F007
E00FE007FFFF8007FFFE0007E0000007E0000007E0000007E0000007E0000007E0000007E00000
07E0000007E0000007E0000007E0000007E00000FFFF0000FFFF00001E1F7E9E24>I<FFFFFC00
00FFFFFF800007E00FE00007E003F00007E003F80007E001F80007E001FC0007E001FC0007E001
FC0007E001FC0007E001F80007E003F80007E003F00007E00FE00007FFFF800007FFFC000007E0
3F000007E00F800007E00FC00007E007C00007E007E00007E007E00007E007E00007E007F00007
E007F00007E007F00007E007F03007E003F83007E001F860FFFF00FFC0FFFF003F80241F7E9E27
>82 D<03FC080FFF381E03F83800F8700078700038F00038F00018F00018F80000FC00007FC000
7FFE003FFF801FFFC00FFFE007FFF000FFF80007F80000FC00007C00003CC0003CC0003CC0003C
E00038E00078F80070FE01E0EFFFC081FF00161F7D9E1D>I<7FFFFFFC7FFFFFFC7C07E07C7007
E01C6007E00C6007E00CE007E00EC007E006C007E006C007E006C007E0060007E0000007E00000
07E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E0000007E000
0007E0000007E0000007E0000007E0000007E00003FFFFC003FFFFC01F1E7E9D24>I<FFFF01FF
E0FFFF01FFE007E0000C0007E0000C0007E0000C0007E0000C0007E0000C0007E0000C0007E000
0C0007E0000C0007E0000C0007E0000C0007E0000C0007E0000C0007E0000C0007E0000C0007E0
000C0007E0000C0007E0000C0007E0000C0007E0000C0007E0000C0007E0000C0007E0000C0003
E000180001F000180001F000300000F8006000007E03C000001FFF80000003FC0000231F7E9E28
>I<07FC001FFF803F07C03F03E03F01F03F01F00C01F00001F0003FF007FDF01F81F03E01F07C
01F0F801F0F801F0F801F0FC02F07E0CF03FF87E0FE03E17147F9319>97
D<FF0000FF00001F00001F00001F00001F00001F00001F00001F00001F00001F00001F00001F1F
C01F7FF01FE0F81F807C1F007E1F003E1F003E1F003F1F003F1F003F1F003F1F003F1F003F1F00
3E1F003E1F007C1F807C1EC1F81C7FE0181F8018207E9F1D>I<01FE0007FF801F0FC03E0FC03E
0FC07C0FC07C0300FC0000FC0000FC0000FC0000FC0000FC00007C00007E00003E00603F00C01F
81C007FF0001FC0013147E9317>I<0007F80007F80000F80000F80000F80000F80000F80000F8
0000F80000F80000F80000F801F8F807FEF81F83F83E01F87E00F87C00F87C00F8FC00F8FC00F8
FC00F8FC00F8FC00F8FC00F87C00F87C00F87E00F83E01F81F07F80FFEFF03F8FF18207E9F1D>
I<01FE0007FF800F83C01E01E03E00F07C00F07C00F8FC00F8FFFFF8FFFFF8FC0000FC0000FC00
007C00007C00003E00181E00180F807007FFE000FF8015147F9318>I<003F8000FFC003E3E007
C7E00787E00F87E00F83C00F80000F80000F80000F80000F8000FFFC00FFFC000F80000F80000F
80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F80000F
80007FF8007FF80013207F9F10>I<03FC3C0FFFFE1E079E3C03DE7C03E07C03E07C03E07C03E0
7C03E03C03C01E07801FFF0013FC003000003000003800003FFF801FFFF00FFFF81FFFFC78007C
70003EF0001EF0001EF0001E78003C78003C3F01F80FFFE001FF00171E7F931A>I<FF0000FF00
001F00001F00001F00001F00001F00001F00001F00001F00001F00001F00001F0FC01F3FE01F61
F01FC0F81F80F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00
F81F00F81F00F8FFE7FFFFE7FF18207D9F1D>I<1C003E007F007F007F003E001C000000000000
00000000000000FF00FF001F001F001F001F001F001F001F001F001F001F001F001F001F001F00
1F001F00FFE0FFE00B217EA00E>I<0038007C00FE00FE00FE007C003800000000000000000000
000001FE01FE003E003E003E003E003E003E003E003E003E003E003E003E003E003E003E003E00
3E003E003E003E303E783EFC3CFC7C78783FF01FC00F2A83A010>I<FF0000FF00001F00001F00
001F00001F00001F00001F00001F00001F00001F00001F00001F01FE1F01FE1F00F01F00C01F03
801F07001F0C001F18001F7C001FFC001F9E001F0F001E0F801E07C01E03C01E01E01E01F01E00
F8FFC3FFFFC3FF18207E9F1C>I<FF00FF001F001F001F001F001F001F001F001F001F001F001F
001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F00FFE0FFE0
0B207E9F0E>I<FE0FE03F80FE1FF07FC01E70F9C3E01E407D01F01E807E01F01F807E01F01F00
7C01F01F007C01F01F007C01F01F007C01F01F007C01F01F007C01F01F007C01F01F007C01F01F
007C01F01F007C01F01F007C01F01F007C01F0FFE3FF8FFEFFE3FF8FFE27147D932C>I<FE0FC0
FE3FE01E61F01EC0F81E80F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F8
1F00F81F00F81F00F81F00F8FFE7FFFFE7FF18147D931D>I<01FF0007FFC01F83F03E00F83E00
F87C007C7C007CFC007EFC007EFC007EFC007EFC007EFC007E7C007C7C007C3E00F83E00F81F83
F007FFC001FF0017147F931A>I<FF1FC0FF7FF01FE1F81F80FC1F007E1F007E1F003E1F003F1F
003F1F003F1F003F1F003F1F003F1F003E1F007E1F007C1F80FC1FC1F81F7FE01F1F801F00001F
00001F00001F00001F00001F00001F0000FFE000FFE000181D7E931D>I<FE3E00FE7F801ECFC0
1E8FC01E8FC01F8FC01F03001F00001F00001F00001F00001F00001F00001F00001F00001F0000
1F00001F0000FFF000FFF00012147E9316>114 D<0FE63FFE701E600EE006E006F800FFC07FF8
3FFC1FFE03FE001FC007C007E007F006F81EFFFCC7F010147E9315>I<03000300030003000700
07000F000F003F00FFFCFFFC1F001F001F001F001F001F001F001F001F001F001F061F061F061F
061F060F8C07F803F00F1D7F9C14>I<FF07F8FF07F81F00F81F00F81F00F81F00F81F00F81F00
F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F01F81F01F80F06F807FCFF03F8FF1814
7D931D>I<FFE07F80FFE07F801F001C000F8018000F80180007C0300007C0300003E0600003E0
600003F0E00001F0C00001F9C00000F9800000FF8000007F0000007F0000003E0000003E000000
1C0000001C000019147F931C>I<FFC7FE1FE0FFC7FE1FE01F00F003001F00F803000F80F80600
0F80F806000FC1BC0E0007C1BC0C0007C3BE0C0003E31E180003E31E180003F60F380001F60F30
0001FE0FB00000FC07E00000FC07E00000F803E000007803C000007803C000003001800023147F
9326>I<FFC0FF00FFC0FF000F80700007C0600007E0C00003E1800001F3800000FF0000007E00
00003E0000003F0000007F8000006F800000C7C0000183E0000381F0000700F8000E00FC00FF81
FF80FF81FF8019147F931C>I<FFE07F80FFE07F801F001C000F8018000F80180007C0300007C0
300003E0600003E0600003F0E00001F0C00001F9C00000F9800000FF8000007F0000007F000000
3E0000003E0000001C0000001C0000001800000018000078300000FC300000FC600000C0E00000
E1C000007F8000001E000000191D7F931C>I<FFFFFF80FFFFFF801902808C1A>123
D<701CF83EFC7EFC7EF83E701C0F067BA01A>127 D E /Fs 43 122 df<0001FF0000001FFFC0
00007F81E00000FC01E00001F807F00003F807F00007F007F00007F007F00007F007F00007F007
F00007F001C00007F000000007F000000007F000000007F03FF800FFFFFFF800FFFFFFF800FFFF
FFF80007F003F80007F003F80007F003F80007F003F80007F003F80007F003F80007F003F80007
F003F80007F003F80007F003F80007F003F80007F003F80007F003F80007F003F80007F003F800
07F003F80007F003F80007F003F80007F003F80007F003F80007F003F8007FFF3FFF807FFF3FFF
807FFF3FFF80212A7FA925>12 D<003F800001FFF00007E0FC000FC07E001F803F001F001F003F
001F803E000F807E000FC07E000FC07E000FC07E000FC0FE000FE0FE000FE0FE000FE0FE000FE0
FE000FE0FE000FE0FE000FE0FE000FE0FE000FE0FE000FE0FE000FE0FE000FE0FE000FE0FE000F
E0FE000FE07E000FC07E000FC07E000FC07E000FC03F001F803F001F801F001F001F803F000FC0
7E0007E0FC0001FFF000003F80001B277DA622>48 D<000E00001E00007E0007FE00FFFE00FFFE
00F8FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE
0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE
0000FE0000FE0000FE0000FE00FFFFFEFFFFFEFFFFFE17277BA622>I<00FF800007FFF0000FFF
FC001E03FE003800FF807C003F80FE003FC0FF001FC0FF001FE0FF000FE0FF000FE07E000FE03C
001FE000001FE000001FC000001FC000003F8000003F0000007E000000FC000000F8000001F000
0003E00000078000000F0000001E0000003C00E0007000E000E000E001C001C0038001C0060001
C00FFFFFC01FFFFFC03FFFFFC07FFFFFC0FFFFFF80FFFFFF80FFFFFF801B277DA622>I<007F80
0003FFF00007FFFC000F81FE001F007F003F807F003F803F803F803F803F803F801F803F801F00
3F8000007F0000007F0000007E000000FC000001F8000007F00000FFC00000FFC0000001F80000
007E0000003F0000003F8000001FC000001FC000001FE000001FE03C001FE07E001FE0FF001FE0
FF001FE0FF001FC0FF003FC0FE003F807C007F003F01FE001FFFFC0007FFF00000FF80001B277D
A622>I<00000F0000000F0000001F0000003F0000007F000000FF000001FF000001FF000003BF
0000073F00000E3F00001C3F00003C3F0000383F0000703F0000E03F0001C03F0003803F000780
3F0007003F000E003F001C003F0038003F0070003F00F0003F00FFFFFFF8FFFFFFF8FFFFFFF800
007F0000007F0000007F0000007F0000007F0000007F0000007F0000007F00001FFFF8001FFFF8
001FFFF81D277EA622>I<180003001F801F001FFFFE001FFFFC001FFFF8001FFFF0001FFFC000
1FFF00001C0000001C0000001C0000001C0000001C0000001C0000001C0000001C7FC0001DFFF8
001F80FC001E003F0008003F0000001F8000001FC000001FC000001FE000001FE018001FE07C00
1FE0FE001FE0FE001FE0FE001FE0FE001FC0FC001FC078003F8078003F803C007F001F01FE000F
FFFC0003FFF00000FF80001B277DA622>I<0007F800003FFE0000FFFF0001FC078003F00FC007
C01FC00F801FC01F801FC01F001FC03F000F803F0000007E0000007E0000007E000000FE020000
FE1FF000FE3FFC00FE603E00FE801F00FF801F80FF000FC0FF000FC0FE000FE0FE000FE0FE000F
E0FE000FE07E000FE07E000FE07E000FE07E000FE03E000FE03F000FC01F000FC01F001F800F80
1F0007E07E0003FFFC0001FFF800003FC0001B277DA622>I<380000003E0000003FFFFFF03FFF
FFF03FFFFFF07FFFFFE07FFFFFC07FFFFF807FFFFF0070000E0070000E0070001C00E0003800E0
007000E000E0000001C0000001C000000380000007800000070000000F0000001F0000001E0000
003E0000003E0000007E0000007C0000007C000000FC000000FC000000FC000000FC000001FC00
0001FC000001FC000001FC000001FC000001FC000001FC000000F80000007000001C297CA822>
I<003FC00001FFF00003FFFC0007C07E000F003F001E001F001E000F803E000F803E000F803F00
0F803F800F803FC00F003FF01F001FFC1E001FFE3C000FFFF80007FFE00003FFF00001FFFC0001
FFFE0007FFFF000F0FFF801E07FFC03E01FFC07C007FE07C001FE0F8000FE0F80007E0F80003E0
F80003E0F80003E0F80003C07C0003C07E0007803F000F001FC03F000FFFFC0003FFF800007FC0
001B277DA622>I<007F800001FFF00007FFF8000FC0FC001F803E003F001F007E001F807E001F
807E000F80FE000FC0FE000FC0FE000FC0FE000FE0FE000FE0FE000FE0FE000FE0FE000FE07E00
1FE07E001FE03F003FE01F002FE00F80CFE007FF8FE001FF0FE000080FE000000FC000000FC000
000FC000001F803E001F807F001F807F003F007F003E007F007E007E00FC003E03F8001FFFE000
0FFF800001FE00001B277DA622>I<00000780000000000780000000000FC0000000000FC00000
00000FC0000000001FE0000000001FE0000000003FF0000000003FF0000000003FF00000000077
F80000000077F800000000F7FC00000000E3FC00000000E3FC00000001C1FE00000001C1FE0000
0003C1FF0000000380FF0000000380FF00000007007F80000007007F8000000F007FC000000E00
3FC000000E003FC000001C001FE000001C001FE000003FFFFFF000003FFFFFF000003FFFFFF000
00700007F80000700007F80000F00007FC0000E00003FC0001E00003FE0001C00001FE0001C000
01FE0003C00001FF00FFFE003FFFFCFFFE003FFFFCFFFE003FFFFC2E297EA833>65
D<FFFFFFF800FFFFFFFF00FFFFFFFFC003F8001FE003F8000FF003F80007F803F80003F803F800
03FC03F80003FC03F80001FC03F80001FC03F80001FC03F80003FC03F80003F803F80003F803F8
0007F003F8000FF003F8001FC003F800FF8003FFFFFE0003FFFFFFC003F8000FF003F80003F803
F80001FC03F80001FE03F80000FE03F80000FE03F80000FF03F80000FF03F80000FF03F80000FF
03F80000FF03F80000FF03F80000FE03F80001FE03F80003FC03F80007FC03F8001FF8FFFFFFFF
E0FFFFFFFFC0FFFFFFFE0028297DA830>I<00007FE0030007FFFC07001FFFFF0F007FF00F9F00
FF0001FF01FC0000FF03F800007F07F000003F0FE000001F1FC000001F1FC000000F3F8000000F
3F800000077F800000077F800000077F00000000FF00000000FF00000000FF00000000FF000000
00FF00000000FF00000000FF00000000FF00000000FF000000007F000000007F800000007F8000
00073F800000073F800000071FC00000071FC000000E0FE000000E07F000001C03F800003C01FC
00007800FF0001F0007FF007C0001FFFFF800007FFFE0000007FF00028297CA831>I<FFFFFFFF
E0FFFFFFFFE0FFFFFFFFE003FC001FE003FC0007F003FC0001F003FC0001F003FC0000F003FC00
007003FC00007003FC00007003FC01C07803FC01C03803FC01C03803FC01C03803FC03C00003FC
03C00003FC0FC00003FFFFC00003FFFFC00003FFFFC00003FC0FC00003FC03C00003FC03C00003
FC01C00E03FC01C00E03FC01C00E03FC01C01C03FC00001C03FC00001C03FC00001C03FC00003C
03FC00003803FC00007803FC0000F803FC0001F803FC0003F803FC001FF8FFFFFFFFF0FFFFFFFF
F0FFFFFFFFF027297EA82C>69 D<00007FE003000007FFFC0700001FFFFF0F00007FF00F9F0000
FF0001FF0001FC0000FF0003F800007F0007F000003F000FE000001F001FC000001F001FC00000
0F003F8000000F003F80000007007F80000007007F80000007007F0000000000FF0000000000FF
0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF0000000000FF000000
0000FF0000FFFFF87F0000FFFFF87F8000FFFFF87F800000FF003F800000FF003F800000FF001F
C00000FF001FC00000FF000FE00000FF0007F00000FF0003F80000FF0001FC0000FF0000FF0001
FF00007FF007FF00001FFFFF9F000007FFFE0F0000007FF003002D297CA835>71
D<FFFFF0FFFFF0FFFFF003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC
0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC
0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC0003FC00FFFF
F0FFFFF0FFFFF014297EA819>73 D<0000FFC00000000FFFFC0000003F807F000000FE001FC000
01F80007E00003F00003F00007E00001F8000FE00001FC001FC00000FE001FC00000FE003F8000
007F003F8000007F007F8000007F807F0000003F807F0000003F807F0000003F80FF0000003FC0
FF0000003FC0FF0000003FC0FF0000003FC0FF0000003FC0FF0000003FC0FF0000003FC0FF0000
003FC0FF0000003FC0FF0000003FC07F0000003F807F8000007F807F8000007F803F8000007F00
3F8000007F001FC00000FE001FC00000FE000FE00001FC0007F00003F80003F80007F00001FC00
0FE00000FE001FC000003FC0FF0000000FFFFC00000000FFC000002A297CA833>79
D<00FF806003FFF0E00FFFF8E01F80FDE03F001FE03E0007E07C0003E07C0003E0FC0001E0FC00
01E0FC0000E0FE0000E0FE0000E0FF000000FFC000007FFC00007FFFE0003FFFF8001FFFFE001F
FFFF0007FFFF8003FFFFC000FFFFC0000FFFE000007FE000001FF000000FF0000007F0E00003F0
E00003F0E00003F0E00003F0F00003E0F00003E0F80007E0FC0007C0FF000F80FFE03F80E3FFFE
00E1FFFC00C01FF0001C297CA825>83 D<7FFFFFFFFF807FFFFFFFFF807FFFFFFFFF807F807F80
7F807C007F800F8078007F80078078007F80078070007F800380F0007F8003C0F0007F8003C0E0
007F8001C0E0007F8001C0E0007F8001C0E0007F8001C0E0007F8001C000007F80000000007F80
000000007F80000000007F80000000007F80000000007F80000000007F80000000007F80000000
007F80000000007F80000000007F80000000007F80000000007F80000000007F80000000007F80
000000007F80000000007F80000000007F80000000007F80000000007F80000000007F80000000
007F80000000FFFFFFC00000FFFFFFC00000FFFFFFC0002A287EA72F>I<03FF80000FFFF0001F
01FC003F80FE003F807F003F803F003F803F801F003F8000003F8000003F8000003F8000003F80
003FFF8001FC3F800FE03F801F803F803F003F807E003F80FC003F80FC003F80FC003F80FC003F
80FC005F807E00DF803F839FFC1FFE0FFC03FC03FC1E1B7E9A21>97 D<FFE00000FFE00000FFE0
00000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000000F
E000000FE000000FE000000FE1FE000FEFFF800FFE07E00FF803F00FF001F80FE000FC0FE000FC
0FE0007E0FE0007E0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE000
7F0FE0007E0FE0007E0FE0007E0FE000FC0FE000FC0FF001F80FF803F00F9C0FE00F0FFF800E01
FC00202A7EA925>I<003FF00001FFFC0003F03E000FC07F001F807F003F007F003F007F007F00
3E007E0000007E000000FE000000FE000000FE000000FE000000FE000000FE000000FE0000007E
0000007E0000007F0000003F0003803F8003801F8007000FE00E0003F83C0001FFF800003FC000
191B7E9A1E>I<00007FF000007FF000007FF0000007F0000007F0000007F0000007F0000007F0
000007F0000007F0000007F0000007F0000007F0000007F0000007F0003F87F001FFF7F007F03F
F00FC00FF01F8007F03F0007F03F0007F07E0007F07E0007F07E0007F0FE0007F0FE0007F0FE00
07F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F07E0007F07E0007F03F0007F03F0007F01F
800FF00FC01FF007E07FFF01FFE7FF007F87FF202A7EA925>I<003FC00001FFF00003E07C000F
803E001F801F001F001F003F000F807E000F807E000FC07E000FC0FE0007C0FE0007C0FFFFFFC0
FFFFFFC0FE000000FE000000FE0000007E0000007E0000007F0000003F0001C01F0001C00F8003
8007C0070003F01E0000FFFC00003FE0001A1B7E9A1F>I<0007F8003FFC007E3E01FC7F03F87F
03F07F07F07F07F03E07F00007F00007F00007F00007F00007F00007F000FFFFC0FFFFC0FFFFC0
07F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F00007F000
07F00007F00007F00007F00007F00007F00007F00007F0007FFF807FFF807FFF80182A7EA915>
I<00FF80F003FFE3F80FC1FE1C1F007C7C3F007E7C3E003E107E003F007E003F007E003F007E00
3F007E003F007E003F003E003E003F007E001F007C000FC1F8000BFFE00018FF80001800000038
000000380000003C0000003FFFF8003FFFFF001FFFFFC00FFFFFE007FFFFF01FFFFFF03C0007F0
7C0001F8F80000F8F80000F8F80000F8F80000F87C0001F07C0001F03F0007E00FC01F8007FFFF
00007FF0001E287E9A22>I<FFE00000FFE00000FFE000000FE000000FE000000FE000000FE000
000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE07E000FE1
FF800FE30FC00FE40FE00FE807E00FF807F00FF007F00FF007F00FE007F00FE007F00FE007F00F
E007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F0
0FE007F00FE007F00FE007F0FFFE3FFFFFFE3FFFFFFE3FFF202A7DA925>I<07000F801FC03FE0
3FE03FE01FC00F8007000000000000000000000000000000FFE0FFE0FFE00FE00FE00FE00FE00F
E00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE0FFFEFFFEFFFE
0F2B7EAA12>I<FFE00000FFE00000FFE000000FE000000FE000000FE000000FE000000FE00000
0FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE01FFC0FE01FFC0FE01F
FC0FE007800FE00F000FE01E000FE03C000FE078000FE0E0000FE3C0000FE7C0000FEFE0000FFF
F0000FFFF8000FF3F8000FE1FC000FC0FE000FC07F000FC07F000FC03F800FC01FC00FC00FE00F
C00FE00FC007F0FFFC1FFFFFFC1FFFFFFC1FFF202A7FA923>107 D<FFE0FFE0FFE00FE00FE00F
E00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE0
0FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE0FFFEFFFEFFFE0F2A7EA912
>I<FFC07F001FC000FFC1FFC07FF000FFC307E0C1F8000FC407F101FC000FC803F200FC000FD8
03FE00FE000FD003FC00FE000FD003FC00FE000FE003F800FE000FE003F800FE000FE003F800FE
000FE003F800FE000FE003F800FE000FE003F800FE000FE003F800FE000FE003F800FE000FE003
F800FE000FE003F800FE000FE003F800FE000FE003F800FE000FE003F800FE000FE003F800FE00
0FE003F800FE000FE003F800FE00FFFE3FFF8FFFE0FFFE3FFF8FFFE0FFFE3FFF8FFFE0331B7D9A
38>I<FFC07E00FFC1FF80FFC30FC00FC40FE00FC807E00FD807F00FD007F00FD007F00FE007F0
0FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007
F00FE007F00FE007F00FE007F00FE007F00FE007F0FFFE3FFFFFFE3FFFFFFE3FFF201B7D9A25>
I<003FE00001FFFC0003F07E000FC01F801F800FC03F0007E03F0007E07E0003F07E0003F07E00
03F0FE0003F8FE0003F8FE0003F8FE0003F8FE0003F8FE0003F8FE0003F8FE0003F87E0003F07E
0003F03F0007E03F0007E01F800FC00FC01F8007F07F0001FFFC00003FE0001D1B7E9A22>I<FF
E1FE00FFEFFF80FFFE0FE00FF803F00FF001F80FE001FC0FE000FC0FE000FE0FE000FE0FE0007F
0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007F0FE0007E0FE000FE0FE000
FE0FE000FC0FE001FC0FF001F80FF807F00FFC0FE00FEFFF800FE1FC000FE000000FE000000FE0
00000FE000000FE000000FE000000FE000000FE000000FE00000FFFE0000FFFE0000FFFE000020
277E9A25>I<FFC1F0FFC7FCFFC63E0FCC7F0FD87F0FD07F0FD07F0FF03E0FE0000FE0000FE000
0FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE000
FFFF00FFFF00FFFF00181B7F9A1B>114 D<03FE300FFFF03E03F07800F07000F0F00070F00070
F80070FE0000FFE0007FFF007FFFC03FFFE01FFFF007FFF800FFF80007FC0000FCE0007CE0003C
F0003CF00038F80038FC0070FF01E0E7FFC0C1FF00161B7E9A1B>I<00E00000E00000E00000E0
0001E00001E00001E00003E00003E00007E0000FE0001FFFE0FFFFE0FFFFE00FE0000FE0000FE0
000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0700FE0700FE0
700FE0700FE0700FE0700FE07007F0E003F0C001FF80007F0014267FA51A>I<FFE07FF0FFE07F
F0FFE07FF00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE0
07F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00F
E00FF00FE00FF007E017F003F067FF01FFC7FF007F87FF201B7D9A25>I<FFFC03FFFFFC03FFFF
FC03FF0FF000F007F000E007F800E003F801C003F801C003FC03C001FC038001FE078000FE0700
00FF0700007F0E00007F0E00007F9E00003F9C00003FFC00001FF800001FF800000FF000000FF0
00000FF0000007E0000007E0000003C0000003C000201B7F9A23>I<FFFC7FFC1FFCFFFC7FFC1F
FCFFFC7FFC1FFC0FE00FE001C007F007E0038007F007E0038007F807F0078003F807F0070003F8
0FF8070003FC0FF80F0001FC0FF80E0001FC1FFC0E0000FE1CFC1C0000FE1CFE1C0000FF387E3C
00007F387E3800007F787F3800003FF03F7000003FF03FF000003FE01FF000001FE01FE000001F
E01FE000000FC00FC000000FC00FC000000F8007C0000007800780000007800780002E1B7F9A31
>I<FFFC1FFEFFFC1FFEFFFC1FFE07F0038003F8078003FC0F0001FE1E0000FE3C00007F380000
7FF800003FF000001FE000000FE000000FF0000007F800000FF800001FFC00003CFE000038FF00
00787F0000F03F8001E01FC003C01FE003800FE0FFF03FFFFFF03FFFFFF03FFF201B7F9A23>I<
FFFC03FFFFFC03FFFFFC03FF0FF000F007F000E007F800E003F801C003F801C003FC03C001FC03
8001FE078000FE070000FF0700007F0E00007F0E00007F9E00003F9C00003FFC00001FF800001F
F800000FF000000FF000000FF0000007E0000007E0000003C0000003C000000380000003800000
078000380700007C0F0000FE0E0000FE1E0000FE1C0000FE38000074F000003FE000000F800000
20277F9A23>I E /Ft 92 125 df<001F83E000F06E3001C078780380F8780300F03007007000
070070000700700007007000070070000700700007007000FFFFFF800700700007007000070070
000700700007007000070070000700700007007000070070000700700007007000070070000700
700007007000070070000700700007007000070070003FE3FF001D20809F1B>11
D<003F0000E0C001C0C00381E00701E00701E0070000070000070000070000070000070000FFFF
E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700
E00700E00700E00700E00700E00700E03FC3FC1620809F19>I<003FE000E0E001C1E00381E007
00E00700E00700E00700E00700E00700E00700E00700E0FFFFE00700E00700E00700E00700E007
00E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700E007
00E03FE7FC1620809F19>I<001F81F80000F04F040001C07C06000380F80F000300F00F000700
F00F00070070000007007000000700700000070070000007007000000700700000FFFFFFFF0007
007007000700700700070070070007007007000700700700070070070007007007000700700700
070070070007007007000700700700070070070007007007000700700700070070070007007007
00070070070007007007003FE3FE3FE02320809F26>I<001F81FF0000F06F070001C07C0F0003
80F80F000300F00700070070070007007007000700700700070070070007007007000700700700
0700700700FFFFFFFF000700700700070070070007007007000700700700070070070007007007
000700700700070070070007007007000700700700070070070007007007000700700700070070
070007007007000700700700070070070007007007003FE3FE3FE02320809F26>I<70F8F8F8F8
F8F8F8707070707070707070702020202020000000000070F8F8F87005217CA00D>33
D<7038F87CFC7EFC7E743A0402040204020804080410081008201040200F0E7F9F17>I<000180
300000018030000001803000000180300000030060000003006000000300600000030060000003
006000000600C000000600C000000600C000000600C000000600C000000C0180007FFFFFFF00FF
FFFFFF8000180300000018030000003006000000300600000030060000003006000000600C0000
00600C0000FFFFFFFF807FFFFFFF0000C018000001803000000180300000018030000001803000
000180300000030060000003006000000300600000030060000003006000000600C000000600C0
00000600C0000021297E9F26>I<078000180018400018003020003000301800E0006017036000
6008FCC000E008018000E008018000E008030000E008060000E008060000E0080C000060081800
0060101800003010300000302060000018406000000780C0000000018078000001818400000303
020000030301000006070100000C060100000C0E008000180E008000300E008000300E00800060
0E008000C00E008000C00E008001800601000300070100030003010006000302000C0001840004
0000780021257EA126>37 D<007800000084000001840000030200000702000007020000070200
0007020000070400000704000007080000070800000390000003A00FFC03C001E003C000C001C0
008001C0010002E0010004E00200087002001878040030380800703C0800701C1000F00E1000F0
0F2000F007C000F00380047001C0047802E008380470181C183C3007E00FC01E227EA023>I<70
F8FCFC74040404080810102040060E7C9F0D>I<0040008001000300060004000C001800180038
003000300070006000600060006000E000E000E000E000E000E000E000E000E000E000E000E000
60006000600060007000300030003800180018000C000400060003000100008000400A2E7BA112
>I<8000400020003000180008000C00060006000700030003000380018001800180018001C001
C001C001C001C001C001C001C001C001C001C001C0018001800180018003800300030007000600
06000C000800180030002000400080000A2E7EA112>I<01800180018001800180E187718E399C
0FF003C003C00FF0399C718EE1870180018001800180018010147DA117>I<0003000000030000
000300000003000000030000000300000003000000030000000300000003000000030000000300
00000300000003000000030000FFFFFFFCFFFFFFFC000300000003000000030000000300000003
000000030000000300000003000000030000000300000003000000030000000300000003000000
0300001E207E9A23>I<70F0F8F878080808101010202040050E7C840D>I<FFF0FFF00C02808A0F
>I<70F8F8F87005057C840D>I<0000400000C00001800001800001800003000003000003000006
00000600000C00000C00000C0000180000180000180000300000300000600000600000600000C0
0000C00000C0000180000180000180000300000300000600000600000600000C00000C00000C00
00180000180000300000300000300000600000600000600000C00000C00000122D7EA117>I<03
F0000E1C001C0E00180600380700700380700380700380700380F003C0F003C0F003C0F003C0F0
03C0F003C0F003C0F003C0F003C0F003C0F003C0F003C0F003C070038070038070038078078038
07001806001C0E000E1C0003F000121F7E9D17>I<008003800F80F38003800380038003800380
038003800380038003800380038003800380038003800380038003800380038003800380038007
C0FFFE0F1E7C9D17>I<03F0000C1C00100E00200700400780800780F007C0F803C0F803C0F803
C02007C00007C0000780000780000F00000E00001C0000380000700000600000C0000180000300
000600400C00401800401000803FFF807FFF80FFFF80121E7E9D17>I<03F0000C1C00100E0020
0F00780F80780780780780380F80000F80000F00000F00001E00001C0000700007F000003C0000
0E00000F000007800007800007C02007C0F807C0F807C0F807C0F00780400780400F00200E0018
3C0007F000121F7E9D17>I<000600000600000E00000E00001E00002E00002E00004E00008E00
008E00010E00020E00020E00040E00080E00080E00100E00200E00200E00400E00C00E00FFFFF0
000E00000E00000E00000E00000E00000E00000E0000FFE0141E7F9D17>I<1803001FFE001FFC
001FF8001FE00010000010000010000010000010000010000011F000161C00180E001007001007
800003800003800003C00003C00003C07003C0F003C0F003C0E00380400380400700200600100C
0008380007E000121F7E9D17>I<007C000182000701000E03800C078018078038030038000078
0000700000700000F1F000F21C00F40600F80700F80380F80380F003C0F003C0F003C0F003C0F0
03C07003C07003C07003803803803807001807000C0E00061C0001F000121F7E9D17>I<400000
7FFFE07FFFC07FFFC0400080800100800100800200000400000400000800001000001000002000
00200000600000600000E00000C00001C00001C00001C00001C00003C00003C00003C00003C000
03C00003C00003C000018000131F7E9D17>I<03F0000C0C001006003003002001806001806001
806001807001807803003E03003F06001FC8000FF00003F80007FC000C7E00103F00300F806007
806001C0C001C0C000C0C000C0C000C0C000806001802001001002000C0C0003F000121F7E9D17
>I<03F0000E18001C0C00380600380700700700700380F00380F00380F003C0F003C0F003C0F0
03C0F003C07007C07007C03807C0180BC00E13C003E3C000038000038000038000070030070078
0600780E00700C002018001070000FC000121F7E9D17>I<70F8F8F87000000000000000000000
70F8F8F87005147C930D>I<70F8F8F8700000000000000000000070F0F8F87808080810101020
2040051D7C930D>I<70F8F8F8700000000000202020202070707070707070707070F8F8F8F8F8
F8F87005217C960D>I<7FFFFFF8FFFFFFFC000000000000000000000000000000000000000000
0000000000000000000000FFFFFFFC7FFFFFF81E0C7E9023>I<038007C007C007C00380000000
0000000000000001000100010001000100010003000200060006000C001C0038007000F006F00F
F00FF0077002700438180FE010207E9615>I<0FE0103C601E400EE00FF00FF00F600F001E001C
00380070006000C00080008001000100010001000100010000000000000000000000038007C007
C007C0038010207E9F15>I<000100000003800000038000000380000007C0000007C0000007C0
000009E0000009E0000009E0000010F0000010F0000010F0000020780000207800002078000040
3C0000403C0000C03E0000801E0000801E0001FFFF0001000F0001000F00020007800200078002
000780040003C0040003C00C0003C01E0003E0FF801FFE1F207F9F22>65
D<FFFFE0000F0078000F001E000F001E000F000F000F000F800F000F800F000F800F000F800F00
0F800F000F000F001F000F001E000F007C000FFFF0000F007C000F001F000F000F800F0007C00F
0003C00F0003E00F0003E00F0003E00F0003E00F0003E00F0003C00F0007C00F0007800F000F00
0F003E00FFFFF0001B1F7E9E20>I<000FE01000381C3000E0027003C00170078000F00F000070
1E0000701E0000303C0000303C0000107C00001078000010F8000000F8000000F8000000F80000
00F8000000F8000000F8000000F8000000F8000000780000007C0000103C0000103C0000101E00
00201E0000200F0000200780004003C0008000E0030000380C00000FF0001C217E9F21>I<FFFF
F80007801E0007800780078003C0078001E0078000F00780007007800078078000780780003C07
80003C0780003C0780003E0780003E0780003E0780003E0780003E0780003E0780003E0780003E
0780003C0780003C0780007C0780007807800078078000F0078001E0078003C00780078007801E
00FFFFF8001F1F7F9E23>I<FFFFFF800F000F800F0003800F0001800F0000800F0000C00F0000
400F0000400F0000400F0040400F0040000F0040000F00C0000F01C0000FFFC0000F01C0000F00
C0000F0040000F0040000F0040000F0000200F0000200F0000200F0000400F0000400F0000400F
0000C00F0001C00F0003800F000F80FFFFFF801B1F7E9E1F>I<FFFFFF80078007800780018007
80018007800080078000C007800040078000400780004007800040078020000780200007802000
078060000780E00007FFE0000780E0000780600007802000078020000780200007800000078000
0007800000078000000780000007800000078000000780000007C00000FFFE00001A1F7F9E1E>
I<000FE01000381C3000E0027003C00170078000F00F0000701E0000701E0000303C0000303C00
00107C00001078000010F8000000F8000000F8000000F8000000F8000000F8000000F8000000F8
003FFEF80001F0780000F07C0000F03C0000F03C0000F01E0000F01E0000F00F0000F0078000F0
03C0017000E0023000380C10000FF0001F217E9F24>I<FFF07FF80F0007800F0007800F000780
0F0007800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F0007
800FFFFF800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F0007800F00
07800F0007800F0007800F0007800F0007800F0007800F000780FFF07FF81D1F7E9E22>I<FFF0
0F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F
000F000F000F000F000F000F000F000F000F00FFF00C1F7E9E10>I<07FFC0003E00001E00001E
00001E00001E00001E00001E00001E00001E00001E00001E00001E00001E00001E00001E00001E
00001E00001E00001E00001E00001E00001E00201E00F81E00F81E00F81E00F01C00403C006038
001070000FC00012207F9E17>I<FFF007FC0F0003E00F0001800F0001000F0002000F0004000F
0008000F0010000F0020000F0040000F0080000F0100000F0300000F0780000F0F80000F13C000
0F21E0000F41E0000F80F0000F0078000F0078000F003C000F001E000F001E000F000F000F0007
800F0007800F0003C00F0003E00F0003F0FFF01FFE1F1F7E9E23>I<FFF8000F80000F00000F00
000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00
000F00000F00000F00000F00020F00020F00020F00020F00060F00040F00040F000C0F001C0F00
7CFFFFFC171F7E9E1C>I<FF800007FE07800007C007800007C005C0000BC005C0000BC004E000
13C004E00013C004E00013C004700023C004700023C004380043C004380043C004380043C0041C
0083C0041C0083C0040E0103C0040E0103C0040E0103C004070203C004070203C004070203C004
038403C004038403C00401C803C00401C803C00401C803C00400F003C00400F003C004006003C0
1F006003C0FFE0607FFE271F7F9E2A>I<FF000FF80F8003E00F8000800BC0008009E0008009E0
008008F000800878008008780080083C0080081E0080081E0080080F0080080780800807808008
03C0800801E0800801E0800800F080080078800800788008003C8008001E8008001E8008000F80
080007800800078008000380080001803E000180FF8000801D1F7E9E22>I<001FE00000703800
01C00E0003800700070003800F0003C01E0001E03C0000F03C0000F07C0000F87C0000F8780000
78F800007CF800007CF800007CF800007CF800007CF800007CF800007CF800007CF800007C7800
00787C0000F87C0000F83C0000F03E0001F01E0001E00F0003C0070003800380070001E01E0000
703800001FE0001E217E9F23>I<FFFFE0000F007C000F001E000F000F000F0007800F0007800F
0007C00F0007C00F0007C00F0007C00F0007800F0007800F000F000F001E000F007C000FFFE000
0F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000
000F0000000F0000000F0000000F000000FFF000001A1F7E9E1F>I<001FE0000070380001C00E
0003800700070003800F0003C01E0001E03E0001F03C0000F07C0000F87C0000F878000078F800
007CF800007CF800007CF800007CF800007CF800007CF800007CF800007CF800007C780000787C
0000F87C0000F83C0000F03E0781F01E0841E00F1023C0071023800390170001D01E0000783804
001FF80400001C0400000C0C00000E1C00000FF800000FF8000007F8000007F0000001E01E297E
9F23>I<FFFF80000F00F0000F003C000F001E000F000F000F000F000F000F800F000F800F000F
800F000F800F000F000F000F000F001E000F003C000F00F0000FFF80000F01C0000F0070000F00
70000F0038000F003C000F003C000F003C000F003E000F003E000F003E000F003E040F003F040F
001F040F000F08FFF00788000001F01E207E9E21>I<03F0400C0CC01803C03001C06000C06000
C0E000C0E00040E00040E00040F00000F800007C00007F80003FF8001FFF0007FF8000FFC0001F
E00003E00001E00000F0000070800070800070800070800070C00060C000E0E000C0F80180C603
0081FC0014217E9F19>I<7FFFFFE0780F01E0600F0060400F0020400F0020C00F0030800F0010
800F0010800F0010800F0010000F0000000F0000000F0000000F0000000F0000000F0000000F00
00000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F
0000000F0000000F0000001F800003FFFC001C1F7E9E21>I<FFF00FF80F0003E00F0000800F00
00800F0000800F0000800F0000800F0000800F0000800F0000800F0000800F0000800F0000800F
0000800F0000800F0000800F0000800F0000800F0000800F0000800F0000800F0000800F000080
0F0000800700010007800100038001000380020001C0040000E0080000383000000FC0001D207E
9E22>I<FFF003FE1F8000F80F0000600F00002007800040078000400780004003C0008003C000
8003E0018001E0010001E0010000F0020000F0020000F802000078040000780400003C0800003C
0800003C0800001E1000001E1000001F1000000F2000000F20000007C0000007C0000007C00000
0380000003800000038000000100001F207F9E22>I<FFF07FF81FF01F000FC007C00F00078001
800F00078001000F0007C001000F8007C00300078007C00200078009E0020007C009E0020003C0
09E0040003C019F0040003C010F0040001E010F0080001E010F0080001E02078080000F0207810
0000F02078100000F0403C10000078403C20000078403C20000078801E2000007C801E6000003C
801E4000003D000F4000003F000F4000001F000F8000001F000F8000001E00078000000E000700
00000E00070000000C000300000004000200002C207F9E2F>I<7FF81FF80FE007C007C0030003
C0020003E0060001F0040000F0080000F8180000781000003C2000003E6000001E4000000F8000
000F8000000780000003C0000007E0000005E0000008F0000018F8000010780000207C0000603E
0000401E0000801F0001000F8001000780020007C0060003C01F0007E0FFC01FFE1F1F7F9E22>
I<FFF001FF1F8000780F8000600780006007C0004003C0008003E0008001F0010000F0010000F8
0200007C0600003C0400003E0800001E0800001F1000000FB0000007A0000007E0000003C00000
03C0000003C0000003C0000003C0000003C0000003C0000003C0000003C0000003C0000003C000
0003C000003FFC00201F7F9E22>I<7FFFFE7E003C78003C7000786000F86000F04001E04003E0
4003C0400780000780000F00001E00001E00003C00007C0000780000F00001F00001E00203C002
03C0020780020F80060F00061E00043E000C3C000C78003C7800FCFFFFFC171F7E9E1C>I<FFFF
C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0FFFF082D7CA10D>I<080410082010201040204020804080408040B85CFC7EFC7E7C3E381C
0F0E7A9F17>I<FFFF030303030303030303030303030303030303030303030303030303030303
0303030303030303030303FFFF082D80A10D>I<1FE000303000781800781C00300E00000E0000
0E00000E0000FE00078E001E0E00380E00780E00F00E10F00E10F00E10F01E10781E103867200F
83C014147E9317>97 D<1C0000FC00001C00001C00001C00001C00001C00001C00001C00001C00
001C00001C00001C7C001D87001E01801E00C01C00E01C00701C00701C00781C00781C00781C00
781C00781C00781C00701C00F01C00E01E00C01A0180198700107C0015207E9F19>I<01FC0007
06001C0F00380F00380600780000700000F00000F00000F00000F00000F00000F0000070000078
00003800803800801C010007060001F80011147F9314>I<0001C0000FC00001C00001C00001C0
0001C00001C00001C00001C00001C00001C00001C001F1C0070DC00C03C01801C03801C07801C0
7001C0F001C0F001C0F001C0F001C0F001C0F001C07001C07001C03801C01803C00C03C0070DC0
01F1F815207F9F19>I<03F0000E1C001C0E00380700380700700700700380F00380F00380FFFF
80F00000F00000F000007000007000003800803800801C010007060001F80011147F9314>I<00
7C01C6030F070F0E060E000E000E000E000E000E000E00FFF00E000E000E000E000E000E000E00
0E000E000E000E000E000E000E000E000E000E000E007FE01020809F0E>I<0000E003E3300E3C
301C1C30380E00780F00780F00780F00780F00780F00380E001C1C001E380033E0002000002000
003000003000003FFE001FFF801FFFC03001E0600070C00030C00030C00030C000306000603000
C01C038003FC00141F7F9417>I<1C0000FC00001C00001C00001C00001C00001C00001C00001C
00001C00001C00001C00001C7C001C86001D03001E03801E03801C03801C03801C03801C03801C
03801C03801C03801C03801C03801C03801C03801C03801C03801C0380FF8FF014207E9F19>I<
38007C007C007C0038000000000000000000000000001C00FC001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C00FF80091F7F9E0C>I<00E001F001F001F000
E0000000000000000000000000007007F000F00070007000700070007000700070007000700070
007000700070007000700070007000700070007000706070F060F0C061803F000C28829E0E>I<
1C0000FC00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C1FE0
1C07801C06001C04001C08001C10001C20001C60001CE0001DF0001E70001C38001C3C001C1C00
1C0E001C0F001C07001C07801C07C0FF9FF014207E9F18>I<1C00FC001C001C001C001C001C00
1C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001C001C001C001C00FF8009207F9F0C>I<1C3E03E000FCC30C30001D039038001E01E01C001E
01E01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C00
1C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C00FF8FF8FF
8021147E9326>I<1C7C00FC86001D03001E03801E03801C03801C03801C03801C03801C03801C
03801C03801C03801C03801C03801C03801C03801C03801C0380FF8FF014147E9319>I<01F800
070E001C03803801C03801C07000E07000E0F000F0F000F0F000F0F000F0F000F0F000F07000E0
7000E03801C03801C01C0380070E0001F80014147F9317>I<1C7C00FD87001E01801E01C01C00
E01C00F01C00701C00781C00781C00781C00781C00781C00781C00701C00F01C00E01E01C01E03
801D87001C7C001C00001C00001C00001C00001C00001C00001C00001C0000FF8000151D7E9319
>I<01F040070CC00E02C01C03C03801C07801C07001C0F001C0F001C0F001C0F001C0F001C0F0
01C07001C07801C03801C01C03C00C05C00709C001F1C00001C00001C00001C00001C00001C000
01C00001C00001C0000FF8151D7F9318>I<1CF0FD181E3C1E3C1E181C001C001C001C001C001C
001C001C001C001C001C001C001C001C00FFC00E147E9312>I<0FC830386018C008C008C008E0
007C003FE01FF007F8003C800E8006C006C006C004E00CD81887E00F147F9312>I<0200020002
00060006000E000E003E00FFF80E000E000E000E000E000E000E000E000E000E000E000E040E04
0E040E040E040708030801F00E1C7F9B12>I<1C0380FC1F801C03801C03801C03801C03801C03
801C03801C03801C03801C03801C03801C03801C03801C03801C03801C07800C0780061B8003E3
F014147E9319>I<FF83F83E00E01C00C00E00800E00800E008007010007010007830003820003
820001C40001C40001E40000E80000E80000700000700000700000200015147F9318>I<FF9FE1
FC3C0780701C0300601C0380200E0380400E0380400E03C0400704C0800704E0800704E0800388
6100038871000388710001D0320001D03A0001D03E0000E01C0000E01C0000601800004008001E
147F9321>I<FF87F81E03C00E01800E030007020003840001C80001D80000F000007000007800
00F800009C00010E00020E000607000403800C03C03C03E0FE07FC16147F9318>I<FF83F83E00
E01C00C00E00800E00800E008007010007010007830003820003820001C40001C40001E40000E8
0000E800007000007000007000002000002000004000004000004000F08000F08000F100006200
003C0000151D7F9318>I<7FFF700E600E401C40384078407000E001E001C00380078007010E01
1E011C0338027006700EFFFE10147F9314>I<FFFFFC1601808C17>I<FFFFFFFFFFF02C01808C2D
>I E /Fu 55 122 df<00FE000381000601800E03801C01001C00001C00001C00001C00001C00
00FFFF801C03801C03801C03801C03801C03801C03801C03801C03801C03801C03801C03801C03
801C03801C0380FF8FF0141A809915>12 D<00FF800383800603800E03801C03801C03801C0380
1C03801C03801C0380FFFF801C03801C03801C03801C03801C03801C03801C03801C03801C0380
1C03801C03801C03801C03801C0380FF9FF0141A809915>I<60C0F1E0F9F068D0081008100810
10201020204040800C0B7F9913>34 D<60F0F86808080810102040050B7D990B>39
D<00800100020004000C00080018003000300030006000600060006000E000E000E000E000E000
E000E000E000E000E0006000600060006000300030003000180008000C00040002000100008009
267D9B0F>I<8000400020001000180008000C0006000600060003000300030003000380038003
80038003800380038003800380038003000300030003000600060006000C000800180010002000
4000800009267E9B0F>I<60F0F07010101020204040040B7D830B>44 D<FFC0FFC00A0280880D>
I<60F0F06004047D830B>I<03000700FF00070007000700070007000700070007000700070007
000700070007000700070007000700070007007FF80D187D9713>49 D<0F80106020304038803C
C01CE01C401C003C003800380070006000C001800100020004040804100430083FF87FF8FFF80E
187E9713>I<07E01838201C601E700E201E001E001C001C0038007007E00038001C000E000F00
0FE00FE00FC00F400E601C183807E010187F9713>I<07E01818300C2006600660067006780C3E
181F3007C003E00CF8307C601E600FC007C003C003C00360022004181807E010187F9713>56
D<07E01C303018700C600EE006E006E007E007E0076007700F3017182707C700070006000E000C
700C7018603030600F8010187F9713>I<60F0F060000000000000000060F0F06004107D8F0B>I<
003F0201C0C603002E0E001E1C000E1C0006380006780002700002700002F00000F00000F00000
F00000F00000F000007000027000027800023800041C00041C00080E000803003001C0C0003F00
171A7E991C>67 D<FFFFF80E00380E00180E00080E000C0E00040E00040E00040E01000E01000E
01000E03000FFF000E03000E01000E01000E01000E00000E00000E00000E00000E00000E00000E
00000E0000FFE000161A7F9919>70 D<003F020001C0C60003002E000E001E001C000E001C0006
0038000600780002007000020070000200F0000000F0000000F0000000F0000000F0000000F001
FFC070000E0070000E0078000E0038000E001C000E001C000E000E000E000300160001C0660000
3F82001A1A7E991E>I<FFE1FFC00E001C000E001C000E001C000E001C000E001C000E001C000E
001C000E001C000E001C000E001C000E001C000FFFFC000E001C000E001C000E001C000E001C00
0E001C000E001C000E001C000E001C000E001C000E001C000E001C000E001C00FFE1FFC01A1A7F
991D>I<FF801C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001C001C001C001C001C001C001C00FF80091A7E990E>I<FFE0000E00000E00000E00000E0000
0E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E0008
0E00080E00080E00180E00100E00300E00700E00F0FFFFF0151A7F9918>76
D<FF0000FF0F0000F00F0000F00B8001700B80017009C0027009C0027009C0027008E0047008E0
0470087008700870087008700870083810700838107008381070081C2070081C2070080E407008
0E4070080E40700807807008078070080300701C030070FF8307FF201A7F9923>I<FFFF800E01
E00E00700E00780E00380E003C0E003C0E003C0E003C0E00380E00780E00700E01E00FFF800E00
000E00000E00000E00000E00000E00000E00000E00000E00000E00000E0000FFE000161A7F991A
>80 D<007F000001C1C000070070000E0038001C001C003C001E0038000E0078000F0070000700
F0000780F0000780F0000780F0000780F0000780F0000780F0000780F00007807000070078000F
0038000E003C1C1E001C221C000E4138000741F00001E1C000007F80800000C0800000C0800000
E18000007F0000007F0000003E0000001C0019217E991E>I<0FC21836200E6006C006C002C002
C002E00070007E003FE01FF803FC007E000E00070003800380038003C002C006E004D81887E010
1A7E9915>83 D<7FFFFF00701C0700401C0100401C0100C01C0180801C0080801C0080801C0080
001C0000001C0000001C0000001C0000001C0000001C0000001C0000001C0000001C0000001C00
00001C0000001C0000001C0000001C0000001C0000001C0000001C000003FFE000191A7F991C>
I<FF801FC01C0007001C0006000E0004000E0004000E0004000700080007000800038010000380
10000380100001C0200001C0200000E0400000E0400000E0400000708000007080000079800000
39000000390000001E0000001E0000001E0000000C0000000C00001A1A7F991D>86
D<FF81FF07F03C007801C01C007800801C007800801C007800800E009C01000E009C01000E009C
010007010E020007010E020007010E020003830F0400038207040003820704000382070C0001C4
03880001C403880001C403880000E801D00000E801D00000E801D000007000E000007000E00000
7000E000003000C0000020004000241A7F9927>I<FEFEC0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0FEFE07257D9B0B>91 D<204020404080408081008100
8100E1C0F1E0F1E060C00B0B7A9913>I<FEFE0606060606060606060606060606060606060606
06060606060606060606060606FEFE0725809B0B>I<1FC000387000383800101C00001C00001C
0003FC001E1C00381C00701C00E01C00E01C80E01C80E03C80705F801F8F0011107F8F13>97
D<FC00001C00001C00001C00001C00001C00001C00001C00001C00001C00001CFC001D07001E03
801C01C01C00C01C00E01C00E01C00E01C00E01C00E01C00E01C01C01C01801E030019060010F8
00131A809915>I<07F81C1C381C70087000E000E000E000E000E000E0007000700438081C1807
E00E107F8F11>I<003F0000070000070000070000070000070000070000070000070000070003
E7000C1700180F00300700700700E00700E00700E00700E00700E00700E0070060070070070038
0F001C370007C7E0131A7F9915>I<07C01C3030187018600CE00CFFFCE000E000E000E0006000
700438081C1807E00E107F8F11>I<01F007180E381C101C001C001C001C001C001C00FFC01C00
1C001C001C001C001C001C001C001C001C001C001C001C001C00FF800D1A80990C>I<0FCF0018
71803030007038007038007038007038003030001860002FC0006000006000007000003FF0003F
FC001FFE00600F00C00300C00300C00300C00300600600381C0007E00011187F8F13>I<FC0000
1C00001C00001C00001C00001C00001C00001C00001C00001C00001C7C001D87001E03801E0380
1C03801C03801C03801C03801C03801C03801C03801C03801C03801C03801C0380FF9FF0141A80
9915>I<183C3C18000000000000FC1C1C1C1C1C1C1C1C1C1C1C1C1C1CFF081A80990A>I<018003
C003C001800000000000000000000000000FC001C001C001C001C001C001C001C001C001C001C0
01C001C001C001C001C001C001C001C041C0E180E3007E000A2182990C>I<FC00001C00001C00
001C00001C00001C00001C00001C00001C00001C00001C1FC01C0F001C0C001C18001C20001C40
001CE0001DE0001E70001C78001C38001C1C001C1E001C0F001C0F80FF9FE0131A809914>I<FC
001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C00
1C001C001C001C001C00FF80091A80990A>I<FC7C1F001D8E63801E0781C01E0781C01C0701C0
1C0701C01C0701C01C0701C01C0701C01C0701C01C0701C01C0701C01C0701C01C0701C01C0701
C0FF9FE7F81D107F8F20>I<FC7C001D87001E03801E03801C03801C03801C03801C03801C0380
1C03801C03801C03801C03801C03801C0380FF9FF01410808F15>I<07E01C38300C700E6006E0
07E007E007E007E007E0076006700E381C1C3807E010107F8F13>I<FCFC001D07001E03801C01
C01C01C01C00E01C00E01C00E01C00E01C00E01C00E01C01C01C01801E03001D06001CF8001C00
001C00001C00001C00001C00001C0000FF80001317808F15>I<FC781D9C1E1C1E081C001C001C
001C001C001C001C001C001C001C001C00FF800E10808F0F>114 D<1F2060E04020C020C020F0
007F003FC01FE000F080708030C030C020F0408F800C107F8F0F>I<0800080008000800180018
003800FFC038003800380038003800380038003800382038203820382018201C4007800B177F96
0F>I<FC1F801C03801C03801C03801C03801C03801C03801C03801C03801C03801C03801C0380
1C07800C07800E0B8003F3F01410808F15>I<FF0F803C07001C06001C04001C04000E08000E08
0007100007100007100003A00003A00001C00001C00001C00000800011107F8F14>I<FE7F1F80
381C07003C1C06001C0C04001C0E04000E1608000E1708000E170800072310000723900007A390
0003C1A00003C1E0000180C0000180C0000180C00019107F8F1C>I<FE3F803C1E001C08000E10
000F300007600003C00001C00001E00003E000027000043800083800181C00381E00FC3FC01210
7F8F14>I<FF0F803C07001C06001C04001C04000E08000E080007100007100007100003A00003
A00001C00001C00001C000008000008000010000010000E10000E20000E4000078000011177F8F
14>I E /Fv 1 4 df<0C000C00CCC0EDC07F800C007F80EDC0CCC00C000C000A0B7D8B10>3
D E /Fw 4 116 df<1FE0003FF0007FF800783C00300E00000E00000E0003FE001FFE003E0E00
700E00E00E00E00E00E00E00783E007FFFE03FE7E00F83E013127E9116>97
D<03F80FFC1FFE3C1E780C7000E000E000E000E000E000F000700778073E0E1FFC0FF803F01012
7D9116>99 D<03F0000FFC001FFE003C0F00780700700380E00380FFFF80FFFF80FFFF80E00000
E000007003807803803E07801FFF0007FE0001F80011127E9116>101 D<0FEC3FFC7FFCF03CE0
1CE01C70007F801FF007F8003C600EE00EF00EF81EFFFCFFF8C7E00F127D9116>115
D E /Fx 26 118 df<3078F06005047C830D>46 D<003E0000E1800181C00300C00700C00600C0
0E00E00C00E01C00C01C00C01801C03801C03801C03801C0700380700380700380700380600700
E00700E00600E00E00E00E00E00C00E0180060380060700030C0001F0000131D7C9B15>48
D<0004000C00180038007807B8007000700070007000E000E000E000E001C001C001C001C00380
03800380038007000700070007000F00FFF00E1C7B9B15>I<003E000041800080C00100C00200
E00440E00440E00840E00840E00840E01081C01081C01103800E0300000600000C000018000060
000080000300000400000800401000802000802001007F070043FE0081FC00807800131D7D9B15
>I<001F000060C00080C00100600200600240600440E00440E00440E00481C00301C000038000
070000FC00001C00000600000600000700000700000700000700700700E00E00800E00801C0040
180040300020E0001F8000131D7D9B15>I<0001800001C0000380000380000380000300000700
000700000600000E00000C00001C0000180000180000300000300000600000400000C600018E00
010E00020E00061C000C1C00181C003F1C0040F800803F80003800003800007000007000007000
00700000E00000600012247E9B15>I<00806001FFC001FF8001FE000100000200000200000200
0002000004000004F800050C000606000C0600080600000600000700000600000E00000E00700E
00700C00E01C0080180080380040300040600021C0001F0000131D7C9B15>I<0003F020001E0C
60003002E000E003C001C001C0038001C0070000C00E0000801E0000801C0000803C0000803C00
0000780000007800000078000000F0000000F0000000F0000000F0000000F0000400F0000400F0
000400F0000800700008007000100038002000180040000C0180000706000001F800001B1E7A9C
1E>67 D<0003F020001E0C60003002E000E003C001C001C0038001C0070000C00E0000801E0000
801C0000803C0000803C000000780000007800000078000000F0000000F0000000F001FF80F000
1E00F0001C00F0001C00F0001C00F0001C00700038007000380038003800180078000C00900007
07100001F800001B1E7A9C20>71 D<000F8400304C00403C008018010018030018030018060010
06001006000007000007000003E00003FC0001FF00007F800007C00001C00001C00000C00000C0
2000C02000C0600180600180600300600200F00400CC180083E000161E7D9C17>83
D<1FFFFFC01C0701C0300E00C0200E0080600E0080400E0080401C0080801C0080801C0080001C
0000003800000038000000380000003800000070000000700000007000000070000000E0000000
E0000000E0000000E0000001C0000001C0000001C0000001C0000003C000007FFE00001A1C799B
1E>I<FF801FC03C0007001C0004001C0004001C0008001C0010001C0010001C0020001C002000
1C0040001C0080001C0080000E0100000E0100000E0200000E0400000E0400000E0800000E0800
000E1000000E2000000F2000000740000007400000078000000700000007000000060000000600
00001A1D779B1F>86 D<01E307170C0F180F380E300E700E700EE01CE01CE01CE01CE039E039E0
396079319A1E0C10127C9115>97 D<0007E00000E00000E00001C00001C00001C00001C0000380
00038000038000038001E7000717000C0F00180F00380E00300E00700E00700E00E01C00E01C00
E01C00E01C00E03900E03900E03900607900319A001E0C00131D7C9C15>100
D<00F807040C0418023804300470087FF0E000E000E000E000E00060046008301030600F800F12
7C9113>I<0078C001C5C00303C00603C00E03800C03801C03801C038038070038070038070038
0700380E00380E00380E00181E000C7C00079C00001C00001C00003800003800C03000E07000C1
C0007F0000121A7E9113>103 D<0FC00001C00001C00003800003800003800003800007000007
00000700000700000E3E000EC3000F03800E03801E03801C03801C03801C038038070038070038
0700380E00700E40700E40701C40701C80E00C80600700121D7E9C15>I<018003800100000000
00000000000000000000001C002600470047008E008E000E001C001C001C003800380071007100
7100720072003C00091C7C9B0D>I<1F800380038007000700070007000E000E000E000E001C00
1C001C001C0038003800380038007000700070007000E200E200E200E40064003800091D7D9C0B
>108 D<383E004CC3004D03804E03809E03809C03801C03801C0380380700380700380700380E
00700E40700E40701C40701C80E00C8060070012127C9117>110 D<00F800030C000E06001C03
00180300300300700380700380E00700E00700E00700E00E00E00E00E01C0060180060300030E0
000F800011127C9115>I<03878004C86004D03004E03009C03009C03801C03801C03803807003
80700380700380600700E00700C00701800783000E86000E78000E00000E00001C00001C00001C
00001C0000380000FF0000151A809115>I<1C3C2642468747078E068E000E000E001C001C001C
001C0038003800380038007000300010127C9112>114 D<01F006080C080C1C18181C001F001F
C00FF007F0007800386030E030C030806060C01F000E127D9111>I<03000700070007000E000E
000E000E00FFE01C001C001C0038003800380038007000700070007000E080E080E100E1006600
38000B1A7C990E>I<1C01802E03804E03804E03808E07008E07001C07001C0700380E00380E00
380E00380E00301C80301C80301C80383C80184D000F860011127C9116>I
E /Fy 63 125 df<007E0001C1800301800703C00E03C00E01800E00000E00000E00000E00000E
0000FFFFC00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E
01C00E01C00E01C00E01C00E01C07F87F8151D809C17>12 D<003F07E00001C09C18000380F018
000701F03C000E01E03C000E00E018000E00E000000E00E000000E00E000000E00E000000E00E0
0000FFFFFFFC000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00
E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E
00E01C000E00E01C007FC7FCFF80211D809C23>14 D<6060F0F0F8F86868080808080808101010
102020404080800D0C7F9C15>34 D<00800100020006000C000C00180018003000300030006000
600060006000E000E000E000E000E000E000E000E000E000E000E000E000600060006000600030
0030003000180018000C000C000600020001000080092A7C9E10>40 D<80004000200030001800
18000C000C00060006000600030003000300030003800380038003800380038003800380038003
800380038003000300030003000600060006000C000C00180018003000200040008000092A7E9E
10>I<60F0F0701010101020204080040C7C830C>44 D<FFE0FFE00B0280890E>I<60F0F0600404
7C830C>I<03C00C301818300C300C700E60066006E007E007E007E007E007E007E007E007E007
E007E007E007E00760066006700E300C300C18180C3007E0101D7E9B15>48
D<010007003F00C700070007000700070007000700070007000700070007000700070007000700
07000700070007000700070007000700FFF80D1C7C9B15>I<07E01830201C201C781E780E781E
381E001C001C00180030006007C00030001C001C000E000F000F700FF80FF80FF80FF00E401C20
1C183007C0101D7E9B15>51 D<000C00000C00001C00003C00003C00005C0000DC00009C00011C
00031C00021C00041C000C1C00081C00101C00301C00201C00401C00C01C00FFFFC0001C00001C
00001C00001C00001C00001C00001C0001FFC0121C7F9B15>I<300C3FF83FF03FC02000200020
0020002000200023E02C303018301C200E000E000F000F000F600FF00FF00FF00F800E401E401C
2038187007C0101D7E9B15>I<00F0030C04040C0E181E301E300C700070006000E3E0E430E818
F00CF00EE006E007E007E007E007E007600760077006300E300C18180C3003E0101D7E9B15>I<
03E00C301008200C200660066006700670067C0C3E183FB01FE007F007F818FC307E601E600FC0
07C003C003C003C00360026004300C1C1007E0101D7E9B15>56 D<03C00C301818300C700C600E
E006E006E007E007E007E007E0076007700F300F18170C2707C700060006000E300C780C781870
18203010C00F80101D7E9B15>I<60F0F0600000000000000000000060F0F06004127C910C>I<60
F0F0600000000000000000000060F0F0701010101020204080041A7C910C>I<00060000000600
0000060000000F0000000F0000000F000000178000001780000037C0000023C0000023C0000043
E0000041E0000041E0000080F0000080F0000080F000010078000100780001FFF80002003C0002
003C0002003C0004001E0004001E000C001F000C000F001E001F00FF00FFF01C1D7F9C1F>65
D<FFFFC0000F0078000F003C000F001E000F000E000F000F000F000F000F000F000F000F000F00
0E000F001E000F003C000F00F8000FFFF0000F003C000F001E000F000F000F0007000F0007800F
0007800F0007800F0007800F0007800F000F000F000F000F001E000F007800FFFFE000191C7F9B
1D>I<001F808000E0618001801980070007800E0003801C0003801C0001803800018078000080
7800008070000080F0000000F0000000F0000000F0000000F0000000F0000000F0000000F00000
00700000807800008078000080380000801C0001001C0001000E000200070004000180080000E0
3000001FC000191E7E9C1E>I<FFFFC0000F00F0000F003C000F000E000F0007000F0007000F00
03800F0003C00F0001C00F0001C00F0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F
0001E00F0001E00F0001C00F0001C00F0003C00F0003800F0007800F0007000F000E000F001C00
0F007000FFFFC0001B1C7E9B20>I<FFFFFC0F003C0F000C0F00040F00040F00060F00020F0002
0F01020F01000F01000F01000F03000FFF000F03000F01000F01000F01000F01010F00010F0002
0F00020F00020F00060F00060F000C0F003CFFFFFC181C7E9B1C>I<FFFFF80F00780F00180F00
080F00080F000C0F00040F00040F01040F01000F01000F01000F03000FFF000F03000F01000F01
000F01000F01000F00000F00000F00000F00000F00000F00000F00000F0000FFF800161C7E9B1B
>I<001F808000E0618001801980070007800E0003801C0003801C000180380001807800008078
00008070000080F0000000F0000000F0000000F0000000F0000000F0000000F000FFF0F0000F80
700007807800078078000780380007801C0007801C0007800E00078007000B800180118000E060
80001F80001C1E7E9C21>I<FFF0FFF00F000F000F000F000F000F000F000F000F000F000F000F
000F000F000F000F000F000F000F000F000F000F000F000F000FFFFF000F000F000F000F000F00
0F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F
000F00FFF0FFF01C1C7F9B1F>I<FFF00F000F000F000F000F000F000F000F000F000F000F000F
000F000F000F000F000F000F000F000F000F000F000F000F000F000F00FFF00C1C7F9B0F>I<07
FF80007C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C0000
3C00003C00003C00003C00003C00003C00003C00003C00703C00F83C00F83C00F8380070780040
700030E0000F8000111D7F9B15>I<FFF8000F80000F00000F00000F00000F00000F00000F0000
0F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00080F00080F0008
0F00180F00180F00100F00300F00700F01F0FFFFF0151C7E9B1A>76 D<FF8000FF800F8000F800
0F8000F8000BC00178000BC00178000BC001780009E002780009E002780008F004780008F00478
0008F0047800087808780008780878000878087800083C107800083C107800083C107800081E20
7800081E207800081E207800080F407800080F4078000807807800080780780008078078000803
0078001C03007800FF8307FF80211C7E9B26>I<FF001FF00F8003800FC001000BC0010009E001
0008F0010008F0010008780100083C0100083E0100081E0100080F0100080F8100080781000803
C1000801E1000801F1000800F1000800790008007D0008003D0008001F0008001F0008000F0008
000700080003001C000300FF8001001C1C7F9B1F>I<003F800000E0E0000380380007001C000E
000E001C0007003C00078038000380780003C0780003C0700001C0F00001E0F00001E0F00001E0
F00001E0F00001E0F00001E0F00001E0F00001E0700001C0780003C0780003C0380003803C0007
801C0007000E000E0007001C000380380000E0E000003F80001B1E7E9C20>I<FFFF800F00E00F
00780F003C0F001C0F001E0F001E0F001E0F001E0F001E0F001C0F003C0F00780F00E00FFF800F
00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F0000FFF00017
1C7E9B1C>I<07E0801C1980300580300380600180E00180E00080E00080E00080F00000F80000
7C00007FC0003FF8001FFE0007FF0000FF80000F800007C00003C00001C08001C08001C08001C0
C00180C00180E00300D00200CC0C0083F800121E7E9C17>83 D<7FFFFFC0700F01C0600F00C040
0F0040400F0040C00F0020800F0020800F0020800F0020000F0000000F0000000F0000000F0000
000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F00
00000F0000000F0000000F0000001F800003FFFC001B1C7F9B1E>I<FFE00FF01F0003C01F0001
800F0001000F000100078002000780020007C0020003C0040003C0040003E00C0001E0080001E0
080000F0100000F0100000F810000078200000782000003C4000003C4000003C4000001E800000
1E8000001F8000000F0000000F00000006000000060000000600001C1D7F9B1F>86
D<FFF003FC0F8001E0078000C007C0008003C0010003E0030001E0020000F0040000F804000078
0800007C1800003C1000003E2000001F2000000F4000000FC00000078000000780000007800000
07800000078000000780000007800000078000000780000007800000078000007FF8001E1C809B
1F>89 D<08081010202040404040808080808080B0B0F8F8787830300D0C7A9C15>92
D<1FC000307000783800781C00301C00001C00001C0001FC000F1C00381C00701C00601C00E01C
40E01C40E01C40603C40304E801F870012127E9115>97 D<FC00001C00001C00001C00001C0000
1C00001C00001C00001C00001C00001C00001C7C001D87001E01801C00C01C00E01C00601C0070
1C00701C00701C00701C00701C00701C00601C00E01C00C01E018019070010FC00141D7F9C17>
I<03F80C0C181E301E700C6000E000E000E000E000E000E00060007002300218040C1803E00F12
7F9112>I<001F8000038000038000038000038000038000038000038000038000038000038003
F3800E0B80180780300380700380600380E00380E00380E00380E00380E00380E0038060038070
03803003801807800E1B8003E3F0141D7F9C17>I<07E00C301818300C700E6006E006FFFEE000
E000E000E00060007002300218040C1803E00F127F9112>I<00F8018C071E061E0E0C0E000E00
0E000E000E000E00FFE00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E
000E007FE00F1D809C0D>I<00038007C4C01C78C0383880301800701C00701C00701C00701C00
3018003838001C700027C0002000002000003000003FF8001FFF001FFF802003806001C0C000C0
C000C0C000C06001803003001C0E0007F800121C7F9215>I<FC00001C00001C00001C00001C00
001C00001C00001C00001C00001C00001C00001C7C001C87001D03001E03801C03801C03801C03
801C03801C03801C03801C03801C03801C03801C03801C03801C03801C0380FF9FF0141D7F9C17
>I<18003C003C0018000000000000000000000000000000FC001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C00FF80091D7F9C0C>I<FC00001C00001C00001C00
001C00001C00001C00001C00001C00001C00001C00001C0FE01C07801C06001C0C001C10001C20
001C40001CE0001DE0001E70001C78001C38001C3C001C1C001C0E001C0F001C0F80FF9FE0131D
7F9C16>107 D<FC001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C00
1C001C001C001C001C001C001C001C001C001C001C001C00FF80091D7F9C0C>I<FC7E07E0001C
838838001D019018001E01E01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C00
1C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C
00FF8FF8FF8021127F9124>I<FC7C001C87001D03001E03801C03801C03801C03801C03801C03
801C03801C03801C03801C03801C03801C03801C03801C0380FF9FF014127F9117>I<03F0000E
1C00180600300300700380600180E001C0E001C0E001C0E001C0E001C0E001C060018070038030
03001806000E1C0003F00012127F9115>I<FC7C001D87001E01801C01C01C00E01C00E01C0070
1C00701C00701C00701C00701C00701C00E01C00E01C01C01E01801D07001CFC001C00001C0000
1C00001C00001C00001C00001C0000FF8000141A7F9117>I<03E0800E19801805803807807003
80700380E00380E00380E00380E00380E00380E003807003807003803807801807800E1B8003E3
80000380000380000380000380000380000380000380001FF0141A7F9116>I<FCE01D381E781E
781C301C001C001C001C001C001C001C001C001C001C001C001C00FFC00D127F9110>I<1F9020
704030C010C010E010F8007F803FE00FF000F880388018C018C018E010D0608FC00D127F9110>
I<04000400040004000C000C001C003C00FFE01C001C001C001C001C001C001C001C001C001C10
1C101C101C101C100C100E2003C00C1A7F9910>I<FC1F801C03801C03801C03801C03801C0380
1C03801C03801C03801C03801C03801C03801C03801C03801C07800C07800E1B8003E3F014127F
9117>I<FF07E03C03801C01001C01000E02000E02000F060007040007040003880003880003C8
0001D00001D00000E00000E00000E00000400013127F9116>I<FF3FC7E03C0703C01C0701801C
0701001C0B01000E0B82000E0B82000E1182000711C4000711C4000720C40003A0E80003A0E800
03C0680001C0700001C0700001803000008020001B127F911E>I<FF0FE01E07001C06000E0400
07080003900003B00001E00000E00000F00001F000013800021C00041C000C0E001807003C0780
FE1FF014127F9116>I<FF07E03C03801C01001C01000E02000E02000F06000704000704000388
0003880003C80001D00001D00000E00000E00000E000004000004000008000008000F08000F100
00F30000660000380000131A7F9116>I<FFFFFFFFFF802901808B2A>124
D E /Fz 7 117 df<00038000000380000007C0000007C0000007C000000FE000000FE000001F
F000001BF000003BF8000031F8000031F8000060FC000060FC0000E0FE0000C07E0000C07E0001
803F0001FFFF0003FFFF8003001F8007001FC006000FC006000FC00C0007E00C0007E0FF803FFE
FF803FFE1F1C7E9B24>65 D<0FF8001C1E003E0F803E07803E07C01C07C00007C0007FC007E7C0
1F07C03C07C07C07C0F807C0F807C0F807C0780BC03E13F80FE1F815127F9117>97
D<FF0000FF00001F00001F00001F00001F00001F00001F00001F00001F00001F00001F3F801FE1
E01F80701F00781F003C1F003C1F003E1F003E1F003E1F003E1F003E1F003E1F003C1F003C1F00
781F80701EC1E01C3F00171D7F9C1B>I<03FC000E0E001C1F003C1F00781F00780E00F80000F8
0000F80000F80000F80000F800007800007801803C01801C03000E0E0003F80011127E9115>I<
FE3E00FE47001E8F801E8F801E8F801F07001F00001F00001F00001F00001F00001F00001F0000
1F00001F00001F0000FFE000FFE00011127F9114>114 D<1FD830786018E018E018F000FF807F
E07FF01FF807FC007CC01CC01CE01CE018F830CFC00E127E9113>I<0300030003000300070007
000F000F003FFCFFFC1F001F001F001F001F001F001F001F001F001F0C1F0C1F0C1F0C0F080798
03F00E1A7F9913>I E /FA 38 122 df<70F8FCFC7404040404080810102040060F7C840E>44
D<70F8F8F87005057C840E>46 D<01F000071C000C06001803003803803803807001C07001C070
01C07001C0F001E0F001E0F001E0F001E0F001E0F001E0F001E0F001E0F001E0F001E0F001E0F0
01E0F001E0F001E07001C07001C07001C07803C03803803803801C07000C0600071C0001F00013
227EA018>48 D<008003800F80F380038003800380038003800380038003800380038003800380
03800380038003800380038003800380038003800380038003800380038007C0FFFE0F217CA018
>I<03F0000C1C001007002007804003C04003C08003E0F003E0F801E0F801E0F801E02003E000
03E00003C00003C0000780000700000E00001C0000180000300000600000C00001800001000002
00200400200800201800603000403FFFC07FFFC0FFFFC013217EA018>I<01F800060E00080300
1001802001806000C06000C06000C07000C07000C07801803E01003F02001FC4000FF80003F800
01FC00067E00083F00100F803007C06003C06000E0C000E0C00060C00060C00060C00060600040
6000C03000801803000E0E0003F00013227EA018>56 D<01F000060C000C060018070038038070
0380700380F001C0F001C0F001C0F001E0F001E0F001E0F001E0F001E07001E07003E03803E018
05E00C05E00619E003E1E00001C00001C00001C0000380000380300380780700780600700C0020
18001030000FC00013227EA018>I<000FE00000701C0000800200030001800400004008000020
080000201007C01020183008203008084060040440C0078441C0038481C0038283800382838003
82838003828380038283800382838003828380038281C0038241C0038240C00782406007842030
0B84201831881007C0F00800000008000000040000000300000E00800078007007C0000FFC001F
237DA226>64 D<0007E0100038183000E0063001C00170038000F0070000F00E0000701E000070
1C0000303C0000303C0000307C0000107800001078000010F8000000F8000000F8000000F80000
00F8000000F8000000F8000000F800000078000000780000107C0000103C0000103C0000101C00
00201E0000200E000040070000400380008001C0010000E0020000381C000007E0001C247DA223
>67 D<FFFFF0000F801E000780070007800380078001C0078000E0078000F00780007807800078
0780007C0780003C0780003C0780003C0780003E0780003E0780003E0780003E0780003E078000
3E0780003E0780003E0780003E0780003C0780003C0780007C0780007807800078078000F00780
00E0078001E0078003C0078007000F801E00FFFFF0001F227EA125>I<0007F008003C0C1800E0
021801C001B8038000F8070000780F0000381E0000381E0000183C0000183C0000187C00000878
00000878000008F8000000F8000000F8000000F8000000F8000000F8000000F8000000F8001FFF
780000F8780000787C0000783C0000783C0000781E0000781E0000780F00007807000078038000
B801C000B800E00318003C0C080007F00020247DA226>71 D<03FFE0001F00000F00000F00000F
00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F
00000F00000F00000F00000F00000F00000F00000F00000F00700F00F80F00F80F00F80E00F01E
00401C0020380018700007C00013237EA119>74 D<FFFC001F80000F00000F00000F00000F0000
0F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F0000
0F00000F00000F00000F00010F00010F00010F00010F00030F00030F00020F00060F00060F001E
1F007EFFFFFE18227DA11E>76 D<FFFFF0000F803C0007800F0007800780078007C0078003C007
8003E0078003E0078003E0078003E0078003E0078003E0078003C0078007C00780078007800F00
07803C0007FFF00007800000078000000780000007800000078000000780000007800000078000
000780000007800000078000000780000007800000078000000FC00000FFFC00001B227EA121>
80 D<000FE00000783C0000E00E0003C00780078003C00F0001E00E0000E01E0000F03E0000F8
3C0000787C00007C7C00007C7800003C7800003CF800003EF800003EF800003EF800003EF80000
3EF800003EF800003EF800003EF800003E7800003C7C00007C7C00007C3C0000783C0000781E03
80F00E0420E00F0801E0078813C003C8178000E80E00007C3C02000FEC0200000C0200000C0200
000E0600000F0E000007FC000007FC000007F8000003F8000001E01F2D7DA226>I<03F0200C0C
601802603001E07000E0600060E00060E00060E00020E00020E00020F00000F000007800007F00
003FF0001FFE000FFF0003FF80003FC00007E00001E00000F00000F00000708000708000708000
70800070C00060C00060E000C0F000C0C80180C6070081FC0014247DA21B>83
D<FFFC07FF0FC000F8078000700780002007800020078000200780002007800020078000200780
002007800020078000200780002007800020078000200780002007800020078000200780002007
8000200780002007800020078000200780002007800020078000200380004003C0004003C00040
01C0008000E000800060010000300600001C08000003F00020237EA125>85
D<1FE000303800780C00780E0030070000070000070000070000FF0007C7001E07003C07007807
00700700F00708F00708F00708F00F087817083C23900FC1E015157E9418>97
D<01FE000703000C07801C0780380300780000700000F00000F00000F00000F00000F00000F000
00F000007000007800403800401C00800C010007060001F80012157E9416>99
D<0000E0000FE00001E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000
E00000E001F8E00704E00C02E01C01E03800E07800E07000E0F000E0F000E0F000E0F000E0F000
E0F000E0F000E07000E07800E03800E01801E00C02E0070CF001F0FE17237EA21B>I<01FC0007
07000C03801C01C03801C07801E07000E0F000E0FFFFE0F00000F00000F00000F00000F0000070
00007800203800201C00400E008007030000FC0013157F9416>I<003E0000E30001C780038780
030780070000070000070000070000070000070000070000070000070000FFF800070000070000
070000070000070000070000070000070000070000070000070000070000070000070000070000
0700000700000700000780007FF000112380A20F>I<00007003F1980E1E181C0E183807003807
007807807807807807807807803807003807001C0E001E1C0033F0002000002000003000003800
003FFE001FFFC00FFFE03000F0600030C00018C00018C00018C000186000306000303800E00E03
8003FE0015217F9518>I<1C003E003E003E001C00000000000000000000000000000000000E00
7E001E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E00FF
C00A227FA10E>105 D<00E001F001F001F000E000000000000000000000000000000000007007
F000F0007000700070007000700070007000700070007000700070007000700070007000700070
007000700070007000706070F0E0F0C061803F000C2C83A10F>I<0E0000FE00001E00000E0000
0E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E03FC0E01F00E01C0
0E01800E02000E04000E08000E10000E38000EF8000F1C000E1E000E0E000E07000E07800E03C0
0E01C00E01E00E00F00E00F8FFE3FE17237FA21A>I<0E00FE001E000E000E000E000E000E000E
000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E00
0E000E000E000E000E000E00FFE00B237FA20E>I<0E1FC07F00FE60E183801E807201C00F003C
00E00F003C00E00E003800E00E003800E00E003800E00E003800E00E003800E00E003800E00E00
3800E00E003800E00E003800E00E003800E00E003800E00E003800E00E003800E00E003800E00E
003800E0FFE3FF8FFE27157F942A>I<0E1F80FE60C01E80E00F00700F00700E00700E00700E00
700E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700E00700E0070FFE7
FF18157F941B>I<01FC000707000C01801800C03800E0700070700070F00078F00078F00078F0
0078F00078F00078F000787000707800F03800E01C01C00E038007070001FC0015157F9418>I<
0E1F00FE61C00E80600F00700E00380E003C0E003C0E001E0E001E0E001E0E001E0E001E0E001E
0E001E0E003C0E003C0E00380F00700E80E00E41C00E3F000E00000E00000E00000E00000E0000
0E00000E00000E00000E0000FFE000171F7F941B>I<0E3CFE461E8F0F0F0F060F000E000E000E
000E000E000E000E000E000E000E000E000E000E000F00FFF010157F9413>114
D<0F8830786018C018C008C008E008F0007F003FE00FF001F8003C801C800C800CC00CC008E018
D0308FC00E157E9413>I<02000200020002000600060006000E001E003E00FFFC0E000E000E00
0E000E000E000E000E000E000E000E000E040E040E040E040E040E040708030801F00E1F7F9E13
>I<0E0070FE07F01E00F00E00700E00700E00700E00700E00700E00700E00700E00700E00700E
00700E00700E00700E00700E00F00E00F006017003827800FC7F18157F941B>I<FF80FE1E0078
1E00300E00200E00200700400700400780C003808003808001C10001C10000E20000E20000E200
00740000740000380000380000380000100017157F941A>I<FF8FF87F3E01E03C1C01C0181C01
E0180E01E0100E0260100E027010070270200704302007043820038438400388184003881C4001
C81C8001D00C8001D00E8000F00F0000E0070000E00700006006000040020020157F9423>I<FF
80FE1E00781E00300E00200E00200700400700400780C003808003808001C10001C10000E20000
E20000E200007400007400003800003800003800001000001000002000002000002000004000F0
4000F08000F180004300003C0000171F7F941A>121 D E /FB 1 4 df<00C00000C00000C00000
C00000C000E0C1C0F0C3C038C7000EDC0003F00000C00003F0000EDC0038C700F0C3C0E0C1C000
C00000C00000C00000C00000C00012157D9619>3 D E /FC 31 123 df<FFFF80FFFF80FFFF80
11037F9016>45 D<78FCFCFCFC7806067A8512>I<007F800001FFF0000701F8000C007E001800
1F0010000F0020000F80400007C0400007C0400003E0B00003E0F80003E0FC0003E0FC0003E0FC
0003E0780003E0000003E0000007C0000007C00000078000000F8000000F0000001F0000001E00
00003C0000007800000070000000E0000001C0000003800000070000000E0000000C0000001800
00003000000060000000C000200180002003000020060000400C00004008000040100000C03FFF
FFC07FFFFF80FFFFFF80FFFFFF801B2F7DAE21>50 D<0C0003000F801E000FFFFC000FFFF8000F
FFE00008FF00000800000008000000080000000800000008000000080000000800000008000000
08000000080000000800000008000000081FC00008E07000090038000A001C000C000E00080007
000000078000000780000003C0000003C0000003C0000003E0000003E0000003E0000003E07800
03E0F80003E0F80003E0F80003E0F00003C0C00007C0400007804000078020000F0030000F0018
001E000E003C000780F00001FFE000007F00001B307DAE21>53 D<78FCFCFCFC78000000000000
0000000000000000000000000078FCFCFCFC78061F7A9E12>58 D<00001FE000800000FFFC0180
0007F00F0180000F80018380003E0000C38000780000278000F00000178001E000000F8003C000
000F800780000007800780000003800F00000003801F00000001801E00000001803E0000000180
3C00000001803C00000000807C00000000807C0000000080780000000000F80000000000F80000
000000F80000000000F80000000000F80000000000F80000000000F80000000000F80000000000
F80000000000F80000000000F800000FFFFC7800000FFFFC7C0000001FC07C0000000F803C0000
000F803C0000000F803E0000000F801E0000000F801F0000000F800F0000000F80078000000F80
07C000000F8003C000000F8001E000000F8000F000001780007C00001780003E00006380000F80
00C3800007F00781800000FFFE008000001FF000002E337CB134>71 D<FFFF80FFFF8007F00003
E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003
E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003
E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003
E00003E00003E00003E00007F000FFFF80FFFF8011317DB017>73 D<007F802001FFE02007C078
600F001C601E0006E03C0003E0380001E0780000E0700000E070000060F0000060F0000060F000
0020F0000020F0000020F8000020F80000007C0000007E0000003F0000003FC000001FF800000F
FF800007FFF00003FFFC0000FFFF00000FFF800000FFC000001FE0000007E0000003F0000001F0
000000F0000000F8000000F88000007880000078800000788000007880000078C0000078C00000
70E00000F0E00000E0F00000E0F80001C0EC000380C7000700C1F01E00807FFC00800FF0001D33
7CB125>83 D<7FFFFFFFFFE07FFFFFFFFFE07E000F8007E078000F8001E070000F8000E060000F
80006040000F80002040000F800020C0000F800030C0000F80003080000F80001080000F800010
80000F80001080000F80001080000F80001080000F80001000000F80000000000F80000000000F
80000000000F80000000000F80000000000F80000000000F80000000000F80000000000F800000
00000F80000000000F80000000000F80000000000F80000000000F80000000000F80000000000F
80000000000F80000000000F80000000000F80000000000F80000000000F80000000000F800000
00000F80000000000F80000000000F80000000000F80000000000F80000000000F80000000000F
80000000000F80000000001FC00000000FFFFF8000000FFFFF80002C317EB030>I<FFFE000007
FFFFFE000007FF07F0000001F807E0000000E003E00000004003F00000004001F00000008001F0
0000008001F80000018000F80000010000F800000100007C00000200007C00000200007E000002
00003E00000400003E00000400001F00000800001F00000800001F80000800000F80001000000F
80001000000FC00030000007C00020000007C00020000003E00040000003E00040000003F00040
000001F00080000001F00080000000F80100000000F80100000000FC01000000007C0200000000
7C02000000007E06000000003E04000000003E04000000001F08000000001F08000000001F8800
0000000F90000000000F900000000007E00000000007E00000000007E00000000003C000000000
03C00000000003C0000000000180000000000180000030327FB032>86 D<00FE00000303C0000C
00E00010007000100038003C003C003E001C003E001E003E001E0008001E0000001E0000001E00
00001E00000FFE0000FC1E0003E01E000F801E001F001E003E001E003C001E007C001E00F8001E
04F8001E04F8001E04F8003E04F8003E0478003E047C005E043E008F080F0307F003FC03E01E1F
7D9E21>97 D<001FC00000F0300001C00C00078002000F0002000E000F001E001F003C001F003C
001F007C00040078000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000
F8000000F8000000780000007C0000003C0000003C0000801E0000800E0001000F000100078002
0001C00C0000F03000001FC000191F7E9E1D>99 D<000000F00000001FF00000001FF000000001
F000000000F000000000F000000000F000000000F000000000F000000000F000000000F0000000
00F000000000F000000000F000000000F000000000F000000000F000000000F000000000F00000
0FC0F000007030F00001C00CF000038002F000070001F0000E0001F0001E0000F0003C0000F000
3C0000F0007C0000F000780000F000780000F000F80000F000F80000F000F80000F000F80000F0
00F80000F000F80000F000F80000F000780000F000780000F0007C0000F0003C0000F0003C0000
F0001E0000F0000E0001F000070002F000038004F00001C008F80000F030FF80001FC0FF802132
7EB125>I<003F800000E0E0000380380007003C000E001E001E001E001C000F003C000F007C00
0F0078000F8078000780F8000780F8000780FFFFFF80F8000000F8000000F8000000F8000000F8
000000F8000000780000007C0000003C0000003C0000801E0000800E0001000F00020007000200
01C00C0000F03000001FC000191F7E9E1D>I<0007E0001C1000383800707C00E07C01E07C01C0
3803C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C000FFFF
C0FFFFC003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C0
0003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C0
0003C00007E0007FFF007FFF0016327FB114>I<000000F0007F030801C1C41C0380E81C070070
080F0078001E003C001E003C003E003E003E003E003E003E003E003E003E003E003E003E001E00
3C001E003C000F007800070070000780E00009C1C000087F000018000000180000001800000018
000000180000001C0000000E0000000FFFF80007FFFF0003FFFF800E000FC0180001E0300000F0
70000070E0000038E0000038E0000038E0000038E00000387000007070000070380000E01C0001
C00700070001C01C00003FE0001E2F7E9F21>I<0780000000FF80000000FF800000000F800000
000780000000078000000007800000000780000000078000000007800000000780000000078000
000007800000000780000000078000000007800000000780000000078000000007800000000780
FE00000783078000078C03C000079001E00007A001E00007A000F00007C000F00007C000F00007
8000F000078000F000078000F000078000F000078000F000078000F000078000F000078000F000
078000F000078000F000078000F000078000F000078000F000078000F000078000F000078000F0
00078000F000078000F000078000F000078000F0000FC001F800FFFC1FFF80FFFC1FFF8021327E
B125>I<0F001F801F801F801F800F000000000000000000000000000000000000000000000007
807F807F800F800780078007800780078007800780078007800780078007800780078007800780
078007800780078007800780078007800FC0FFF8FFF80D307EAF12>I<07800000FF800000FF80
00000F800000078000000780000007800000078000000780000007800000078000000780000007
80000007800000078000000780000007800000078000000780000007800FFE07800FFE078003F0
078003800780030007800600078008000780100007802000078040000780800007818000078380
00078FC0000793C00007A1E00007C1F0000780F0000780780007807C0007803C0007803E000780
1F0007800F0007800F80078007C0078003C0078003E00FC007F8FFFC0FFFFFFC0FFF20327EB123
>107 D<0780FF80FF800F80078007800780078007800780078007800780078007800780078007
800780078007800780078007800780078007800780078007800780078007800780078007800780
07800780078007800780078007800780078007800FC0FFFCFFFC0E327EB112>I<0780FE001FC0
00FF83078060F000FF8C03C18078000F9001E2003C0007A001E4003C0007A000F4001E0007C000
F8001E0007C000F8001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E00
078000F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0
001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E0007
8000F0001E00078000F0001E00078000F0001E00078000F0001E00078000F0001E000FC001F800
3F00FFFC1FFF83FFF0FFFC1FFF83FFF0341F7E9E38>I<0780FE0000FF83078000FF8C03C0000F
9001E00007A001E00007A000F00007C000F00007C000F000078000F000078000F000078000F000
078000F000078000F000078000F000078000F000078000F000078000F000078000F000078000F0
00078000F000078000F000078000F000078000F000078000F000078000F000078000F000078000
F000078000F0000FC001F800FFFC1FFF80FFFC1FFF80211F7E9E25>I<001FC00000F0780001C0
1C00070007000F0007801E0003C01C0001C03C0001E03C0001E0780000F0780000F0780000F0F8
0000F8F80000F8F80000F8F80000F8F80000F8F80000F8F80000F8F80000F8780000F07C0001F0
3C0001E03C0001E01E0003C01E0003C00F00078007800F0001C01C0000F07800001FC0001D1F7E
9E21>I<0781FC0000FF86078000FF8801C0000F9000E00007A000700007C00078000780003C00
0780003E000780001E000780001F000780001F000780000F000780000F800780000F800780000F
800780000F800780000F800780000F800780000F800780000F000780001F000780001F00078000
1E000780003E000780003C0007C000780007A000700007A000E000079803C00007860F00000781
F80000078000000007800000000780000000078000000007800000000780000000078000000007
800000000780000000078000000007800000000FC0000000FFFC000000FFFC000000212D7E9E25
>I<0783E0FF8418FF887C0F907C07A07C07A03807C00007C00007C00007800007800007800007
800007800007800007800007800007800007800007800007800007800007800007800007800007
80000780000780000FC000FFFE00FFFE00161F7E9E19>114 D<01FC100E03301800F030007060
0030E00030E00010E00010E00010F00010F800007E00003FF0001FFF000FFFC003FFE0003FF000
01F80000F880003C80003C80001CC0001CC0001CE0001CE00018F00038F00030CC0060C301C080
FE00161F7E9E1A>I<00400000400000400000400000400000C00000C00000C00001C00001C000
03C00007C0000FC0001FFFE0FFFFE003C00003C00003C00003C00003C00003C00003C00003C000
03C00003C00003C00003C00003C00003C00003C00003C00003C01003C01003C01003C01003C010
03C01003C01003C01001C02001E02000E0400078C0001F00142C7FAB19>I<078000F000FF801F
F000FF801FF0000F8001F000078000F000078000F000078000F000078000F000078000F0000780
00F000078000F000078000F000078000F000078000F000078000F000078000F000078000F00007
8000F000078000F000078000F000078000F000078000F000078000F000078001F000078001F000
078001F000038002F00003C004F00001C008F800007030FF80001FC0FF80211F7E9E25>I<FFF0
3FF80FFCFFF03FF80FFC0F8007E003F00F8003C001C0078003C00080078003C0008007C003E001
8003C003E0010003C004E0010003E004F0030001E004F0020001E00870020001F00878060000F0
0878040000F0103804000078103C08000078103C08000078201C0800003C201E1000003C201E10
00003C400E1000001E400F2000001E400F2000001E80072000000F8007C000000F8007C000000F
0003C0000007000380000007000380000006000180000002000100002E1F7F9E30>119
D<FFF800FF80FFF800FF800FC0007C000780003800078000300003C000200003C000200001E000
400001E000400001F000400000F000800000F000800000780100000078010000007C010000003C
020000003C020000001E040000001E040000001F040000000F080000000F080000000790000000
079000000007D000000003E000000003E000000001C000000001C000000001C000000000800000
000080000000010000000001000000000100000000020000000002000000000400000070040000
00F80C000000F808000000F810000000702000000030400000001F80000000212D7F9E23>121
D<3FFFFF3E001E38001E30003C2000782000786000F04001E04001E04003C0400780000780000F
00001E00001E00003C0000780000780000F00101E00101E00103C0010780010780030F00021E00
021E00063C000678000E78007EFFFFFE181F7E9E1D>I E end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300
TeXDict begin @a4 /a4 where {pop a4} if
%%EndSetup
%%Page: 1 1
bop 105 381 a FC(Implemen)n(ting)20 b(lazy)h(functional)g(languages)f(on)h
(sto)r(c)n(k)h(hardw)n(are:)481 473 y(the)g(Spineless)e(T)-6
b(agless)22 b(G-mac)n(hine)1431 447 y FB(\003)798 564 y FC(V)-6
b(ersion)21 b(2.5)717 720 y FA(Simon)15 b(L)h(P)o(eyton)g(Jones)229
778 y(Departmen)o(t)f(of)h(Computing)g(Science,)e(Univ)o(ersit)o(y)g(of)i
(Glasgo)o(w)i(G12)f(8QQ)667 836 y(simonp)s(j@dcs.glasgo)o(w.ac.uk)827
967 y(July)e(9,)h(1992)865 1091 y Fz(Abstract)213 1170 y Fy(The)k(Spineless)g
(T)m(agless)e(G-mac)o(hine)f(is)i(an)g(abstract)h(mac)o(hine)d(designed)j(to)
f(supp)q(ort)h(non-)151 1220 y(strict)14 b(higher-order)f(functional)f
(languages.)17 b(This)c(presen)o(tation)h(of)e(the)i(mac)o(hine)d(falls)h(in)
o(to)g(three)151 1270 y(parts.)20 b(Firstly)m(,)14 b(w)o(e)g(giv)o(e)g(a)g
(general)h(discussion)g(of)f(the)h(design)f(issues)i(in)o(v)o(olv)o(ed)d(in)h
(implemen)o(ting)151 1320 y(non-strict)h(functional)d(languages.)213
1370 y(Next,)i(w)o(e)g(presen)o(t)h(the)f Fx(STG)h(language)p
Fy(,)f(an)g(austere)h(but)e(recognisably-functional)g(language,)151
1420 y(whic)o(h)k(as)g(w)o(ell)f(as)h(a)g Fx(denotational)h
Fy(meaning)d(has)i(a)g(w)o(ell-de\014ned)g Fx(op)n(er)n(ational)g
Fy(seman)o(tics.)27 b(The)151 1469 y(STG)14 b(language)f(is)g(the)i
(\\abstract)f(mac)o(hine)f(co)q(de")h(for)g(the)g(Spineless)h(T)m(agless)f
(G-mac)o(hine.)213 1519 y(Lastly)m(,)d(w)o(e)g(discuss)i(the)f(mapping)d(of)i
(the)h(STG)e(language)h(on)o(to)g(sto)q(c)o(k)h(hardw)o(are.)17
b(The)12 b(success)151 1569 y(of)f(an)h(abstract)h(mac)o(hine)d(mo)q(del)h
(dep)q(ends)i(largely)e(on)h(ho)o(w)f(e\016cien)o(t)i(this)f(mapping)d(can)j
(b)q(e)h(made,)151 1619 y(though)c(this)h(topic)f(is)h(often)f(relegated)h
(to)g(a)f(short)h(section.)17 b(Instead,)11 b(w)o(e)e(giv)o(e)g(a)g(detailed)
h(discussion)151 1669 y(of)h(the)h(design)g(issues)h(and)e(the)h(c)o(hoices)h
(w)o(e)e(ha)o(v)o(e)h(made.)k(Our)c(principal)f(target)h(is)f(the)h(C)g
(language,)151 1718 y(treating)i(the)h(C)e(compiler)g(as)h(a)f(p)q(ortable)h
(assem)o(bler.)213 1804 y(This)g(pap)q(er)h(is)f(to)f(app)q(ear)i(in)e(the)h
(Journal)g(of)f(F)m(unctional)g(Programming.)213 1865 y Fx(Changes)i(in)e(V)m
(ersion)h(2.0)p Fy(:)j(large)12 b(new)h(section)h(on)e(comparing)f(the)i(STG)
f(mac)o(hine)f(with)i(other)151 1915 y(designs)i(\(Section)f(3\);)f
(pro\014ling)g(material)f(\(Section)i(11\);)f(index.)213 1977
y Fx(Changes)20 b(in)e(V)m(ersion)g(2.1)p Fy(:)27 b(prop)q(er)18
b(statemen)o(t)g(of)g(the)g(initial)e(state)j(of)e(the)i(mac)o(hine)d(\(Sec-)
151 2027 y(tion)g(5.1\);)g(reform)o(ulation)d(of)j(CAF)g(up)q(dates)h
(\(Section)g(10.8\);)e(new)i(format)d(for)i(state)h(transition)151
2076 y(rules,)12 b(separating)g(the)h(guards)e(whic)o(h)h(go)o(v)o(ern)g(the)
g(applicabilit)o(y)d(of)i(the)i(rules)f(\(\\suc)o(h)g(that"\))g(from)151
2126 y(the)j(auxiliary)d(de\014nitions)i(\(\\where"\))g(|)g(Section)g(5.)213
2188 y Fx(Changes)j(in)e(V)m(ersion)g(2.2)p Fy(:)20 b(in)o(tro)q(duction)14
b(of)g(the)h(term)f(\\lam)o(b)q(da-form)o(")o(;)e(new)j(subsection)h(on)151
2238 y(lam)o(b)q(da)11 b(lifting)h(\(Section)i(4.5\);)e(discussion)i(of)f
(cop)o(y-vs-share)i(in)e(Section)h(10.6;)e(allo)o(w)f(a)j(v)n(ariable-)151
2287 y(binding)f(form)f(of)h(default)h(alternativ)o(e)g(in)f(algebraic)g
Fw(case)g Fy(expressions.)213 2349 y Fx(Changes)22 b(in)e(V)m(ersion)g(2.3)p
Fy(:)30 b(more)19 b(explicit)h(discussion)h(of)e(the)i(translation)e(in)o(to)
g(the)i(STG)151 2399 y(language)14 b(\(Section)h(4.1\);)f(some)g(re-ordering)
i(of)e(sub-sections)i(in)e(Section)i(4;)e(an)h(o)o(v)o(erview)g(of)f(the)151
2449 y(co)q(de)h(generation)f(pro)q(cess)i(at)d(the)i(start)f(of)g(Section)g
(9.)213 2510 y Fx(Changes)21 b(in)f(V)m(ersion)f(2.4)p Fy(:)29
b(new-format)18 b(pro\014ling)g(in)h(Section)h(11;)h(new)f(section)g(on)f
(blac)o(k)151 2560 y(holes,)14 b(sa)o(ying)f(ho)o(w)g(to)h(a)o(v)o(oid)f
(space)h(leaks)g(without)g(blac)o(k-holing)e(\(Section)i(9.3.3\).)213
2622 y Fx(Changes)e(in)f(V)m(ersion)g(2.5)p Fy(:)16 b(app)q(endix)10
b(added)g(giving)f(gory)g(details.)17 b(Apart)10 b(from)e(the)j(app)q(endix,)
151 2672 y(this)j(is)g(essen)o(tially)g(the)h(v)o(ersion)f(published)h(in)e
(the)i(Journal)f(of)g(F)m(unctional)f(Programmi)o(ng.)j(V)m(ery)151
2721 y(minor)c(c)o(hanges)j(to)e(main)f(pap)q(er:)19 b(\014xed)14
b(bug)g(in)f(Fig)h(5,)f(and)h(other)g(t)o(yp)q(os.)p 37 2753
735 2 v 89 2780 a Fv(\003)107 2796 y Fu(Previously)h(en)o(titled)g(\\The)e
(Spineless)j(T)m(agless)d(G-mac)o(hine:)19 b(a)13 b(second)h(attempt".)945
2921 y Ft(1)p eop
%%Page: 2 2
bop 37 199 a Fs(Con)n(ten)n(ts)37 331 y Fr(1)43 b(In)o(tro)q(duction)1456
b(5)37 462 y(2)43 b(Ov)o(erview)1527 b(6)106 548 y Ft(2.1)45
b(P)o(art)14 b(I:)h(the)h(design)g(space)40 b Fq(:)22 b(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)93 b Ft(6)106 634 y(2.2)45 b(P)o(art)14
b(I)q(I:)i(the)f(abstract)g(mac)o(hine)34 b Fq(:)22 b(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)93 b Ft(6)106 720 y(2.3)45 b(P)o(art)14 b(I)q(I)q(I:)j(mapping)f(the)f
(abstract)f(mac)o(hine)i(on)o(to)e(real)i(hardw)o(are)40 b
Fq(:)22 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)93 b Ft(7)106 806
y(2.4)45 b(Source)16 b(language)f(and)h(compilation)g(route)h
Fq(:)23 b(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)93 b Ft(7)37 937 y Fr(3)43 b(Exploring)18 b(the)g(design)f
(space)1130 b(9)106 1023 y Ft(3.1)45 b(The)16 b(represen)o(tation)f(of)g
(closures)20 b Fq(:)i(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)93 b Ft(9)106
1109 y(3.2)45 b(F)l(unction)16 b(application)h(and)e(the)h(ev)m(aluation)g
(stac)o(k)23 b Fq(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)71 b Ft(14)106 1195 y(3.3)45 b(Data)14 b(structures)23
b Fq(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(16)106 1281 y(3.4)45 b(Summary)37 b Fq(:)22 b(:)g(:)h(:)f(:)h(:)f(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(17)37 1413
y Fr(4)43 b(The)17 b(STG)h(language)1289 b(19)106 1499 y Ft(4.1)45
b(T)l(ranslating)16 b(in)o(to)f(the)g(STG)g(language)28 b Fq(:)22
b(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)71 b Ft(21)106 1585 y(4.2)45 b(Closures)16 b(and)f(up)q(dates)
f Fq(:)22 b(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(23)106 1671 y(4.3)45 b(Generating)16 b(few)o(er)e(up)q(datable)j(lam)o
(b)q(da-forms)24 b Fq(:)e(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(25)106 1757 y(4.4)45 b(Standard)15
b(constructors)34 b Fq(:)23 b(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(26)106 1843 y(4.5)45 b(Lam)o(b)q(da)16 b(lifting)40 b
Fq(:)22 b(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(27)106 1929 y(4.6)45 b(F)l(ull)17 b(laziness)23 b Fq(:)f(:)h(:)f(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(27)106
2015 y(4.7)45 b(Arithmetic)16 b(and)g(un)o(b)q(o)o(xed)g(v)m(alues)31
b Fq(:)22 b(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(28)106 2101 y(4.8)45
b(Relationship)18 b(to)c(CPS)h(con)o(v)o(ersion)23 b Fq(:)f(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)71 b Ft(30)37 2232 y Fr(5)43 b(Op)q(erational)20 b(seman)o(tics)d(of)h
(the)f(STG)h(language)720 b(32)106 2318 y Ft(5.1)45 b(The)16
b(initial)h(state)12 b Fq(:)22 b(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)71 b Ft(34)106 2404 y(5.2)45 b(Applications)16
b Fq(:)22 b(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)71 b Ft(34)106 2490 y(5.3)45 b Fp(let\(rec\))14 b Ft(expressions)f
Fq(:)22 b(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b
Ft(35)106 2576 y(5.4)45 b(Case)15 b(expressions)h(and)f(data)g(constructors)c
Fq(:)23 b(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)71 b Ft(36)106 2662 y(5.5)45 b(Built)17 b(in)f(op)q(erations)
30 b Fq(:)22 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)
h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(37)106 2748 y(5.6)45 b(Up)q(dating)d Fq(:)22 b(:)g(:)h(:)f(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(38)945
2921 y(2)p eop
%%Page: 3 3
bop 37 199 a Fr(6)43 b(T)l(arget)17 b(language)1353 b(41)106
285 y Ft(6.1)45 b(Mapping)16 b(the)f(STG)g(mac)o(hine)h(to)f(C)42
b Fq(:)23 b(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(42)106 371 y(6.2)45
b(Compiling)17 b(jumps)29 b Fq(:)23 b(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)71 b Ft(42)106 457 y(6.3)45 b(Optimising)17
b(the)f(tin)o(y)f(in)o(terpreter)34 b Fq(:)22 b(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(44)106 543 y(6.4)45 b(Debugging)17 b Fq(:)22 b(:)g(:)h(:)f(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(45)37
675 y Fr(7)43 b(The)17 b(heap)1504 b(45)106 761 y Ft(7.1)45
b(Ho)o(w)15 b(closures)h(are)e(represen)o(ted)42 b Fq(:)22
b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(45)106 847 y(7.2)45 b(Allo)q(cation)25
b Fq(:)d(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)71 b Ft(47)106 933 y(7.3)45 b(Tw)o(o-space)15 b(garbage)f(collection)39
b Fq(:)22 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(47)106 1019
y(7.4)45 b(Other)16 b(garbage)e(collector)i(v)m(arian)o(ts)c
Fq(:)22 b(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(49)106 1105 y(7.5)45
b(T)l(rading)16 b(co)q(de)g(size)g(for)e(sp)q(eed)41 b Fq(:)23
b(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(49)106 1191 y(7.6)45
b(The)16 b(standard-en)o(try)e(co)q(de)i(for)f(a)f(closure)43
b Fq(:)23 b(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)71 b Ft(50)37 1322 y Fr(8)43 b(Stac)o(ks)1572
b(50)106 1408 y Ft(8.1)45 b(One)16 b(stac)o(k?)44 b Fq(:)22
b(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(50)106 1494 y(8.2)45 b(Tw)o(o)15 b(stac)o(ks)40 b Fq(:)22
b(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(51)37 1625 y Fr(9)43 b(Compiling)18 b(the)g(STG)g(language)h(to)f(C)931
b(52)106 1711 y Ft(9.1)45 b(The)16 b(initial)h(state)12 b Fq(:)22
b(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(53)106 1797 y(9.2)45 b(Applications)16 b Fq(:)22 b(:)h(:)f(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(55)106
1883 y(9.3)45 b Fp(let\(rec\))14 b Ft(expressions)48 b Fq(:)23
b(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(57)106 1969
y(9.4)45 b Fp(case)15 b Ft(expressions)37 b Fq(:)23 b(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(60)106 2055 y(9.5)45
b(Arithmetic)13 b Fq(:)22 b(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(64)37 2187 y Fr(10)17 b(Adding)g(up)q(dates)
1355 b(65)106 2273 y Ft(10.1)22 b(Represen)o(ting)17 b(up)q(date)e(frames)25
b Fq(:)e(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(65)106 2359
y(10.2)22 b(P)o(artial)15 b(applications)j Fq(:)k(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(66)106 2445 y(10.3)22 b(Constructors)41
b Fq(:)23 b(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(68)106 2531 y(10.4)22 b(V)l(ectored)16 b(returns)37 b
Fq(:)23 b(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(68)106 2617 y(10.5)22 b(Returning)17 b(v)m(alues)f(in)g(registers)c
Fq(:)23 b(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(69)106 2703
y(10.6)22 b(Up)q(date)16 b(in)g(place)j Fq(:)j(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(71)106 2789 y(10.7)22 b(Up)q(date)16
b(frames)e(and)i(garbage)e(collection)43 b Fq(:)23 b(:)f(:)g(:)h(:)f(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(72)945 2921 y(3)p eop
%%Page: 4 4
bop 106 199 a Ft(10.8)22 b(Global)16 b(up)q(datable)g(closures)32
b Fq(:)22 b(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(73)37
331 y Fr(11)17 b(Status)h(and)g(pro\014ling)g(results)1096
b(74)37 462 y(A)29 b(The)17 b(gory)g(details)1345 b(81)106
548 y Ft(A.1)34 b(Up)q(date)16 b(\015ags)c Fq(:)22 b(:)h(:)f(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(81)106 634
y(A.2)34 b(Blac)o(k)16 b(holes)39 b Fq(:)22 b(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(81)106 720 y(A.3)34
b(Adding)17 b(\014llers)32 b Fq(:)23 b(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(81)106 806 y(A.4)34 b(P)o(erforming)15
b(up)q(dates)f Fq(:)22 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(82)106 892 y(A.5)34 b(Lam)o(b)q(da-form)15 b(info)46 b
Fq(:)22 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71
b Ft(83)37 1023 y Fr(B)32 b(Stac)o(k)17 b(stubbing)1379 b(84)106
1109 y Ft(B.1)36 b(Implemen)o(tation)22 b Fq(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)71 b Ft(85)945 2921 y(4)p eop
%%Page: 5 5
bop 37 199 a Fs(1)67 b(In)n(tro)r(duction)37 330 y Ft(The)14
b(c)o(hallenges)h(of)f(compiling)h(non-strict)f(functional)h(languages)f(ha)o
(v)o(e)f(giv)o(en)h(rise)g(to)f(a)h(whole)g(stream)37 387 y(of)i(researc)o(h)
f(w)o(ork.)20 b(Generally)d(the)f(discussion)h(of)e(this)h(w)o(ork)f(has)h(b)
q(een)g(fo)q(cussed)h(around)e(the)h(design)37 443 y(of)f(a)h(so-called)g
(\\abstract)e(mac)o(hine",)i(whic)o(h)g(distils)h(the)f(k)o(ey)f(asp)q(ects)h
(of)e(the)i(compilation)h(tec)o(hnique)37 500 y(without)d(b)q(ecoming)h(sw)o
(amp)q(ed)f(in)g(the)g(details)h(of)e(source)h(language)g(or)f(co)q(de)h
(generation.)20 b(Quite)15 b(a)e(few)37 556 y(suc)o(h)k(abstract-mac)o(hine)e
(designs)i(ha)o(v)o(e)f(b)q(een)h(presen)o(ted)f(in)h(recen)o(t)e(y)o(ears;)g
(examples)i(include)h(the)e(G-)37 613 y(mac)o(hine)f(\(Augustsson)f([1987];)e
(Johnsson)i([1987]\),)e(TIM)i(\(F)l(airbairn)g(&)h(W)l(ra)o(y)e([1987]\),)f
(the)i(Spineless)37 669 y(G-mac)o(hine)21 b(\(Burn,)g(P)o(eyton)e(Jones)h(&)g
(Robson)g([1988]\),)f(the)h(Oregon)g(G-mac)o(hine)g(c)o(hip)h(\(Kieburtz)37
725 y([1987]\),)16 b(the)h(CASE)h(mac)o(hine)g(\(Da)o(vie)f(&)g(McNally)i
([1989]\),)c(the)i(HDG)g(mac)o(hine)h(\(Kingdon,)h(Lester)37
782 y(&)e(Burn)f([1991]\),)e(the)i Fo(h)p Fq(\027;)8 b Fn(G)t
Fo(i)15 b Ft(mac)o(hine)i(\(Augustsson)e(&)h(Johnsson)h([1989]\),)c(and)j
(the)g(ABC)g(mac)o(hine)37 838 y(\(Ko)q(opman)g([1990]\).)37
924 y(Early)k(implemen)o(tations,)i(esp)q(ecially)g(those)e(based)g(on)f
(graph)h(reduction,)h(w)o(ere)f(radically)h(di\013eren)o(t)37
981 y(from)15 b(con)o(v)o(en)o(tional)g(compiler)h(tec)o(hnology:)k(the)14
b(di\013erence)i(b)q(et)o(w)o(een)g(an)e(SK)i(com)o(binator)e(implemen-)37
1037 y(tation)i(\(T)l(urner)f([1979]\))e(and)j(\(sa)o(y\))e(a)i(Lisp)g
(compiler)h(is)f(substan)o(tial.)21 b(So)16 b(great)e(w)o(as)h(this)h(div)o
(ergence)37 1094 y(that)g(new)g(hardw)o(are)f(arc)o(hitectures)h(w)o(ere)f
(dev)o(elop)q(ed)j(sp)q(eci\014cally)g(to)d(supp)q(ort)h(the)g(execution)h
(mo)q(del)37 1150 y(\(Sc)o(heev)o(el)g([1986];)c(Sto)o(y)o(e,)h(Clark)o(e)h
(&)h(Norman)f([1984]\).)j(As)d(understanding)i(has)e(dev)o(elop)q(ed,)h
(though,)37 1207 y(it)k(has)f(b)q(een)h(p)q(ossible)h(to)d(recognise)i
(features)e(of)h(more)f(con)o(v)o(en)o(tional)i(systems)e(emerging)i(from)e
(the)37 1263 y(mist,)d(and)h(to)e(generate)h(e\016cien)o(t)h(co)q(de)g(for)f
(sto)q(c)o(k)f(arc)o(hitectures.)37 1349 y(In)22 b(this)g(pap)q(er)g(w)o(e)e
(presen)o(t)i(a)f(new)g(abstract)f(mac)o(hine)i(for)f(non-strict)g
(functional)h(languages,)h(the)37 1405 y(Spineless)d(T)l(agless)e(G-mac)o
(hine,)g(set)f(it)h(in)g(the)g(con)o(text)e(of)h(con)o(v)o(en)o(tional)h
(compiler)h(tec)o(hnology)l(,)f(and)37 1462 y(giv)o(e)d(a)g(detailed)h
(discussion)g(of)e(its)h(mapping)g(on)o(to)f(sto)q(c)o(k)g(hardw)o(are.)19
b(Our)c(design)g(exhibits)h(a)f(n)o(um)o(b)q(er)37 1518 y(of)g(un)o(usual)h
(features:)106 1642 y Fo(\017)22 b Ft(In)d(all)g(other)f(the)g(abstract)g
(mac)o(hines)h(men)o(tioned)g(ab)q(o)o(v)o(e,)f(the)g(abstract)g(mac)o(hine)h
(co)q(de)g(for)e(a)151 1698 y(program)h(consists)h(of)g(a)g(sequence)h(of)e
(abstract)g(mac)o(hine)i(instructions.)33 b(Eac)o(h)18 b(instruction)i(is)151
1755 y(giv)o(en)c(a)f(precise)h(op)q(erational)g(seman)o(tics)f(using)h(a)f
(state)f(transition)i(system.)151 1830 y(W)l(e)e(tak)o(e)f(a)h(di\013eren)o
(t)g(approac)o(h:)k(the)c(abstract)f(mac)o(hine)i(language)f(is)g(itself)h(a)
e(v)o(ery)h(small)g(func-)151 1886 y(tional)h(language,)g(whic)o(h)h(has)e
(the)h(usual)h(denotational)f(seman)o(tics.)20 b(In)15 b(addition,)h(though,)
e(eac)o(h)151 1943 y(language)i(construct)g(has)g(a)g(direct)h(op)q
(erational)g(in)o(terpretation,)f(and)g(w)o(e)g(giv)o(e)g(an)g(op)q
(erational)151 1999 y(seman)o(tics)f(for)g(the)g(same)g(language)h(using)g(a)
e(state)h(transition)g(system.)106 2093 y Fo(\017)22 b Ft(Ob)s(jects)g(in)g
(the)g(heap,)h(b)q(oth)f(unev)m(aluated)h(susp)q(ensions)g(and)f(head)g
(normal)g(forms,)g(ha)o(v)o(e)f(a)151 2149 y(uniform)d(represen)o(tation)f
(with)h(a)f(co)q(de)g(p)q(oin)o(ter)h(in)g(their)g(\014rst)f(\014eld.)27
b(Man)o(y)17 b(implemen)o(tations)151 2206 y(examine)c(tag)d(\014elds)j(on)f
(heap)g(ob)s(jects)f(to)g(decide)j(ho)o(w)d(to)g(treat)g(them.)19
b(With)11 b(our)h(represen)o(tation)151 2262 y(w)o(e)i(nev)o(er)h(do)g(this;)
g(instead,)g(a)f(jump)h(is)g(made)f(to)g(the)h(co)q(de)g(p)q(oin)o(ted)h(to)e
(b)o(y)g(the)h(ob)s(ject.)k(This)c(is)151 2319 y(wh)o(y)g(w)o(e)g(call)h(the)
g(mac)o(hine)g(\\tagless".)106 2413 y Fo(\017)22 b Ft(A)17
b(p)q(erv)m(asiv)o(e)h(feature)f(of)f(functional)i(programs)e(is)h(the)g
(construction)g(of)g(data)f(structures,)h(and)151 2469 y(their)h(tra)o(v)o
(ersal)d(using)j(pattern-matc)o(hing.)25 b(Man)o(y)16 b(abstract)g(mac)o
(hine)i(designs)g(sa)o(y)e(v)o(ery)h(little)151 2526 y(ab)q(out)e(ho)o(w)g
(to)f(do)i(this)f(e\016cien)o(tly)l(,)i(but)e(w)o(e)g(pa)o(y)g(a)g(lot)g(of)g
(atten)o(tion)f(to)h(it.)106 2619 y Fo(\017)22 b Ft(The)c(mac)o(hine)g
(manipulates)h Fn(unb)n(oxe)n(d)f(values)g Ft(directly)l(,)h(based)f(on)g
(the)f(ideas)i(in)f(a)f(companion)151 2676 y(pap)q(er)e(\(P)o(eyton)f(Jones)h
(&)f(Launc)o(h)o(bury)i([1991]\).)h(This)e(is)g(essen)o(tial)g(for)f(an)h
(e\016cien)o(t)g(implemen-)151 2732 y(tation)g(of)g(arithmetic,)g(but)h(it)f
(is)h(usually)g(hidden)h(in)f(the)g(co)q(de)f(generator.)945
2921 y(5)p eop
%%Page: 6 6
bop 106 199 a Fo(\017)22 b Ft(There)16 b(is)h(scop)q(e)g(for)e(exploiting)j
(the)e(fruits)g(of)f(b)q(oth)i(strictness)f(analysis)h(and)f(sharing)g
(analysis)151 256 y(to)f(impro)o(v)o(e)g(execution)h(sp)q(eed.)106
350 y Fo(\017)22 b Ft(Lam)o(b)q(da)c(lifting,)i(a)d(common)h(feature)f(of)h
(almost)f(all)i(functional-language)g(implemen)o(tations,)151
406 y(is)c(not)g(carried)g(out.)20 b(Instead,)15 b(the)g(free)g(v)m(ariables)
h(of)e(lam)o(b)q(da)h(abstractions)g(are)f(iden)o(ti\014ed,)j(but)151
462 y(the)e(abstraction)g(is)h(left)f(in)h(place.)106 556 y
Fo(\017)22 b Ft(The)f(mac)o(hine)h(is)f(particularly)h(w)o(ell-suited)h(for)d
(parallel)j(implemen)o(tations,)g(although)e(space)151 613
y(prev)o(en)o(ts)10 b(this)i(asp)q(ect)e(b)q(eing)i(discussed)g(in)g(this)f
(pap)q(er)g(\(P)o(eyton)f(Jones,)h(Clac)o(k)g(&)g(Salkild)i([1989]\).)37
736 y(Almost)18 b(all)g(the)g(individual)i(ideas)f(w)o(e)e(describ)q(e)i(are)
e(presen)o(t)h(in)g(other)f(implemen)o(tations,)i(but)e(their)37
792 y(com)o(bination)f(pro)q(duces)g(a)f(particularly)i(fast)d(implemen)o
(tation)j(of)d(lazy)i(functional)g(languages.)37 878 y(An)22
b(earlier)h(v)o(ersion)f(of)f(this)h(pap)q(er)g(\(P)o(eyton)f(Jones)h(&)f
(Salkild)j([1989]\),)d(had)g(a)h(similar)g(title)h(and)37 935
y(in)o(tro)q(duction)17 b(to)f(this)g(one.)22 b(The)16 b(underlying)i(mac)o
(hine)f(b)q(eing)g(describ)q(ed)h(is)f(mostly)e(unc)o(hanged,)i(but)37
991 y(the)f(presen)o(tation)f(has)g(b)q(een)h(completely)h(rewritten.)37
1164 y Fs(2)67 b(Ov)n(erview)37 1295 y Ft(The)18 b(pap)q(er)g(divides)h(in)o
(to)e(three)g(parts.)25 b(P)o(art)17 b(I)g(explores)h(the)f(design)i(space)e
(to)g(sho)o(w)f(ho)o(w)h(the)g(STG)37 1352 y(mac)o(hine)23
b(\014ts)e(in)o(to)g(a)g(wider)h(con)o(text.)37 b(P)o(art)20
b(I)q(I)i(in)o(tro)q(duces)g(the)g(abstract)e(mac)o(hine)i(and)f(giv)o(es)h
(its)37 1408 y(op)q(erational)15 b(seman)o(tics,)e(and)h(P)o(art)f(I)q(I)q(I)
i(discusses)g(ho)o(w)e(the)g(abstract)g(mac)o(hine)h(is)g(mapp)q(ed)h(on)o
(to)d(sto)q(c)o(k)37 1464 y(hardw)o(are.)37 1616 y Fm(2.1)56
b(P)n(art)19 b(I:)g(the)f(design)g(space)37 1731 y Ft(The)g(implemen)o
(tation)h(of)e(non-strict)g(functional)i(languages)e(has)h(tended)g(to)e(b)q
(e)i(done)g(in)g(a)f(separate)37 1788 y(w)o(orld)g(to)f(that)g(of)h(\\real)f
(compilers".)26 b(One)17 b(goal)g(of)f(this)h(pap)q(er)g(is)h(to)e(help)i
(bridge)f(the)g(gap)g(b)q(et)o(w)o(een)37 1844 y(these)12 b(t)o(w)o(o)e
(cultures.)20 b(T)l(o)11 b(this)g(end)h(w)o(e)f(iden)o(tify)i(sev)o(eral)e(k)
o(ey)h(asp)q(ects)f(of)g(a)g(compiler)i(\(its)e(represen)o(tation)37
1900 y(of)k(data)g(structures,)g(its)g(treatmen)o(t)g(of)f(function)j
(application,)f(and)g(its)f(compilation)i(of)e(case-analysis)37
1957 y(on)h(data)e(structures\),)g(and)i(compare)f(the)g(approac)o(h)g(w)o(e)
g(tak)o(e)f(with)i(that)e(of)h(others.)37 2043 y(W)l(e)i(hop)q(e)g(that)f
(this)h(exercise)g(ma)o(y)f(b)q(e)h(useful)g(in)h(its)e(o)o(wn)g(righ)o(t,)g
(as)g(w)o(ell)i(as)e(setting)g(the)h(con)o(text)f(for)37 2099
y(the)g(rest)f(of)f(the)i(pap)q(er.)37 2251 y Fm(2.2)56 b(P)n(art)19
b(I)r(I:)f(the)g(abstract)h(mac)n(hine)37 2366 y Ft(The)h(usual)f(w)o(a)o(y)f
(of)g(presen)o(ting)i(an)f(ev)m(aluation)h(mo)q(del)g(for)e(a)g(functional)i
(language)f(is)h(to)e(de\014ne)i(an)37 2422 y Fn(abstr)n(act)f(machine)p
Ft(,)g(whic)o(h)g(executes)g(an)f(instruction)h(stream.)28
b(The)18 b(abstract)g(mac)o(hine)h(is)f(giv)o(en)h(an)37 2479
y(op)q(erational)j(seman)o(tics)f(using)g(a)g Fn(state)g(tr)n(ansition)f
(system)p Ft(,)h(and)g Fn(c)n(ompilation)h(rules)e Ft(are)g(giv)o(en)i(for)37
2535 y(con)o(v)o(erting)14 b(a)f(functional)i(program)e(in)o(to)h(abstract)e
(mac)o(hine)j(co)q(de.)20 b(The)14 b(application)h(of)e(these)h(compi-)37
2592 y(lation)h(rules)g(is)f(usually)i(preceded)f(b)o(y)f(lam)o(b)q(da)g
(lifting)h(\(Johnsson)f([1985]\),)e(whic)o(h)j(eliminates)h(lam)o(b)q(da)37
2648 y(abstractions)e(in)g(fa)o(v)o(our)e(of)h(sup)q(ercom)o(binators,)h
(functions)g(with)g(no)g(free)f(v)m(ariables.)21 b(A)14 b(go)q(o)q(d)f
(example)37 2705 y(of)20 b(this)f(approac)o(h)g(is)h(the)g(G-mac)o(hine)g
(\(Johnsson)g([1987];)f(P)o(eyton)g(Jones)h([1987]\),)e(whose)h(abstract)37
2761 y(mac)o(hine)e(co)q(de)e(is)h(called)h(G-co)q(de.)945
2921 y(6)p eop
%%Page: 7 7
bop 37 199 a Ft(This)12 b(approac)o(h)e(su\013ers)g(an)h(anno)o(ying)g
(disadv)m(an)o(tage:)17 b Fn(the)c(abstr)n(act)f(machine)g(is)f(gener)n(al)r
(ly)g(not)h(abstr)n(act)37 256 y(enough)p Ft(.)39 b(F)l(or)21
b(example,)j(the)d(abstract)g(G-mac)o(hine)h(uses)g(the)f(stac)o(k)g(to)g
(hold)h(man)o(y)f(in)o(termediate)37 312 y(v)m(alues.)35 b(When)21
b(G-co)q(de)f(is)g(to)g(b)q(e)g(compiled)i(in)o(to)d(nativ)o(e)h(mac)o(hine)h
(co)q(de,)g(man)o(y)f(stac)o(k)f(op)q(erations)37 369 y(can)g(b)q(e)g
(eliminated)i(b)o(y)e(holding)h(the)e(in)o(termediate)i(v)m(alues)f(in)h
(registers.)29 b(The)19 b(co)q(de)g(generator)f(has)37 425
y(to)j(sim)o(ulate)h(the)f(op)q(eration)g(of)g(the)g(abstract)f(stac)o(k,)i
(whic)o(h)g(is)f(used,)i(in)f(e\013ect,)g(mainly)g(to)f(name)37
482 y(in)o(termediate)c(v)m(alues.)22 b(Not)15 b(only)h(do)q(es)g(this)g(pro)
q(cess)g(complicate)h(the)e(co)q(de)i(generator,)d(but)i(it)g(mak)o(es)37
538 y(G-co)q(de)g(harder)f(to)g(manipulate)h(and)g(optimise.)37
624 y(T)l(o)21 b(a)o(v)o(oid)g(this)g(problem,)h(one)f(is)h(driv)o(en)f(to)g
(in)o(tro)q(duce)g(explicitly-n)q(amed)i(v)m(alues)f(in)g(the)f(abstract)37
680 y(mac)o(hine,)d(whic)o(h)f(is)f(ho)o(w)g(the)h(T-co)q(de)g(of)e(our)h
(earlier)i(pap)q(er)e(w)o(as)g(deriv)o(ed)h(\(P)o(eyton)f(Jones)g(&)h
(Salkild)37 737 y([1989]\).)h(Unfortunately)l(,)d(the)h(simplicit)o(y)h(of)e
(the)g(abstract)f(mac)o(hine)i(is)g(no)o(w)f(lost.)37 823 y(W)l(e)e(tak)o(e)e
(a)h(sligh)o(tly)i(di\013eren)o(t)e(approac)o(h)g(here.)19
b(Instead)13 b(of)f(de\014ning)i(a)e(new)g(abstract)f(mac)o(hine,)j(w)o(e)e
(use)37 879 y(a)h(v)o(ery)g(small)i(functional)f(language,)g(the)f
Fn(STG)h(language)p Ft(,)f(as)g(the)g(abstract)f(mac)o(hine)i(co)q(de.)20
b(It)14 b(has)f(the)37 936 y(usual)j(denotational)g(seman)o(tics,)f(so)f(it)i
(is)f(in)h(principle)i(p)q(ossible)f(to)d(c)o(hec)o(k)h(the)h(transformation)
d(of)i(the)37 992 y(original)k(program)c(in)o(to)i(the)g(STG)g(language)g(is)
g(correct.)25 b(But)17 b(w)o(e)g(also)g(giv)o(e)g(it)g(a)g(direct)g(op)q
(erational)37 1049 y(seman)o(tics)h(using)h(a)e(state)g(transition)h(system,)
g(whic)o(h)g(explains)i(ho)o(w)d(w)o(e)g(in)o(tend)i(it)f(to)f(b)q(e)h
(executed.)37 1105 y(The)f(problem)h(of)e(pro)o(ving)h(the)g(en)o(tire)g
(system)f(correct)g(is)h(thereb)o(y)g(made)g(easier)g(than,)f(for)g(example,)
37 1162 y(the)g(G-mac)o(hine)329 1145 y Fl(1)353 1162 y Ft(,)e(b)q(ecause)i
(only)g(the)f(equiv)m(alence)i(of)e(the)g(denotational)g(and)g(op)q
(erational)h(seman)o(tics)37 1218 y(of)h(a)f Fn(single)g Ft(language)h(is)g
(in)o(v)o(olv)o(ed.)26 b(Ev)o(en)16 b(so,)h(it)g(is)g(a)g(substan)o(tial)g
(task,)f(and)h(w)o(e)g(do)f(not)h(attempt)f(it)37 1274 y(here.)37
1426 y Fm(2.3)56 b(P)n(art)19 b(I)r(I)r(I:)e(mapping)h(the)g(abstract)h(mac)n
(hine)e(on)n(to)i(real)f(hardw)n(are)37 1541 y Ft(T)o(ypically)l(,)h(m)o(uc)o
(h)d(is)h(written)f(ab)q(out)h(the)f(compilation)i(of)e(a)g(functional)h
(program)f(in)o(to)g(abstract)f(ma-)37 1598 y(c)o(hine)21 b(co)q(de,)g(and)f
(rather)f(little)i(ab)q(out)f(ho)o(w)f(to)g(map)g(the)h(abstract)e(mac)o
(hine)j(on)o(to)d(the)i(underlying)37 1654 y(hardw)o(are.)i(Y)l(et)16
b(the)g(abstract)f(mac)o(hine)i(can)f(only)h(b)q(e)g(considered)g(a)f
(success)g(if)h(this)f(mapping)h(w)o(orks)37 1710 y(w)o(ell;)f(that)f(is,)g
(the)g(resulting)i(co)q(de)e(is)h(e\016cien)o(t.)37 1796 y(W)l(e)i(b)q(eliev)
o(e)i(that)c(the)i(Spineless)i(T)l(agless)d(G-mac)o(hine)h(comes)g(out)f(w)o
(ell)h(in)h(this)e(regard,)h(and)f(dev)o(ote)37 1853 y(considerable)d(space)e
(to)g(discussing)h(the)f(mapping)h(pro)q(cess.)19 b(One)13
b(of)e(the)h(nice)h(asp)q(ects)f(is)h(that)e(a)h(v)m(ariet)o(y)37
1909 y(of)j(mappings)h(are)f(p)q(ossible,)i(of)d(increasing)j(complexit)o(y)f
(and)f(e\016ciency)l(.)37 1995 y(Our)h(target)e(mac)o(hine)i(co)q(de)g(is)f
(the)g(C)g(language.)20 b(This)c(has)f(b)q(ecome)h(common)f(of)f(late,)h
(conferring,)g(as)37 2052 y(it)j(do)q(es,)h(wide)f(p)q(ortabilit)o(y)l(.)28
b(W)l(e)18 b(ma)o(y)f(pa)o(y)g(some)h(p)q(erformance)f(p)q(enalt)o(y)i(for)e
(not)g(generating)h(nativ)o(e)37 2108 y(mac)o(hine)f(co)q(de,)e(and)g(plan)h
(to)f(build)i(other)e(co)q(de)h(generators)e(whic)o(h)i(do)f(so.)37
2259 y Fm(2.4)56 b(Source)18 b(language)h(and)g(compilation)e(route)37
2375 y Ft(W)l(e)e(are)f(in)o(terested)h(in)h(compiling)g Fn(str)n(ongly-typ)n
(e)n(d,)f(higher-or)n(der,)h(non-strict,)g(pur)n(ely)f(functional)g(lan-)37
2431 y(guages)f Ft(suc)o(h)h(as)e(LML,)h(or)g(Hask)o(ell.)20
b(W)l(e)14 b(exp)q(ect)h(hea)o(vy)e(use)i(of)e(b)q(oth)h(higher-order)h
(functions)g(and)f(the)37 2488 y(non-strict)i(seman)o(tics)f(\(Hughes)h
([1989]\).)37 2574 y(This)e(pap)q(er)f(is)g(only)g(ab)q(out)f(the)h(bac)o(k)f
(end)h(of)f(a)g(compiler.)20 b(Our)13 b(complete)h(compilation)f(route)f(in)o
(v)o(olv)o(es)37 2630 y(the)k(follo)o(wing)g(steps:)p 37 2670
735 2 v 86 2697 a Fk(1)107 2712 y Fu(The)d(task)g(of)g(pro)o(ving)h(a)f
(simple)i(G-mac)o(hine)f(correct)g(is)f(carried)h(out)g(b)o(y)f(Lester)g(in)h
(his)g(thesis)g(\(Lester)f([1989]\).)945 2921 y Ft(7)p eop
%%Page: 8 8
bop 93 199 a Ft(1.)22 b(The)d(primary)f(source)h(language)f(is)h(Hask)o(ell)h
(\(Hudak)e(et)g(al.)h([1992]\),)d(a)j(strongly-t)o(yp)q(ed,)g(non-)151
256 y(strict,)f(purely-functional)h(language.)27 b(Hask)o(ell's)18
b(main)g(inno)o(v)m(ativ)o(e)g(feature)g(is)f(its)h(supp)q(ort)g(for)151
312 y(systematic)d(o)o(v)o(erloading.)93 406 y(2.)22 b(Hask)o(ell)e(is)g
(compiled)i(to)c(a)h(small)i Fn(Cor)n(e)e(language)p Ft(.)33
b(All)20 b(Hask)o(ell's)g(syn)o(tactic)g(sugar)f(is)g(trans-)151
462 y(lated)c(out,)f(t)o(yp)q(e)h(c)o(hec)o(king)g(is)g(p)q(erformed,)f(and)h
(o)o(v)o(erloading)g(is)g(resolv)o(ed.)20 b(P)o(attern-matc)o(hing)13
b(is)151 519 y(translated)18 b(in)o(to)g(simple)h Fp(case)f
Ft(expressions,)h(eac)o(h)f(of)f(whic)o(h)i(p)q(erforms)f(only)g(a)g(single)h
(lev)o(el)g(of)151 575 y(matc)o(hing.)93 669 y(3.)j(Program)14
b(analyses)h(and)h(a)f(v)m(ariet)o(y)g(of)g(transformations)f(are)g(applied)k
(to)c(the)h(Core)g(language.)93 763 y(4.)22 b(The)14 b(Core)g(language)g(is)g
(translated)g(to)g(the)g Fn(STG)g(language)p Ft(,)g(whic)o(h)g(w)o(e)g(in)o
(tro)q(duce)h(in)g(Section)g(4.)151 819 y(This)h(transformation)e(is)h
(rather)g(simple.)93 913 y(5.)22 b(The)16 b(co)q(de)g(generator)f(translates)
g(the)h(STG)f(language)h(in)o(to)g Fn(A)o(bstr)n(act)g(C)p
Ft(.)e(The)i(latter)g(is)g(just)f(an)151 970 y(in)o(ternal)g(data)f(t)o(yp)q
(e)g(whic)o(h)h(can)f(simply)h(b)q(e)g(prin)o(ted)g(out)f(as)f(C)h(co)q(de,)h
(but)f(whic)o(h)h(can)f(also)g(serv)o(e)151 1026 y(as)h(an)g(input)h(to)f(a)g
(nativ)o(e-co)q(de)h(generator.)37 1149 y(Strictness)e(analysis)h(pla)o(ys)e
(an)g(imp)q(ortan)o(t)g(role)h(in)g(compilers)h(for)e(non-strict)g
(languages,)h(enabling)h(the)37 1206 y(compiler)f(to)d(determine)i(cases)f
(where)g(function)h(argumen)o(ts)e(can)i(b)q(e)f(passed)h(in)f(ev)m(aluated)i
(form,)d(whic)o(h)37 1262 y(is)17 b(often)e(more)g(e\016cien)o(t.)21
b(Using)c(this)f(tec)o(hnology)f(compilers)i(for)e(lazy)h(languages)f(can)h
(generate)f(co)q(de)37 1319 y(whic)o(h)i(is)e(sometimes)g(as)g(fast)g(as)f
(or)h(faster)g(than)g(C)g(\(Smetsers)f(et)h(al.)g([1991]\).)37
1405 y(Usually)k(the)e(results)h(of)e(strictness)i(analysis)g(are)f(passed)g
(to)g(the)g(co)q(de)h(generator,)e(whic)o(h)i(is)g(thereb)o(y)37
1461 y(made)i(signi\014can)o(tly)i(more)d(complicated.)35 b(W)l(e)20
b(tak)o(e)f(a)h(di\013eren)o(t)g(approac)o(h.)33 b(W)l(e)20
b(extend)h(the)e(Core)37 1518 y(and)14 b(STG)g(languages)g(with)g
(full-\015edged)i Fn(unb)n(oxe)n(d)f(values)p Ft(,)e(whic)o(h)i(mak)o(es)e
(them)h(expressiv)o(e)g(enough)h(to)37 1574 y(incorp)q(orate)j(the)f(results)
g(of)f(strictness)h(analysis)h(b)o(y)f(simple)h(program)e(transformations.)23
b(W)l(e)17 b(giv)o(e)g(a)37 1631 y(brief)g(in)o(tro)q(duction)g(to)f(un)o(b)q
(o)o(xed)g(v)m(alues)h(in)g(Section)g(4.7,)e(but)h(the)g(full)i(details,)f
(including)h(the)e(trans-)37 1687 y(formations)c(required)i(to)e(exploit)i
(strictness)f(analysis,)h(are)e(giv)o(en)h(in)h(a)e(separate)g(pap)q(er)i
(\(P)o(eyton)e(Jones)37 1744 y(&)k(Launc)o(h)o(bury)g([1991]\).)37
1830 y(The)i(co)q(de)g(generator,)e(whic)o(h)j(is)e(the)h(sub)s(ject)f(of)g
(this)h(pap)q(er,)g(is)f(therefore)g(not)g(directly)i(in)o(v)o(olv)o(ed)f(in)
37 1886 y(strictness)e(analysis)g(or)f(its)g(exploitation,)h(so)f(w)o(e)g(do)
g(not)f(discuss)j(it)e(further.)945 2921 y(8)p eop
%%Page: 9 9
bop 368 213 a Fj(P)n(art)27 b(I:)g(Exploring)h(the)e(design)h(space)37
386 y Fs(3)67 b(Exploring)25 b(the)e(design)f(space)37 517
y Ft(Before)17 b(in)o(tro)q(ducing)h(the)e(STG)g(mac)o(hine)i(in)f(detail)g
(w)o(e)g(pause)f(to)g(explore)h(the)g(design)g(space)g(a)f(little.)37
574 y(The)f(STG)g(mac)o(hine)g(has)g(its)f(ro)q(ots)g(in)h(lazy)g(graph)g
(reduction.)20 b(It)15 b(is)g(no)o(w)f(folk-lore)i(that,)d(while)j(graph)37
630 y(reduction)i(lo)q(oks)e(v)o(ery)g(di\013eren)o(t)g(to)g(con)o(v)o(en)o
(tional)h(compiler)g(tec)o(hnology)l(,)f(the)h(b)q(est)f(compilers)i(based)37
686 y(on)i(graph)f(reduction)h(generate)f(quite)h(similar)g(co)q(de)g(to)e
(those)h(for)g(\(sa)o(y\))f(Lisp.)33 b(In)20 b(this)f(section)h(w)o(e)37
743 y(attempt)15 b(to)f(compare)h(some)g(asp)q(ects)g(of)g(the)h(STG)e(mac)o
(hine)i(with)g(more)f(con)o(v)o(en)o(tional)g(compilers.)37
829 y(An)o(y)20 b(implemen)o(tation)i(is)e(the)g(result)g(of)g(a)f(raft)g(of)
h(in)o(ter-related)g(design)h(decisions,)i(eac)o(h)d(of)f(whic)o(h)37
885 y(is)k(partly)f(justi\014ed)i(b)o(y)e(the)g(presence)h(of)f(the)g
(others.)40 b(That)22 b(mak)o(es)g(it)g(hard)g(to)g(\014nd)h(a)e(place)j(to)
37 942 y(start)18 b(our)h(description.)32 b(W)l(e)18 b(pro)q(ceed)i(b)o(y)f
(asking)g(three)g(k)o(ey)f(questions,)i(whic)o(h)g(help)g(to)e(lo)q(cate)h
(the)37 998 y(implemen)o(tation)e(tec)o(hniques)f(for)f(an)o(y)g(non-strict)g
(higher-order)h(language:)106 1122 y Fo(\017)22 b Ft(Ho)o(w)f(are)f(function)
i(v)m(alues,)i(data)c(v)m(alues)i(and)f(unev)m(aluated)i(expressions)f
(represen)o(ted)g(\(Sec-)151 1178 y(tion)16 b(3.1\)?)106 1272
y Fo(\017)22 b Ft(Ho)o(w)15 b(is)g(function)h(application)h(p)q(erformed)f
(\(Section)f(3.2\)?)106 1366 y Fo(\017)22 b Ft(Ho)o(w)15 b(is)g(case)h
(analysis)g(p)q(erformed)f(on)g(data)g(structures)g(\(Section)g(3.3\)?)37
1489 y(This)21 b(section)g(giv)o(es)f(the)g(con)o(text)g(and)g(motiv)m(ation)
g(for)g(man)o(y)f(of)h(the)g(implemen)o(tation)i(tec)o(hniques)37
1545 y(describ)q(ed)c(in)e(P)o(arts)e(I)q(I)i(and)f(I)q(I)q(I,)i(and)e
(suitable)i(forw)o(ard)d(references)h(are)g(giv)o(en.)37 1697
y Fm(3.1)56 b(The)19 b(represen)n(tation)e(of)i(closures)37
1812 y Ft(The)11 b(heap)h(con)o(tains)e(t)o(w)o(o)g(kinds)h(of)g(ob)s(jects:)
17 b Fn(he)n(ad)12 b(normal)g(forms)f Ft(\(or)f Fn(values)p
Ft(\),)g(and)h(as-y)o(et)f(unev)m(aluated)37 1869 y(susp)q(ensions)15
b(\(or)e Fn(thunks)p Ft(\).)18 b(Head)c(normal)f(forms)g(can)g(b)q(e)h
(further)f(classi\014ed)i(in)o(to)e(t)o(w)o(o)f(kinds:)20 b
Fn(function)37 1925 y(values)e Ft(and)g Fn(data)h(values)p
Ft(.)28 b(A)17 b(v)m(alue)i(ma)o(y)f(con)o(tain)g(th)o(unks)f(inside)j(it;)f
(for)e(example,)i(a)f(list)g Fp(Cons)f Ft(cell)37 1981 y(migh)o(t)h(ha)o(v)o
(e)e(an)i(unev)m(aluated)g(head)g(and/or)f(tail.)26 b(A)18
b(v)m(alue)g(whic)o(h)g(con)o(tains)f(no)h(th)o(unks)f(inside)i(it)e(is)37
2038 y(called)g(a)e Fn(normal)h(form)p Ft(.)37 2124 y(It)j(is)f(w)o(orth)f
(noting)i(that,)e(in)i(a)f(p)q(olymorphic)i(language,)e(it)h(is)f(not)g(alw)o
(a)o(ys)g(p)q(ossible)h(to)f(distinguish)37 2180 y(th)o(unks)f(whose)g(v)m
(alue)h(will)g(turn)f(out)f(to)g(b)q(e)h(a)g(function)g(from)f(th)o(unks)h
(whose)g(v)m(alue)h(is)f(a)f(data)g(v)m(alue.)37 2237 y(F)l(or)f(example,)h
(consider)g(the)f(comp)q(osition)h(function:)228 2323 y Fp(compose)23
b(f)h(g)g(x)f(=)h(f)g(\(g)g(x\))37 2409 y Ft(Is)c Fp(\(g)j(x\))c
Ft(a)f(function)i(or)e(not?)31 b(It)19 b(dep)q(ends,)h(of)f(course,)g(on)g
(the)g(t)o(yp)q(e)f(of)h Fp(g)f Ft(and,)i(since)g Fp(compose)d
Ft(is)37 2465 y(p)q(olymorphic,)g(this)f(is)f(not)g(statically)h(determined.)
37 2551 y(F)l(or)g(reasons)f(whic)o(h)i(will)g(b)q(ecome)g(apparen)o(t)e(w)o
(e)h(use)g(the)g(term)f Fn(closur)n(e)h Ft(to)f(refer)h(to)f(b)q(oth)h(v)m
(alues)h(and)37 2608 y(th)o(unks.)27 b(In)18 b(the)f(remainder)h(of)f(this)h
(section)f(w)o(e)g(consider)i(v)m(arious)e(w)o(a)o(ys)g(in)h(whic)o(h)g
(closures)g(can)f(b)q(e)37 2664 y(represen)o(ted,)f(con)o(trasting)e(the)i
(STG)e(mac)o(hine)i(with)g(other)f(designs.)945 2921 y(9)p
eop
%%Page: 10 10
bop 37 199 a Fr(3.1.1)52 b(Represen)o(ting)18 b(functions)37
315 y Ft(An)o(y)f(implemen)o(tation)i(of)d(a)h(higher-order)g(language)g(m)o
(ust)g(pro)o(vide)g(a)g(w)o(a)o(y)e(to)i(represen)o(t)g(a)f(function)37
371 y(v)m(alue.)25 b(Suc)o(h)17 b(a)f(v)m(alue)i(b)q(eha)o(v)o(es)f(lik)o(e)g
(a)f(susp)q(ended)i(computation:)23 b(when)17 b(the)f(v)m(alue)i(is)f
(applied)h(to)e(its)37 428 y(argumen)o(ts,)e(the)i(computation)f(is)h(p)q
(erformed.)37 513 y(The)h(most)f(compact)g(w)o(a)o(y)g(to)g(represen)o(t)g(a)
h(function)g(v)m(alue)h(is)f(as)f(a)h(blo)q(c)o(k)g(of)f(static)g(co)q(de)i
(\(shared)e(b)o(y)37 570 y(all)k(dynamic)g(instances)g(of)e(the)h(v)m
(alue\),)h(together)e(with)i(the)f(v)m(alues)h(of)e(its)h(free)g(v)m
(ariables.)32 b(\(Suc)o(h)19 b(a)37 626 y(v)m(alue)f(is)f(commonly)g(called)h
(a)e Fn(closur)n(e)p Ft(,)g(though)h(w)o(e)f(use)h(the)f(term)g(in)i(a)e
(wider)h(sense)g(in)g(this)g(pap)q(er.\))37 683 y(The)d(most)f(direct)h(ph)o
(ysical)h(represen)o(tation)e(of)g(suc)o(h)h(a)f(closure)h(is)g(a)f(p)q(oin)o
(ter)h(to)f(a)g(con)o(tiguous)g(blo)q(c)o(k)h(of)37 739 y(heap-allo)q(cated)k
(storage,)d(consisting)h(of)g(a)g Fn(c)n(o)n(de)g(p)n(ointer)g
Ft(whic)o(h)h(p)q(oin)o(ts)f(to)f(the)i(static)e(co)q(de,)i(follo)o(w)o(ed)37
796 y(b)o(y)f(\(p)q(oin)o(ters)f(to\))f(the)h(v)m(alues)i(of)e(the)g(free)g
(v)m(ariables,)h(th)o(us:)p 580 1026 4 150 v 880 1026 V 1329
1026 V 281 878 675 4 v 280 1026 4 150 v 281 1028 675 4 v 1256
878 375 4 v 1629 1026 4 150 v 1256 1028 375 4 v 956 878 15
4 v 985 878 V 1013 878 V 1042 878 V 1071 878 V 1099 878 V 1128
878 V 1156 878 V 1185 878 V 1213 878 V 1242 878 V 956 1028
V 985 1028 V 1013 1028 V 1042 1028 V 1071 1028 V 1099 1028
V 1128 1028 V 1156 1028 V 1185 1028 V 1213 1028 V 1242 1028
V 430 1251 4 300 v 431 1253 150 4 v 539 1251 a Fi(-)p 730 1101
4 150 v 731 1101 a(?)p 1479 1101 V 708 w(?)623 1292 y Ft(Co)q(de)908
1172 y(F)l(ree)f(v)m(ariables)37 1378 y(This)d(is)e(the)h(represen)o(tation)f
(adopted)h(b)o(y)f(man)o(y)g(compiled)i(Lisp)g(systems,)f(b)o(y)f(SML)h(of)f
(New)g(Jersey)l(,)i(and)37 1435 y(b)o(y)18 b(the)g(Spineless)h(T)l(agless)f
(G-mac)o(hine.)27 b(T)l(o)18 b(p)q(erform)f(the)g(computation,)h(a)f
(distinguished)j(register,)37 1491 y(the)d Fn(envir)n(onment)f(p)n(ointer)p
Ft(,)g(is)h(made)f(to)g(p)q(oin)o(t)h(to)f(the)g(closure,)h(and)g(the)f(co)q
(de)h(is)g(executed.)24 b(W)l(e)17 b(call)37 1548 y(this)h(op)q(eration)f
Fn(entering)g(a)i(closur)n(e)p Ft(.)24 b(The)18 b(co)q(de)f(can)h(access)f
(its)g(free)g(v)m(ariables)i(b)o(y)e(o\013sets)f(from)g(the)37
1604 y(en)o(vironmen)o(t)i(p)q(oin)o(ter,)f(and)g(its)g(argumen)o(ts)f(b)o(y)
g(some)h(standard)f(argumen)o(t-passing)h(con)o(v)o(en)o(tion)f(\(eg)37
1661 y(in)h(registers,)d(on)h(the)h(stac)o(k,)e(or)g(in)i(an)g(activ)m(ation)
f(record\).)37 1747 y(Instead)22 b(of)e(storing)g(the)h(v)m(alues)h(of)e(the)
h(free)f(v)m(ariables)i(themselv)o(es)g(in)f(the)g(closure,)h(it)f(is)g(p)q
(ossible)37 1803 y(to)g(store)g(a)g(p)q(oin)o(ter)h(to)e(a)h(blo)q(c)o(k)h
(of)f(free)g(v)m(ariables,)j(or)d(ev)o(en)h(to)e(a)h(c)o(hain)h(of)f(suc)o(h)
h(blo)q(c)o(ks.)39 b(These)37 1860 y(represen)o(tations)23
b(attempt)f(to)f(sa)o(v)o(e)h(storage,)h(at)f(the)g(cost)g(of)g(slo)o(wing)h
(do)o(wn)g(access.)42 b(The)22 b(Orbit)37 1916 y(compiler,)e(for)e(example,)h
(w)o(orks)e(hard)i(to)e(c)o(ho)q(ose)h(the)h(b)q(est)f(represen)o(tation)g
(for)g(closures,)h(including)37 1972 y(allo)q(cating)14 b(them)e(on)g(the)g
(stac)o(k)f(rather)h(than)f(in)i(the)f(heap)h(whenev)o(er)f(p)q(ossible,)i
(and)f(sharing)f(one)g(blo)q(c)o(k)37 2029 y(of)h(free)g(v)m(ariables)i(b)q
(et)o(w)o(een)e(sev)o(eral)g(closures)h(\(Kranz)f([1988]\).)k(Apart)12
b(from)h(the)g(compiler)h(complexit)o(y)37 2085 y(in)o(v)o(olv)o(ed,)j
(considerable)h(extra)d(care)h(has)f(to)h(b)q(e)g(tak)o(en)g(in)g(the)g
(garbage)f(collector)i(to)e(a)o(v)o(oid)h(the)g(space)37 2142
y(leak)m(age)e(whic)o(h)g(can)f(o)q(ccur)h(when)g(a)e(closure)i(captures)f(a)
g(larger)g(set)g(of)g(free)g(v)m(ariables)h(than)f(the)g(closure)37
2198 y(itself)22 b(requires.)36 b(Indeed,)23 b(App)q(el's)f(measuremen)o(ts)e
(for)g(SML)g(of)g(New)h(Jersey)g(suggest)f(that)f(clev)o(er)37
2255 y(closure-represen)o(tation)d(tec)o(hniques)g(gain)g(little,)f(and)g(p)q
(oten)o(tially)i(lose)e(a)f(lot)h(\(in)h(space)f(complexit)o(y\),)37
2311 y(so)g(he)h(recommends)f(a)g(simple)i(\015at)e(represen)o(tation)g
(\(App)q(el)h([1992,)e(Chapter)h(12]\).)37 2397 y(The)j(Three)g(Instruction)g
(Mac)o(hine)g(\(TIM\))f(tak)o(es)f(another)h(in)o(teresting)h(p)q(osition.)28
b(Instead)18 b(of)f(repre-)37 2454 y(sen)o(ting)h(a)e(closure)h(b)o(y)g(a)g
(single)h(p)q(oin)o(ter,)f(it)g(represen)o(ts)g(a)f(closure)h(b)o(y)g(a)g
Fn(p)n(air)f Ft(of)h(a)f(co)q(de)i(p)q(oin)o(ter)f(and)37 2510
y(a)e(p)q(oin)o(ter)h(to)e(a)h(heap-allo)q(cated)h Fn(fr)n(ame)g
Ft(\(F)l(airbairn)f(&)g(W)l(ra)o(y)f([1987]\).)k(The)d(frame,)g(whic)o(h)g
(is)h(a)f(v)o(ector)37 2567 y(of)h(co)q(de-p)q(oin)o(ter/frame-p)q(oin)o(ter)
h(pairs,)f(giv)o(es)g(the)g(v)m(alues)h(of)f(the)g(free)g(v)m(ariables)h(of)e
(the)h(closure,)h(and)37 2623 y(ma)o(y)h(b)q(e)h(shared)g(b)q(et)o(w)o(een)f
(man)o(y)g(closures.)30 b(These)19 b(co)q(de-p)q(oin)o(ter/frame-p)q(oin)o
(ter)h(pairs)e(need)i(to)d(b)q(e)37 2679 y(handled)d(v)o(ery)e(carefully)i
(in)f(a)f(lazy)h(system,)f(b)q(ecause)h(they)g(cannot)f(b)q(e)h(duplicated)h
(without)e(the)h(risk)f(of)37 2736 y(duplicating)18 b(w)o(ork.)j(Prop)q(er)16
b(sharing)g(can)g(still)h(b)q(e)g(ensured,)f(but)g(it)g(results)g(in)h(a)e
(system)h(remark)m(ably)37 2792 y(similar)e(to)e(the)h(more)f(con)o(v)o(en)o
(tional)h(one)g(men)o(tioned)g(ab)q(o)o(v)o(e)g(\(P)o(eyton)e(Jones)i(&)g
(Lester)g([1992,)e(Chapter)934 2921 y(10)p eop
%%Page: 11 11
bop 37 199 a Ft(4]\).)37 349 y Fr(3.1.2)52 b(Represen)o(ting)18
b(th)o(unks)37 464 y Ft(In)c(a)f(non-strict)g(language,)h(v)m(alues)g(are)f
(passed)g(to)f(functions)i(or)f(stored)f(in)i(data)f(structures)f(in)i(unev)m
(al-)37 521 y(uated)k(form,)e(and)i(only)f(ev)m(aluated)i(when)e(their)h(v)m
(alue)g(is)g(actually)g(required.)27 b(Lik)o(e)18 b(function)g(v)m(alues,)37
577 y(these)e(unev)m(aluated)g(forms)e(capture)h(a)g(susp)q(ended)h
(computation,)f(and)g(can)g(b)q(e)h(represen)o(ted)f(b)o(y)g(a)f(clo-)37
634 y(sure)f(in)g(the)g(same)f(w)o(a)o(y)f(as)h(a)g(function)h(v)m(alue.)20
b(F)l(ollo)o(wing)14 b(the)e(terminology)h(of)f(Bloss,)g(Hudak)h(&)g(Y)l
(oung)37 690 y([1988],)18 b(w)o(e)g(call)i(this)f(particular)h(sort)d(of)i
(closure)g(a)f Fn(thunk)p Ft(,)i(a)e(term)g(whic)o(h)i(go)q(es)e(bac)o(k)h
(to)f(the)h(early)37 746 y(Algol)h(implemen)o(tations)g(of)e(call-b)o(y-name)
i(\(Ingerman)e([1961]\).)28 b(When)19 b(the)g(v)m(alue)h(of)e(the)h(th)o(unk)
f(is)37 803 y(required,)e(the)g(th)o(unk)f(is)h Fn(for)n(c)n(e)n(d)p
Ft(.)37 889 y(A)e(th)o(unk)g(can)g(\(in)h(principle\))h(b)q(e)e(represen)o
(ted)h(simply)g(b)o(y)e(a)h(parameter-less)g(function)g(v)m(alue,)h(but)f(it)
g(is)37 945 y(ine\016cien)o(t)h(to)d(do)g(so,)h(b)q(ecause)g(it)g(migh)o(t)g
(b)q(e)g(ev)m(aluated)h(rep)q(eatedly)l(.)20 b(This)13 b(duplicated)i(w)o
(ork)d(is)h(a)o(v)o(oided)37 1002 y(b)o(y)k(so-called)i Fn(lazy)d
Ft(implemen)o(tations)j(as)d(follo)o(ws:)24 b(when)17 b(a)g(th)o(unk)g(is)h
(forced)f(for)f(the)h(\014rst)g(time,)g(it)g(is)37 1058 y(ph)o(ysically)h
Fn(up)n(date)n(d)d Ft(with)h(its)f(v)m(alue.)37 1144 y(There)h(are)f(three)g
(main)h(strategies)e(for)h(dealing)i(with)e(up)q(dates)h(in)g(lazy)g
(implemen)o(tations:)37 1268 y Fr(The)i(na)-6 b(\177)-20 b(\020v)o(e)18
b(reduction)g(mo)q(del)23 b Ft(up)q(dates)12 b(the)f(graph)f(after)g(eac)o(h)
h(reduction)h(\(P)o(eyton)e(Jones)i([1987]\).)151 1324 y(\(By)22
b(\\reduction")g(is)g(mean)o(t)f(the)h(replacemen)o(t)g(of)g(an)f(instance)i
(of)e(the)h(left-hand)g(side)h(of)e(a)151 1380 y(function)c(de\014nition)g(b)
o(y)e(the)h(corresp)q(onding)h(instance)f(of)f(its)h(righ)o(t-hand)g(side.\))
21 b(Apart)15 b(from)g(a)151 1437 y(few)e(optimisations,)h(this)f(is)g(the)g
(up)q(date)h(strategy)e(used)h(b)o(y)g(the)g(G-mac)o(hine)h(\(Johnsson)f
([1984]\).)151 1493 y(Its)h(main)f(disadv)m(an)o(tage)h(is)g(that)f(a)g(th)o
(unk)g(ma)o(y)g(b)q(e)h(up)q(dated)g(with)g(another)f(th)o(unk,)h(so)f(the)g
(same)151 1550 y(ob)s(ject)i(ma)o(y)f(b)q(e)i(up)q(dated)g(rep)q(eatedly)l(,)
g(and)g(w)o(e)f(do)g(not)g(consider)h(this)f(mo)q(del)h(further.)37
1644 y Fr(The)i(cell)h(mo)q(del.)k Ft(In)c(the)f(cell)i(mo)q(del,)f(eac)o(h)g
(closure)g(is)f(pro)o(vided)h(with)g(a)f Fn(status)h(\015ag)f
Ft(to)f(indicate)151 1700 y(whether)h(it)f(is)h(ev)m(aluated)h(or)e(not.)26
b(The)18 b(co)q(de)g(to)f(force)g(\(that)f(is,)j(get)e(the)g(v)m(alue)i(of)t
(\))d(a)h(closure)151 1757 y(c)o(hec)o(ks)11 b(the)g(status)f(\015ag.)18
b(If)11 b(the)f(closure)i(is)f(already)g(ev)m(aluated,)h(its)f(v)m(alue)h(is)
f(extracted;)h(otherwise)151 1813 y(the)j(susp)q(ended)i(computation)d(is)i
(p)q(erformed)f(\(b)o(y)f(en)o(tering)i(the)f(closure\),)g(the)f(v)m(alue)j
(is)e(written)151 1869 y(in)o(to)g(the)h(cell,)g(and)f(the)h(status)e(\015ag)
h(is)h(\015ipp)q(ed)h(\(Bloss,)e(Hudak)g(&)h(Y)l(oung)f([1988]\).)37
1963 y Fr(The)j(self-up)q(dating)i(mo)q(del,)j Ft(whic)o(h)17
b(is)f(used)h(b)o(y)e(the)h(STG)g(mac)o(hine.)23 b(The)16 b(cell)h(mo)q(del)g
(places)g(the)151 2020 y(resp)q(onsibilit)o(y)j(for)d(p)q(erforming)h(the)g
(up)q(date)g(on)f(the)h(co)q(de)g(whic)o(h)h(ev)m(aluates)f(the)g(th)o(unk.)
27 b(The)151 2076 y(self-up)q(dating)14 b(mo)q(del)f(instead)g(places)g(this)
g(resp)q(onsibilit)o(y)i(on)d(the)g(co)q(de)h(inside)h(the)e(th)o(unk)g
(itself.)151 2133 y(The)18 b(co)q(de)g(to)f(force)g(a)g(closure)h(simply)h
(pushes)f(a)f(contin)o(uation)h(on)g(the)f(stac)o(k)g(and)h(en)o(ters)f(the)
151 2189 y(closure;)26 b(if)d(the)f(closure)g(is)h(a)f(th)o(unk,)h(it)g
(arranges)e(for)g(an)h(up)q(date)h(to)e(b)q(e)i(p)q(erformed)f(when)151
2246 y(ev)m(aluation)17 b(is)e(complete,)h(otherwise)f(it)h(just)f(returns)g
(its)g(v)m(alue.)21 b(No)15 b(tests)g(need)h(b)q(e)g(p)q(erformed.)151
2321 y(The)i(up)q(date)g(o)o(v)o(erwrites)f(the)g(th)o(unk)h(with)g(a)f(v)m
(alue,)i Fn(which)g(ther)n(efor)n(e)f(must)h(also)f(have)h(a)f(c)n(o)n(de)151
2377 y(p)n(ointer)p Ft(,)d(b)q(ecause)h(subsequen)o(t)g(forces)e(will)j
(re-en)o(ter)e(the)g(th)o(unk-turned-v)m(alue.)22 b(This)16
b(represen-)151 2434 y(tation)g(is)g(natural)g(for)f(function)h(v)m(alues,)h
(as)e(w)o(e)h(ha)o(v)o(e)f(already)h(discussed,)h(but)f(is)g(something)g(of)
151 2490 y(a)f(surprise)i(for)d(data)h(v)m(alues.)22 b(A)16
b(list)g(cell,)h(for)e(example,)h(is)g(represen)o(ted)g(b)o(y)f(a)g(co)q(de)h
(p)q(oin)o(ter)g(to-)151 2547 y(gether)e(with)h(the)f(t)o(w)o(o)f(p)q(oin)o
(ters)h(comprising)h(the)g(head)f(and)h(tail)f(of)g(the)g(list.)21
b(The)14 b(co)q(de)h(p)q(oin)o(ted)151 2603 y(to)h(from)f(the)h(list)h(cell)h
(simply)f(returns)f(immediately)1100 2586 y Fl(2)1125 2603
y Ft(.)23 b(In)16 b(e\013ect,)g(the)g(co)q(de)h(p)q(oin)o(ter)g(pla)o(ys)f
(the)151 2659 y(role)g(of)e(the)i(\015ag)f(in)h(cell)g(mo)q(del.)p
37 2699 735 2 v 86 2726 a Fk(2)107 2742 y Fu(In)e(Section)h(3.3)f(w)o(e)f
(explore)j(v)n(arian)o(ts)f(of)f(this)h(sc)o(heme,)f(in)h(whic)o(h)g(the)f
(co)q(de)h(for)f(a)g(list)h(cell)g(do)q(es)g(rather)f(more)g(than)37
2787 y(simply)h(return.)934 2921 y Ft(11)p eop
%%Page: 12 12
bop 151 199 a Ft(Bloss,)17 b(Hudak)f(&)h(Y)l(oung)f([1988])e(call)k(this)e
(mo)q(del)h(\\closure)g(mo)q(de",)f(but)g(the)h(implemen)o(tation)151
256 y(they)j(suggest)g(is)g(v)o(ery)g(m)o(uc)o(h)g(less)h(e\016cien)o(t)g
(\(in)f(b)q(oth)g(time)h(and)f(space\))g(than)g(that)f(outlined)151
312 y(ab)q(o)o(v)o(e,)c(b)q(ecause)h(it)f(is)h(based)f(on)h(a)e(translation)i
(in)o(to)f(Lisp.)37 436 y(The)e(latter)f(t)o(w)o(o)f(mo)q(dels)i(eac)o(h)g
(o\013er)e(scop)q(e)i(for)f(optimisation.)19 b(Consider)13
b(the)f(cell)i(mo)q(del,)g(for)d(example.)37 492 y(F)l(orcing)17
b(can)g(b)q(e)g(optimised)g(if)g(the)f(compiler)i(can)f(pro)o(v)o(e)e(that)h
(the)g(th)o(unk)h(is)g(certainly)g(already)g(ev)m(al-)37 548
y(uated)g(\(or)g(the)g(rev)o(erse\),)f(b)q(ecause)i(the)f(test)f(on)h(the)g
(\015ag)g(can)g(b)q(e)g(omitted)g(\(Bloss,)g(Hudak)h(&)f(Y)l(oung)37
605 y([1988]\).)j(F)l(urthermore,)15 b(if)i(the)f(compiler)h(can)f(pro)o(v)o
(e)f(that)g(there)h(can)g(b)q(e)h(no)e(subsequen)o(t)i(co)q(de)f(forces)37
661 y(on)g(the)f(th)o(unk,)g(then)g(it)h(can)f(omit)g(the)h(co)q(de)f(whic)o
(h)h(p)q(erforms)f(the)h(up)q(date.)37 747 y(A)23 b(similar)h(situation)g
(holds)f(for)f(the)h(self-up)q(dating)i(mo)q(del.)43 b(If)23
b(the)g(compiler)h(can)f(pro)o(v)o(e)f(that)g(a)37 804 y(particular)16
b(th)o(unk)e(can)h(only)g(b)q(e)g(ev)m(aluated)h(at)e(most)f(once)i(\(whic)o
(h)g(w)o(e)f(exp)q(ect)i(to)e(b)q(e)h(quite)g(common\),)37
860 y(it)k(can)f(create)g(co)q(de)g(for)g(the)g(th)o(unk)g(whic)o(h)h(do)q
(esn't)f(p)q(erform)f(the)h(up)q(date.)29 b(Unlik)o(e)20 b(the)e(cell)h(mo)q
(del,)37 917 y(the)d(self-up)q(dating)h(mo)q(del)f(cannot)f(tak)o(e)f(adv)m
(an)o(tage)h(of)g(order-of-ev)m(aluation)h(analyses.)37 1066
y Fr(3.1.3)52 b(A)17 b(uniform)g(represen)o(tation)h(for)f(closures)37
1182 y Ft(As)c(indicated)h(ab)q(o)o(v)o(e,)f(the)f(self-up)q(dating)i(mo)q
(del)g(strongly)e(suggests)g(that)g Fn(every)i(he)n(ap-al)r(lo)n(c)n(ate)n(d)
f(obje)n(ct)37 1238 y(\(whether)j(a)f(he)n(ad)g(normal)g(form)h(or)f(a)g
(thunk\))g(is)f(r)n(epr)n(esente)n(d)g(uniformly,)h(by)g(a)g(c)n(o)n(de)g(p)n
(ointer)g(to)n(gether)37 1295 y(with)22 b(zer)n(o)e(or)h(mor)n(e)g(\014elds)e
(which)i(give)g(the)g(values)f(of)h(the)g(fr)n(e)n(e)e(variables)i(of)f(the)h
(c)n(o)n(de)p Ft(.)34 b(The)20 b(STG)37 1351 y(mac)o(hine)j(adopts)f(this)g
(uniform)g(represen)o(tation,)i(as)d(can)h(b)q(e)h(seen)g(in)f(the)g(op)q
(erational)h(seman)o(tics)37 1407 y(\(Section)c(5\),)f(where)g(all)h(heap)g
(v)m(alues)g(are)f(represen)o(ted)h(uniformly)g(b)o(y)f(some)g(co)q(de)g
(together)g(with)g(a)37 1464 y(sequence)f(of)e(v)m(alues.)22
b(Indeed)17 b(this)f(is)g(wh)o(y)g(the)f(mac)o(hine)h(is)h(called)g
(\\tagless":)i(since)e(all)f(ob)s(jects)f(ha)o(v)o(e)37 1520
y(the)22 b(same)f(form)f(there)h(is)h(no)f(need)h(for)e(a)h(tag)f(to)h
(distinguish)i(one)e(kind)i(of)d(ob)s(ject)h(from)f(another)37
1577 y(\(con)o(trast)c(the)h(presen)o(tation)h(in)g(P)o(eyton)f(Jones)g
([1987,)f(Chapter)h(10]\).)25 b(W)l(e)17 b(use)h(the)f(term)g(\\closure")37
1633 y(to)e(refer)g(to)g(b)q(oth)g(v)m(alues)h(and)g(th)o(unks)f(b)q(ecause)h
(of)f(their)h(uniform)f(represen)o(tation.)37 1719 y(The)c(decision)h(to)e
(use)h(a)f(uniform)h(represen)o(tation)f(for)g(all)h(closures)h(has)e(other)g
(in)o(teresting)h(rami\014cations,)37 1776 y(whic)o(h)17 b(w)o(e)d(explore)i
(in)g(this)g(section.)37 1862 y(Firstly)l(,)i(when)g(a)f(th)o(unk)g(is)g(up)q
(dated)h(with)g(its)f(v)m(alue,)h(it)g(is)f(p)q(ossible)i(that)e(the)g(v)m
(alue)h(will)h(tak)o(e)d(more)37 1918 y(space)j(than)f(the)g(th)o(unk.)29
b(In)19 b(this)g(case,)f(the)h(th)o(unk)f(m)o(ust)g(b)q(e)h(up)q(dated)g
(with)f(an)g Fn(indir)n(e)n(ction)f Ft(to)h(the)37 1975 y(v)m(alue)h
(\(Figure)d(1\).)24 b(This)18 b(causes)f(no)g(di\016cult)o(y)h(for)e(the)h
(self-up)q(dating)h(mo)q(del,)g(b)q(ecause)g(indirections)37
2031 y(can)13 b(b)q(e)f(represen)o(ted)h(b)o(y)f(a)g(closure)h(whose)f(co)q
(de)g(simply)i(en)o(ters)e(the)g(target)f(closure.)19 b(Suc)o(h)13
b(indirections)37 2087 y(can)j(readily)g(b)q(e)g(remo)o(v)o(ed)f(during)h
(garbage)e(collection)j(\(Section)f(7.3\).)37 2173 y(In)e(the)f(cell)i(mo)q
(del,)f(either)g(a)e(second)i(test)e(m)o(ust)h(b)q(e)g(made)g(to)g(c)o(hec)o
(k)g(for)f(indirections,)k(or)c(alternativ)o(ely)37 2230 y
Fn(every)i Ft(up)q(dated)h(th)o(unk)f(m)o(ust)f(b)q(e)h(an)g(indirection.)22
b(\(Figure)13 b(2)h(sho)o(ws)f(the)h(latter)f(case.\))19 b(Both)14
b(metho)q(ds)37 2286 y(imp)q(ose)j(extra)d(o)o(v)o(erhead.)37
2372 y(Secondly)l(,)25 b(the)c(self-up)q(dating)i(mo)q(del)f(also)f(allo)o
(ws)g(other)g(exceptional)i(cases)e(to)g(b)q(e)h(tak)o(en)e(care)h(of)37
2429 y(without)16 b(extra)e(tests.)19 b(F)l(or)c(example,)106
2552 y Fo(\017)22 b Ft(When)16 b(a)f(th)o(unk)g(is)h(en)o(tered,)f(its)g(co)q
(de)h(p)q(oin)o(ter)g(can)f(b)q(e)h(o)o(v)o(erwritten)f(with)g(a)g(\\blac)o
(k-hole")h(co)q(de)151 2609 y(p)q(oin)o(ter.)k(If)14 b(the)g(th)o(unk)g(is)g
(ev)o(er)g(re-en)o(tered)g(b)q(efore)h(it)f(is)g(up)q(dated,)h(then)f(its)g
(v)m(alue)h(m)o(ust)e(dep)q(end)151 2665 y(on)j(itself.)23
b(It)16 b(follo)o(ws)g(that)f(the)h(program)f(has)h(en)o(tered)g(an)g
(in\014nite)i(lo)q(op,)e(and)g(a)f(suitable)j(error)151 2722
y(message)c(can)h(b)q(e)g(displa)o(y)o(ed.)21 b(Without)14
b(this)h(mec)o(hanism)g(stac)o(k)e(o)o(v)o(er\015o)o(w)h(o)q(ccurs,)g(whic)o
(h)h(is)g(less)151 2778 y(helpful)i(to)e(the)g(programmer.)934
2921 y(12)p eop
%%Page: 13 13
bop 377 783 270 4 v 377 847 4 64 v 643 847 V 377 850 270 4
v 507 848 4 64 v 443 980 4 165 v 445 981 64 4 v 467 979 a Fi(-)p
576 816 195 4 v 729 814 a(-)p 1172 783 397 4 v 1172 847 4 64
v 1565 847 V 1172 850 397 4 v 1309 848 4 64 v 1436 848 V 1241
1043 4 229 v 1243 1045 68 4 v 1269 1043 a(-)p 1373 912 4 98
v 1374 912 a(?)p 1500 912 V 86 w(?)p 752 329 397 4 v 752 393
4 64 v 1146 393 V 752 396 397 4 v 881 395 4 64 v 1016 395 V
818 586 4 225 v 819 588 64 4 v 842 586 a(-)p 945 458 4 98 v
947 458 a(?)p 1080 458 V 93 w(?)p 250 164 1413 4 v 250 1158
4 994 v 1659 1158 V 250 1161 1413 4 v 298 732 a Fy(After)15
b(up)q(dating)e(\(big)h(v)n(alue\))546 995 y Fu(Indirection)h(co)q(de)801
833 y(V)m(alue)1322 1043 y(Cons)e(co)q(de)1322 961 y(Head)60
b(T)m(ail)1146 732 y Fy(After)14 b(up)q(dating)g(\(small)d(v)n(alue\))902
605 y Fu(Co)q(de)936 507 y(F)m(ree)h(v)n(ars)789 279 y Fy(Before)j(up)q
(dating)494 1270 y Ft(Figure)g(1:)20 b(Up)q(dating)c(in)g(the)f(self-up)q
(dating)i(mo)q(del)106 1407 y Fo(\017)22 b Ft(In)17 b(a)e(system)g(whic)o(h)i
(supp)q(orts)f(concurren)o(t)g(threads)f(of)h(execution,)g(exactly)g(the)g
(same)g(metho)q(d)151 1464 y(can)23 b(b)q(e)g(used)g(to)f(sync)o(hronise)i
(threads.)42 b(When)23 b(a)f(th)o(unk)h(is)g(en)o(tered,)h(its)f(co)q(de)g(p)
q(oin)o(ter)g(is)151 1520 y(o)o(v)o(erwritten)c(with)g(a)h(\\queue-me")f(co)q
(de)h(p)q(oin)o(ter.)33 b(If)20 b(another)f(thread)g(tries)h(to)f(ev)m
(aluate)h(the)151 1577 y(th)o(unk)e(b)q(efore)h(the)f(\014rst)f(thread)h(has)
g(completed,)h(the)f(former)g(is)g(susp)q(ended)i(and)e(added)h(to)e(a)151
1633 y(queue)c(of)e(threads)g(attac)o(hed)g(to)g(the)h(th)o(unk.)19
b(When)12 b(the)f(th)o(unk)h(is)g(up)q(dated,)h(the)e(queued)i(threads)151
1690 y(are)i(re-enabled.)106 1784 y Fo(\017)22 b Ft(In)c(a)f(system)g(with)g
(distributed)i(memory)l(,)e(p)q(oin)o(ters)g(to)g(remote)f(memory)h(units)h
(often)f(ha)o(v)o(e)g(to)151 1840 y(b)q(e)j(treated)f(di\013eren)o(tly)h(to)f
(lo)q(cal)i(p)q(oin)o(ters.)33 b(Ho)o(w)o(ev)o(er,)19 b(it)h(w)o(ould)f(b)q
(e)i(v)o(ery)e(exp)q(ensiv)o(e)i(to)e(test)151 1896 y(for)13
b(remote-ness)h(whenev)o(er)h(dereferencing)g(a)f(p)q(oin)o(ter!)20
b(In)14 b(the)g(self-up)q(dating)i(mo)q(del,)f(a)f(remote)151
1953 y(p)q(oin)o(ter)21 b(can)g(b)q(e)h(represen)o(ted)f(as)g(a)f(sp)q(ecial)
j(kind)f(of)e(indirection,)k(and)d(no)g(tests)f(for)h(remote)151
2009 y(p)q(oin)o(ters)16 b(need)g(b)q(e)g(p)q(erformed.)p 1116
2357 4 75 v 1039 2281 232 4 v 1039 2356 4 75 v 1267 2356 V
1039 2359 232 4 v 1174 2322 225 4 v 1357 2320 a Fi(-)1455 2339
y Fy(V)m(alue)1076 2335 y FA(1)1076 2245 y Ft(After)f(up)q(dating)p
553 2357 4 75 v 703 2357 V 478 2582 4 263 v 480 2584 75 4 v
513 2582 a Fi(-)p 628 2432 4 113 v 630 2432 a(?)p 778 2432
V 108 w(?)p 327 2281 532 4 v 327 2356 4 75 v 855 2356 V 327
2359 532 4 v 403 2357 4 75 v 286 2112 1342 4 v 286 2656 4 544
v 1624 2656 V 286 2659 1342 4 v 574 2601 a Fy(Co)q(de)611 2489
y(F)m(ree)g(v)n(ars)356 2335 y FA(0)360 2241 y Ft(Before)g(up)q(dating)590
2768 y(Figure)g(2:)20 b(Up)q(dating)c(in)g(the)f(cell)i(mo)q(del)934
2921 y(13)p eop
%%Page: 14 14
bop 37 199 a Fm(3.2)56 b(F)-5 b(unction)19 b(application)f(and)h(the)f(ev)m
(aluation)g(stac)n(k)37 315 y Ft(Higher-order)23 b(languages,)g(whic)o(h)g
(allo)o(w)f(functions)h(as)f(\\\014rst-class)g(citizens",)i(presen)o(t)e(in)o
(teresting)37 371 y(c)o(hallenges)c(for)d(the)h(compiler-writer.)24
b(An)16 b(illuminating)j(w)o(a)o(y)c(of)g(comparing)h(compilation)h
(strategies)37 428 y(is)f(to)f(ask)g(ho)o(w)f(function)i(application)h(is)f
(p)q(erformed.)37 575 y Fr(3.2.1)52 b(Currying)37 690 y Ft(The)16
b(languages)f(in)g(whic)o(h)h(w)o(e)f(are)f(in)o(terested)i(mak)o(e)e(hea)o
(vy)h(use)g(of)g Fn(currie)n(d)h(functions)p Ft(.)j(F)l(or)14
b(example,)37 746 y(consider)j(the)e(follo)o(wing)h(Hask)o(ell)g(function)g
(de\014nition:)228 832 y Fp(f)24 b(x)g(y)g(=)f(x)37 918 y(f)17
b Ft(is)g(attributed)g(the)f(t)o(yp)q(e)h Fp(a)24 b(->)f(\(b)h(->)f(a\))p
Ft(.)h(That)16 b(is,)h Fp(f)g Ft(ma)o(y)f(b)q(e)h(though)o(t)f(of)g(as)g(a)g
(function)i(of)e(one)37 975 y(argumen)o(t,)22 b(whic)o(h)f(returns)g(a)f
(function)i(whic)o(h)g(tak)o(es)e(the)h(second)g(argumen)o(t.)36
b(An)21 b(application)h(of)37 1031 y Fp(f)p Ft(,)e(sa)o(y)f
Fp(\(f)24 b(1)f(2\))p Ft(,)d(is)g(short)e(for)h Fp(\(\(f)k(1\))h(2\))p
Ft(.)32 b(An)20 b(application)g(of)f Fp(f)g Ft(to)g(one)h(argumen)o(t)e(is)i
(p)q(erfectly)37 1088 y(acceptable;)c(for)f(example)h Fp(\(map)23
b(\(f)h(1\))f(xs\))p Ft(.)37 1174 y(In)15 b(strict)g(languages)f(lik)o(e)i
(Lisp,)f(Hop)q(e)g(and)f(SML,)g(the)h(de\014nition)h(of)e Fp(f)g
Ft(w)o(ould)h(usually)g(b)q(e)g(of)f(the)h(form)228 1260 y
Fp(f)24 b(\(x,y\))f(=)h(x)37 1346 y Ft(where)19 b Fp(f)g Ft(is)g(attributed)f
(the)h(t)o(yp)q(e)g Fp(\(a,b\))k(->)g(a)p Ft(.)30 b(\(W)l(e)19
b(use)g Fp(\(a,b\))e Ft(to)h(denote)h(the)g(t)o(yp)q(e)f(of)h(pairs)f(of)37
1402 y(elemen)o(ts)e(of)e(t)o(yp)q(e)h Fp(a)f Ft(and)h Fp(b)p
Ft(.\))k(The)c(function)g Fp(f)g Ft(can)g(only)g(b)q(e)g(applied)i(to)c(a)i
(suitable)h(pair,)e(and)h(cannot)37 1459 y(b)q(e)h(applied)h(to)e(just)g(one)
g(argumen)o(t.)37 1545 y(In)d(all)f(of)f(these)h(languages)f(it)h(is)g(p)q
(ossible)h(\(and,)f(in)h(SML,)e(easy\))g(to)g(de\014ne)h(curried)h(functions)
f(\(otherwise)37 1601 y(they)22 b(w)o(ould)f(hardly)g(deserv)o(e)h(the)f
(title)g(\\higher-order"\),)h(but)f(compilers)h(usually)h(implemen)o(t)f(the)
37 1657 y(uncurried)f(form)d(m)o(uc)o(h)g(more)h(e\016cien)o(tly)l(,)h(and)f
(programmers)f(resp)q(ond)h(accordingly)l(.)32 b(There)19 b(is)g(the)37
1714 y(in)o(v)o(erse)f(cultural)h(tradition)f(in)g(non-strict)g(functional)h
(languages,)f(where)g(the)f(additional)i(\015exibili)q(t)o(y)37
1770 y(allo)o(w)o(ed)14 b(b)o(y)f(the)f(curried)i(form)f(means)f(that)g(it)i
(is)f(usually)h(preferred)f(b)o(y)g(programmers,)f(and)h(compilers)37
1827 y(t)o(ypically)k(treat)d(curried)j(application)f(as)f(fundamen)o(tal.)37
1974 y Fr(3.2.2)52 b(Compiling)19 b(function)g(application)37
2089 y Ft(Compilers)g(from)d(the)i(Lisp)h(tradition)e(usually)i(compile)g
(function)f(application)i(as)d(follo)o(ws:)24 b(ev)m(aluate)37
2146 y(the)16 b(function,)f(ev)m(aluate)h(the)f(argumen)o(t,)f(and)i(apply)g
(the)f(function)h(v)m(alue)g(to)f(the)g(argumen)o(t.)k(When)c(a)37
2202 y(kno)o(wn)j(function)g(is)g(b)q(eing)h(applied)h(\(as)d(is)h(often)f
(the)h(case,)g(esp)q(ecially)i(in)e(Lisp\),)h(the)f(\\ev)m(aluate)g(the)37
2259 y(function")f(part)f(b)q(ecomes)h(trivial.)25 b(This)17
b(mo)q(del)g(for)f(function)h(application,)i(whic)o(h)e(w)o(e)f(call)i(the)e
Fn(eval-)37 2315 y(apply)f(mo)n(del)p Ft(,)f(is)f(in)o(v)m(ariably)i(used)f
(b)o(y)g(compilers)g(for)f(strict)g(languages)h(\(eg)e(Lisp,)j(Hop)q(e,)f
(SML)f(and)h(the)37 2371 y(SECD)e(mac)o(hine)h(\(Henderson)f([1980];)f
(Landin)i([1965]\)\).)j(It)c(is)h(also)f(used)g(in)h(some)e(implemen)o
(tations)i(of)37 2428 y(non-strict)e(languages,)g(except)g(that)f(of)g
(course)g(only)h(the)g(function)g(is)g(ev)m(aluated)g(b)q(efore)g(the)f
(application)37 2484 y(\(eg)17 b(the)g(ABC)g(mac)o(hine)h(\(Ko)q(opman)e
([1990]\),)f(and)i(the)g Fo(h)p Fq(\027;)8 b Fn(G)t Fo(i)p
Ft(-mac)o(hine)34 b(\(Augustsson)16 b(&)i(Johnsson)37 2541
y([1989]\)\).)37 2627 y(In)i(con)o(trast,)f(compilers)h(based)f(on)g(lazy)h
(graph)f(reduction)h(treat)e(function)i(application)h(as)d(follo)o(ws:)37
2683 y(push)f(the)f(argumen)o(t)f(on)h(an)g(ev)m(aluation)i(stac)o(k,)d(and)h
(tail-call)i(\(or)d Fn(enter)p Ft(\))g(the)h(function.)23 b(There)17
b(is)f(no)37 2740 y(\\return")f(when)g(the)g(ev)m(aluation)h(of)f(the)g
(function)g(is)h(complete.)k(W)l(e)15 b(call)h(this)f(the)g
Fn(push-enter)i(mo)n(del)p Ft(;)37 2796 y(it)f(is)g(used)f(b)o(y)h(the)f
(G-mac)o(hine,)g(TIM,)g(and)g(the)h(STG)f(mac)o(hine.)934 2921
y(14)p eop
%%Page: 15 15
bop 37 199 a Ft(The)15 b(di\013erence)g(b)q(et)o(w)o(een)g(the)f(t)o(w)o(o)f
(mo)q(dels)i(seems)f(rather)g(sligh)o(t,)g(but)g(it)h(has)f(a)g(p)q(erv)m
(asiv)o(e)h(e\013ect.)k(It)14 b(is)37 256 y(di\016cult)h(to)d(sa)o(y)f(in)j
(general)f(whic)o(h)g(of)g(the)f(t)o(w)o(o)f(is)j(\\b)q(etter".)k(In)13
b(essen)o(tially)h(\014rst-order)e(programs)g(they)37 312 y(generate)17
b(m)o(uc)o(h)g(the)h(same)e(co)q(de.)26 b(F)l(or)17 b(programs)f(whic)o(h)i
(mak)o(e)e(extensiv)o(e)i(use)f(of)g(curried)h(functions)37
369 y(the)e(push-en)o(ter)g(mo)q(del)g(lo)q(oks)f(b)q(etter.)20
b(F)l(or)15 b(example,)g(consider)h(the)g(\(curried\))f(function)h
(de\014nition)228 455 y Fp(apply3)23 b(f)h(x)g(y)g(z)f(=)h(f)g(x)g(y)f(z)37
541 y Ft(A)g(Lisp-lik)o(e)i(compiler)f(w)o(ould)f(b)q(e)g(comp)q(elled)i(to)d
(ev)m(aluate)h Fp(\(f)g(x\))p Ft(,)h(then)f(ev)m(aluate)g(that)f(function)37
597 y(applied)d(to)d Fp(y)p Ft(,)g(and)h(\014nally)h(apply)f(the)f(result)h
(to)f Fp(z)p Ft(.)24 b(A)16 b(graph-reduction)i(compiler)f(w)o(ould)g(just)f
(push)37 653 y Fp(x)p Ft(,)f Fp(y)g Ft(and)h Fp(z)f Ft(on)o(to)f(the)h(ev)m
(aluation)i(stac)o(k)d(b)q(efore)h(jumping)h(to)f(the)g(closure)h(for)f
Fp(f)p Ft(.)37 803 y Fr(3.2.3)52 b(The)18 b(ev)m(aluation)h(stac)o(k)37
918 y Ft(The)i(main)f(cost)g(of)f(the)i(push-en)o(ter)f(mo)q(del)h(of)f
(function)h(application)g(is)g(that)e(the)h(link)i(b)q(et)o(w)o(een)e(a)37
975 y Fn(function)c(b)n(o)n(dy)e Ft(and)g(an)g Fn(activation)i(fr)n(ame)f
Ft(is)f(brok)o(en.)20 b(F)l(or)14 b(example,)h(consider)g Fp(apply3)e
Ft(again.)20 b(In)15 b(the)37 1031 y(ev)m(al-apply)e(mo)q(del)f(the)f
(compiler)h(can)f(allo)q(cate)g(an)g(activ)m(ation)g(frame)g(for)f
Fp(apply3)g Ft(whic)o(h)h(is)h(deallo)q(cated)37 1088 y(when)k(the)f(v)m
(alue)h(of)e Fp(\(f)24 b(x)f(y)h(z\))14 b Ft(has)h(b)q(een)h(computed.)k(In)
15 b(the)g(push-en)o(ter)h(mo)q(del,)f(all)h(that)e(happ)q(ens)37
1144 y(is)g(that)f(three)h(more)f(argumen)o(ts)f(are)i(pushed)g(on)g(the)f
(ev)m(aluation)i(stac)o(k)e(b)q(efore)g(jumping)i(to)e Fp(f)o
Ft(.)20 b(T)l(o)13 b(put)37 1201 y(it)j(another)e(w)o(a)o(y)l(,)g(there)h
(are)f(no)h(iden)o(ti\014able)j(momen)o(ts)c(at)g(whic)o(h)i(a)e(new)h(activ)
m(ation)h(frame)e(should)i(b)q(e)37 1257 y(allo)q(cated)h(or)d(reclaimed.)37
1343 y(This)e(pushes)g(the)f(push-en)o(ter)g(ev)m(aluation)i(mo)q(del)e(in)h
(the)f(direction)h(of)f(ha)o(ving)g(a)g(con)o(tiguous)g(ev)m(aluation)37
1400 y(stac)o(k,)i(rather)g(than)g(a)f(link)o(ed)j(list)f(of)f(heap-allo)q
(cated)i(activ)m(ation)f(frames,)e(as)h(exempli\014ed)j(b)o(y)d(the)g(New)37
1456 y(Jersey)k(SML)g(compiler)g(\(App)q(el)h(&)f(Jim)g([1989]\).)k(The)16
b(idea)h(of)f(heap-allo)q(cated)i(activ)m(ation)f(frames)e(is)37
1512 y(v)o(ery)e(app)q(ealing,)h(b)q(ecause)f(it)g(mak)o(es)f(it)h(easy)f(to)
g(implemen)o(t)i Fp(call/cc)d Ft(\(App)q(el)j(&)f(Jim)g([1989]\),)d(parallel)
37 1569 y(threads)17 b(\(Co)q(op)q(er)g(&)g(Morrisett)f([1990]\))e(and)j
(certain)g(debugging)h(mec)o(hanisms)g(\(T)l(olmac)o(h)e(&)h(App)q(el)37
1625 y([1990]\).)25 b(But)17 b(all)i(these)e(things)h(can)f(b)q(e)i(done)e(b)
o(y)h(allo)q(cating)g(a)f(con)o(tiguous)h(stac)o(k)e(in)j(medium-sized)37
1682 y(c)o(h)o(unks)f(in)g(the)g(heap,)g(at)f(the)g(price)h(of)f(a)g(little)i
(extra)e(complication)i(\(Hieb,)f(Dyb)o(vig)g(&)f(Bruggeman)37
1738 y([1990];)c(P)o(eyton)i(Jones)h(&)f(Salkild)i([1989]\).)37
1824 y(Indeed,)k(p)q(erformance)e(ma)o(y)f(w)o(ell)i(b)q(e)g(b)q(etter)f
(using)g(a)g(con)o(tiguous)g(stac)o(k)f(b)q(ecause)h(of)g(the)g(impro)o(v)o
(ed)37 1881 y(spatial)13 b(lo)q(calit)o(y,)h(whic)o(h)g(reduces)f(paging)f
(and)h(cac)o(he)g(misses.)19 b(Con)o(tiguous)12 b(allo)q(cation)i(of)e(fresh)
g(activ)m(a-)37 1937 y(tion)k(records)f(is)h(p)q(essimal)g(for)f(cac)o(hes,)g
(since)h(they)f(ha)o(v)o(e)g(to)g(b)q(oth)g(fetc)o(h)g(useless)h(data)f
(\(since)h(they)f(are)37 1994 y(not)f(clev)o(er)g(enough)g(to)f(kno)o(w)g
(that)g(it)h(is)g(free)g(space)g(whic)o(h)g(is)g(ab)q(out)g(to)f(b)q(e)h
(allo)q(cated\))g(and)g(then)g(write)37 2050 y(bac)o(k)h(an)f(activ)m(ation)g
(frame)g(to)g(main)g(memory)g(whic)o(h)h(is)g(quite)f(lik)o(ely)i(to)e(b)q(e)
h(garbage)e(already)l(.)20 b(Unless)37 2107 y(one)c(uses)g(generational)h
(garbage)e(collection,)i Fn(and)g(the)g(youngest)f(gener)n(ation)g(\014ts)g
(entir)n(ely)g(within)h(the)37 2163 y(c)n(ache)p Ft(,)g(using)h(a)e(con)o
(tiguous)h(stac)o(k)f(is)h(lik)o(ely)i(to)d(ha)o(v)o(e)g(far)g(b)q(etter)h
(cac)o(he)g(p)q(erformance)g(\(App)q(el)h([1992,)37 2219 y(Chapter)c(15];)f
(Wilson,)i(Lam)f(&)g(Moher)g([1992]\).)j(Curren)o(t)d(cac)o(he)g(sizes)h(are)
f(still)h(to)q(o)f(small)g(to)g(con)o(tain)37 2276 y(a)j(complete)g
(generation,)f(but)h(that)f(ma)o(y)g(c)o(hange.)23 b(It)17
b(w)o(ould)g(b)q(e)g(v)o(ery)f(in)o(teresting)h(to)f(quan)o(tify)h(these)37
2332 y(e\013ects.)37 2418 y(The)11 b Fo(h)p Fq(\027;)d Fn(G)t
Fo(i)p Ft(-mac)o(hine)k(is)f(another)f(in)o(teresting)i(design)f(compromise)g
(\(Augustsson)f(&)h(Johnsson)h([1989]\).)37 2475 y(Here)19
b(again,)g(there)f(is)h(no)g(con)o(tiguous)f(ev)m(aluation)i(stac)o(k.)28
b(Instead,)19 b(w)o(orking)f(space)h(is)g(allo)q(cated)g(in)37
2531 y(ev)o(ery)c(closure)f(\(whic)o(h)h(the)f Fo(h)p Fq(\027;)8
b Fn(G)t Fo(i)p Ft(-mac)o(hine)15 b(calls)g(a)f(frame\),)f(and)i(the)f
(closures)h(under)g(ev)m(aluation)g(are)37 2588 y(link)o(ed)h(together)d(m)o
(uc)o(h)h(as)g(heap-allo)q(cated)i(activ)m(ation)e(frames)g(are.)19
b(The)14 b(p)q(enalties)i(are:)j(space)14 b(usage)37 2644 y(is)20
b(w)o(orse,)f(b)q(ecause)g(all)h(closures)g(con)o(tain)f(the)g(extra)f(space)
h(regardless)g(of)g(whether)g(they)g(are)g(b)q(eing)37 2701
y(ev)m(aluated)g(or)e(not)h(\(and)f(most)g(are)g(not\);)h(when)g(a)f
(function)i(is)f(ev)m(aluated)g(to)f(a)h(partial)g(application,)37
2757 y(the)e(argumen)o(ts)e(m)o(ust)g(b)q(e)i(copied)g(from)e(the)h
(function's)g(frame)g(to)f(the)h(application's)h(frame;)e(and)h(it)g(is)934
2921 y(15)p eop
%%Page: 16 16
bop 37 199 a Ft(not)13 b(alw)o(a)o(ys)e(p)q(ossible)k(statically)e(to)f(b)q
(ound)h(the)g(amoun)o(t)f(of)g(w)o(orking)g(space)h(required)g(\(unless)g
(separate)37 256 y(compilation)k(is)f(abandoned\),)g(so)f(an)g(exception-c)o
(hec)o(king)j(mec)o(hanism)e(is)g(required)g(to)f(deal)h(with)g(the)37
312 y(cases)g(where)f(to)q(o)g(little)h(has)f(b)q(een)i(allo)q(cated.)37
463 y Fm(3.3)56 b(Data)19 b(structures)37 579 y Ft(Strongly-t)o(yp)q(ed)11
b(functional)h(languages)e(suc)o(h)h(as)f(Hask)o(ell)h(encourage)f(the)g
(programmer)f(to)h(de\014ne)h(man)o(y)37 635 y(algebraic)19
b(data)e(t)o(yp)q(es.)28 b(Ev)o(en)18 b(the)g(built-in)j(data)c(t)o(yp)q(es)h
(of)f(the)h(language,)h(suc)o(h)f(as)f(lists,)i(b)q(o)q(oleans,)37
692 y(tuples)f(and)e(\(as)f(w)o(e)h(will)i(see)e(in)h(Section)g(4.7\))e(in)o
(tegers,)h(ma)o(y)f(b)q(e)i(regarded)f(as)g(algebraic)h(data)e(t)o(yp)q(es.)
37 748 y(Here,)h(for)e(example,)i(are)f(represen)o(tativ)o(e)g(t)o(yp)q(e)g
(declarations)h(for)f(some)f(of)h(them:)228 834 y Fp(data)24
b(Boolean)f(=)g(False)h(|)f(True)228 891 y(data)h(List)f(a)h(=)f(Nil)h(|)g
(Cons)f(a)h(\(List)f(a\))228 947 y(data)h(Tuple3)f(a)g(b)h(c)g(=)g(MkTuple3)e
(a)i(b)g(c)228 1003 y(data)g(Int)f(=)h(MkInt)f(Int#)228 1060
y(data)h(Tree)f(a)h(=)f(Leaf)h(a)g(|)f(Branch)g(\(Tree)g(a\))h(\(Tree)f(a\))
37 1146 y Ft(\(Sp)q(ecial)18 b(syn)o(tax)d(for)h(lists)g(and)g(tuples)h(is)g
(pro)o(vided)f(b)o(y)g(most)f(high-lev)o(el)k(languages,)c(but)h(not)g(b)o(y)
g(the)37 1202 y(STG)j(language.\))31 b(Data)18 b(v)m(alues)i(are)f
Fn(built)g Ft(using)h(constructors,)f(suc)o(h)g(as)g Fp(False)o
Ft(,)g Fp(Cons)p Ft(,)g Fp(MkTuple3)o Ft(,)37 1259 y Fp(Branch)p
Ft(,)14 b(and)i Fn(taken)g(ap)n(art)g Ft(using)g Fp(case)e
Ft(expressions.)21 b(F)l(or)14 b(example:)228 1345 y Fp(case)24
b(t)f(of)419 1401 y(Leaf)h(n)167 b(->)23 b(e1)419 1458 y(Branch)g(t1)h(t2)g
(->)f(e2)37 1544 y Ft(\(In)e(a)f(high-lev)o(el)j(programming)d(language,)h
(data)f(v)m(alues)h(are)f(usually)i(tak)o(en)e(apart)f(using)i(v)m(arious)37
1600 y(pattern-matc)o(hing)h(constructs,)h(but)f(its)g(is)g(w)o(ell)h(kno)o
(wn)e(ho)o(w)h(to)f(translate)g(suc)o(h)i(constructs)e(in)o(to)37
1657 y Fp(case)14 b Ft(expressions)h(with)f(simple)i(single-lev)o(el)h
(patterns)d(\(W)l(adler)g([1987]\).)j(W)l(e)e(here)f(assume)g(that)g(this)37
1713 y(translation)i(has)f(b)q(een)h(p)q(erformed.\))37 1799
y(These)11 b(op)q(erations)g(of)f(construction)h(and)g(pattern)f(matc)o(hing)
g(are)g(so)g(p)q(erv)m(asiv)o(e)i(in)f(functional)h(programs)37
1855 y(that)19 b(they)h(deserv)o(e)f(particular)h(atten)o(tion.)32
b(Compilers)21 b(sometimes)e(implemen)o(t)i(the)e(built-in)j(t)o(yp)q(es)37
1912 y(\(list,)h(tuples,)g(n)o(um)o(b)q(ers\))d(in)i(sp)q(ecial)g(\\magic")f
(w)o(a)o(ys,)g(and)g(the)f(programmer)g(pa)o(ys)g(a)h(p)q(erformance)37
1968 y(p)q(enalt)o(y)16 b(for)f(user-de\014ned)i(t)o(yp)q(es.)j(W)l(e)15
b(tak)o(e)f(the)i(view)f(that)g(the)g(general)h(mec)o(hanisms)f(used)h(for)f
(user-)37 2025 y(de\014ned)j(t)o(yp)q(es)d(should)i(b)q(e)f(made)g(e\016cien)
o(t)g(enough)g(to)f(use)h(for)f(built-in)j(t)o(yp)q(es)e(to)q(o.)21
b(\(Lisp,)16 b(of)f(course,)37 2081 y(has)h(no)f(user-de\014ned)i(t)o(yp)q
(es,)d(so)h(this)h(question)g(do)q(es)f(not)g(arise.\))37 2167
y(W)l(e)g(ha)o(v)o(e)g(already)g(discussed)h(the)f(represen)o(tation)g(of)f
(data)g(v)m(alues,)i(as)e(a)h(co)q(de)g(p)q(oin)o(ter)h(together)e(with)37
2224 y(zero)d(or)e(more)h(con)o(ten)o(ts)g(\014elds.)19 b(W)l(e)11
b(no)o(w)e(turn)i(our)f(atten)o(tion)f(to)h(the)g(compilation)i(of)e
Fp(case)g Ft(expressions.)37 2280 y(Notice)15 b(that)f(a)g
Fp(case)g Ft(expression)h(really)g(do)q(es)g(t)o(w)o(o)d(things:)20
b(it)15 b Fn(evaluates)f Ft(the)g(expression)i(whose)e(v)m(alue)37
2337 y(it)i(scrutinises,)g(and)g(then)f(it)h Fn(sele)n(cts)d
Ft(the)i(appropriate)g(alternativ)o(e.)37 2423 y(If)20 b(the)g(cell)h(mo)q
(del)g(is)f(used,)h(the)f Fp(case)f Ft(expression)i(m)o(ust)e(\014rst)g
(force)h(the)f(v)m(alue)i(to)e(b)q(e)i(scrutinised.)37 2479
y(Then)14 b(it)f(m)o(ust)g(insp)q(ect)h(the)f(v)m(alue)h(to)e(disco)o(v)o(er)
i(whic)o(h)f(constructor)g(it)g(is)g(built)i(with,)e(and)g(hence)h(whic)o(h)
37 2536 y(alternativ)o(e)j(of)f(the)h Fp(case)f Ft(expression)h(should)h(b)q
(e)f(executed.)25 b(It)16 b(follo)o(ws)h(that)e(eac)o(h)i(data)f(v)m(alue)i
(m)o(ust)37 2592 y(con)o(tain)13 b(a)f Fn(tag)h Ft(\(usually)g(a)f(natural)g
(n)o(um)o(b)q(er\))h(whic)o(h)g(distinguishes)h(from)e(eac)o(h)g(other)g(the)
h(constructors)37 2648 y(of)i(the)h(relev)m(an)o(t)f(data)g(t)o(yp)q(e.)20
b(So)15 b(the)g(sequence)i(of)d(ev)o(en)o(ts)h(is:)106 2772
y Fo(\017)22 b Ft(F)l(orce)15 b(the)g(v)m(alue.)934 2921 y(16)p
eop
%%Page: 17 17
bop 106 199 a Fo(\017)22 b Ft(Extract)14 b(its)i(tag.)106 290
y Fo(\017)22 b Ft(T)l(ak)o(e)15 b(a)g(m)o(ulti-w)o(a)o(y)g(jump)g(based)h(on)
f(the)g(tag)960 273 y Fl(3)106 380 y Fo(\017)22 b Ft(Bind)17
b(the)e(names)g(in)h(the)f(pattern)g(of)g(the)g(alternativ)o(e)h(to)e(the)h
(comp)q(onen)o(ts)h(of)e(the)i(data)e(v)m(alue.)106 470 y Fo(\017)22
b Ft(Execute)16 b(the)f(co)q(de)h(for)e(the)i(alternativ)o(e.)37
585 y(In)j(the)f(case)g(of)g(the)g(self-up)q(dating)i(mo)q(del,)f(though,)g
(there)f(are)g(more)f(p)q(ossibilitie)q(s.)31 b(Recall)20 b(that)d(in)37
641 y(this)d(mo)q(del)g(a)e(closure)i(is)f(forced)g(b)o(y)g(en)o(tering)g
(it,)g Fn(r)n(e)n(gar)n(d)r(less)g(of)h(whether)h(it)f(has)g(b)n(e)n(en)f
(for)n(c)n(e)n(d)h(b)n(efor)n(e)p Ft(.)k(So)37 698 y(far)e(w)o(e)g(ha)o(v)o
(e)g(assumed)g(that)f(the)i(co)q(de)f(for)g(a)g(constructor)f(alw)o(a)o(ys)g
(returns)i(immediately)l(.)24 b(But)16 b(other)37 754 y(v)m(arian)o(ts)k(are)
g(p)q(ossible.)35 b(It)20 b(could,)i(for)d(example,)j(load)e(the)g(tag)f(in)o
(to)g(a)h(register)g(b)q(efore)g(returning,)37 810 y(so)c(that)f(the)i(tag)e
(do)q(es)h(not)g(need)g(to)g(b)q(e)h(represen)o(ted)f(explicitly)j(at)c(all)i
(\(Section)g(9.4.3\).)j(Better)c(still,)37 867 y(instead)c(of)f(returning)h
(to)f(a)g(m)o(ulti-w)o(a)o(y)g(jump,)h(the)f(constructor)g(co)q(de)g(could)i
(return)e(to)g(the)g(appropriate)37 923 y(mem)o(b)q(er)i(of)f(a)h(v)o(ector)f
(of)g(return)g(addresses)h(|)g(w)o(e)f(call)i(this)f(a)g Fn(ve)n(ctor)n(e)n
(d)g(r)n(eturn)f Ft(\(Section)i(9.4.3\).)j(These)37 980 y Fn(r)n(eturn)g(c)n
(onventions)c Ft(can)i(b)q(e)h(c)o(hosen)g(on)f(indep)q(enden)o(tly)j(for)d
(eac)o(h)g(data)f(t)o(yp)q(e.)37 1066 y(In)i(e\013ect,)e(the)h(self-up)q
(dating)i(mo)q(del)f(used)f(b)o(y)g(the)g(STG)g(mac)o(hine)g(tak)o(es)g(adv)m
(an)o(tage)f(of)g(the)h(fact)g(that)37 1122 y(a)j(data)e(v)m(alue)j(is)f
(only)g(ev)o(er)f(forced)h(b)o(y)f(a)g Fp(case)g Ft(expression.)28
b(This)18 b(prop)q(ert)o(y)f(is)h(unique)h(to)e(the)g(STG)37
1179 y(mac)o(hine.)26 b(Other)17 b(lazy)g(implemen)o(tations)h(treat)e(n)o
(umeric)i(data)e(t)o(yp)q(es)g(as)h(a)f(sp)q(ecial)j(case,)e(whic)o(h)g(are)
37 1235 y(implicitl)q(y)k(forced)d(b)o(y)g(the)g(built-in)i(arithmetic)f(op)q
(erations.)29 b(In)18 b(the)h(STG)e(mac)o(hine,)j(n)o(umeric)f(data)37
1292 y(t)o(yp)q(es)d(are)f(implemen)o(ted)i(as)d(algebraic)i(data)f(t)o(yp)q
(es,)g(and)g(only)h(forced)f(using)h Fp(case)f Ft(\(Section)g(4.7\).)37
1378 y(The)h(idea)g(can)f(b)q(e)h(tak)o(en)f(one)g(step)g(further.)20
b(Consider)c(the)f(expression)228 1464 y Fp(case)24 b(\(f)f(x\))h(of)419
1520 y(Nil)167 b(->)24 b(e1)419 1576 y(Cons)g(a)f(as)h(->)g(e2)37
1662 y Ft(and)15 b(supp)q(ose)g(that)f Fp(\(f)23 b(x\))14 b
Ft(ev)m(aluates)h(to)f(a)g Fp(Cons)o Ft(.)20 b(The)15 b(cell)g(mo)q(del)h(w)o
(ould)e(ev)m(aluate)i Fp(\(f)23 b(x\))p Ft(,)14 b(resulting)37
1719 y(in)20 b(a)d(heap-allo)q(cated)j Fp(Cons)e Ft(cell,)i(the)f(comp)q
(onen)o(ts)f(of)g(whic)o(h)h(w)o(ould)f(b)q(e)h(used)g(in)g
Fp(e2)p Ft(.)29 b(But)18 b(supp)q(ose)37 1775 y(that)13 b(w)o(e)h(use)g(the)f
(self-up)q(dating)j(mo)q(del,)e(and)g(that)f(the)h(co)q(de)g(for)f
Fp(Cons)g Ft(puts)h(the)g(head)g(and)f(tail)i(of)e(the)37 1832
y Fp(Cons)i Ft(cell)h(in)f(registers)g(b)q(efore)g(returning)g(\(as)f(w)o
(ell)i(as)e(loading)h(the)g(tag)f(in)o(to)g(a)h(register,)f(if)h(the)g
(return)37 1888 y(is)j(not)f(v)o(ectored\).)25 b Fn(Then)18
b(the)g Fp(Cons)f Fn(c)n(el)r(l)h(ne)n(e)n(d)f(never)g(b)n(e)h(al)r(lo)n(c)n
(ate)n(d)f(in)h(the)g(he)n(ap)g(at)h(al)r(l!)26 b Ft(Since)18
b(man)o(y)37 1945 y(functions)e(return)g(data)e(v)m(alues)i(this)g
(optimisation)g(seems)f(quite)h(v)m(aluable.)37 2031 y(In)23
b(summary)l(,)g(the)g(cell)g(mo)q(del)g(separates)f(the)g(forcing)g(of)g(a)g
(th)o(unk)g(from)g(the)g(case)g(analysis)h(and)37 2087 y(unpac)o(king)16
b(p)q(erformed)f(b)o(y)g(a)f Fp(case)g Ft(expression.)21 b(The)15
b(self-up)q(dating)h(mo)q(del)g(allo)o(ws)f(these)g(op)q(erations)37
2144 y(to)f(b)q(e)h(w)o(o)o(v)o(en)f(together,)f(whic)o(h)i(seems)g(to)e
(o\013er)h(in)o(teresting)h(opp)q(ortunities)g(for)f(optimisations.)20
b(T)l(o)14 b(b)q(e)37 2200 y(fair,)j(these)g(optimisations)g(do)g(complicate)
g(up)q(dating,)h(as)e(w)o(e)h(will)h(see)f(when)g(w)o(e)f(roll)i(up)f(our)f
(sleev)o(es)37 2257 y(in)h(P)o(art)d(I)q(I)q(I,)i(so)f(the)g(b)q(ene\014t)h
(is)g(not)f(en)o(tirely)h(without)f(cost)g(\(Section)h(10\).)37
2406 y Fm(3.4)56 b(Summary)37 2521 y Ft(The)15 b(single)g(most)e(p)q(erv)m
(asiv)o(e)i(design)g(decision)g(in)g(the)f(STG)g(mac)o(hine)g(is)h(that)e
(eac)o(h)h(closure)h(\(including)37 2578 y(data)c(v)m(alues\))i(is)f
(represen)o(ted)g(uniformly)l(,)h(and)f(scrutinised)h(only)g(b)o(y)e(en)o
(tering)h(it.)19 b(The)12 b(b)q(ene\014ts)h(include)p 37 2616
735 2 v 86 2643 a Fk(3)107 2659 y Fu(Ireland)i([1992])e(clev)o(erly)j(a)o(v)o
(oids)f(the)f(forcing)g(step)g(when)g(it)g(is)g(not)g(necessary)m(,)h(b)o(y)f
(using)h(the)f(same)f(\014eld)i(to)f(enco)q(de)37 2705 y(the)f(ev)n(aluation)
i(status)d(\015ag)h(and)g(constructor)g(tag.)k(The)12 b Fh(case)f
Fu(expression's)j(m)o(ulti-w)o(a)o(y)f(jump)g(has)g(an)f(extra)h(branc)o(h)g
(for)37 2751 y(the)i(case)g(where)f(an)h(unev)n(aluated)h(th)o(unk)g(or)e
(indirection)j(is)e(encoun)o(tered:)21 b(it)15 b(forces)g(the)f(th)o(unk)h
(and)g(then)g(re-executes)37 2796 y(the)f(m)o(ulti-w)o(a)o(y)g(jump.)934
2921 y Ft(17)p eop
%%Page: 18 18
bop 106 199 a Fo(\017)22 b Ft(Cheap)16 b(indirections)i(are)e(a)o(v)m
(ailable)h(\(and)f(are)g(useful)h(when)f(p)q(erforming)g(up)q(dates\).)22
b(They)16 b(cost)151 256 y(nothing)f(when)g(they)g(are)f(not)g(presen)o(t,)g
(and)h(can)f(b)q(e)h(eliminated)i(easily)e(during)h(garbage)d(collec-)151
312 y(tion.)106 406 y Fo(\017)22 b Ft(Other)13 b(exceptional)i(conditions)f
(\(blac)o(k)f(holes,)g(concurrency)l(,)h(etc\))f(can)g(b)q(e)g(handled)i(in)e
(the)g(same)151 462 y(w)o(a)o(y)l(.)106 556 y Fo(\017)22 b
Ft(A)12 b(v)m(ariet)o(y)h(of)e(return)i(con)o(v)o(en)o(tions)f(for)f
(constructors)h(are)f(p)q(ossible,)k(including)g(v)o(ectored)c(returns,)151
613 y(and)19 b(returning)g(the)f(comp)q(onen)o(ts)h(of)f(the)h(constructor)e
(in)j(registers.)29 b(The)19 b(latter)f(means)h(that)151 669
y(data)c(v)m(alues)h(ma)o(y)f(not)f(b)q(e)i(allo)q(cated)g(in)g(the)g(heap)f
(at)g(all.)37 792 y(What)j(are)f(the)h(costs?)28 b(The)18 b(main)g(one)g
(seems)g(to)f(b)q(e)i(this:)26 b(in)18 b(the)g(common)g(case)f(when)i(a)e(p)q
(ossible)37 849 y(th)o(unk)i(turns)g(out)f(to)h(b)q(e)g(already)g(ev)m
(aluated,)i(the)d(self-up)q(dating)j(mo)q(del)f(tak)o(es)e(t)o(w)o(o)f
(jumps,)j(one)f(to)37 905 y(en)o(ter)e(the)f(closure)h(and)f(one)h(to)e
(return,)h(while)i(the)e(cell)i(mo)q(del)f(tak)o(es)f(only)g(one)h
(\(conditional\))g(jump.)37 962 y(\(As)e(w)o(e)g(ha)o(v)o(e)g(seen,)g
(though,)g(a)g(jump)g(can)h(often)f(b)q(e)h(sa)o(v)o(ed)e(again)h(b)o(y)h
(using)g(a)e(v)o(ectored)h(return.\))37 1048 y(W)l(orse,)20
b(the)f(\014rst)f(jump)h(is)h(to)e(an)h(unkno)o(wn)g(destination,)h(whic)o(h)
g(means)f(that)f(the)h(co)q(de)h(generator)37 1104 y(cannot)e(k)o(eep)g
(things)g(in)h(registers.)27 b(The)18 b(cell)h(mo)q(del)f(only)h(incurs)f
(these)g(con)o(text-switc)o(hing)g(costs)f(if)37 1161 y(the)h(th)o(unk)f(is)h
(unev)m(aluated.)27 b(Ev)o(en)17 b(so,)g(the)g(cell)i(mo)q(del)f(ma)o(y)f
(not)f(alw)o(a)o(ys)h(win.)26 b(If)18 b(there)f(are)g(t)o(w)o(o)e(or)37
1217 y(more)e(forces)g(in)h(a)e(ro)o(w)g(there)i(is)f(the)g(nast)o(y)f(p)q
(ossibilit)o(y)k(of)c(sa)o(ving)h(the)g(con)o(text,)g(ev)m(aluating)h(one)f
(th)o(unk,)37 1274 y(restoring)19 b(the)f(con)o(text,)g(disco)o(v)o(ering)i
(the)e(second)h(th)o(unk)g(is)g(unev)m(aluated,)h(and)f(sa)o(ving)f(the)h
(con)o(text)37 1330 y(for)f(a)f(second)h(time.)28 b(In)18 b(this)g(sort)f(of)
g(situation)h(it)g(ma)o(y)f(w)o(ell)h(b)q(e)h(just)e(as)g(go)q(o)q(d)h(to)f
(sa)o(v)o(e)g(the)h(con)o(text)37 1387 y(once)e(and)f(for)g(all)h(at)f(the)g
(start)f(of)h(a)g(string)g(of)g(forces,)f(as)h(the)g(self-up)q(dating)i(mo)q
(del)f(m)o(ust)f(do.)37 1473 y(There)j(are)g(also)f(some)h(underlying)h(arc)o
(hitectural)f(issues.)28 b(Firstly)l(,)19 b(indirect)g(jumps)f(are)f(more)g
(lik)o(ely)37 1529 y(to)22 b(cause)h(cac)o(he)g(misses)g(than)g(\(not-tak)o
(en\))e(conditional)j(jumps.)42 b(Secondly)l(,)26 b(mo)q(dern)d(RISCs)g(are)
37 1585 y(w)o(ell)16 b(optimised)g(for)f(taking)f Fn(c)n(onditional)h
Ft(jumps)g(\(emplo)o(y)o(ed)g(b)o(y)g(the)g(cell)h(mo)q(del\),)f(but)g(not)g
(for)f(taking)37 1642 y Fn(indir)n(e)n(ct)e Ft(jumps)h(\(whic)o(h)g(are)f
(needed)i(b)o(y)f(the)g(self-up)q(dating)h(mo)q(del\).)20 b(In)13
b(principle,)j(if)d(the)f(jump)h(target)37 1698 y(address)19
b(is)h(fetc)o(hed)f(a)f(few)h(instructions)h(b)q(efore)f(the)g(jump)g
(itself,)h(and)f(the)g(instruction)g(fetc)o(h)g(logic)37 1755
y(in)o(terprets)g(the)f(indirect)i(jump)e(directly)l(,)i(no)e(pip)q(eline)j
(bubbles)f(need)f(b)q(e)g(caused.)29 b(Most)17 b(RISCs)i(are)37
1811 y(not)d(\(y)o(et\))f(optimised)i(for)e(this)h(sequence,)h(but)f(the)g(T)
l(era)f(arc)o(hitecture)h(is:)22 b(it)16 b(allo)o(ws)g(a)f(branc)o(h)h
(target)37 1868 y(to)f(b)q(e)g(prefetc)o(hed)h(in)o(to)e(a)h(register,)f(and)
h(thereb)o(y)g(supp)q(orts)g(zero-dela)o(y)g(indirect)i(branc)o(hes)e(\(Alv)o
(erson)37 1924 y(et)h(al.)f([1990]\).)37 2010 y(In)h(short,)d(b)o(y)i(alw)o
(a)o(ys)e(en)o(tering)i(a)f(closure)i(when)f(w)o(e)f(need)h(its)g(v)m(alue,)g
(w)o(e)f(pa)o(y)h(a)f(single,)h(fairly)g(mo)q(dest,)37 2067
y(up-fron)o(t)f(cost)e(but)i(get)f(a)g(wide)h(v)m(ariet)o(y)g(of)f(other)g(b)
q(ene\014ts)h(at)f(no)g(further)g(cost.)19 b(Whether)14 b(the)f(b)q
(ene\014ts)37 2123 y(out)o(w)o(eigh)i(the)h(costs)e(is)i(at)f(presen)o(t)g
(an)g(op)q(en)h(question.)934 2921 y(18)p eop
%%Page: 19 19
bop 438 213 a Fj(P)n(art)27 b(I)r(I:)h(The)e(abstract)i(mac)n(hine)37
383 y Fs(4)67 b(The)23 b(STG)f(language)37 514 y Ft(The)g(abstract)e(mac)o
(hine)i(co)q(de)f(for)g(the)g(Spineless)i(T)l(agless)e(G-mac)o(hine)h(is)f(a)
g(v)o(ery)g(austere)g(purely-)37 571 y(functional)e(language,)e(called)i(the)
e(STG)g(language,)g(whose)g(syn)o(tax)f(is)i(giv)o(en)f(in)h(Figure)f(3.)26
b(Virtually)37 627 y(ev)o(ery)12 b(functional-language)i(compiler)f(uses)f(a)
f(small)i(purely-functional)h(language)e(as)f(an)h(in)o(termediate)37
684 y(co)q(de)k(\(eg)e(the)h(\\enric)o(hed)h(lam)o(b)q(da)f(calculus")h(\(P)o
(eyton)e(Jones)h([1987]\),)e(FLIC)i(\(P)o(eyton)e(Jones)j([1988]\),)37
740 y(F)o(C)f(\(Field)h(&)g(Harrison)f([1988]\),)d(Kid)17 b(\(Ariola)e(&)h
(Arvind)g([1991]\)\).)37 826 y(The)f(distinguishing)i(feature)c(of)h(the)g
(STG)g(language)g(is)h(that)e(it)h(has)g(a)g(formal)f Fn(op)n(er)n(ational)h
Ft(seman)o(tics,)37 883 y(expressed)i(as)f(a)f(state)g(transition)h(system,)f
(as)h(w)o(ell)h(as)e(the)h(usual)h Fn(denotational)e Ft(seman)o(tics.)20
b(Indeed)d(it)37 939 y(is)h(exactly)f(this)g(prop)q(ert)o(y)g(whic)o(h)h
(justi\014es)f(the)g(title)h(\\abstract)d(mac)o(hine)j(co)q(de".)25
b(In)17 b(particular,)h(the)37 995 y(follo)o(wing)e(corresp)q(ondence)h(b)q
(et)o(w)o(een)e(the)h(STG)f(language)g(and)g(op)q(erational)h(matters)e(is)i
(main)o(tained:)p 441 1040 1032 2 v 440 1096 2 57 v 465 1079
a(Construct)325 b(Op)q(erational)16 b(reading)p 1471 1096 V
441 1098 1032 2 v 440 1154 2 57 v 465 1137 a(F)l(unction)g(application)115
b(T)l(ail)16 b(call)p 1471 1154 V 440 1211 V 465 1194 a(Let)g(expression)238
b(Heap)15 b(allo)q(cation)p 1471 1211 V 440 1267 V 465 1250
a(Case)g(expression)211 b(Ev)m(aluation)p 1471 1267 V 440 1324
V 465 1307 a(Constructor)14 b(application)52 b(Return)16 b(to)e(contin)o
(uation)p 1471 1324 V 441 1325 1032 2 v 37 1390 a(The)i(salien)o(t)g(c)o
(haracteristics)f(of)g(STG)g(co)q(de)h(are)f(as)f(follo)o(ws:)106
1499 y Fo(\017)22 b Fn(A)o(l)r(l)e(function)f(and)i(c)n(onstructor)f(ar)n
(guments)g(ar)n(e)g(simple)g(variables)f(or)i(c)n(onstants.)32
b Ft(This)20 b(con-)151 1555 y(strain)o(t)h(corresp)q(onds)h(to)g(the)g(op)q
(erational)g(realit)o(y)g(that)f(function)i(argumen)o(ts)e(are)h(prepared)151
1612 y(\(either)16 b(b)o(y)f(constructing)g(a)g(closure)h(or)f(b)o(y)g(ev)m
(aluating)h(them\))f(prior)h(to)e(the)h(call.)151 1684 y(It)i(is)g(easy)f(to)
g(satisfy)g(this)h(condition)h(when)f(translating)g(in)o(to)g(the)f(STG)g
(language,)h(simply)h(b)o(y)151 1740 y(adding)e(new)g Fp(let)e
Ft(bindings)j(for)e(non-trivial)i(argumen)o(ts.)106 1828 y
Fo(\017)22 b Fn(A)o(l)r(l)e(c)n(onstructors)h(and)g(built-in)g(op)n(er)n
(ations)f(ar)n(e)h(satur)n(ate)n(d.)36 b Ft(This)21 b(constrain)o(t)f
(simpli\014es)j(the)151 1884 y(op)q(erational)f(seman)o(tics)g(of)g(STG)f(co)
q(de.)40 b(It)22 b(is)g(easily)h(arranged)e(b)o(y)h(adding)h(extra)e(lam)o(b)
q(das)151 1941 y(around)11 b(an)g(un-saturated)f(constructor)g(or)h(built-in)
i(application,)g(th)o(us)d(p)q(erforming)h(the)g(opp)q(osite)151
1997 y(of)k Fq(\021)r Ft(-reduction.)151 2069 y(Notice)c(that,)g(in)g(a)f
(higher-order)i(language,)f(w)o(e)f(cannot)g(ensure)i(that)d
Fn(every)i Ft(function)g(application)151 2126 y(is)k(saturated)e(\(that)g
(is,)h(giv)o(es)g(to)f(the)h(function)h(exactly)f(the)g(n)o(um)o(b)q(er)g(of)
g(argumen)o(ts)f(it)h(exp)q(ects\).)106 2214 y Fo(\017)22 b
Fn(Pattern)f(matching)h(is)e(p)n(erforme)n(d)i(only)f(by)g
Fp(case)f Fn(expr)n(essions,)43 b Ft(and)20 b(the)h(patterns)f(in)i
Fp(case)151 2270 y Ft(expressions)14 b(are)g(simple)h(one-lev)o(el)g
(patterns.)k(More)12 b(complex)j(forms)d(of)i(pattern-matc)o(hing)f(can)151
2327 y(easily)j(b)q(e)g(translated)f(in)o(to)g(this)h(form)f(\(W)l(adler)g
([1987]\).)151 2399 y(The)i(v)m(alue)h(scrutinised)g(b)o(y)f(a)f
Fp(case)g Ft(expression)i(can)f(b)q(e)g(an)g(arbitrary)f(expression,)h(and)g
(is)g(not)151 2455 y(restricted)22 b(to)e(b)q(e)i(a)f(simple)h(v)m(ariable)h
(or)d(constan)o(t.)37 b(Nothing)22 b(w)o(ould)f(b)q(e)h(gained)g(b)o(y)f(suc)
o(h)g(a)151 2512 y(restriction,)f(and)e(some)g(p)q(erformance)h(w)o(ould)g(b)
q(e)g(lost)g(b)q(ecause)g(a)f(closure)i(for)d(the)i(expression)151
2568 y(w)o(ould)d(b)q(e)g(unnecessarily)h(built)f(and)g(then)f(immediately)i
(ev)m(aluated.)106 2656 y Fo(\017)22 b Fn(Ther)n(e)c(is)g(a)h(sp)n(e)n(cial)e
(form)i(of)g(binding.)26 b Ft(The)18 b(STG)f(language)h(has)g(a)f(sp)q(ecial)
i(form)e(of)g(binding,)151 2712 y(whose)e(general)h(form)e(is)627
2796 y Fn(f)25 b Fp(=)e({)p Fn(v)758 2803 y Fl(1)782 2796 y
Fq(;)8 b(:)g(:)g(:)t(;)g Fn(v)904 2803 y Fl(n)927 2796 y Fp(})24
b(\\)p Fq(\031)17 b Fp({)o Fn(x)1086 2803 y Fl(1)1110 2796
y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(x)1233 2803 y Fl(m)1264 2796
y Fp(})24 b(->)15 b Fn(e)934 2921 y Ft(19)p eop
%%Page: 20 20
bop 37 403 1582 2 v 37 2460 2 2058 v 88 455 a Ft(Program)164
b Fn(pr)n(o)n(g)16 b Fo(!)c Fn(binds)88 568 y Ft(Bindings)146
b Fn(binds)15 b Fo(!)d Fn(var)644 575 y Fl(1)683 568 y Fp(=)j
Fn(lf)748 575 y Fl(1)771 568 y Fp(;)7 b Fq(:)h(:)g(:)e Fp(;)15
b Fn(var)965 575 y Fl(n)1004 568 y Fp(=)g Fn(lf)1069 575 y
Fl(n)1134 568 y Fn(n)h Fo(\025)d Fn(1)88 681 y Ft(Lam)o(b)q(da-forms)101
b Fn(lf)21 b Fo(!)12 b Fn(vars)663 688 y Fl(f)697 681 y Fp(\\)p
Fq(\031)17 b Fn(vars)846 688 y Fl(a)883 681 y Fp(->)e Fn(expr)88
794 y Ft(Up)q(date)g(\015ag)164 b Fq(\031)14 b Fo(!)e Fp(u)529
b Ft(Up)q(datable)540 850 y Fo(j)28 b Fp(n)529 b Ft(Not)15
b(up)q(datable)88 963 y(Expression)121 b Fn(expr)17 b Fo(!)12
b Fp(let)j Fn(binds)j Fp(in)d Fn(expr)198 b Ft(Lo)q(cal)16
b(de\014nition)540 1020 y Fo(j)28 b Fp(letrec)14 b Fn(binds)k
Fp(in)d Fn(expr)127 b Ft(Lo)q(cal)16 b(recursion)540 1076 y
Fo(j)28 b Fp(case)15 b Fn(expr)20 b Fp(of)15 b Fn(alts)206
b Ft(Case)15 b(expression)540 1133 y Fo(j)28 b Fn(var)20 b(atoms)353
b Ft(Application)540 1189 y Fo(j)28 b Fn(c)n(onstr)19 b(atoms)296
b Ft(Saturated)15 b(constructor)540 1246 y Fo(j)28 b Fn(prim)19
b(atoms)324 b Ft(Saturated)15 b(built-in)i(op)540 1302 y Fo(j)28
b Fn(liter)n(al)88 1415 y Ft(Alternativ)o(es)111 b Fn(alts)15
b Fo(!)d Fn(aalt)654 1422 y Fl(1)678 1415 y Fp(;)7 b Fq(:)h(:)g(:)e
Fp(;)15 b Fn(aalt)882 1422 y Fl(n)906 1415 y Fp(;)g Fn(default)57
b(n)16 b Fo(\025)d Fn(0)21 b Ft(\(Algebraic\))540 1471 y Fo(j)28
b Fn(p)n(alt)652 1478 y Fl(1)675 1471 y Fp(;)8 b Fq(:)g(:)g(:)d
Fp(;)15 b Fn(p)n(alt)877 1478 y Fl(n)901 1471 y Fp(;)g Fn(default)62
b(n)16 b Fo(\025)d Fn(0)21 b Ft(\(Primitiv)o(e\))88 1584 y(Algebraic)16
b(alt)90 b Fn(aalt)17 b Fo(!)12 b Fn(c)n(onstr)19 b(vars)g
Fp(->)c Fn(expr)88 1641 y Ft(Primitiv)o(e)h(alt)96 b Fn(p)n(alt)16
b Fo(!)c Fn(liter)n(al)19 b Fp(->)c Fn(expr)88 1697 y Ft(Default)g(alt)72
b Fn(default)17 b Fo(!)12 b Fn(var)20 b Fp(->)15 b Fn(expr)540
1754 y Fo(j)28 b Fp(default)14 b(->)h Fn(expr)88 1867 y Ft(Literals)157
b Fn(liter)n(al)16 b Fo(!)c Fp(0#)j Fo(j)g Fp(1#)f Fo(j)23
b Fq(:)8 b(:)g(:)309 b Ft(Primitiv)o(e)16 b(in)o(tegers)540
1923 y Fo(j)28 b Fq(:)8 b(:)g(:)88 2036 y Ft(Primitiv)o(e)16
b(ops)61 b Fn(prim)16 b Fo(!)c Fp(+#)j Fo(j)g Fp(-#)f Fo(j)h
Fp(*#)g Fo(j)g Fp(/#)233 b Ft(Primitiv)o(e)16 b(in)o(teger)g(ops)540
2092 y Fo(j)28 b Fq(:)8 b(:)g(:)88 2205 y Ft(V)l(ariable)16
b(lists)81 b Fn(vars)16 b Fo(!)c Fp({)p Fn(var)668 2212 y Fl(1)692
2205 y Fp(,)7 b Fq(:)h(:)g(:)e Fp(,)15 b Fn(var)886 2212 y
Fl(n)910 2205 y Fp(})200 b Fn(n)16 b Fo(\025)d Fn(0)88 2318
y Ft(A)o(tom)h(lists)99 b Fn(atoms)16 b Fo(!)c Fp({)p Fn(atom)703
2325 y Fl(1)727 2318 y Fp(,)7 b Fq(:)h(:)g(:)e Fp(,)15 b Fn(atom)956
2325 y Fl(n)981 2318 y Fp(})129 b Fn(n)16 b Fo(\025)d Fn(0)410
2375 y(atom)j Fo(!)c Fn(var)20 b Fo(j)15 b Fn(liter)n(al)p
1617 2460 V 37 2462 1582 2 v 574 2539 a Ft(Figure)g(3:)20 b(Syn)o(tax)15
b(of)f(the)i(STG)e(language)934 2921 y(20)p eop
%%Page: 21 21
bop 151 199 a Ft(It)13 b(has)g(t)o(w)o(o)e(readings.)20 b(F)l(rom)12
b(a)h(denotational)g(p)q(oin)o(t)h(of)e(view,)i(the)f(free)g(v)m(ariables)h
Fn(v)1620 206 y Fl(1)1643 199 y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(v)1766
206 y Fl(n)1802 199 y Ft(and)151 256 y(up)q(date)16 b(\015ag)f
Fq(\031)h Ft(are)f(ignored,)h(and)f(the)g(de\014nition)i(binds)g
Fn(f)25 b Ft(to)14 b(the)h(function)h(\()p Fq(\025)p Fn(x)1589
263 y Fl(1)1620 256 y Fq(:)8 b(:)g(:)d Fn(x)1701 263 y Fl(m)1734
256 y Fq(:)p Fn(e)s Ft(\).)151 327 y(F)l(rom)14 b(an)g(op)q(erational)h(p)q
(oin)o(t)f(of)g(view,)h Fn(f)23 b Ft(is)15 b(b)q(ound)g(to)f(a)g(heap-allo)q
(cated)i(closure,)e(con)o(taining)h(a)151 384 y(co)q(de)h(p)q(oin)o(ter)f
(and)h(\(p)q(oin)o(ters)f(to\))f(the)h(free)g(v)m(ariables)i
Fn(v)1141 391 y Fl(1)1164 384 y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(v)1287
391 y Fl(n)1310 384 y Ft(.)19 b(This)d(closure)g(represen)o(ts)f(the)151
440 y(function)20 b(\()p Fq(\025)p Fn(x)399 447 y Fl(1)429
440 y Fq(:)8 b(:)g(:)e Fn(x)511 447 y Fl(m)543 440 y Fq(:)p
Fn(e)s Ft(\);)20 b(when)f(its)g(co)q(de)g(is)g(executed,)i(a)d(sp)q(ecial)j
(register)d(will)j(p)q(oin)o(t)e(to)f(the)151 497 y(closure)e(thereb)o(y)f
(giving)h(access)g(to)e(its)i(free)f(v)m(ariables.)151 568
y(The)21 b(righ)o(t-hand)g(side)g(of)f(a)h(binding)h(is)f(called)h(a)f
Fn(lamb)n(da-form)p Ft(,)h(and)f(is)g(the)f(only)h(site)g(for)f(a)151
625 y(lam)o(b)q(da)15 b(abstraction.)k(Notice,)c(though,)e(that)h(the)g
(abstraction)g(can)h(ha)o(v)o(e)e(free)i(v)m(ariables,)g(so)f(no)151
681 y(lam)o(b)q(da)i(lifting)g(need)g(b)q(e)g(p)q(erformed)g(\(Section)f
(4.5\).)151 753 y(The)d(up)q(date)g(\015ag)g(on)f(a)h(lam)o(b)q(da-form)f
(indicates)j(whether)d(its)h(closure)h(should)g(b)q(e)f(up)q(dated)g(when)151
809 y(it)i(reac)o(hes)g(its)g(normal)g(form)g(\(Section)g(4.2\).)k(W)l(e)c
(sa)o(y)g(a)f(lam)o(b)q(da-form)h(\(or)f(a)h(closure)g(built)i(from)151
865 y(it\))f(is)h Fn(up)n(datable)g Ft(if)f(its)h(up)q(date)f(\015ag)g(is)h
Fp(u)p Ft(,)f(and)g Fn(non-up)n(datable)g Ft(otherwise.)106
952 y Fo(\017)22 b Fn(The)f(STG)g(language)h(supp)n(orts)g(unb)n(oxe)n(d)f
(values.)37 b Ft(This)22 b(asp)q(ect)f(is)h(discussed)h(b)q(elo)o(w)e(in)h
(Sec-)151 1009 y(tion)16 b(4.7.)37 1114 y(A)f(STG)f(program)f(is)i(just)f(a)h
(collection)h(of)e(bindings.)21 b(The)15 b(v)m(ariables)h(de\014ned)f(b)o(y)g
(this)g(top-lev)o(el)g(set)f(of)37 1170 y(bindings)20 b(are)d(called)i
Fn(glob)n(als)p Ft(,)d(while)j(all)f(other)f(v)m(ariables)i(b)q(ound)f(in)g
(the)g(program)e(are)h(called)i Fn(lo)n(c)n(als)p Ft(.)37 1227
y(The)d(v)m(alue)g(of)f(an)g(STG)g(program)f(is)i(the)f(v)m(alue)i(of)d(the)i
(global)g Fp(main)o Ft(.)37 1313 y(The)c(concrete)g(syn)o(tax)f(w)o(e)g(use)h
(is)g(con)o(v)o(en)o(tional:)18 b(paren)o(theses)12 b(are)f(used)h(to)f
(disam)o(biguate;)i(application)37 1369 y(asso)q(ciates)j(to)f(the)h(left)g
(and)g(binds)h(more)e(tigh)o(tly)h(than)g(an)o(y)f(other)h(op)q(erator;)f
(the)g(b)q(o)q(dy)i(of)e(a)h(lam)o(b)q(da)37 1426 y(abstraction)f(extends)g
(as)g(far)f(to)g(the)h(righ)o(t)g(as)f(p)q(ossible;)j(and,)e(where)g(the)g
(la)o(y)o(out)f(mak)o(es)g(the)h(meaning)37 1482 y(clear,)h(w)o(e)f(allo)o(w)
g(ourselv)o(es)h(to)e(omit)h(semicolons)i(b)q(et)o(w)o(een)e(bindings)i(and)f
(case)f(alternativ)o(es.)37 1568 y(The)g(STG)e(language)h(is)h(similar)g(in)g
(some)e(w)o(a)o(ys)g(to)h(\\contin)o(uation-passing)h(st)o(yle")e(\(CPS\),)g
(a)h(p)q(oin)o(t)g(w)o(e)37 1625 y(return)i(to)e(in)i(Section)g(4.8.)37
1772 y Fm(4.1)56 b(T)-5 b(ranslating)19 b(in)n(to)f(the)h(STG)f(language)37
1888 y Ft(In)e(this)g(section)f(w)o(e)g(outline)i(ho)o(w)d(to)h(translate)g
(a)f(functional)j(program)d(in)o(to)h(the)g(STG)g(language.)20
b(W)l(e)37 1944 y(b)q(egin)d(with)e(an)g(example,)g(the)g(w)o(ell-kno)o(wn)h
(function)g Fp(map)o Ft(.)k(Its)15 b(de\014nition,)h(in)g(con)o(v)o(en)o
(tional)f(notation)37 2001 y(\(eg)g(Hask)o(ell\),)h(is)f(as)g(follo)o(ws:)133
2087 y Fp(map)23 b(f)h([])119 b(=)24 b([])133 2143 y(map)f(f)h(\(y:ys\))f(=)h
(\(f)f(y\))h(:)g(\(map)f(f)h(ys\))37 2229 y Ft(The)16 b(corresp)q(onding)g
(STG)f(binding)i(is)f(this:)133 2315 y Fp(map)23 b(=)h({})g(\\n)f({f,xs})g
(->)348 2371 y(case)g(xs)h(of)395 2428 y(Nil)g({})143 b(->)23
b(Nil)h({})395 2484 y(Cons)g({y,ys})f(->)g(let)h(fy)f(=)h({f,y})f(\\u)h({})g
(->)f(f)h({y})849 2541 y(mfy)f(=)h({f,ys})f(\\u)h({})f(->)h(map)f({f,ys})753
2597 y(in)h(Cons)f({fy,mfy})37 2683 y Ft(Notice)15 b(the)g(\015attened)f
(structure,)g(the)g(explicit)j(argumen)o(t)c(lists)i(for)f(ev)o(ery)g(call,)h
(and)g(the)f(free-v)m(ariable)37 2740 y(lists)21 b(and)e(up)q(date)h(\015ags)
f(on)g(eac)o(h)g(lam)o(b)q(da-form.)32 b(Since)21 b Fp(map)e
Ft(itself)h(is)g(a)f(global)h(constan)o(t)e(it)i(is)f(not)37
2796 y(considered)e(to)e(b)q(e)h(a)e(free)i(v)m(ariable)g(of)f(the)g(lam)o(b)
q(da-form)g(for)g Fp(mfy)p Ft(.)934 2921 y(21)p eop
%%Page: 22 22
bop 37 199 a Ft(In)13 b(this)g(example,)g(ev)o(ery)g(lam)o(b)q(da-form)f(has)
g(either)h(no)f(argumen)o(ts)f(or)h(no)g(free)h(v)m(ariables.)20
b(T)l(o)12 b(illustrate)37 256 y(the)k(t)o(w)o(o)e(in)i(com)o(bination,)f
(consider)h(the)g(follo)o(wing)f(alternativ)o(e)h(de\014nition)h(for)d
Fp(map)p Ft(:)133 342 y Fp(map1)23 b(f)h(=)g(mf)47 b(where)g(mf)24
b([])f(=)h([])610 398 y(mf)g(\(y:ys\))f(=)h(\(f)f(y\))h(:)f(\(mf)h(ys\))37
484 y Ft(Here)16 b(the)f(recursion)h(is)g(o)o(v)o(er)e Fp(mf)p
Ft(,)h(whic)o(h)h(has)f(free)g(v)m(ariable)i Fp(f)p Ft(.)i(The)d(corresp)q
(onding)g(STG)f(binding)i(is:)61 570 y Fp(map1)24 b(=)f({})h(\\n)g({f})f(->)
228 627 y(letrec)276 683 y(mf)h(=)f({f,mf})g(\\n)h({xs})f(->)395
739 y(case)h(xs)f(of)443 796 y(Nil)h({})f(->)h(Nil)f({})443
852 y(Cons)g({y,ys})h(->)f(let)h(fy)f(=)h({f,y})f(\\u)h({})f(->)h(f)g({y})897
909 y(mfy)f(=)h({mf,ys})f(\\u)g({})h(->)f(mf)h({ys})801 965
y(in)g(Cons)f({fy,mfy})228 1022 y(in)h(mf)37 1108 y Ft(Here,)14
b Fp(mf)e Ft(is)i(an)f(example)h(of)e(a)h(lam)o(b)q(da-form)g(with)g(b)q(oth)
g(free)g(v)m(ariables)i(and)e(argumen)o(ts.)18 b(Notice)c(that)37
1164 y Fp(mf)h Ft(is)h(a)f(free)g(v)m(ariable)i(of)e(its)g(o)o(wn)g(righ)o
(t-hand)g(side)h(\(see)g(Section)g(4.5\).)37 1314 y Fr(4.1.1)52
b(The)18 b(general)g(transformation)37 1429 y Ft(In)e(general,)g(translation)
f(in)o(to)g(the)g(STG)g(language)h(in)o(v)o(olv)o(es)f(the)h(follo)o(wing)f
(transformations:)106 1552 y Fo(\017)22 b Ft(Replace)17 b(binary)f
(application)h(b)o(y)e(m)o(ultiple)i(application.)527 1655
y(\()p Fq(:)8 b(:)g(:)d Ft(\(\()p Fn(f)24 b(e)700 1662 y Fl(1)723
1655 y Ft(\))15 b Fn(e)777 1662 y Fl(2)800 1655 y Ft(\))23
b Fq(:)8 b(:)g(:)n Ft(\))15 b Fn(e)948 1662 y Fl(n)1029 1655
y Ft(=)-8 b Fo(\))60 b Fn(f)25 b Fo(f)p Fn(e)1244 1662 y Fl(1)1267
1655 y Fq(;)8 b Fn(e)1309 1662 y Fl(2)1331 1655 y Fq(;)g(:)g(:)g(:)d(;)j
Fn(e)1454 1662 y Fl(n)1477 1655 y Fo(g)151 1757 y Ft(The)k(seman)o(tics)f(is)
h(still)h(that)e(of)g(curried)h(application,)i(of)d(course,)h(but)f(the)h
(STG)f(mac)o(hine)h(applies)151 1813 y(a)j(function)h(to)f(all)h(the)f(a)o(v)
m(ailable)i(argumen)o(ts)d(at)h(once,)g(rather)g(than)g(doing)g(so)g(one)g(b)
o(y)h(one.)106 1907 y Fo(\017)22 b Ft(Saturate)15 b(all)h(constructors)e(and)
h(built-in)j(op)q(erations,)d(b)o(y)g Fq(\021)r Ft(-expansion)h(if)f
(necessary)l(.)21 b(That)14 b(is)422 2005 y Fn(c)k Fo(f)p Fn(e)505
2012 y Fl(1)528 2005 y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(e)651 2012
y Fl(n)674 2005 y Fo(g)58 b Ft(=)-8 b Fo(\))59 b Fq(\025)p
Fn(y)935 2012 y Fl(1)966 2005 y Fq(:)8 b(:)g(:)d Fn(y)1048
2012 y Fl(m)1081 2005 y Fq(:)14 b Fn(c)k Fo(f)p Fn(e)1191 2012
y Fl(1)1214 2005 y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(e)1337 2012
y Fl(n)1360 2005 y Fq(;)g Fn(y)1403 2012 y Fl(1)1426 2005 y
Fq(;)g(:)g(:)g(:)t(;)g Fn(y)1549 2012 y Fl(m)1581 2005 y Fo(g)422
2062 y Ft(where)16 b Fn(c)i Ft(is)d(a)g(built-in)j(or)c(constructor)h(with)g
(arit)o(y)g Fn(n)e Ft(+)e Fn(m)s Ft(\))106 2179 y Fo(\017)22
b Ft(Name)13 b(ev)o(ery)f(non-atomic)h(function)h(argumen)o(t,)e(and)h(ev)o
(ery)g(lam)o(b)q(da)g(abstraction,)f(b)o(y)h(in)o(tro)q(duc-)151
2235 y(ing)j(a)f Fp(let)g Ft(expression:)106 2329 y Fo(\017)22
b Ft(Con)o(v)o(ert)17 b(the)i(righ)o(t-hand)g(side)g(of)f(eac)o(h)g
Fp(let)g Ft(binding)i(in)o(to)f(a)f(lam)o(b)q(da-form,)g(b)o(y)h(adding)g
(free-)151 2385 y(v)m(ariable)e(and)e(up)q(date-\015ag)h(information.)37
2535 y Fr(4.1.2)52 b(Iden)o(tifying)18 b(the)g(free)f(v)m(ariables)37
2650 y Ft(The)f(transformation)e(to)h(STG)g(co)q(de)g(requires)h(the)g(free)f
(v)m(ariables)i(of)d(eac)o(h)i(lam)o(b)q(da-form)f(to)g(b)q(e)h(iden-)37
2707 y(ti\014ed.)21 b(The)13 b(rule)h(is)g(as)f(follo)o(ws:)19
b(a)13 b(v)m(ariable)i(m)o(ust)e(app)q(ear)g(in)h(the)g(free)f(v)m(ariable)i
(list)f(of)f(a)g(lam)o(b)q(da-form)37 2763 y(if)934 2921 y(22)p
eop
%%Page: 23 23
bop 93 199 a Ft(1.)22 b(it)16 b(is)f(men)o(tioned)h(in)g(the)g(b)q(o)q(dy)f
(of)g(the)h(lam)o(b)q(da)f(abstraction,)g(and)93 293 y(2.)22
b(it)16 b(is)f(not)g(b)q(ound)h(b)o(y)f(the)h(lam)o(b)q(da,)f(and)93
387 y(3.)22 b(it)16 b(is)f(not)g(b)q(ound)h(at)f(the)g(top)g(lev)o(el)h(of)f
(the)g(program.)37 510 y(Th)o(us,)21 b(in)f(the)g(\014rst)f(v)o(ersion)h(of)f
Fp(map)g Ft(in)h(the)g(previous)g(section,)h Fp(map)e Ft(do)q(es)h(not)f(app)
q(ear)h(in)g(the)g(free-)37 567 y(v)m(ariable)d(list)f(of)f
Fp(mfy)g Ft(b)q(ecause)i(it)e(is)h(a)f(global)h(constan)o(t.)k(On)c(the)g
(other)f(hand,)g(in)h(the)g(second)g(v)o(ersion)37 623 y(of)f
Fp(map)p Ft(,)g Fp(mf)g Ft(is)g(a)g(free)g(v)m(ariable)i(of)e(b)q(oth)g
(itself)h(and)g Fp(mfy)o Ft(.)37 709 y(The)i(free-v)m(ariable)h(rule)f
(handles)h(m)o(utual)e(recursion)h(without)g(an)o(y)f(further)g
(complications.)28 b(F)l(or)17 b(ex-)37 766 y(ample,)f(the)f(Hask)o(ell)h
(de\014nition)228 852 y Fp(f)24 b(x)g(y)g(=)f(fbody)419 908
y(where)419 964 y(g1)h(a)g(=)f(...a...g2...x...)419 1021 y(g2)h(b)g(=)f
(...b...g1...y...)37 1107 y Ft(w)o(ould)16 b(transform)e(to)g(the)i(STG)f
(de\014nition:)228 1193 y Fp(f)24 b(=)g({})f(\\n)h({x,y})f(->)h(letrec)730
1249 y(g1)f(=)h({g2,x})f(\\n)g({a})h(->)g(...a...g2...x...)730
1306 y(g2)f(=)h({g1,y})f(\\n)g({b})h(->)g(...b...g1...y...)682
1362 y(in)682 1419 y(fbody)37 1505 y Ft(The)16 b Fp(letrec)e
Ft(builds)j(a)e(pair)h(of)f(closures,)g(eac)o(h)g(of)g(whic)o(h)h(p)q(oin)o
(ts)g(to)e(the)i(other.)37 1591 y(The)f(rule)h(ab)q(o)o(v)o(e)e(sa)o(ys)f
(when)i(a)g(v)m(ariable)h Fn(must)e Ft(app)q(ear)h(in)g(a)g(free-v)m(ariable)
h(list)f(of)f(a)g(lam)o(b)q(da-form.)20 b(Of)37 1647 y(course,)e(an)o(y)f
(in-scop)q(e)i(v)m(ariable)g Fn(may)f Ft(app)q(ear)f(\(redundan)o(tly\);)i
(surprisingly)l(,)h(there)d(is)h(one)g(situation)37 1704 y(in)f(whic)o(h)f
(suc)o(h)f(redundan)o(t)h(free)f(v)m(ariables)h(pro)o(v)o(e)f(useful)h(|)g
(see)f(Section)i(4.4.)37 1855 y Fm(4.2)56 b(Closures)19 b(and)g(up)r(dates)37
1970 y Ft(In)f(the)f(STG)g(language,)g Fp(let\(rec\))f Ft(expressions)i(bind)
g(v)m(ariables)g(to)f(lam)o(b)q(da-forms.)25 b(Tw)o(o)16 b(pieces)i(of)37
2027 y(denotationally)d(redundan)o(t)f(but)f(op)q(erationally)i(signi\014can)
o(t)f(information)g(are)f(attac)o(hed)g(to)f(a)h(lam)o(b)q(da-)37
2083 y(form:)23 b(a)16 b(list)i(of)e(the)h(free)g(v)m(ariables)h(of)f(the)g
(lam)o(b)q(da-form,)f(and)h(an)g Fn(up)n(date)i(\015ag)p Ft(.)24
b(In)18 b(this)f(section)g(w)o(e)37 2140 y(fo)q(cus)f(on)f(the)g(up)q(date)h
(\015ag.)37 2226 y(Up)q(dates)22 b(are)e(an)h(exp)q(ensiv)o(e)h(feature)f(of)
f(lazy)i(ev)m(aluation,)h(whereb)o(y)e(the)g(closure)h(represen)o(ting)f(an)
37 2282 y(unev)m(aluated)h(expression)e(is)g(up)q(dated)h(with)e(its)h
(\(head\))g(normal)f(form)g(when)h(it)g(is)g(ev)m(aluated)h(\(Sec-)37
2338 y(tion)16 b(3.1.2\).)i(The)d(aim)h(is)f(to)g(a)o(v)o(oid)g(ev)m
(aluating)h(a)f(particular)h(closure)g(more)f(than)g(once.)37
2424 y(In)k(con)o(trast)e(to)h(the)g(G-mac)o(hine,)i(whic)o(h)f(p)q(erforms)f
(an)g(up)q(date)h(after)e(almost)h(ev)o(ery)g(reduction,)i(the)37
2481 y(Spineless)d(T)l(agless)e(G-mac)o(hine)g(is)g(able)g(to)f(decide)i
Fn(on)g(a)g(closur)n(e-by-closur)n(e)f(b)n(asis)e Ft(whether)i(up)q(dating)37
2537 y(is)e(required.)20 b(\(It)13 b(shares)f(this)h(prop)q(ert)o(y)f(with)h
(TIM)f(and)g(the)h(Spineless)i(G-mac)o(hine.\))k(The)13 b(up)q(date/no-)37
2594 y(up)q(date)j(decision)h(is)f(con)o(trolled)g(b)o(y)g(the)f(up)q(date)h
(\015ag)f(on)g(a)g(lam)o(b)q(da-form:)20 b(if)c(the)f(up)q(date)h(\015ag)f
(is)h(\\)p Fp(u)p Ft(",)37 2650 y(the)f(corresp)q(onding)g(closure)f(will)i
(b)q(e)e(up)q(dated)h(with)g(its)f(head)g(normal)g(form)f(if)i(it)f(is)h(ev)o
(er)e(ev)m(aluated;)i(if)37 2707 y(it)h(is)g(\\)p Fp(n)o Ft(")f(no)g(up)q
(date)h(will)h(b)q(e)f(p)q(erformed.)37 2793 y(It)j(is)g(clearly)h(safe)e(to)
g(set)g(the)g(up)q(date)i(\015ag)e(of)g(ev)o(ery)g(lam)o(b)q(da-form)g(to)g
Fp(u)p Ft(,)h(thereb)o(y)g(up)q(dating)g(ev)o(ery)934 2921
y(23)p eop
%%Page: 24 24
bop 37 199 a Ft(closure.)28 b(But)18 b(w)o(e)f(can)g(do)h(m)o(uc)o(h)f(b)q
(etter)h(than)f(this.)28 b(The)17 b(ob)o(vious)h(question)g(is:)25
b(to)17 b(whic)o(h)h(lam)o(b)q(da-)37 256 y(forms)10 b(can)h(w)o(e)f(safely)h
(assign)g(an)g(up)q(date)g(\015ag)f(of)g(\\)p Fp(n)p Ft(",)h(without)f
(losing)i(the)e(single-ev)m(aluation)k(prop)q(ert)o(y?)37 312
y(W)l(e)i(explore)g(this)f(question)h(b)o(y)f(classifying)i(lam)o(b)q
(da-forms)e(in)o(to)g(distinct)i(classes:)37 436 y Fr(Manifest)h(functions.)
24 b Ft(A)11 b(manifest)h(function)h(is)g(a)e(lam)o(b)q(da-form)h(with)g(a)g
(non-empt)o(y)f(argumen)o(t)h(list.)151 492 y(F)l(or)h(example,)h
Fp(map)e Ft(and)h Fp(mf)g Ft(are)g(manifest)g(functions)h(in)g(the)f
(examples)h(of)f(the)g(previous)h(section.)151 548 y(Manifest)19
b(functions)g(do)g(not)g(require)g(up)q(dating)h(b)q(ecause)g(they)f(are)f
(already)h(in)h(head)f(normal)151 605 y(form.)37 699 y Fr(P)o(artial)g
(applications.)25 b Ft(A)15 b(partial)h(application)h(lam)o(b)q(da-form)e(is)
g(of)g(the)g(form)749 801 y Fn(vs)k Fp(\\n)14 b Fo(fg)h Fp(->)g
Fn(f)25 b Fo(f)p Fn(x)1077 808 y Fl(1)1100 801 y Fq(;)8 b(:)g(:)g(:)d(;)j
Fn(x)1223 808 y Fl(m)1254 801 y Fo(g)151 903 y Ft(where)22
b Fn(f)32 b Ft(is)22 b(kno)o(wn)g(to)f(b)q(e)i(a)f(manifest)g(function)h
(taking)f(more)f(than)h Fn(m)k Ft(argumen)o(ts.)39 b(Lik)o(e)151
959 y(manifest)15 b(functions,)h(partial)f(applications)i(are)d(already)i(in)
f(head)h(normal)f(form,)f(and)h(hence)h(do)151 1016 y(not)j(require)g(up)q
(dating.)32 b(Both)19 b(manifest)g(functions)g(and)g(partial)h(applications)g
(are)e(of)h(course)151 1072 y(function)d(v)m(alues.)151 1147
y(P)o(artial)k(applications)h(sometimes)f(app)q(ear)g(directly)h(in)g
(programs,)e(but)h(they)g(also)g(arise)g(as)f(a)151 1204 y(result)d(of)f(p)q
(erforming)g(up)q(dates)h(\(Section)g(5.6\).)151 1279 y(Only)j(lam)o(b)q
(da-forms)e(in)h(precisely)i(the)d(form)g(giv)o(en)h(ab)q(o)o(v)o(e)f(are)g
(classi\014ed)i(as)f(partial)f(applica-)151 1335 y(tions.)j(F)l(or)15
b(example,)g(the)h(lam)o(b)q(da-form)342 1448 y Fp({x,y})23
b(\\u)h({})f(->)h(let)f(z)h(=)g(...)700 1504 y(in)g(f)f({z})151
1617 y Ft(is)18 b Fn(not)f Ft(classi\014ed)i(as)e(a)h(partial)f(application,)
j(b)q(ecause)e(its)g(b)q(o)q(dy)g(is)g(not)f(in)h(the)g(required)g(form.)151
1673 y(There)11 b(is)g(a)g(go)q(o)q(d)g(reason)f(for)g(this:)18
b(if)11 b(a)g(closure)g(built)h(from)e(this)i(lam)o(b)q(da-form)e(w)o(as)g
(not)g(up)q(dated,)151 1730 y(the)15 b(closure)h(for)f Fp(z)g
Ft(w)o(ould)g(b)q(e)h(re-built)h(eac)o(h)e(time)h(it)f(w)o(as)g(en)o(tered.)
37 1824 y Fr(Constructors.)22 b Ft(A)15 b(constructor)g(is)g(a)g(lam)o(b)q
(da-form)g(of)g(the)g(form)749 1926 y Fn(vs)k Fp(\\n)14 b Fo(fg)h
Fp(->)g Fn(c)j Fo(f)p Fn(x)1077 1933 y Fl(1)1100 1926 y Fq(;)8
b(:)g(:)g(:)d(;)j Fn(x)1223 1933 y Fl(m)1254 1926 y Fo(g)151
2028 y Ft(where)19 b Fn(c)h Ft(is)f(a)f(constructor.)28 b(\(Since)20
b(constructor)d(applications)j(are)e(alw)o(a)o(ys)f(saturated)h(in)h(the)151
2084 y(STG)14 b(language,)g Fn(c)i Ft(is)e(b)q(ound)h(to)e(ha)o(v)o(e)g(arit)
o(y)h Fn(m)s Ft(.\))19 b(The)14 b(up)q(date)h(\015ag)e(on)h(a)f(constructor)g
(is)i(alw)o(a)o(ys)151 2141 y Fp(n)g Ft(\(no)g(up)q(date\).)37
2235 y Fr(Th)o(unks.)22 b Ft(The)d(remaining)g(lam)o(b)q(da-forms,)g(those)g
(with)g(an)f(empt)o(y)g(argumen)o(t)g(list)i(but)e(not)h(of)f(the)151
2291 y(sp)q(ecial)h(form)e(of)f(a)h(partial)h(application)h(or)d(a)h
(constructor,)g(are)g(called)h Fn(thunks)p Ft(.)26 b(The)17
b(lam)o(b)q(da-)151 2348 y(forms)e Fp(mfy)f Ft(and)i Fp(fy)f
Ft(are)f(examples)i(of)f(th)o(unks)g(in)h(the)g(previous)g(section.)151
2423 y(Since)h(th)o(unks)e(are)g(not)g(in)i(normal)e(form,)f(it)i(app)q(ears)
f(at)g(\014rst)g(that)f(they)i(should)g(all)g(ha)o(v)o(e)f(their)151
2479 y(up)q(date)i(\015ag)f(set)g(to)g Fp(u)o Ft(.)24 b(Ho)o(w)o(ev)o(er,)15
b Fn(if)i(the)g(c)n(ompiler)h(c)n(an)e(pr)n(ove)i(that)f(a)h(thunk)f(c)n(an)g
(b)n(e)g(evaluate)n(d)151 2536 y(at)h(most)f(onc)n(e)f Ft(then)h(it)f(is)h
(safe)f(to)g(set)g(its)h(up)q(date)g(\015ag)f(to)f Fp(n)p Ft(,)i(thereb)o(y)f
(allo)o(wing)h(the)g(up)q(date)g(to)151 2592 y(b)q(e)f(omitted.)151
2667 y(F)l(or)f(example,)g(consider)i(the)e(follo)o(wing)h(de\014nition:)934
2921 y(24)p eop
%%Page: 25 25
bop 342 199 a Fp(f)24 b(=)f({})h(\\n)g({p,xs})f(->)g(let)h(j)f(=)h({p})g(\\n)
f({})h(->)f(factorial)g(p)819 256 y(in)819 312 y(case)h(xs)f(of)915
369 y(Nil)g({})143 b(->)24 b(+)f({j,1})915 425 y(Cons)g({y,ys})g(->)h(+)f
({j,2})151 538 y Ft(Here)15 b(it)f(is)h(clear)g(that)e Fp(j)h
Ft(will)i(b)q(e)f(ev)m(aluated)g(at)f(most)f(once,)i(so)f(its)g(closure)h(do)
q(es)g(not)f(need)h(to)e(b)q(e)151 594 y(up)q(dated.)37 717
y(In)k(summary)l(,)e(up)q(dates)h(are)f(nev)o(er)h(required)h(for)e
(functions,)h(partial)g(applications)h(and)f(constructors;)37
774 y(and)g(ma)o(y)e(in)i(addition)h(sometimes)e(b)q(e)h(omitted)f(for)g(th)o
(unks.)37 860 y(The)22 b(analysis)g(phase)f(whic)o(h)h(determines)h(whic)o(h)
f(th)o(unks)f(need)h(not)f(b)q(e)h(up)q(dated)g(is)f(called)i
Fn(up)n(date)37 916 y(analysis)p Ft(.)28 b(Not)18 b(m)o(uc)o(h)g(w)o(ork)f
(seems)i(to)e(ha)o(v)o(e)h(b)q(een)i(done)e(on)g(this)h(topic,)g(but)f(w)o(e)
g(are)g(w)o(orking)g(on)g(a)37 973 y(simple)f(up)q(date)f(analyser.)37
1124 y Fm(4.3)56 b(Generating)18 b(few)n(er)h(up)r(datable)f(lam)n(b)r
(da-forms)37 1239 y Ft(The)h(translation)g(from)e(the)i(Core)f(to)g(STG)g
(language)g(is)h(largely)h(straigh)o(tforw)o(ard)c(\(apart)h(from)h(the)37
1296 y(up)q(date)e(analysis,)g(whic)o(h)g(can)f(of)g(course)g(b)q(e)h
(omitted)f(b)o(y)h(\015agging)f(all)h(th)o(unks)f(as)g(up)q(datable\).)21
b(There)37 1352 y(is)16 b(an)e(imp)q(ortan)o(t)h(opp)q(ortunit)o(y)g(to)f
(reduce)h(the)g(incidence)j(of)c(up)q(dates,)h(whic)o(h)h(concerns)f
(constructors)37 1409 y(and)h(partial)f(applications.)22 b(Consider)16
b(the)f(Hask)o(ell)h(expression)228 1495 y Fp(let)24 b(xs)f(=)h(y1)g(:)f
(\(y2)h(:)g(\(y3)f(:)h([]\)\)\))228 1551 y(in)g(...)37 1637
y Ft(A)16 b(straigh)o(tforw)o(ard)d(translation)i(in)o(to)g(the)g(STG)g
(language)h(giv)o(es)228 1723 y Fp(let)24 b(xs)f(=)h({y1,y2,y3})f(\\u)g({})h
(->)443 1780 y(let)g(t1)f(=)h({y2,y3})f(\\u)g({})h(->)658 1836
y(let)f(t2)h(=)g({y3})f(\\u)h({})f(->)873 1892 y(let)g(t3)h(=)f({})h(\\n)g
({})f(->)h(Nil)f({})873 1949 y(in)g(Cons)h({y3,t3})658 2005
y(in)g(Cons)f({y2,t2})443 2062 y(in)h(Cons)f({y1,t1})228 2118
y(in)h(...)37 2204 y Ft(Three)18 b(up)q(datable)g(th)o(unks)f(ha)o(v)o(e)g(b)
q(een)h(built)h(whic)o(h)f(will)h(subsequen)o(tly)f(b)q(e)g(up)q(dated)g
(when)f(\(and)g(if)t(\))37 2261 y Fp(xs)e Ft(is)h(tra)o(v)o(ersed.)j(An)c
(alternativ)o(e,)g(and)h(usually)g(sup)q(erior,)g(translation)f(is)h(this:)
228 2347 y Fp(let)95 b(t3)24 b(=)g({})f(\\n)h({})g(->)f(Nil)h({})228
2403 y(in)g(let)f(t2)h(=)g({y3,t3})f(\\n)g({})h(->)f(Cons)h({y3,t3})228
2460 y(in)g(let)f(t1)h(=)g({y2,t2})f(\\n)g({})h(->)f(Cons)h({y2,t2})228
2516 y(in)g(let)f(xs)h(=)g({y1,t1})f(\\n)g({})h(->)f(Cons)h({y1,t1})228
2572 y(in)g(...)37 2658 y Ft(No)15 b(up)q(datable)i(th)o(unks)e(are)g(built)h
(at)f(all.)21 b(The)15 b(only)h(bad)f(thing)h(ab)q(out)f(this)g(translation)h
(is)f(that)g(if)g Fp(xs)37 2715 y Ft(w)o(as)d(to)f(b)q(e)h(discarded)i
(without)d(b)q(eing)j(tra)o(v)o(ersed)d(then)h(the)g(w)o(ork)f(of)g
(constructing)h(all)h(four)f(constructor)37 2771 y(closures)k(w)o(ould)g(ha)o
(v)o(e)f(b)q(een)h(w)o(asted.)j(\(This)d(is)f(a)g(strictly)h(b)q(ounded)h
(amoun)o(t)d(of)h(w)o(ork,)f(ho)o(w)o(ev)o(er.\))934 2921 y(25)p
eop
%%Page: 26 26
bop 37 199 a Ft(Just)15 b(the)f(same)g(alternativ)o(e)h(translation)f(is)h(p)
q(ossible)h(when)f(a)f(kno)o(wn)g(function)h(is)g(applied)h(to)d(to)q(o)h
(few)37 256 y(argumen)o(ts;)i(the)h Fp(let)f Ft(bindings)i(for)e(the)h
(argumen)o(t)f(expressions)h(can)g(b)q(e)g(lifted)g(up)g(a)g(lev)o(el)g(so)f
(that)g(a)37 312 y(partial-application)i(lam)o(b)q(da-form)d(remains,)g(whic)
o(h)h(do)q(es)g(not)f(need)h(to)e(b)q(e)i(up)q(dated.)37 398
y(In)g(general,)106 521 y Fo(\017)22 b Ft(Up)q(dates)17 b(can)g(b)q(e)h
(omitted)f(for)f(parameterless)h(lam)o(b)q(da-forms)f(if)h(the)g(b)q(o)q(dy)h
(is)f(a)g(head)g(normal)151 578 y(form.)106 672 y Fo(\017)22
b Ft(Opp)q(ortunities)g(for)d(this)h(impro)o(v)o(emen)o(t)g(ma)o(y)f(b)q(e)h
(enhanced)h(b)o(y)f(mo)o(ving)f Fp(let\(rec\))g Ft(bindings)151
728 y(from)g(the)g(lam)o(b)q(da-form)g(to)g(its)h(enclosing)g(con)o(text.)32
b(More)19 b(generally)l(,)i(an)o(y)e(small,)i(b)q(ounded,)151
785 y(computation)d(ma)o(y)g(b)q(e)h(mo)o(v)o(ed)f(from)g(a)g(lam)o(b)q
(da-form)g(to)g(its)g(enclosing)i(con)o(text)e(to)f(exp)q(ose)i(a)151
841 y(head)d(normal)f(form,)f(and)h(thereb)o(y)h(a)o(v)o(oid)f(an)g(up)q
(date.)37 992 y Fm(4.4)56 b(Standard)20 b(constructors)37 1108
y Ft(The)c(\014nal)g(form)e(of)h(the)g(example)h(in)h(the)e(previous)h
(section)f(had)h(three)f(lam)o(b)q(da-forms)g(of)g(the)g(form)636
1210 y Fp({)p Fn(x)5 b Fp(,)p Fn(xs)t Fp(})23 b(\\n)h({})f(->)h(Cons)f({)p
Fn(x)5 b Fp(,)q Fn(xs)t Fp(})37 1312 y Ft(for)13 b(v)m(arious)h
Fn(x)19 b Ft(and)13 b Fn(xs)t Ft(.)19 b(Because)14 b(they)f(all)h(ha)o(v)o(e)
f(the)g(same)g(shap)q(e,)h(they)g(can)f(clearly)h(all)h(share)e(a)g(single)37
1368 y(co)q(de)j(p)q(oin)o(ter.)21 b(In)15 b(general,)h(a)f(lam)o(b)q
(da-form)g(of)g(the)g(form)592 1471 y Fo(f)p Fn(x)636 1478
y Fl(1)659 1471 y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(x)782 1478 y
Fl(m)813 1471 y Fo(g)15 b Fp(\\n)g Fo(fg)g Fp(->)g Fn(c)i Fo(f)p
Fn(x)1120 1478 y Fl(1)1144 1471 y Fq(;)8 b(:)g(:)g(:)t(;)g
Fn(x)1266 1478 y Fl(m)1298 1471 y Fo(g)37 1573 y Ft(where)17
b Fn(c)h Ft(is)e(a)g(constructor)f(of)h(arit)o(y)f Fn(m)s Ft(,)h(is)h(called)
g(a)f Fn(standar)n(d)h(c)n(onstructor)p Ft(.)22 b(All)17 b(suc)o(h)f(lam)o(b)
q(da-forms)37 1629 y(for)f(a)g(particular)h(constructor)e Fn(c)k
Ft(can)d(share)g(common)g(co)q(de.)37 1715 y(The)f(free-v)m(ariable)h(list)e
(of)g(a)g(global)h(de\014nition)h(is)e(usually)i(empt)o(y)l(,)e(since)h(the)f
(global)h(can)f(only)h(men)o(tion)37 1772 y(other)19 b(globals,)i(and)e(is)h
(represen)o(ted)g(b)o(y)f(a)g(closure)h(consisting)g(only)g(of)f(a)g(co)q(de)
h(p)q(oin)o(ter.)32 b(Ho)o(w)o(ev)o(er,)37 1828 y(consider)17
b(the)e(follo)o(wing)h(global)g(Hask)o(ell)g(de\014nition:)228
1914 y Fp(aList)24 b(=)f([thing])228 1970 y(thing)h(=)f(...)37
2056 y Ft(A)16 b(straigh)o(tforw)o(ard)d(translation)i(to)g(the)g(STG)g
(language)g(giv)o(es)228 2142 y Fp(aList)24 b(=)f({})h(\\n)f(Cons)h
({thing,nil})228 2199 y(nil)g(=)g({})f(\\n)h(Nil)f({})228 2255
y(thing)h(=)f(...)37 2341 y Ft(This)g(is)f(p)q(erfectly)g(correct,)g(but)g
(it)g(means)f(ha)o(ving)h(sp)q(ecial-purp)q(ose)i(co)q(de)e(for)f
Fp(aList)o Ft(,)i(whic)o(h)f(has)37 2398 y(references)c(to)e
Fp(thing)g Ft(and)h Fp(nil)f Ft(wired)h(in)o(to)g(it.)25 b(If)17
b Fp(aList)f Ft(w)o(as)g(a)g(list)h(with)h(sev)o(eral)e(items)h(in)h(it,)f
(eac)o(h)37 2454 y(cell)g(in)f(the)g(list)g(w)o(ould)f(ha)o(v)o(e)g(a)g
(separate)g(co)q(de)g(sequence!)21 b(An)16 b(alternativ)o(e)f(translation,)g
(is)228 2540 y Fp(aList)24 b(=)f({thing,nil})g(\\n)g(Cons)h({thing,nil})228
2597 y(nil)g(=)g({})f(\\n)h(Nil)f({})228 2653 y(thing)h(=)f(...)37
2739 y Ft(The)17 b(lam)o(b)q(da-form)g(for)f Fp(aList)g Ft(no)o(w)g(has)g
(free)h(v)m(ariables)h(whic)o(h)f(are)g(not)f(strictly)h(necessary)l(,)g(but)
g(the)37 2796 y(pa)o(y)o(o\013)c(is)i(that)e(the)h(lam)o(b)q(da-form)g(is)h
(no)o(w)e(a)h(standard)g(constructor,)f(and)h(can)g(use)h(the)f(standard)f
(co)q(de)934 2921 y(26)p eop
%%Page: 27 27
bop 37 199 a Ft(for)15 b Fp(Cons)p Ft(.)20 b(Instead)c(of)f(b)q(eing)i
(represen)o(ted)f(b)o(y)g(a)f(co)q(de)h(p)q(oin)o(ter)g(alone,)f
Fp(aList)g Ft(is)h(no)o(w)f(represen)o(ted)h(b)o(y)37 256 y(the)g
Fp(Cons)e Ft(co)q(de)i(together)f(with)g(p)q(oin)o(ters)h(to)e(the)i(globals)
f Fp(thing)g Ft(and)g Fp(nil)p Ft(.)37 342 y(W)l(e)j(apply)g(this)g(idea)g
(throughout,)f(not)g(just)g(at)f(top)h(lev)o(el,)i(to)e(mak)o(e)g(sure)g
(that)g(ev)o(ery)g(lam)o(b)q(da-form)37 398 y(whose)f(b)q(o)q(dy)f(is)h(a)f
(simple)i(constructor)d(application)j(is)f(a)f(standard)f(constructor.)37
484 y(F)l(or)19 b(n)o(ullary)h(constructors,)e(suc)o(h)i(as)e
Fp(Nil)p Ft(,)h(it)g(is)h(not)e(only)i(p)q(ossible)g(to)f(share)f(its)i
Fn(c)n(o)n(de)p Ft(,)f(but)g(also)g(to)37 541 y(share)13 b(its)g
Fn(closur)n(e)p Ft(.)19 b(Th)o(us,)12 b(in)i(the)f(ab)q(o)o(v)o(e)f(example,)
i(the)f Fp(nil)f Ft(global)h(can)g(b)q(e)h(shared)f(b)o(y)f(all)i(o)q
(ccurrences)37 597 y(of)h Fp(Nil)g Ft(in)h(the)f(program.)37
748 y Fm(4.5)56 b(Lam)n(b)r(da)18 b(lifting)37 864 y Ft(Lam)o(b)q(da)j
(lifting)g(is)g(a)e(pro)q(cess)h(whereb)o(y)h(all)g(function)f(de\014nitions)
i(are)e(lifted)h(to)e(the)h(top)g(lev)o(el,)i(b)o(y)37 920
y(making)e(their)g(free)f(v)m(ariables)i(in)o(to)e(extra)g(argumen)o(ts)g
(\(Johnsson)g([1985];)g(P)o(eyton)g(Jones)h(&)g(Lester)37 977
y([1991]\).)36 b(In)22 b(a)f(lam)o(b)q(da-lifted)i(program)e(eac)o(h)g(lam)o
(b)q(da-form)g(has)g(either)h(no)f(free)h(v)m(ariables)g(or)f(no)37
1033 y(argumen)o(ts.)g(In)16 b(con)o(trast)f(to)g(most)g(other)g(abstract)g
(mac)o(hines,)h(the)g(STG)f(mac)o(hine)i(do)q(es)f(not)f(require)37
1089 y(the)c(program)f(to)h(b)q(e)g(lam)o(b)q(da)g(lifted;)j(a)c(righ)o
(t-hand)i(side)f(can)g(ha)o(v)o(e)g(b)q(oth)g(free)g(v)m(ariables)h(and)f
(argumen)o(ts.)37 1175 y(The)23 b(op)q(erational)g(di\013erence)h(b)q(et)o(w)
o(een)f(the)g(t)o(w)o(o)e(is)i(fairly)g(sligh)o(t.)43 b(Consider)23
b(the)g(follo)o(wing)g(STG)37 1232 y(language)16 b(de\014nition:)228
1318 y Fp(f)24 b(=)g({})f(\\n)h({x1,x2,x3})f(->)g(let)h(z)f(=)h({x1,x3})f
(\\n)h({y})f(->)h(zbody)801 1374 y(in)g(fbody)37 1460 y Ft(in)16
b(whic)o(h)g(the)f(lam)o(b)q(da-form)g(for)f Fp(z)h Ft(has)g(the)g(free)g(v)m
(ariables)h Fp(x1)f Ft(and)g Fp(x3)p Ft(,)f(and)i(argumen)o(t)e
Fp(y)p Ft(.)19 b(If)d(lam)o(b)q(da)37 1517 y(lifting)h(is)f(p)q(erformed,)f
(a)g(new)g(global)h(function)g(\(or)e(sup)q(ercom)o(binator\))i
Fp($z)e Ft(is)i(in)o(tro)q(duced,)g(giving:)228 1603 y Fp($z)24
b(=)g({})f(\\n)h({x1,x3,y})46 b(->)24 b(zbody)228 1659 y(f)48
b(=)24 b({})f(\\n)h({x1,x2,x3})e(->)i(let)f(z)h(=)g({x1,x3})f(\\n)g({})h(->)g
($z)f({x1,x3})825 1716 y(in)h(fbody)37 1802 y Ft(No)o(w)19
b(the)h(program)e(has)i(only)g(th)o(unks)f(\(lik)o(e)i Fp(z)o
Ft(\))e(and)h(sup)q(ercom)o(binators)g(\(lik)o(e)g Fp(f)f Ft(and)h
Fp($z)p Ft(\).)32 b(Op)q(era-)37 1858 y(tionally)l(,)17 b(what)f(happ)q(ens)g
(is)h(that)e(when)h Fp(z)f Ft(is)h(en)o(tered,)g(it)g(pushes)h(its)e(t)o(w)o
(o)g(free)h(v)m(ariables,)g Fp(x1)g Ft(and)g Fp(x3)o Ft(,)37
1915 y(on)o(to)g(the)g(ev)m(aluation)h(stac)o(k)f(and)g(jumps)g(to)g
Fp($z)o Ft(.)23 b(In)17 b(the)f(original)h(v)o(ersion,)f(whic)o(h)h(the)f
(STG)g(mac)o(hine)37 1971 y(can)g(execute)g(directly)l(,)g(the)f(free)h(v)m
(ariables)g(can)f(b)q(e)h(used)g(directly)h(from)d(the)h(closure)h(itself.)37
2057 y(In)21 b(short,)f(the)g(lo)q(cal)i(en)o(vironmen)o(t)e(in)h(whic)o(h)g
(the)f(STG)g(mac)o(hine)g(executes)h(consists)f(of)g(t)o(w)o(o)f(parts)37
2113 y(\(Section)f(5.2\):)k(v)m(alues)c(held)g(in)g(the)f(closure)g(just)g
(en)o(tered)g(\(its)g(free)g(v)m(ariables\),)h(and)f(v)m(alues)h(held)g(on)37
2170 y(the)h(stac)o(k)f(\(its)g(argumen)o(ts\).)29 b(This)19
b(t)o(w)o(o-lev)o(el)g(en)o(vironmen)o(t)g(reduces)g(somewhat)f(the)h(mo)o(v)
o(emen)o(t)e(of)37 2226 y(v)m(alues)h(from)e(the)h(heap)g(to)f(the)g(stac)o
(k,)g(but)h(it)g(is)g(not)f(y)o(et)g(clear)h(whether)g(this)g(is)g(a)f(big)h
(impro)o(v)o(emen)o(t)37 2283 y(or)e(only)h(a)f(marginal)g(one.)37
2434 y Fm(4.6)56 b(F)-5 b(ull)19 b(laziness)37 2549 y Ft(Consider)d(the)g
(binding)228 2635 y Fp(f)24 b(=)g({x})f(\\n)h({y})f(->)h(let)f(z)h(=)g({x})f
(\\u)h({})f(->)h(ez)658 2692 y(in)g(ef)934 2921 y Ft(27)p eop
%%Page: 28 28
bop 37 199 a Ft(where)14 b Fp(ez)g Ft(and)f Fp(ef)h Ft(are)f(arbitrary)g
(expressions.)20 b(Supp)q(ose)15 b Fp(x)e Ft(and)h Fp(y)g Ft(are)f(b)q(oth)h
(free)f(in)i Fp(ef)p Ft(,)e(but)h(only)g Fp(x)f Ft(is)37 256
y(free)k(in)f Fp(ez)p Ft(.)22 b(Since)c(the)e(lam)o(b)q(da-form)g(for)f
Fp(z)h Ft(do)q(es)g(not)g(ha)o(v)o(e)f Fp(y)h Ft(as)g(a)f(free)h(v)m
(ariable,)h(this)g(is)f(equiv)m(alen)o(t)37 312 y(to)f(the)g(pair)h(of)f
(bindings)228 398 y Fp(z)24 b(=)g({x})f(\\u)h({})f(->)h(ez)228
455 y(f)g(=)g({x,z})f(\\n)h({y})f(->)h(ef)37 541 y Ft(F)l(urthermore,)19
b(the)g(latter)g(form)f(ma)o(y)g(sa)o(v)o(e)h(w)o(ork)f(if)h
Fp(f)g Ft(is)g(applied)i(man)o(y)d(times,)i(b)q(ecause)g Fp(z)f
Ft(will)h(b)q(e)37 597 y(instan)o(tiated)f(only)f(once)h(rather)e(than)h
(once)g(for)f(eac)o(h)h(call)h(of)f Fp(f)p Ft(.)28 b(In)19
b(general,)f(eac)o(h)g(binding)i(can)e(b)q(e)37 653 y(mo)o(v)o(ed)j(out)o(w)o
(ards)f(un)o(til)i(its)f(immediately)h(enclosing)h(lam)o(b)q(da)e
(abstraction)g(binds)h(one)f(of)g(the)g(free)37 710 y(v)m(ariables)16
b(of)d(the)h(binding.)21 b(This)15 b(transformation)d(is)i(called)i(the)e
Fn(ful)r(l)g(laziness)e Ft(transformation,)g(and)i(is)37 766
y(describ)q(ed)k(in)e(detail)g(b)o(y)f(P)o(eyton)g(Jones)g(&)h(Lester)f
([1991].)37 918 y Fm(4.7)56 b(Arithmetic)16 b(and)j(un)n(b)r(o)n(xed)g(v)m
(alues)37 1033 y Ft(In)d(a)f(non-strict)h(functional)g(language)g(implemen)o
(tation,)g(when)g(a)e(v)m(ariable)j(is)f(b)q(ound,)g(it)f(is)h(generally)37
1089 y(b)q(ound)k(to)f(an)f(unev)m(aluated)j(closure)e(allo)q(cated)h(in)g
(the)f(heap.)31 b(When)20 b(the)f(v)m(alue)h(of)e(the)h(v)m(ariable)h(is)37
1146 y(required,)e(the)e(closure)h(to)e(whic)o(h)i(it)g(p)q(oin)o(ts)f(is)h
(ev)m(aluated,)g(and)f(the)h(closure)f(is)h(o)o(v)o(erwritten)e(with)i(the)37
1202 y(resulting)g(v)m(alue.)k(F)l(urther)15 b(ev)m(aluations)h(of)f(the)g
(same)g(closure)h(will)h(\014nd)f(the)f(v)m(alue)i(immediately)l(.)37
1288 y(This)12 b(ev)m(aluation)g(mo)q(del)g(means)f(that)f(all)i(n)o(um)o(b)q
(ers)f(are)g(represen)o(ted)g(b)o(y)g(a)g(p)q(oin)o(ter)g(to)g(a)f(heap-allo)
q(cated)37 1345 y(closure,)20 b(or)e(\\b)q(o)o(x",)g(whic)o(h)h(con)o(tains)f
(either)h(information)g(whic)o(h)g(enables)g(the)g(n)o(um)o(b)q(er)f(to)g(b)q
(e)h(com-)37 1401 y(puted,)i(or)d(\(if)i(the)f(closure)h(has)f(b)q(een)h(ev)m
(aluated\))g(the)f(actual)g(v)m(alue)i(of)d(the)h(n)o(um)o(b)q(er.)32
b(W)l(e)20 b(call)g(the)37 1458 y(\\actual)c(v)m(alue")g(an)f
Fn(unb)n(oxe)n(d)h(value)p Ft(;)e(it)i(can)f(b)q(e)h(manipulated)g(directly)h
(b)o(y)e(the)g(instruction)h(set)f(of)g(the)37 1514 y(mac)o(hine.)37
1600 y(The)j(uniform)f(b)q(o)o(xed)h(represen)o(tation)f(mak)o(es)g
(arithmetic)h(horribly)g(exp)q(ensiv)o(e.)27 b(A)18 b(simple)g(addition,)37
1657 y(whic)o(h)f(tak)o(es)f(one)g(instruction)h(in)f(a)g(con)o(v)o(en)o
(tional)h(system,)e(requires)i(a)e(sequence)j(of)d(instructions)i(to:)37
1713 y(ev)m(aluate)i(the)g(t)o(w)o(o)d(op)q(erands,)j(fetc)o(h)f(their)h(v)m
(alues,)g(add)g(them,)f(allo)q(cate)h(a)f(new)g(b)q(o)o(x)g(for)g(the)g
(result,)37 1770 y(and)e(place)g(the)f(result)h(in)g(it.)37
1855 y(One)f(of)f(the)g(inno)o(v)m(ativ)o(e)h(features)e(of)h(our)f(compiler)
i(is)g(that)e Fn(unb)n(oxe)n(d)i(values)f(ar)n(e)i(explicitly)e(p)n(art)i(of)
f(the)37 1912 y(Cor)n(e)g(and)g(STG)f(languages)p Ft(.)19 b(That)13
b(is,)h(v)m(ariables)h(ma)o(y)e(b)q(e)i(b)q(ound)g(to)e(un)o(b)q(o)o(xed)h(v)
m(alues,)h(functions)g(ma)o(y)37 1968 y(tak)o(e)f(un)o(b)q(o)o(xed)h(v)m
(alues)h(as)e(argumen)o(ts)f(and)i(return)f(them)h(as)f(results,)g(un)o(b)q
(o)o(xed)h(v)m(alues)h(ma)o(y)d(b)q(e)i(stored)37 2025 y(in)h(data)f
(structures,)f(and)h(so)g(on.)k(The)d(main)f(motiv)m(ation)g(for)g(this)g
(approac)o(h)g(is)g(that)f(w)o(e)h(can)g(then)g(b)q(e)37 2081
y(explicit)20 b(ab)q(out)d(the)g(steps)g(in)o(v)o(olv)o(ed)h(in)g(\(sa)o(y\))
e(addition.)26 b(T)l(o)17 b(b)q(egin)i(with,)e(w)o(e)g(declare)h(the)f(follo)
o(wing)37 2138 y(data)e(t)o(yp)q(e:)228 2224 y Fp(data)24 b(Int)f(=)h(MkInt)f
(Int#)37 2310 y Ft(This)17 b(declares)f(the)g(data)f(t)o(yp)q(e)h(of)f(\(b)q
(o)o(xed\))h(in)o(tegers,)f Fp(Int)p Ft(,)g(as)g(an)h(algebraic)g(data)g(t)o
(yp)q(e)f(with)h(a)g(single)37 2366 y(constructor,)22 b Fp(MkInt)p
Ft(.)38 b(The)22 b(latter)f(has)g(a)g(single)i(argumen)o(t)d(of)h(t)o(yp)q(e)
h Fp(Int#)o Ft(,)g(the)g(t)o(yp)q(e)f(of)g Fn(unb)n(oxe)n(d)37
2423 y Ft(in)o(tegers.)f(So)14 b(the)h(v)m(alue)g Fp(\(MkInt)24
b(3#\))13 b Ft(represen)o(ts)i(the)f(b)q(o)o(xed)h(in)o(teger)f(3)g(\()p
Fp(3#)g Ft(stands)g(for)g(the)g(un)o(b)q(o)o(xed)37 2479 y(constan)o(t)h(3,)f
(of)h(t)o(yp)q(e)g Fp(Int#)p Ft(\).)37 2565 y(No)o(w,)g(giv)o(en)g(the)h
(expression)g Fp(\(e1)23 b(+)h(e2\))o Ft(,)15 b(sa)o(y)l(,)g(w)o(e)g(can)g
(rewrite)g(it)h(lik)o(e)g(this:)228 2651 y Fp(case)24 b(e1)f(of)228
2708 y(MkInt)h(x#)f(->)h(case)f(e2)h(of)515 2764 y(MkInt)f(y#)h(->)f(case)g
(\(x#)h(+#)f(y#\))h(of)934 2921 y Ft(28)p eop
%%Page: 29 29
bop 801 199 a Fp(t#)24 b(->)f(MkInt)g(t#)37 285 y Ft(The)11
b(outer)g(t)o(w)o(o)e Fp(case)h Ft(expressions)i(ev)m(aluate)f
Fp(e1)f Ft(and)h Fp(e2)g Ft(resp)q(ectiv)o(ely)l(,)i(while)f(the)f(inner)g
Fp(case)g Ft(expresses)37 342 y(the)i(fact)f(that)g Fp(x#)h
Ft(and)g Fp(y#)f Ft(are)h(added,)g(and)g Fn(then)g Ft(their)g(result)g
Fp(t#)f Ft(is)i(b)q(o)o(xed)f(with)g(a)f Fp(MkInt)g Ft(constructor.)37
398 y(\(By)k(con)o(v)o(en)o(tion,)f(w)o(e)g(use)g(a)g(trailing)i
Fp(#)e Ft(for)g(iden)o(ti\014ers)h(whose)g(v)m(alues)g(or)f(results)h(are)f
(primitiv)o(e.)21 b(This)37 455 y(is)16 b(just)e(for)g(h)o(uman)h(readabilit)
o(y:)21 b(the)15 b(iden)o(ti\014ers)h Fp(+)f Ft(and)f Fp(+#)h
Ft(are)f(distinct,)i(but)f(the)g Fp(#)f Ft(is)h(not)g(otherwise)37
511 y(recognised)i(sp)q(ecially)g(b)o(y)e(the)h(compiler.\))37
597 y(It)g(turns)g(out)g(that)f(this)h(simple)h(idea)g(allo)o(ws)f(sev)o
(eral)g(optimisations)h(whic)o(h)f(hitherto)g(w)o(ere)g(buried)h(in)37
653 y(the)c(co)q(de)f(generator)f(to)h(b)q(e)g(reform)o(ulated)g(as)g
(program)f(transformations.)17 b(F)l(urthermore,)12 b(the)g(idea)h(can)37
710 y(b)q(e)18 b(generalised)g(in)f(a)f(n)o(um)o(b)q(er)h(of)f(directions,)h
(suc)o(h)g(as)f(allo)o(wing)h(general)g(algebraic)g(data)f(t)o(yp)q(es)h
(with)37 766 y(un)o(b)q(o)o(xed)e(comp)q(onen)o(ts)f(\(rather)e(than)i(just)f
Fp(Int)p Ft(\).)19 b(All)c(of)e(this)h(is)g(discussed)i(in)e(detail)h(in)f(P)
o(eyton)g(Jones)37 823 y(&)i(Launc)o(h)o(bury)g([1991].)37
909 y(F)l(or)f(the)g(purp)q(oses)h(of)f(this)h(pap)q(er,)f(it)g(su\016ces)h
(to)e(establish)j(the)e(follo)o(wing)h(facts:)106 1031 y Fo(\017)22
b Ft(Data)16 b(t)o(yp)q(es)h(are)g(divided)i(in)o(to)e(t)o(w)o(o)e(kinds:)25
b Fn(algebr)n(aic)17 b(data)i(typ)n(es)d Ft(are)h(in)o(tro)q(duced)h(b)o(y)f
(explicit)151 1087 y Fp(data)c Ft(declarations,)h(while)h Fn(primitive)g
(data)h(typ)n(es)d Ft(are)g(built)i(in)o(to)f(the)f(system.)19
b(V)l(alues)c(of)e(primi-)151 1144 y(tiv)o(e)g(t)o(yp)q(e)g(can)f(b)q(e)h
(manipulated)h(directly)g(b)o(y)f(mac)o(hine)g(instructions,)h(and)f(are)f
(alw)o(a)o(ys)g(un)o(b)q(o)o(xed.)151 1200 y(F)l(or)j(example,)h
Fp(Int)f Ft(is)h(an)g(algebraic)g(t)o(yp)q(e,)f(while)i Fp(Int#)e
Ft(is)h(primitiv)o(e.)23 b(F)l(or)15 b(the)g(purp)q(ose)h(of)g(this)151
1257 y(pap)q(er,)f(it)f(su\016ces)g(to)g(iden)o(tify)h(primitiv)o(e)h(t)o(yp)
q(es)e(with)g(un)o(b)q(o)o(xed)h(t)o(yp)q(es,)f(though)g(the)g(generalisa-)
151 1313 y(tions)j(discussed)i(in)f(P)o(eyton)f(Jones)g(&)h(Launc)o(h)o(bury)
g([1991])d(p)q(ermit)j(un)o(b)q(o)o(xed)g(algebraic)g(t)o(yp)q(es)151
1370 y(as)d(w)o(ell.)106 1463 y Fo(\017)22 b Ft(All)f(literal)f(constan)o(ts)
f(are)g(of)g(primitiv)o(e)i(t)o(yp)q(e;)g(literals)f(of)f(algebraic)h(t)o(yp)
q(e)g(are)f(expressed)h(b)o(y)151 1520 y(giving)c(an)f(explicit)j
(application)f(of)d(a)h(constructor.)106 1613 y Fo(\017)22
b Ft(All)15 b(arithmetic)g(built-in)h(op)q(erations)e(op)q(erate)f(o)o(v)o
(er)g(primitiv)o(e)i(v)m(alues)g(\(for)e(example)i Fp(+#)e
Ft(ab)q(o)o(v)o(e\).)151 1669 y(De\014nitions)19 b(for)f(functions)g(op)q
(erating)g(o)o(v)o(er)f(non-primitiv)o(e)j(\(ie)e(algebraic\))h(v)m(alues)g
(can)f(b)q(e)h(ex-)151 1726 y(pressed)d(directly)g(in)g(the)g(STG)f
(language,)g(and)g(hence)h(do)f(not)g(need)h(to)f(b)q(e)h(built)g(in.)106
1819 y Fo(\017)22 b Ft(V)l(alues)16 b(of)f(un)o(b)q(o)o(xed)g(t)o(yp)q(e)g
(need)h(not)f(b)q(e)g(the)g(same)g(size)h(as)f(a)f(p)q(oin)o(ter.)21
b(F)l(or)14 b(example,)h Fp(Double#)o Ft(,)151 1876 y(the)g(t)o(yp)q(e)g(of)g
(double-precision)j(\015oating-p)q(oin)o(t)d(n)o(um)o(b)q(ers,)g(o)q(ccup)o
(y)h(64)e(bits)i(while)g(p)q(oin)o(ters)f(usu-)151 1932 y(ally)e(o)q(ccup)o
(y)g(32)f(bits.)20 b(As)12 b(a)g(result,)h Fn(p)n(olymorphic)h(functions)f(c)
n(an)g(take)h(only)f(ar)n(guments)g(of)h(b)n(oxe)n(d)151 1988
y(typ)n(e)p Ft(,)h(b)q(ecause)h(argumen)o(ts)e(m)o(ust)h(b)q(e)g(passed)h(to)
e(suc)o(h)h(functions)h(in)g(a)f(uniform)g(represen)o(tation.)151
2045 y(\(Ev)o(en)i(if)h(un)o(b)q(o)o(xed)g(v)m(alues)g(w)o(ere)f(alw)o(a)o
(ys)f(the)i(same)e(size)j(as)d(a)h(p)q(oin)o(ter)h(there)f(w)o(ould)h(still)g
(b)q(e)g(a)151 2101 y(di\016cult)o(y)f(for)d(the)h(garbage)g(collector)h(in)g
(distinguishing)i(a)c(p)q(oin)o(ter)i(from)f(a)f(non-p)q(oin)o(ter.\))106
2195 y Fo(\017)22 b Ft(A)15 b Fp(let)g Ft(or)f Fp(letrec)h
Ft(expression)g(cannot)g(bind)i(a)d(v)m(ariable)j(of)d(un)o(b)q(o)o(xed)i(t)o
(yp)q(e.)k(Suc)o(h)c(a)e(binding)j(is)151 2251 y(instead)h(made)g(using)g(a)f
Fp(case)g Ft(expression.)28 b(The)18 b(reason)f(for)g(this)h(is)g(that)f
(when)h(a)f(v)m(ariable)i(of)151 2308 y(un)o(b)q(o)o(xed)f(t)o(yp)q(e)f(is)g
(b)q(ound,)h(the)f(expression)h(to)f(whic)o(h)g(it)h(is)f(b)q(ound)h(m)o(ust)
f(b)q(e)g(ev)m(aluated)h(imme-)151 2364 y(diately;)j(the)d(whole)h(p)q(oin)o
(t)f(ab)q(out)h(un)o(b)q(o)o(xed)f(v)m(alues)i(is)f(that)e(they)h(cannot)g(b)
q(e)h(represen)o(ted)g(b)o(y)151 2421 y(as-y)o(et-unev)m(aluated)d(closures.)
151 2495 y(In)i(other)e(w)o(ords,)g(in)i(the)f(STG)g(language,)g
Fp(case)f Ft(expressions)i(p)q(erform)f(ev)m(aluation,)h(while)g
Fp(let)151 2552 y Ft(and)13 b Fp(letrec)f Ft(build)j(closures.)20
b(This)14 b(uniform)f(seman)o(tics)g(giv)o(es)g(rise)h(to)e(uniform)h
(transformation)151 2608 y(la)o(ws;)21 b(for)d(example,)i(a)f
Fp(let)g Ft(expression)h(whose)f(b)q(ound)h(v)m(ariable)g(is)g(not)e(used)i
(can)f(alw)o(a)o(ys)f(b)q(e)151 2665 y(elided.)151 2740 y(F)l(or)g(the)g
(same)g(reason,)g(the)g(global)h(\(top-lev)o(el\))f(bindings)i(of)e(an)g(STG)
g(program)f(cannot)h(bind)151 2796 y(v)m(alues)e(of)f(un)o(b)q(o)o(xed)h(t)o
(yp)q(e.)934 2921 y(29)p eop
%%Page: 30 30
bop 106 199 a Fo(\017)22 b Ft(There)17 b(are)g(t)o(w)o(o)e(forms)h(of)h
Fp(case)f Ft(expression,)i(as)e(the)h(the)g(syn)o(tax)f(of)g(Figure)h(3)g
(describ)q(es.)26 b(One)151 256 y(tak)o(es)14 b(apart)f(a)h(v)m(alue)h(of)f
(an)g(algebraic)h(data)e(t)o(yp)q(e,)h(while)i(the)e(other)g(p)q(erforms)g
(case)g(analysis)h(on)151 312 y(a)g(v)m(alue)h(of)f(primitiv)o(e)i(t)o(yp)q
(e.)37 463 y Fm(4.8)56 b(Relationship)17 b(to)i(CPS)h(con)n(v)n(ersion)37
579 y Ft(T)l(ransformation)e(to)g(contin)o(uation-passing)i(st)o(yle)f
(\(CPS\))f(is)h(a)f(tec)o(hnique)i(whic)o(h)f(has)g(b)q(een)g(used)h(to)37
635 y(go)q(o)q(d)e(e\013ect)g(in)g(sev)o(eral)g(compilers)h(for)e(strict)g
(\(call-b)o(y-v)m(alue\))j(languages)e(\(App)q(el)h([1992];)d(F)l(radet)i(&)
37 692 y(Meta)o(y)o(er)12 b([1991];)f(Kelsey)i([1989];)f(Kranz)g([1988];)f
(Steele)j([1978]\).)j(Though)12 b(the)h(STG)f(language)h(is)g(lazy)l(,)37
748 y(it)j(has)f(m)o(uc)o(h)g(the)g(same)g(\015a)o(v)o(our)f(as)g(CPS:)h
(nested)h(constructs)e(are)h(\015attened)g(to)g(an)g(explicit)i(sequence)37
805 y(of)d(simple)i(op)q(erations,)e(so)g(that)g(the)g(\015o)o(w)g(of)g(con)o
(trol)g(is)h(manifest,)f(and)h(there)f(is)h(a)f(direct)h(relationship)37
861 y(b)q(et)o(w)o(een)h(the)f(remaining)i(language)e(constructs)g(and)g
(individual)k(mac)o(hine)d(op)q(erations.)37 947 y(T)l(o)h(mak)o(e)f(the)h
(connection)g(explicit,)i(the)e(follo)o(wing)g(table)g(sho)o(ws)f(the)h
(appro)o(ximate)f(corresp)q(ondence)37 1003 y(b)q(et)o(w)o(een)g(the)g
(constructs)f(of)g(the)h(CPS)g(language)g(used)g(b)o(y)f(App)q(el)j(\(App)q
(el)e([1992]\),)e(and)h(those)h(of)f(the)37 1060 y(STG)g(language.)p
156 1104 1601 2 v 155 1161 2 57 v 181 1144 a Fn(Op)n(er)n(ation)p
858 1161 V 507 w(App)n(el)h(CPS)f(form)p 1233 1161 V 50 w(STG)h(form)p
1756 1161 V 156 1162 1601 2 v 156 1172 V 155 1229 2 57 v 181
1212 a Ft(Application)p 858 1229 V 473 w(APP)p 1233 1229 V
279 w(Application)p 1756 1229 V 156 1230 1601 2 v 155 1287
2 57 v 181 1270 a(Lo)q(cal)g(function)g(de\014nition)p 858
1287 V 216 w(FIX)p 1233 1287 V 1756 1287 V 156 1288 1078 2
v 155 1343 2 57 v 181 1326 a(Record)f(construction)p 858 1343
V 303 w(RECORD)p 1233 1343 V 175 w Fp(let\(rec\))p 1756 1343
V 156 1345 1078 2 v 155 1400 2 57 v 181 1383 a Ft(Th)o(unk)g(construction)p
858 1400 V 311 w(|)p 1233 1400 V 1756 1400 V 156 1401 1601
2 v 155 1458 2 57 v 181 1441 a(F)l(orcing)g(of)g(data)f(v)m(alues)p
858 1458 V 266 w(|)p 1233 1458 V 1756 1458 V 156 1459 1078
2 v 155 1514 2 57 v 181 1497 a(Selection)j(of)d(alternativ)o(e)p
858 1514 V 247 w(SWITCH)p 1233 1514 V 187 w Fp(case)h Ft(on)g(algebraic)h(t)o
(yp)q(es)p 1756 1514 V 156 1516 1078 2 v 155 1571 2 57 v 181
1554 a(Extraction)e(of)h(record)g(comp)q(onen)o(ts)p 858 1571
V 50 w(SELECT)p 1233 1571 V 1756 1571 V 156 1572 1601 2 v 155
1629 2 57 v 181 1612 a(Primitiv)o(e)h(op)q(erations)p 858 1629
V 296 w(PRIMOP)p 1233 1629 V 187 w Fp(case)f Ft(on)g(primitiv)o(e)i(t)o(yp)q
(es)p 1756 1629 V 156 1630 1601 2 v 37 1696 a(There)d(are)e(a)h(few)g(minor)g
(di\013erences)h(b)q(et)o(w)o(een)f(App)q(el's)h(CPS)f(and)g(the)g(STG)g
(language.)19 b(Firstly)l(,)14 b(CPS-)37 1752 y(based)k(implemen)o(tations)g
(usually)h(un)o(bundle)g Fp(case)d Ft(expressions)i(in)o(to)f(forcing,)h(m)o
(ulti-w)o(a)o(y)f(selection,)37 1809 y(and)i(extraction)g(of)f(the)g(comp)q
(onen)o(ts)h(of)f(the)g(data)g(v)m(alue.)31 b(These)19 b(are)f(all)i(bundled)
g(up)f(together)f(in)37 1865 y Fp(case)h Ft(expressions)h(whic)o(h,)h(as)e(w)
o(e)g(ha)o(v)o(e)g(seen,)h(can)g(b)q(e)g(used)g(to)e(adv)m(an)o(tage)h(b)o(y)
g(the)h(STG)e(mac)o(hine.)37 1922 y(Secondly)l(,)j(the)e(STG)f(language)h
(uses)g(a)f(single)i(construct,)f Fp(let\(rec\))o Ft(,)g(to)f(allo)q(cate)h
(function-v)m(alued)37 1978 y(and)14 b(data-v)m(alued)h(closures,)f(th)o(us)f
(allo)o(wing)i(arbitrary)e(m)o(utual)h(recursion)g(b)q(et)o(w)o(een)g(the)g
(t)o(w)o(o.)k(It)13 b(is)h(not)37 2034 y(so)h(clear)h(ho)o(w)f(to)f(ac)o
(hiev)o(e)i(this)g(using)g(App)q(el's)g(form)f(of)f(CPS.)37
2120 y(There)h(is)h(a)e(m)o(uc)o(h)h(more)f(imp)q(ortan)o(t)g(di\013erence)i
(though:)j(the)c(STG)f(language)h(is)g(not)g(a)f(contin)o(uation-)37
2177 y(passing)k(st)o(yle!)27 b(In)18 b(CPS,)f(ev)o(ery)g(user-de\014ned)i
(function)f(is)g(giv)o(en)g(an)f(extra)g(parameter,)g(namely)h(the)37
2233 y(contin)o(uation)e(to)f(apply)h(to)f(its)g(result.)20
b(F)l(or)15 b(example,)g(assuming)h(a)f(contin)o(uation)h Fp(k)p
Ft(,)e(the)i(expression)228 2319 y Fp(\(f)24 b(x\))g(+)f(y)37
2405 y Ft(w)o(ould)16 b(b)q(e)g(con)o(v)o(erted)f(to)f(the)i(CPS)f(form)228
2491 y Fp(f)24 b(x)g(\(\\fx.)f(+)h(fx)f(y)h(\(\\r.)f(k)h(r\)\))37
2577 y Ft(The)e(call)h(to)e Fp(f)h Ft(is)g(made)g(in)o(to)g(a)f(tail)i(call,)
h(passing)e(to)f Fp(f)g Ft(an)h(extra)f(argumen)o(t,)h(the)g(contin)o(uation)
37 2634 y Fp(\(\\fx.)i(+)f(fx)h(y)g(\(\\r.)f(k)h(r\)\))o Ft(.)k(This)18
b(contin)o(uation)h(sa)o(ys)e(what)g(to)g(do)h(after)f Fp(\(f)23
b(x\))18 b Ft(has)f(b)q(een)i(com-)37 2690 y(puted,)c(namely)g(add)f(the)g
(result)h(to)e Fp(y)h Ft(and)g(pass)g(that)g(v)m(alue)h(to)e
Fp(k)p Ft(.)20 b(In)14 b(con)o(trast,)f(the)h(STG)g(form)f(of)h(the)37
2747 y(same)h(expression)h(is:)934 2921 y(30)p eop
%%Page: 31 31
bop 228 199 a Fp(case)24 b(\(f)f(x\))h(of)228 256 y(MkInt)g(x#)f(->)h(case)f
(y)h(of)515 312 y(MkInt)f(y#)h(->)f(case)g(\(x#)h(+#)f(y#\))h(of)801
369 y(r#)g(->)f(MkInt)g(r#)37 455 y Ft(The)d(contin)o(uation)f(to)f(the)h
(call)h(to)e Fp(f)h Ft(is)g(passed)g Fn(implicitly)p Ft(;)h(when)f(ev)m
(aluation)i(of)d Fp(f)24 b(x)18 b Ft(is)i(complete,)37 511
y(con)o(trol)15 b(returns)g(to)f(the)h(second)g Fp(case)g Ft(expression.)20
b(The)15 b(second)h Fp(case)e Ft(ev)m(aluates)h Fp(y)p Ft(,)g(whic)o(h)g(of)g
(course)37 568 y(is)f(not)e(necessary)h(in)h(App)q(el's)g(w)o(orld)e(since)i
(SML)f(is)g(strict.)19 b(A)13 b(lazy)g(v)o(ersion)g(of)f(CPS)h(w)o(ould)g
(require)h(the)37 624 y(susp)q(ended)h(computation)d(inside)i(a)e(th)o(unk)g
(to)g(b)q(e)h(a)f(function)h(taking)g(a)f(contin)o(uation)h(as)f(its)g
(argumen)o(t.)37 680 y(So)k(the)f(CPS)g(form)g(w)o(ould)g(really)h(b)q(e)228
766 y Fp(f)24 b(x)g(\(\\fx.)f(force)g(y)h(\(\\yr.)f(+)h(fx)f(yr)h(\(\\r.)f(k)
h(r\)\)\))37 852 y Ft(where)13 b Fp(force)e Ft(is)h(the)g(function)h(whic)o
(h)g(forces)e(a)h(th)o(unk)g(\(its)f(\014rst)h(argumen)o(t\))f(b)o(y)g
(applying)j(it)e(to)f Fp(force)o Ft('s)37 909 y(second)16 b(argumen)o(t)f
(\(the)g(con)o(tin)o(uation\).)20 b(This)15 b(co)q(de)h(is)g(strikingly)g
(similar)h(to)d(the)h(STG)g(form)g(ab)q(o)o(v)o(e.)37 995 y(This)g
(di\013erence)g(in)g(the)g(w)o(a)o(y)e(in)h(whic)o(h)h(con)o(tin)o(uations)g
(are)f(handled)h(clearly)g(distinguishes)i(CPS)d(from)37 1051
y(the)i(STG)g(language,)g(but)g(it)g(is)g(quite)h(di\016cult)g(to)e(pin)i(do)
o(wn)f(all)h(the)f(implications)i(of)d(the)h(di\013erence.)37
1108 y(F)l(or)c(example,)g(the)g(CPS)g(v)o(ersion)g(has)f(a)h(natural)f(stac)
o(k-less)h(implemen)o(tation,)h(since)g(ev)o(ery)f(call)h(is)f(a)f(tail)37
1164 y(call.)23 b(On)16 b(the)g(other)f(hand,)h(it)g(ma)o(y)f(thereb)o(y)h
(incur)h(the)f(cost)f(of)g(heap-allo)q(cating)j(the)d(closure)i(for)e(the)37
1221 y(contin)o(uation,)k(and)e(passing)h(it)f(as)g(an)g(argumen)o(t)g(to)f
Fp(f)p Ft(.)26 b(The)17 b(STG)g(v)o(ersion)h(suggests)e(a)h(stac)o(k-based)37
1277 y(implemen)o(tation,)22 b(since)f(the)f(curren)o(t)f(activ)m(ation)h
(frame)g(con)o(tains)f(the)h(en)o(vironmen)o(t)g(in)g(whic)o(h)h(the)37
1334 y(contin)o(uation)16 b(should)g(b)q(e)g(executed.)21 b(But)15
b(of)f(course,)h(either)h(implemen)o(tation)g(is)g(p)q(ossible)h(from)d(b)q
(oth)37 1390 y(st)o(yles.)37 1476 y(The)j(STG)e(st)o(yle)h(also)g(seems)g(to)
f(b)q(e)i(more)e(natural)h(for)f(curried)i(function)g(application.)23
b(Consider)17 b(the)37 1532 y(call)i Fp(\(f)k(x)h(y\))p Ft(,)17
b(whic)o(h)h(is)f(left)g(unc)o(hanged)h(b)o(y)f(the)g(con)o(v)o(ersion)g(to)g
(the)g(STG)f(language.)26 b(If)17 b(con)o(v)o(erted)37 1589
y(to)c(CPS)h(\(assuming)f(that)g(the)h(call)g(itself)h(has)e(contin)o(uation)
h Fp(k)p Ft(\),)f(this)h(w)o(ould)g(generate)f(something)h(lik)o(e:)228
1675 y Fp(f)24 b(x)g(\(\\w.)f(w)h(k)g(y\))37 1761 y Ft(This)17
b(is)f(a)g(rather)f(exp)q(ensiv)o(e)j(and)e(clumsy)g(compilation)i(for)d(an)h
(ordinary)g(function)g(application!)24 b(W)l(e)37 1817 y(exp)q(ect)15
b(curried)f(function)h(application)g(to)e(b)q(e)h(p)q(erv)m(asiv)o(e,)h(so)e
(the)g(STG)h(language)f(pro)o(vides)h(it)g(as)f(prim-)37 1874
y(itiv)o(e.)37 1960 y(Of)18 b(course,)g(this)h(imp)q(oses)f(an)g(extra)f
(requiremen)o(t)h(on)g(the)g(co)q(de)g(generator)f(for)g(the)h(STG)f
(language:)37 2016 y(it)k(m)o(ust)e(cop)q(e)h(with)g(functions)h(applied)h
(to)d(more)g(or)h(few)o(er)f(argumen)o(ts)g(than)h(they)f(are)h(exp)q
(ecting.)37 2073 y(\(F)l(or)14 b(example)i Fp(f)f Ft(migh)o(t)g(tak)o(e)f
(one)h(argumen)o(t,)e Fp(x)p Ft(,)i(do)g(a)f(lot)h(of)f(computation,)h(and)g
(\014nally)h(reduce)g(to)e(a)37 2129 y(function)f(whic)o(h)f(tak)o(es)f(the)h
(second)g(argumen)o(t)e Fp(y)p Ft(.\))18 b(As)12 b(Section)g(5)g(will)h(sho)o
(w,)e(though,)h(graph)f(reduction)37 2186 y(giv)o(es)16 b(a)f(natural)g(w)o
(a)o(y)f(to)h(pro)o(vide)g(this)h(functionalit)o(y)l(.)37 2272
y(In)21 b(summary)l(,)f(the)g(STG)g(language)g(has)g(a)f(similar)i(\015a)o(v)
o(our)e(to)g(CPS,)h(but)g(is)g(a)g(little)h(less)f(extreme.)37
2328 y(So)c(far)f(w)o(e)g(ha)o(v)o(e)h(not)f(disco)o(v)o(ered)h(an)o(y)f(opp)
q(ortunities)i(for)e(optimisation)h(whic)o(h)h(are)e(exp)q(osed)h(b)o(y)g
(CPS)37 2384 y(but)e(hidden)h(b)o(y)e(the)g(STG)g(language.)20
b(\(Consel)13 b(&)h(Dan)o(vy)e([1991])g(sho)o(w)h(that)f(transforming)h(the)g
(source)37 2441 y(program)d(to)g(CPS)h(ma)o(y)e(impro)o(v)o(e)i(the)g
(accuracy)f(of)h(some)f(analyses;)i(w)o(e)e(ha)o(v)o(e)h(not)f(in)o(v)o
(estigated)h(whether)37 2497 y(or)k(not)g(the)g(STG)g(language)h(has)f(a)g
(similar)h(prop)q(ert)o(y)l(.\))934 2921 y(31)p eop
%%Page: 32 32
bop 37 199 a Fs(5)67 b(Op)r(erational)24 b(seman)n(tics)e(of)f(the)i(STG)f
(language)37 330 y Ft(The)14 b(STG)f(language)g(is)g(the)g(abstract)f(mac)o
(hine)i(co)q(de)g(for)e(the)h(STG)g(mac)o(hine.)20 b(In)14
b(this)f(section)h(w)o(e)f(giv)o(e)37 387 y(a)i(direct)h(op)q(erational)g
(seman)o(tics)f(for)g(the)g(STG)g(language)h(using)f(a)g(state)g(transition)g
(system.)37 473 y(A)h(state)f(transition)h(seman)o(tics)g(sp)q(eci\014es)i
(\(a\))c(an)i(initial)i(state)d(for)g(the)h(mac)o(hine,)g(and)g(\(b\))g(a)f
(series)h(of)37 529 y(state)f(transition)h(rules.)22 b(Eac)o(h)15
b(rule)h(sp)q(eci\014es)i(a)d(set)g(of)g(source)h(states)e(and)i(the)g
(corresp)q(onding)g(target)37 586 y(states)11 b(after)g(the)g(transition)h
(has)f(tak)o(en)g(place.)20 b(The)11 b(set)h(of)f(source)g(states)g(is)h(sp)q
(eci\014ed)h(implicitly)l(,)i(using)37 642 y(pattern-matc)o(hing)j(and)f
(guard)g(conditions;)j(if)d(a)g(state)g(is)h(in)g(the)g(source)f(set)g(for)g
(a)g(giv)o(en)h(transition)37 699 y(rule)h(w)o(e)e(sa)o(y)g(that)f(the)i
(rule)g Fn(matches)g Ft(the)f(state.)26 b(A)o(t)17 b(most)f(one)i(transition)
g(rule)g(should)g(matc)o(h)f(an)o(y)37 755 y(giv)o(en)f(state,)e(and)i(if)f
(no)g(rule)h(matc)o(hes,)f(the)g(mac)o(hine)h(halts.)37 841
y(The)g(state)e(has)h(\014v)o(e)h(comp)q(onen)o(ts:)93 964
y(1.)22 b(the)15 b Fn(c)n(o)n(de)p Ft(,)g(whic)o(h)h(tak)o(es)e(one)i(of)e
(sev)o(eral)i(forms,)e(giv)o(en)h(b)q(elo)o(w;)93 1058 y(2.)22
b(the)15 b Fn(ar)n(gument)i(stack)p Ft(,)d Fn(as)t Ft(,)h(whic)o(h)h(con)o
(tains)f Fn(values)p Ft(;)93 1152 y(3.)22 b(the)15 b Fn(r)n(eturn)i(stack)p
Ft(,)d Fn(rs)t Ft(,)g(whic)o(h)i(con)o(tains)g Fn(c)n(ontinuations)p
Ft(;)93 1246 y(4.)22 b(the)15 b Fn(up)n(date)i(stack)p Ft(,)e
Fn(us)t Ft(,)f(whic)o(h)j(con)o(tains)e Fn(up)n(date)i(fr)n(ames)p
Ft(;)93 1340 y(5.)22 b(the)15 b Fn(he)n(ap)p Ft(,)g Fn(h)s
Ft(,)h(whic)o(h)g(con)o(tains)f(\(only\))g Fn(closur)n(es)p
Ft(;)93 1433 y(6.)22 b(the)15 b Fn(glob)n(al)g(envir)n(onment)p
Ft(,)e Fq(\033)r Ft(,)h(whic)o(h)h(giv)o(es)g(the)g(addresses)g(of)f(all)h
(closures)h(de\014ned)g(at)e(top)g(lev)o(el.)37 1557 y Fn(Se)n(quenc)n(es)g
Ft(are)i(used)g(extensiv)o(ely)h(in)f(what)g(follo)o(ws.)21
b(They)16 b(are)f(denoted)i(using)f(curly)g(brac)o(k)o(ets,)f(th)o(us)37
1613 y Fo(f)p Fn(a)83 1620 y Fl(1)107 1613 y Fq(;)8 b(:)g(:)g(:)d(;)j
Fn(a)232 1620 y Fl(n)255 1613 y Fo(g)p Ft(.)19 b(The)13 b(empt)o(y)g
(sequence)h(is)g(denoted)f Fo(fg)p Ft(;)g(if)h Fn(as)i Ft(and)e
Fn(bs)i Ft(are)d(t)o(w)o(o)e(sequences)k(then)e Fn(as)j Ft(+)-23
b(+)14 b Fn(bs)37 1670 y Ft(is)i(their)f(concatenation;)g(and)g
Fn(a)h Ft(:)c Fn(as)19 b Ft(denotes)c(the)g(sequence)h(obtained)f(b)o(y)g
(adding)g(the)g(item)g Fn(a)k Ft(to)14 b(the)37 1726 y(b)q(eginning)k(of)d
(the)g(sequence)h Fn(as)t Ft(.)k(The)15 b(length)h(of)f(a)g(sequence)h
Fn(as)j Ft(is)c(denoted)h Fn(length)s Ft(\()p Fn(as)t Ft(\).)37
1812 y(A)g Fn(value)f Ft(tak)o(es)f(one)i(of)e(the)i(follo)o(wing)g(forms:)
611 1894 y Fn(A)n(ddr)k(a)54 b Ft(A)15 b(heap)h(address)611
1951 y Fn(Int)j(n)90 b Ft(A)15 b(primitiv)o(e)i(in)o(teger)e(v)m(alue)37
2033 y(In)j(the)f(op)q(erational)g(seman)o(tics,)g(v)m(alues)g(are)g(tagged)f
(with)h Fn(A)n(ddr)k Ft(and)c Fn(Int)j Ft(and)d(so)f(on)h(to)f(distinguish)37
2089 y(these)21 b(di\013eren)o(t)g(kinds)h(of)e(v)m(alue.)38
b(W)l(e)20 b(discuss)i(later)f(w)o(a)o(ys)e(to)h(a)o(v)o(oid)h(actually)g
(implemen)o(ting)i(this)37 2146 y(tagging)16 b(in)h(a)e(real)i(implemen)o
(tation)g(\(Section)f(8\).)22 b(W)l(e)16 b(could)h(add)f(further)g(forms)f
(of)h(v)m(alue)h(for)e(other)37 2202 y(primitiv)o(e)e(data)d(t)o(yp)q(es,)h
(suc)o(h)g(as)f(\015oating-p)q(oin)o(t)i(n)o(um)o(b)q(ers,)f(but)g(they)g
(are)f(handled)j(exactly)e(analogously)37 2259 y(to)k(in)o(tegers,)g(so)g(w)o
(e)g(omit)g(them)g(to)f(reduce)j(clutter.)37 2345 y(W)l(e)f(use)f
Fn(w)5 b Fq(;)j Fn(w)280 2352 y Fl(1)303 2345 y Fq(;)g(:)g(:)g(:)m
Ft(,)15 b(to)g(range)g(o)o(v)o(er)f(v)m(alues,)i(and)f Fn(ws)k
Ft(to)c(range)f(o)o(v)o(er)h(sequences)h(of)f(v)m(alues.)37
2431 y(The)h Fn(ar)n(gument)g(stack)p Ft(,)e Fn(as)t Ft(,)g(is)h(just)g(a)f
(sequence)i(of)e(v)m(alues.)21 b(The)15 b(\\top")f(of)h(the)g(stac)o(k)f(is)h
(the)g(b)q(eginning)37 2487 y(of)f(the)g(sequence.)21 b(The)14
b(return)g(stac)o(k)g(and)g(up)q(date)g(stac)o(k)g(will)h(b)q(e)g(dealt)g
(with)f(later)g(\(Sections)h(5.4)e(and)37 2543 y(5.6)i(resp)q(ectiv)o(ely\).)
37 2629 y(The)f Fn(he)n(ap)p Ft(,)f Fn(h)s Ft(,)g(is)h(a)e(mapping)i(from)e
Fn(addr)n(esses)p Ft(,)g(ranged)h(o)o(v)o(er)f(b)o(y)h Fn(a)s
Fq(;)8 b Fn(a)1247 2636 y Fl(1)1270 2629 y Fq(;)g(:)g(:)g(:)n
Ft(,)k(to)h Fn(closur)n(es)p Ft(.)18 b(Ev)o(ery)12 b(closure)37
2686 y(is)k(of)f(the)g(form)769 2742 y(\()p Fn(vs)j Fp(\\)p
Fq(\031)f Fn(xs)i Fp(->)14 b Fn(e)s Ft(\))i Fn(ws)934 2921
y Ft(32)p eop
%%Page: 33 33
bop 37 199 a Ft(In)o(tuitiv)o(ely)l(,)14 b(the)c(lam)o(b)q(da-form)h(\()p
Fn(vs)i Fp(\\)p Fq(\031)f Fn(xs)i Fp(->)c Fn(e)s Ft(\))g(denotes)h(the)g(co)q
(de)g(of)f(the)g(closure,)i(while)g(the)f(sequence)37 256 y(of)16
b(v)m(alues)g Fn(ws)j Ft(giv)o(es)d(the)g(v)m(alue)h(of)e(eac)o(h)h(of)f(the)
g(free)h(v)m(ariables)h Fn(vs)t Ft(.)j(\(W)l(e)15 b(use)h Fq(\031)h
Ft(to)e(range)h(o)o(v)o(er)e(up)q(date)37 312 y(\015ags,)19
b(whic)o(h)h(can)f(b)q(e)g(either)g Fp(u)g Ft(or)f Fp(n)p Ft(.\))30
b(This)19 b(is)g(exactly)g(the)g(uniform)g(represen)o(tation)g(discussed)h
(in)37 369 y(Section)d(3.1.3.)37 455 y(The)e Fn(glob)n(al)g(envir)n(onment)f
Ft(comp)q(onen)o(t)g(of)h(the)g(state,)e Fq(\033)r Ft(,)h(maps)g(the)h(name)g
(of)f(eac)o(h)h(v)m(ariable)h(b)q(ound)g(at)37 511 y(the)f(top)g(lev)o(el)h
(of)e(the)h(program)f(to)g(the)h(address)g(of)g(its)g(closure.)20
b(These)15 b(closures)h(can)f(all)g(b)q(e)h(allo)q(cated)37
568 y(once)i(and)f(for)g(all)h(b)q(efore)f(execution)i(b)q(egins.)27
b(\(Indeed,)18 b(unlik)o(e)h(the)e(other)g(comp)q(onen)o(ts,)g
Fq(\033)i Ft(do)q(es)e(not)37 624 y(c)o(hange)e(during)h(execution.\))k(The)
15 b(STG)g(mac)o(hine)g(is)h(un)o(usual)f(in)h(binding)g(globals)g(to)e
Fn(closur)n(es)g Ft(rather)37 680 y(than)e(to)g(co)q(de)g(sequences.)20
b(It)12 b(is)h(imp)q(ortan)o(t)e(to)h(do)g(so,)f(ho)o(w)o(ev)o(er,)h(b)q
(ecause)h(a)f(global)g(ma)o(y)f(b)q(e)i(up)q(datable,)37 737
y(so)i(there)h(m)o(ust)e(b)q(e)i(a)f(closure)h(to)e(up)q(date!)37
823 y(As)22 b(w)o(e)f(discussed)h(earlier,)i(it)d(is)h(p)q(ossible)h(to)d
(share)h(the)h(co)q(de)g(for)e(standard-constructor)g(closures)37
879 y(\(Section)j(4.4\).)40 b(In)22 b(the)h(sp)q(ecial)h(case)e(of)g
(constructors)f(with)h(no)g(argumen)o(ts)g(\(suc)o(h)g(as)g
Fp(Nil)o Ft(\))g(it)g(is)37 936 y(p)q(ossible)f(to)d(share)h(not)f(just)g
(the)h(co)q(de)g(for)f(the)h(closure,)h(but)f(the)f(closure)i(itself.)31
b(F)l(or)18 b(example,)i(all)37 992 y(references)15 b(to)f
Fp(Nil)g Ft(can)g(use)h(the)f(address)g(of)g(a)g(single)h(global)g(closure.)
21 b(This)14 b(is)h(easily)g(done)g(b)o(y)f(adding)37 1049
y(niladic)k(constructors)13 b(as)i(a)f(p)q(ossible)j(form)d(of)g
Fn(atom)19 b Ft(\(Figure)c(3\),)f(and)h(extending)h Fq(\033)g
Ft(with)f(the)g(address)37 1105 y(of)d(a)g(suitable)i(closure)f(for)e(eac)o
(h)i(niladic)h(constructor.)19 b(F)l(or)11 b(the)i(sak)o(e)e(of)h(simplicit)o
(y)l(,)j(w)o(e)d(do)g(not)g(p)q(erform)37 1162 y(this)k(optimisation)g(in)g
(the)f(op)q(erational)h(seman)o(tics)f(whic)o(h)h(follo)o(ws.)37
1248 y(Finally)l(,)h(the)e Fn(c)n(o)n(de)g Ft(comp)q(onen)o(t)g(of)g(the)g
(state)g(tak)o(es)f(one)h(of)g(the)g(follo)o(wing)h(four)f(forms,)f(eac)o(h)h
(of)g(whic)o(h)37 1304 y(is)h(accompanied)g(b)o(y)g(its)f(in)o(tuitiv)o(e)h
(meaning:)318 1386 y Fn(Eval)j(e)g Fq(\032)207 b Ft(Ev)m(aluate)22
b(the)f(expression)h Fn(e)j Ft(in)d(en)o(vironmen)o(t)f Fq(\032)695
1443 y Ft(and)d(apply)h(its)g(v)m(alue)g(to)f(the)g(argumen)o(ts)f(on)i(the)
695 1499 y(argumen)o(t)c(stac)o(k.)22 b(The)16 b(expression)h
Fn(e)i Ft(is)e(an)f(arbi-)695 1555 y(trarily)f(complex)h(STG-language)f
(expression.)318 1668 y Fn(Enter)k(a)223 b Ft(Apply)21 b(the)e(closure)i(at)e
(address)h Fn(a)j Ft(to)c(the)h(argu-)695 1725 y(men)o(ts)15
b(on)g(the)g(argumen)o(t)f(stac)o(k.)318 1838 y Fn(R)n(eturnCon)k(c)f(ws)54
b Ft(Return)13 b(the)h(constructor)e Fn(c)j Ft(applied)g(to)e(v)m(alues)h
Fn(ws)695 1894 y Ft(to)g(the)i(contin)o(uation)f(on)h(the)f(return)g(stac)o
(k.)318 2007 y Fn(R)n(eturnInt)j(k)143 b Ft(Return)13 b(the)g(primitiv)o(e)i
(in)o(teger)e Fn(k)k Ft(to)c(the)g(contin)o(u-)695 2064 y(ation)i(on)g(the)g
(return)g(stac)o(k.)37 2148 y(The)f Fn(lo)n(c)n(al)g(envir)n(onment)p
Ft(,)e Fq(\032)p Ft(,)h(maps)h(v)m(ariable)h(names)e(to)g Fn(values)p
Ft(.)19 b(The)14 b(notation)f Fq(\032)p Ft([)p Fn(v)j Fo(7!)e
Fn(w)5 b Ft(])13 b(extends)h(the)37 2205 y(map)f Fq(\032)g
Ft(with)g(a)g(mapping)h(of)f(the)g(v)m(ariable)i Fn(v)i Ft(to)c(v)m(alue)h
Fn(w)5 b Ft(.)19 b(This)14 b(notation)f(also)g(extends)h(in)g(the)f(ob)o
(vious)37 2261 y(w)o(a)o(y)i(to)f(sequences)j(of)d(v)m(ariables)j(and)e(v)m
(alues;)h(for)f(example)h Fq(\032)p Ft([)p Fn(vs)f Fo(7!)e
Fn(ws)t Ft(].)37 2347 y(The)j Fn(val)k Ft(function)c(tak)o(es)e(an)h(atom)f
(\(Figure)h(3\))g(and)g(deliv)o(ers)i(a)e(v)m(alue:)559 2448
y Fn(val)46 b Fq(\032)41 b(\033)i Fn(k)k Ft(=)41 b Fn(Int)19
b(k)559 2504 y(val)46 b Fq(\032)41 b(\033)i Fn(v)k Ft(=)41
b Fq(\032)15 b Fn(v)85 b Ft(if)16 b Fn(v)h Fo(2)c Fn(dom)s
Ft(\()p Fq(\032)p Ft(\))863 2561 y(=)41 b Fq(\033)17 b Fn(v)81
b Ft(otherwise)37 2659 y(If)18 b(the)f(atom)g(is)g(a)g(literal)i
Fn(k)5 b Ft(,)17 b Fn(val)k Ft(returns)d(a)e(primitiv)o(e)j(in)o(teger)e(v)m
(alue.)28 b(If)17 b(it)h(is)f(a)g(v)m(ariable,)i Fn(val)j Ft(lo)q(oks)37
2715 y(it)f(up)f(in)h Fq(\032)e Ft(or)g Fq(\033)j Ft(as)d(appropriate.)34
b Fn(val)24 b Ft(extends)d(in)f(the)g(ob)o(vious)h(w)o(a)o(y)d(to)i
(sequences)h(of)e(v)m(ariables:)37 2772 y Fn(val)h Fq(\032)15
b(\033)i Fn(vs)h Ft(is)e(the)f(sequence)h(of)f(v)m(alues)h(to)f(whic)o(h)h
Fn(val)k Fq(\032)14 b(\033)j Ft(maps)e(the)g(v)m(ariables)i
Fn(vs)t Ft(.)934 2921 y(33)p eop
%%Page: 34 34
bop 37 199 a Fm(5.1)56 b(The)19 b(initial)e(state)37 315 y
Ft(W)l(e)h(b)q(egin)h(b)o(y)e(sp)q(ecifying)j(the)d(initial)j(state)c(of)h
(the)h(STG)f(mac)o(hine.)27 b(The)18 b(general)g(form)f(of)g(an)g(STG)37
371 y(program)e(is)g(as)g(follo)o(ws:)358 453 y Fn(g)379 460
y Fl(1)453 453 y Fp(=)g Fn(vs)532 460 y Fl(1)570 453 y Fp(\\)p
Fq(\031)620 460 y Fl(1)658 453 y Fn(xs)698 460 y Fl(1)736 453
y Fp(->)g Fn(e)820 460 y Fl(1)358 510 y Fq(:)8 b(:)g(:)358
566 y Fn(g)379 573 y Fl(n)453 566 y Fp(=)15 b Fn(vs)532 573
y Fl(n)570 566 y Fp(\\)p Fq(\031)620 573 y Fl(n)659 566 y Fn(xs)699
573 y Fl(n)738 566 y Fp(->)g Fn(e)822 573 y Fl(n)37 648 y Ft(One)f(of)e(the)h
Fn(g)277 655 y Fl(i)305 648 y Ft(will)i(b)q(e)e Fp(main)o Ft(.)19
b(Giv)o(en)14 b(this)f(program,)f(the)g(corresp)q(onding)i(initial)h(state)d
(of)g(the)h(mac)o(hine)37 705 y(is:)p 337 710 1239 2 v 336
767 2 57 v 758 750 a Fn(A)o(r)n(g)74 b(R)n(eturn)45 b(Up)n(date)p
1575 767 V 336 823 V 358 806 a(Co)n(de)302 b(stack)46 b(stack)82
b(stack)h(He)n(ap)44 b(Glob)n(als)p 1575 823 V 336 880 V 1575
880 V 336 936 V 358 919 a(Eval)19 b Ft(\()p Fp(main)14 b Fo(fg)p
Ft(\))h Fo(fg)41 b(fg)99 b(fg)135 b(fg)h Fn(h)1289 926 y Fl(init)1409
919 y Fq(\033)p 1575 936 V 336 993 V 1575 993 V 336 1341 2
349 v 358 1091 a Ft(where)36 b Fq(\033)96 b Ft(=)708 994 y
Fg(2)708 1067 y(6)708 1094 y(4)757 1035 y Fn(g)778 1042 y Fl(1)814
1035 y Fo(7!)13 b Ft(\()p Fn(A)n(ddr)20 b(a)1030 1042 y Fl(1)1053
1035 y Ft(\))757 1091 y Fq(:)8 b(:)g(:)757 1148 y Fn(g)778
1155 y Fl(n)814 1148 y Fo(7!)13 b Ft(\()p Fn(A)n(ddr)20 b(a)1030
1155 y Fl(n)1054 1148 y Ft(\))1093 994 y Fg(3)1093 1067 y(7)1093
1094 y(5)510 1266 y Fn(h)533 1273 y Fl(init)632 1266 y Ft(=)708
1169 y Fg(2)708 1242 y(6)708 1268 y(4)757 1209 y Fn(a)780 1216
y Fl(1)816 1209 y Fo(7!)13 b Ft(\()p Fn(vs)932 1216 y Fl(1)970
1209 y Fp(\\)p Fq(\031)1020 1216 y Fl(1)1058 1209 y Fn(xs)1098
1216 y Fl(1)1137 1209 y Fp(->)h Fn(e)1220 1216 y Fl(1)1244
1209 y Ft(\))h(\()p Fq(\033)h Fn(vs)1377 1216 y Fl(1)1400 1209
y Ft(\))757 1266 y Fq(:)8 b(:)g(:)757 1322 y Fn(a)780 1329
y Fl(n)817 1322 y Fo(7!)13 b Ft(\()p Fn(vs)933 1329 y Fl(n)971
1322 y Fp(\\)p Fq(\031)1021 1329 y Fl(n)1059 1322 y Fn(xs)1099
1329 y Fl(n)1138 1322 y Fp(->)i Fn(e)1222 1329 y Fl(n)1246
1322 y Ft(\))g(\()p Fq(\033)h Fn(vs)1379 1329 y Fl(n)1402 1322
y Ft(\))1441 1169 y Fg(3)1441 1242 y(7)1441 1268 y(5)p 1575
1341 V 336 1398 2 57 v 1575 1398 V 337 1400 1239 2 v 37 1462
a Ft(W)l(e)j(write)f(a)g(mac)o(hine)i(state)d(as)h(a)g(horizon)o(tal)h(ro)o
(w)e(of)h(its)h(comp)q(onen)o(ts,)g(sometimes)f(with)h(auxiliary)37
1519 y(de\014nitions)c(\(as)d(here\))h(in)o(tro)q(duced)h(b)o(y)f(a)g
(\\where")f(clause.)20 b(In)14 b(this)f(initial)i(state,)d(the)h(co)q(de)h
(comp)q(onen)o(t)37 1575 y(sa)o(ys)h(that)g Fp(main)g Ft(is)i(to)e(b)q(e)h
(ev)m(aluated)h(in)f(the)g(empt)o(y)f(lo)q(cal)i(en)o(vironmen)o(t;)f(the)g
(argumen)o(t,)e(return)i(and)37 1632 y(up)q(date)j(stac)o(ks)e(are)h(empt)o
(y;)h(the)f(initial)i(heap,)f Fn(h)928 1639 y Fl(init)985 1632
y Ft(,)f(con)o(tains)g(a)g(closure)h(for)e(eac)o(h)h(global;)i(and)e(the)37
1688 y(global)e(en)o(vironmen)o(t,)f Fq(\033)r Ft(,)g(binds)h(eac)o(h)g
(global)f(to)g(its)g(closure.)37 1774 y(Notice)h(that)f(the)g(v)m(alues)i(in)
f(the)g(range)f(of)g(the)g(global)h(en)o(vironmen)o(t)g(are)f(all)h
Fn(addr)n(esses)p Ft(.)k(This)c(re\015ects)37 1830 y(the)g(fact)e(that)h
(global)h(v)m(ariables)g(are)f(alw)o(a)o(ys)g(b)q(o)o(xed.)37
1982 y Fm(5.2)56 b(Applications)37 2097 y Ft(W)l(e)16 b(b)q(egin)g(the)g
(main)f(op)q(erational)h(seman)o(tics)f(with)h(the)f(rule)h(for)f
(applications.)37 2322 y(\(1\))p 111 2141 1091 2 v 110 2254
2 113 v 328 2220 a Fn(Eval)k Ft(\()p Fn(f)25 b(xs)t Ft(\))14
b Fq(\032)329 b Fn(as)24 b(rs)h(us)f(h)h Fq(\033)p 1201 2254
V 110 2367 V 121 2333 a Ft(suc)o(h)16 b(that)k Fn(val)f Fq(\032)c(\033)i
Fn(f)22 b Ft(=)13 b Fn(A)n(ddr)20 b(a)p 1201 2367 V 110 2480
V 121 2446 a Ft(=)-8 b Fo(\))135 b Fn(Enter)19 b(a)129 b Ft(\()p
Fn(val)19 b Fq(\032)c(\033)i Fn(xs)t Ft(\))11 b(+)-23 b(+)14
b Fn(as)24 b(rs)h(us)f(h)h Fq(\033)p 1201 2480 V 111 2482 1091
2 v 37 2547 a Ft(The)c(top)f(line)i(of)d(the)i(rule)g(giv)o(es)f(the)g(state)
g(b)q(efore)g(the)g(transition,)i(while)f(the)g(b)q(ottom)e(line)j(giv)o(es)
37 2603 y(the)17 b(state)e(afterw)o(ards.)22 b(W)l(e)16 b(use)h(a)f
(pattern-matc)o(hing)g(notation)g(for)g(the)g(top)g(line.)25
b(In)17 b(this)g(case,)f(the)37 2660 y(rule)h(only)g(matc)o(hes)e(if)h(the)g
(co)q(de)h(comp)q(onen)o(t)f(is)g(an)g Fn(Eval)k Ft(of)15 b(an)h(expression)h
(of)e(the)h(giv)o(en)h(form.)k(The)37 2716 y(\\suc)o(h)16 b(that")e(clause)i
(further)f(constrains)h(the)f(rule)h(to)e(the)i(case)f(where)h
Fn(f)24 b Ft(is)16 b(b)q(ound)g(to)f(the)g(address)g(of)37
2773 y(a)g(closure)h(\(and)f(not)g(to)g(a)g(primitiv)o(e)h(v)m(alue\).)934
2921 y(34)p eop
%%Page: 35 35
bop 37 199 a Ft(The)14 b(rule)g(sa)o(ys)e(that)g(to)h(p)q(erform)g(a)f(tail)i
(call,)g(the)f(v)m(alues)i(of)d(the)h(argumen)o(ts)g(are)f(put)i(on)f(the)g
(argumen)o(t)37 256 y(stac)o(k,)i(and)g(the)h(v)m(alue)g(of)f(the)h(function)
g(is)g(en)o(tered.)k(The)c(function)g(is)g(exp)q(ected)g(to)f(b)q(e)h(a)f
(closure;)h(the)37 312 y(other)g(case,)g(when)g Fn(f)26 b Ft(is)16
b(not)g(an)g(address)g(but)g(rather)g(is)g(a)g(primitiv)o(e)h(v)m(alue)g
(instead,)g(is)f(dealt)h(with)f(in)37 369 y(Section)f(5.5.)k(Notice)14
b(that)g(the)g(lo)q(cal)h(en)o(vironmen)o(t)f(is)g(discarded)h(at)f(this)g(p)
q(oin)o(t;)h(in)f(general,)h(the)f(lo)q(cal)37 425 y(en)o(vironmen)o(t)i
(only)g(has)f(a)g(v)o(ery)g(lo)q(cal)h(lifetime.)37 511 y(The)f(next)f(thing)
g(to)f(discuss)i(is)f(the)g(rule)h(for)e(en)o(tering)i(a)e(closure.)20
b(W)l(e)14 b(giv)o(e)g(only)h(the)f(rule)g(for)g(en)o(tering)37
568 y Fn(non-up)n(datable)i Ft(closures;)f(the)h(rule)g(for)e(up)q(datable)j
(closures)e(is)h(giv)o(en)g(in)g(Section)g(5.6.)37 897 y(\(2\))p
111 612 1209 2 v 110 725 2 113 v 328 691 a Fn(Enter)j(a)48
b(as)24 b(rs)g(us)h(h)s Ft([)p Fn(a)16 b Fo(7!)d Ft(\()p Fn(vs)18
b Fp(\\n)d Fn(xs)k Fp(->)c Fn(e)s Ft(\))g Fn(ws)1229 698 y
Fl(f)1248 691 y Ft(])20 b Fq(\033)p 1318 725 V 110 838 V 121
804 a Ft(suc)o(h)c(that)k Fn(length)s Ft(\()p Fn(as)t Ft(\))11
b Fo(\025)i Fn(length)s Ft(\()p Fn(xs)t Ft(\))p 1318 838 V
110 950 V 121 917 a(=)-8 b Fo(\))135 b Fn(Eval)19 b(e)g Fq(\032)h
Fn(as)564 900 y Ff(0)596 917 y Fn(rs)k(us)h(h)532 b Fq(\033)p
1318 950 V 110 1159 2 209 v 121 1029 a Ft(where)101 b Fn(ws)387
1036 y Fl(a)422 1029 y Ft(+)-23 b(+)13 b Fn(as)528 1013 y Ff(0)586
1029 y Ft(=)21 b Fn(as)338 1086 y(length)s Ft(\()p Fn(ws)526
1093 y Fl(a)547 1086 y Ft(\))g(=)g Fn(length)s Ft(\()p Fn(xs)t
Ft(\))338 1142 y Fq(\032)224 b Ft(=)21 b([)p Fn(vs)15 b Fo(7!)f
Fn(ws)818 1149 y Fl(f)836 1142 y Fq(;)23 b Fn(xs)16 b Fo(7!)d
Fn(ws)1035 1149 y Fl(a)1057 1142 y Ft(])p 1318 1159 V 111 1161
1209 2 v 37 1226 a(When)i(a)e(non-up)q(datable)i(closure)g(is)f(en)o(tered,)g
(the)g(lo)q(cal)g(en)o(vironmen)o(t)g(is)h(constructed)e(b)o(y)h(binding)i
(its)37 1283 y(free)h(v)m(ariables)h(to)e(the)g(v)m(alues,)i
Fn(ws)651 1290 y Fl(f)670 1283 y Ft(,)e(found)h(in)h(the)e(closure,)h(and)g
(its)g(argumen)o(ts)e(to)h(the)h(v)m(alues,)g Fn(ws)1840 1290
y Fl(a)1862 1283 y Ft(,)37 1339 y(found)h(on)f(the)h(stac)o(k.)25
b(Then)17 b(the)h(b)q(o)q(dy)g(of)e(the)i(closure)g(is)f(ev)m(aluated)i(in)f
(this)f(en)o(vironmen)o(t.)27 b(In)18 b(this)37 1396 y(rule)f(w)o(e)d(use)i
(a)f(\\where")g(clause)h(to)e(giv)o(e)i(v)m(alues)g(to)f(v)m(ariables)h(used)
g(in)g(the)f(result)h(state)e(of)h(the)g(rule.)37 1547 y Fm(5.3)56
b Fe(let\(rec\))16 b Fm(expressions)37 1662 y Ft(As)g(men)o(tioned)g
(earlier,)f(a)g Fp(let)g Ft(expression)h(constructs)f(one)g(or)g(more)g
(closures)g(in)i(the)e(heap.)37 2050 y(\(3\))p 111 1706 1255
2 v 110 1932 2 226 v 258 1831 a Fn(Eval)372 1709 y Fg(0)372
1782 y(B)372 1807 y(B)372 1832 y(B)372 1858 y(@)408 1746 y
Fp(let)36 b Fn(x)537 1753 y Fl(1)576 1746 y Fp(=)15 b Fn(vs)655
1753 y Fl(1)693 1746 y Fp(\\)p Fq(\031)743 1753 y Fl(1)782
1746 y Fn(xs)822 1753 y Fl(1)860 1746 y Fp(->)g Fn(e)944 1753
y Fl(1)516 1802 y Fq(:)8 b(:)g(:)516 1859 y Fn(x)537 1866 y
Fl(n)576 1859 y Fp(=)16 b Fn(vs)656 1866 y Fl(n)694 1859 y
Fp(\\)p Fq(\031)744 1866 y Fl(n)783 1859 y Fn(xs)823 1866 y
Fl(n)861 1859 y Fp(->)f Fn(e)945 1866 y Fl(n)408 1915 y Fp(in)g
Fn(e)969 1709 y Fg(1)969 1782 y(C)969 1807 y(C)969 1832 y(C)969
1858 y(A)1028 1831 y Fq(\032)20 b Fn(as)25 b(rs)f(us)g(h)36
b Fq(\033)p 1365 1932 V 110 2045 2 113 v 121 2011 a Ft(=)-8
b Fo(\))65 b Fn(Eval)20 b(e)e Fq(\032)428 1995 y Ff(0)1072
2011 y Fn(as)25 b(rs)f(us)g(h)1294 1995 y Ff(0)1327 2011 y
Fq(\033)p 1365 2045 V 110 2372 2 327 v 121 2124 a Ft(where)32
b Fq(\032)293 2108 y Ff(0)363 2124 y Ft(=)21 b Fq(\032)p Ft([)p
Fn(x)477 2131 y Fl(1)513 2124 y Fo(7!)13 b Fn(A)n(ddr)20 b(a)711
2131 y Fl(1)735 2124 y Fq(;)8 b(:)g(:)g(:)t(;)g Fn(x)857 2131
y Fl(n)893 2124 y Fo(7!)13 b Fn(A)n(ddr)20 b(a)1091 2131 y
Fl(n)1115 2124 y Ft(])269 2240 y Fn(h)295 2223 y Ff(0)363 2240
y Ft(=)h Fn(h)454 2143 y Fg(2)454 2216 y(6)454 2242 y(4)492
2183 y Fn(a)515 2190 y Fl(1)551 2183 y Fo(7!)13 b Ft(\()p Fn(vs)667
2190 y Fl(1)705 2183 y Fp(\\)p Fq(\031)755 2190 y Fl(1)793
2183 y Fn(xs)833 2190 y Fl(1)872 2183 y Fp(->)h Fn(e)955 2190
y Fl(1)979 2183 y Ft(\))h(\()p Fq(\032)1054 2190 y Fl(rhs)1118
2183 y Fn(vs)1158 2190 y Fl(1)1181 2183 y Ft(\))492 2240 y
Fq(:)8 b(:)g(:)492 2296 y Fn(a)515 2303 y Fl(n)551 2296 y Fo(7!)14
b Ft(\()p Fn(vs)668 2303 y Fl(n)706 2296 y Fp(\\)p Fq(\031)756
2303 y Fl(n)794 2296 y Fn(xs)834 2303 y Fl(n)873 2296 y Fp(->)h
Fn(e)957 2303 y Fl(n)981 2296 y Ft(\))f(\()p Fq(\032)1055 2303
y Fl(rhs)1120 2296 y Fn(vs)1160 2303 y Fl(n)1184 2296 y Ft(\))1212
2143 y Fg(3)1212 2216 y(7)1212 2242 y(5)269 2355 y Fq(\032)293
2362 y Fl(rhs)363 2355 y Ft(=)21 b Fq(\032)p 1365 2372 V 111
2373 1255 2 v 37 2440 a Ft(The)16 b(rule)g(for)f Fp(letrec)f
Ft(is)i(almost)e(iden)o(tical,)j(except)f(that)e Fq(\032)1103
2447 y Fl(rhs)1168 2440 y Ft(is)i(de\014ned)h(to)d(b)q(e)i
Fq(\032)1512 2423 y Ff(0)1538 2440 y Ft(instead)g(of)f Fq(\032)p
Ft(.)934 2921 y(35)p eop
%%Page: 36 36
bop 37 199 a Fm(5.4)56 b(Case)19 b(expressions)f(and)h(data)g(constructors)37
315 y Ft(The)h Fn(r)n(eturn)h(stack)e Ft(is)h(used)g(for)g(the)f(\014rst)h
(time)g(when)g(w)o(e)f(come)h(to)f Fp(case)g Ft(expressions.)34
b(Giv)o(en)20 b(the)37 371 y(expression)814 428 y Fp(case)14
b Fn(e)19 b Fp(of)c Fn(alts)37 511 y Ft(the)f(op)q(erational)g(in)o
(terpretation)g(is)g(\\push)f(a)g(contin)o(uation)i(on)o(to)d(the)h(return)h
(stac)o(k,)e(and)i(ev)m(aluate)g Fn(e)s Ft(".)37 567 y(When)i(the)f(ev)m
(aluation)h(of)e Fn(e)k Ft(is)d(complete,)g(execution)h(will)h(resume)e(at)f
(the)h(contin)o(uation,)g(whic)o(h)h(then)37 624 y(decides)h(whic)o(h)f
(alternativ)o(e)g(to)e(execute.)21 b(The)15 b(rule)h(for)f
Fp(case)g Ft(follo)o(ws)g(fairly)h(directly:)37 736 y(\(4\))p
111 668 1062 2 v 110 724 2 57 v 215 708 a Fn(Eval)k Ft(\()p
Fp(case)14 b Fn(e)k Fp(of)d Fn(alts)t Ft(\))f Fq(\032)21 b
Fn(as)213 b(rs)24 b(us)h(h)f Fq(\033)p 1171 724 V 110 781 V
121 764 a Ft(=)-8 b Fo(\))22 b Fn(Eval)e(e)e Fq(\032)317 b
Fn(as)24 b Ft(\()p Fn(alts)t Fq(;)8 b(\032)p Ft(\))i(:)i Fn(rs)24
b(us)h(h)f Fq(\033)p 1171 781 V 111 783 1062 2 v 37 850 a Ft(The)18
b(contin)o(uation)f(is)h(a)f(pair)g(\()p Fn(alts)t Fq(;)8 b(\032)p
Ft(\);)15 b(the)i(alternativ)o(es)g Fn(alts)j Ft(sa)o(y)d(what)f(to)h(do)g
(when)g(ev)m(aluation)h(of)37 907 y Fn(e)j Ft(completes,)e(while)g(the)e(en)o
(vironmen)o(t)h Fq(\032)f Ft(pro)o(vides)h(the)g(con)o(text)f(in)h(whic)o(h)h
(to)e(ev)m(aluate)h(the)g(c)o(hosen)37 963 y(alternativ)o(e.)23
b(W)l(e)17 b(will)g(ha)o(v)o(e)f(more)g(to)f(sa)o(y)h(ab)q(out)g(ho)o(w)f
(this)i(exp)q(ensiv)o(e-lo)q(oking)i(en)o(vironmen)o(t)d(sa)o(ving)37
1020 y(is)g(p)q(erformed)g(later,)e(in)i(Section)h(9.4.1.)37
1106 y(The)i(other)f(side)i(of)e(the)h(coin)g(is)g(the)g(rules)g(for)f
(constructors)g(and)h(literals.)31 b(Presumably)19 b Fn(e)j
Ft(ev)o(en)o(tu-)37 1162 y(ally)e(ev)m(aluates)f(to)f(either)h(a)f
(constructor)f(or)h(a)g(literal,)i(at)e(whic)o(h)h(p)q(oin)o(t)g(the)f
(contin)o(uation)h(m)o(ust)f(b)q(e)37 1219 y(p)q(opp)q(ed)g(from)c(the)i
(return)g(stac)o(k)e(and)i(executed.)22 b(The)16 b(rules)h(for)e
(constructors)f(and)i(literals)h(eac)o(h)f(use)37 1275 y(an)j(in)o
(termediate)h(state,)e Fn(R)n(eturnCon)k Ft(and)d Fn(R)n(eturnInt)j
Ft(resp)q(ectiv)o(ely)l(,)f(just)d(as)h(the)f(rule)i(for)e(function)37
1332 y(application)i(uses)e Fn(Enter)5 b Ft(.)26 b(Primitiv)o(e)19
b(v)m(alues)g(are)e(dealt)h(with)g(in)h(the)e(next)h(section,)g(while)h(the)f
(rules)37 1388 y(for)d(constructors)f(are)h(giv)o(en)h(next.)37
1474 y(Ev)m(aluating)h(a)e(constructor)f(application)j(simply)f(mo)o(v)o(es)f
(in)o(to)g(the)g Fn(R)n(eturnCon)j Ft(state:)37 1586 y(\(5\))p
111 1518 917 2 v 110 1575 2 57 v 215 1558 a Fn(Eval)i Ft(\()p
Fn(c)d(xs)t Ft(\))d Fq(\032)268 b Fn(as)24 b(rs)h(us)f(h)h
Fq(\033)p 1027 1575 V 110 1631 V 121 1614 a Ft(=)-8 b Fo(\))22
b Fn(R)n(eturnCon)c(c)g Ft(\()p Fn(val)h Fq(\032)c(\033)h Fn(xs)t
Ft(\))k Fn(as)k(rs)h(us)f(h)h Fq(\033)p 1027 1631 V 111 1633
917 2 v 37 1698 a Ft(The)15 b(rules)g(for)e Fn(R)n(eturnCon)k
Ft(return)d(to)f(the)h(appropriate)g(contin)o(uation)h(tak)o(en)f(from)f(the)
h(return)g(stac)o(k:)37 1810 y(\(6\))p 111 1742 1276 2 v 110
1799 2 57 v 215 1782 a Fn(R)n(eturnCon)k(c)g(ws)58 b(as)24
b Ft(\()p Fq(:)8 b(:)g(:)e Fp(;)15 b Fn(c)i(vs)i Fp(->)14 b
Fn(e)s Fp(;)8 b Fq(:)g(:)g(:)e(;)22 b(\032)p Ft(\))12 b(:)g
Fn(rs)24 b(us)h(h)f Fq(\033)p 1386 1799 V 110 1855 V 121 1838
a Ft(=)-8 b Fo(\))22 b Fn(Eval)e(e)e Fq(\032)p Ft([)p Fn(vs)d
Fo(7!)e Fn(ws)t Ft(])20 b Fn(as)532 b(rs)24 b(us)h(h)f Fq(\033)p
1386 1855 V 111 1857 1276 2 v 37 1922 a Ft(Pro)o(vided)14 b(that)f(the)g
(contin)o(uation)h(on)f(the)h(return)f(stac)o(k)f(con)o(tains)i(a)f(pattern)f
Fn(c)k(vs)h Ft(whose)c(constructor)37 1978 y Fn(c)j Ft(is)d(the)h(same)e(as)h
(that)f(b)q(eing)i(ev)m(aluated,)h(w)o(e)d(just)h(ev)m(aluate)h(the)f(righ)o
(t-hand)g(side)h(of)f(that)f(alternativ)o(e,)37 2035 y(in)k(the)e(sa)o(v)o
(ed)g(en)o(vironmen)o(t)h Fq(\032)f Ft(augmen)o(ted)g(with)h(bindings)h(for)e
(the)h(v)m(ariables)g Fn(vs)j Ft(to)c(the)g(v)m(alues)i(of)e(the)37
2091 y(actual)i(argumen)o(ts)e(to)h Fn(c)s Ft(.)37 2177 y(If)g(there)g(is)g
(no)f(suc)o(h)h(alternativ)o(e,)f(the)g(default)h(alternativ)o(e)g(is)g(tak)o
(en.)k(The)c(rule)g(for)f(this)g(is)h(easy)f(when)37 2234 y(no)i(v)m(ariable)
g(is)g(b)q(ound)g(in)g(the)f(default)h(case:)37 2506 y(\(7\))p
111 2269 1334 2 v 110 2495 2 226 v 328 2393 a Fn(R)n(eturnCon)i(c)f(ws)25
b(as)742 2272 y Fg(0)742 2345 y(B)742 2370 y(B)742 2394 y(B)742
2421 y(@)789 2309 y Fn(c)810 2316 y Fl(1)848 2309 y Fn(vs)888
2316 y Fl(1)926 2309 y Fp(->)15 b Fn(e)1010 2316 y Fl(1)1033
2309 y Fp(;)789 2365 y Fq(:)8 b(:)g(:)d Fp(;)789 2422 y Fn(c)810
2429 y Fl(n)848 2422 y Fn(vs)888 2429 y Fl(n)927 2422 y Fp(->)15
b Fn(e)1011 2429 y Fl(n)1034 2422 y Fp(;)789 2478 y(default)22
b(->)15 b Fn(e)1063 2485 y Fl(d)1096 2393 y Fq(;)22 b(\032)1155
2272 y Fg(1)1155 2345 y(C)1155 2370 y(C)1155 2394 y(C)1155
2421 y(A)1204 2393 y Ft(:)12 b Fn(rs)24 b(us)h(h)f Fq(\033)p
1443 2495 V 110 2608 2 113 v 121 2574 a Ft(suc)o(h)16 b(that)k
Fn(c)15 b Fo(6)p Ft(=)e Fn(c)433 2581 y Fl(i)539 2574 y Ft(\()p
Fn(1)19 b Fo(\024)13 b Fn(i)k Fo(\024)c Fn(n)s Ft(\))p 1443
2608 V 110 2721 V 121 2687 a(=)-8 b Fo(\))135 b Fn(Eval)19
b(e)455 2694 y Fl(d)493 2687 y Fq(\032)159 b Fn(as)511 b(rs)24
b(us)h(h)f Fq(\033)p 1443 2721 V 111 2722 1334 2 v 934 2921
a Ft(36)p eop
%%Page: 37 37
bop 37 199 a Ft(Ho)o(w)o(ev)o(er,)22 b(if)f(a)g(v)m(ariable)h
Fn(v)k Ft(is)21 b(b)q(ound)h(b)o(y)f(the)g(default,)i(w)o(e)e(need)g(to)g
(heap-allo)q(cate)h(a)f(constructor)37 256 y(closure)16 b(to)f(whic)o(h)h(to)
f(bind)h Fn(v)5 b Ft(,)15 b(th)o(us:)37 642 y(\(8\))p 111 300
1328 2 v 110 526 2 226 v 328 424 a Fn(R)n(eturnCon)j(c)f(ws)34
b(as)752 302 y Fg(0)752 375 y(B)752 400 y(B)752 425 y(B)752
452 y(@)798 339 y Fn(c)819 346 y Fl(1)858 339 y Fn(vs)898 346
y Fl(1)936 339 y Fp(->)15 b Fn(e)1020 346 y Fl(1)1043 339 y
Fp(;)798 396 y Fq(:)8 b(:)g(:)e Fp(;)798 452 y Fn(c)819 459
y Fl(n)858 452 y Fn(vs)898 459 y Fl(n)937 452 y Fp(->)14 b
Fn(e)1020 459 y Fl(n)1044 452 y Fp(;)798 509 y Fn(v)20 b Fp(->)15
b Fn(e)923 516 y Fl(d)1078 424 y Fq(;)23 b(\032)1138 302 y
Fg(1)1138 375 y(C)1138 400 y(C)1138 425 y(C)1138 452 y(A)1186
424 y Ft(:)12 b Fn(rs)25 b(us)f(h)36 b Fq(\033)p 1437 526 V
110 639 2 113 v 121 605 a Ft(suc)o(h)16 b(that)k Fn(c)15 b
Fo(6)p Ft(=)e Fn(c)433 612 y Fl(i)539 605 y Ft(\()p Fn(1)19
b Fo(\024)13 b Fn(i)k Fo(\024)c Fn(n)s Ft(\))p 1437 639 V 110
752 V 121 718 a(=)-8 b Fo(\))135 b Fn(Eval)19 b(e)455 725 y
Fl(d)493 718 y Fq(\032)p Ft([)p Fn(v)d Fo(7!)d Fn(a)s Ft(])21
b Fn(as)484 b(rs)25 b(us)f(h)1367 701 y Ff(0)1400 718 y Fq(\033)p
1437 752 V 110 960 2 209 v 121 831 a Ft(where)101 b Fn(h)364
814 y Ff(0)389 831 y Ft(=)13 b Fn(h)s Ft([)p Fn(a)k Fo(7!)c
Ft(\()p Fn(vs)18 b Fp(\\n)23 b({})h(->)15 b Fn(c)j(vs)t Ft(\))c
Fn(ws)t Ft(])338 887 y Fn(vs)k Ft(is)e(a)f(sequence)h(of)f(arbitrary)g
(distinct)h(v)m(ariables)338 943 y Fn(length)s Ft(\()p Fn(vs)t
Ft(\))11 b(=)i Fn(length)s Ft(\()p Fn(ws)t Ft(\))p 1437 960
V 111 962 1328 2 v 37 1027 a(This)22 b(rule)h(is)f(a)f(little)h(complicated,)
i(and)e(a)f(simple)i(program)d(transformation)g(can)i(eliminate)h(the)37
1084 y(v)m(ariable-bindi)q(ng)18 b(form)c(of)h(default)h(from)e(the)h
(language)g(\(for)f(algebraic)i Fp(case)e Ft(expressions,)i(an)o(yw)o(a)o
(y\):)343 1241 y Fp(case)f Fn(e)j Fp(of)23 b Fq(:)8 b(:)g(:)d
Fp(;)15 b Fn(v)20 b Fp(->)15 b Fn(b)31 b Ft(=)-8 b Fo(\))941
1184 y Fp(let)14 b Fn(v)20 b Fp(=)15 b Fn(xs)k Fp(\\u)k({})h(->)15
b Fn(e)941 1241 y Fp(in)941 1297 y(case)f Fn(v)20 b Fp(of)j
Fq(:)8 b(:)g(:)d Fp(;)24 b(default)f(->)15 b Fn(b)37 1396 y
Ft(In)j(implemen)o(tation)g(terms)f(this)g(v)o(ersion)g(is)h(a)f(little)h
(less)g(e\016cien)o(t,)f(b)q(ecause)h(a)f(closure)h(for)e Fn(v)22
b Ft(will)c(b)q(e)37 1452 y(allo)q(cated)d(and)e(then)h(up)q(dated,)g
(whereas)f(using)h(Rule)h(8)e(simply)i(allo)q(cates)f(the)f(constructor)g(in)
h(its)f(\014nal)37 1509 y(form.)37 1595 y(Lastly)l(,)j(if)g(there)g(is)g(no)f
(matc)o(h)g(and)h(no)f(default)h(alternativ)o(e,)g(no)f(rule)h(matc)o(hes,)f
(whic)o(h)h(is)g(in)o(terpreted)37 1651 y(as)f(failure.)37
1802 y Fm(5.5)56 b(Built)18 b(in)g(op)r(erations)37 1918 y
Ft(In)e(this)f(section)g(w)o(e)g(giv)o(e)g(the)g(extra)f(rules)h(whic)o(h)h
(handle)g(primitiv)o(e)g(v)m(alues.)21 b(The)15 b(rule)h(for)e(ev)m(aluating)
37 1974 y(a)h(primitiv)o(e)i(literal,)f Fn(k)5 b Ft(,)15 b(en)o(ters)g(the)g
Fn(R)n(eturnInt)j Ft(state:)37 2086 y(\(9\))p 111 2018 646
2 v 110 2075 2 57 v 215 2058 a Fn(Eval)i(k)f Fq(\032)89 b Fn(as)25
b(rs)f(us)g(h)h Fq(\033)p 756 2075 V 110 2131 V 121 2114 a
Ft(=)-8 b Fo(\))22 b Fn(R)n(eturnInt)d(k)25 b(as)g(rs)f(us)g(h)h
Fq(\033)p 756 2131 V 111 2133 646 2 v 37 2198 a Ft(A)16 b(similar)g(rule)g
(deals)g(with)g(the)f(case)g(where)h(a)e(v)m(ariable)j(b)q(ound)f(to)f(a)g
(primitiv)o(e)h(v)m(alue)h(is)e(en)o(tered:)37 2310 y(\(10\))p
133 2242 895 2 v 132 2299 2 57 v 238 2282 a Fn(Eval)k Ft(\()p
Fn(f)25 b Fo(fg)p Ft(\))14 b Fq(\032)p Ft([)p Fn(f)21 b Fo(7!)13
b Fn(Int)19 b(k)5 b Ft(])20 b Fn(as)k(rs)h(us)f(h)h Fq(\033)p
1027 2299 V 132 2355 V 144 2338 a Ft(=)-8 b Fo(\))22 b Fn(R)n(eturnInt)c(k)
274 b(as)24 b(rs)h(us)f(h)h Fq(\033)p 1027 2355 V 133 2357
895 2 v 37 2422 a Ft(Next)20 b(come)g(the)g(rules)h(for)e(the)h
Fn(R)n(eturnInt)k Ft(state,)c(whic)o(h)g(lo)q(ok)h(for)e(a)g(contin)o(uation)
i(on)f(the)g(return)37 2479 y(stac)o(k.)g(First,)14 b(the)h(case)h(where)f
(there)g(is)h(an)f(alternativ)o(e)h(whic)o(h)g(matc)o(hes)e(the)i(literal:)37
2591 y(\(11\))p 133 2523 1068 2 v 132 2579 2 57 v 238 2562
a Fn(R)n(eturnInt)i(k)26 b(as)e Ft(\()p Fq(:)8 b(:)g(:)e Fp(;)15
b Fn(k)5 b Fp(->)o Fn(e)s Fp(;)j Fq(:)g(:)g(:)d(;)23 b(\032)p
Ft(\))12 b(:)g Fn(rs)24 b(us)h(h)f Fq(\033)p 1200 2579 V 132
2636 V 144 2619 a Ft(=)-8 b Fo(\))22 b Fn(Eval)d(e)g Fq(\032)90
b Fn(as)446 b(rs)24 b(us)h(h)f Fq(\033)p 1200 2636 V 133 2637
1068 2 v 37 2703 a Ft(Next,)15 b(the)h(cases)f(where)g(the)g(default)h
(alternativ)o(e)g(is)f(tak)o(en:)934 2921 y(37)p eop
%%Page: 38 38
bop 37 392 a Ft(\(12\))p 133 155 1297 2 v 132 381 2 226 v 350
280 a Fn(R)n(eturnInt)19 b(k)182 b(as)833 158 y Fg(0)833 231
y(B)833 256 y(B)833 281 y(B)833 307 y(@)880 195 y Fn(k)901
202 y Fl(1)939 195 y Fp(->)15 b Fn(e)1023 202 y Fl(1)1046 195
y Fp(;)880 251 y Fq(:)8 b(:)g(:)d Fp(;)880 308 y Fn(k)901 315
y Fl(n)939 308 y Fp(->)15 b Fn(e)1023 315 y Fl(n)1047 308 y
Fp(;)880 364 y Fn(x)20 b Fp(->)15 b Fn(e)1081 280 y Fq(;)23
b(\032)1141 158 y Fg(1)1141 231 y(C)1141 256 y(C)1141 281 y(C)1141
307 y(A)1189 280 y Ft(:)12 b Fn(rs)25 b(us)f(h)h Fq(\033)p
1429 381 V 132 494 2 113 v 144 460 a Ft(suc)o(h)15 b(that)20
b Fn(k)e Fo(6)p Ft(=)13 b Fn(k)458 467 y Fl(i)564 460 y Ft(\()p
Fn(1)19 b Fo(\024)13 b Fn(i)k Fo(\024)c Fn(n)s Ft(\))p 1429
494 V 132 607 V 144 573 a(=)-8 b Fo(\))134 b Fn(Eval)20 b(e)e
Fq(\032)p Ft([)p Fn(x)g Fo(7!)13 b Fn(Int)18 b(k)5 b Ft(])21
b Fn(as)405 b(rs)25 b(us)f(h)h Fq(\033)p 1429 607 V 133 609
1297 2 v 37 890 a Ft(\(13\))p 133 653 1227 2 v 132 878 2 226
v 350 777 a Fn(R)n(eturnInt)19 b(k)26 b(as)677 655 y Fg(0)677
728 y(B)677 753 y(B)677 778 y(B)677 804 y(@)724 692 y Fn(k)745
699 y Fl(1)783 692 y Fp(->)15 b Fn(e)867 699 y Fl(1)890 692
y Fp(;)724 748 y Fq(:)8 b(:)g(:)d Fp(;)724 805 y Fn(k)745 812
y Fl(n)783 805 y Fp(->)15 b Fn(e)867 812 y Fl(n)891 805 y Fp(;)724
861 y(default)23 b(->)14 b Fn(e)1012 777 y Fq(;)22 b(\032)1071
655 y Fg(1)1071 728 y(C)1071 753 y(C)1071 778 y(C)1071 804
y(A)1120 777 y Ft(:)12 b Fn(rs)24 b(us)h(h)f Fq(\033)p 1359
878 V 132 991 2 113 v 144 957 a Ft(suc)o(h)15 b(that)20 b Fn(k)e
Fo(6)p Ft(=)13 b Fn(k)458 964 y Fl(i)564 957 y Ft(\()p Fn(1)19
b Fo(\024)13 b Fn(i)k Fo(\024)c Fn(n)s Ft(\))p 1359 991 V 132
1104 V 144 1070 a(=)-8 b Fo(\))134 b Fn(Eval)20 b(e)e Fq(\032)91
b Fn(as)492 b(rs)24 b(us)h(h)f Fq(\033)p 1359 1104 V 133 1106
1227 2 v 37 1180 a Ft(Finally)l(,)d(w)o(e)e(need)g(a)f(family)h(of)g(rules)g
(for)f(built-in)j(arithmetic)e(op)q(erations)g(whic)o(h,)h(for)e(eac)o(h)g
(binary)37 1236 y(built-in)g(op)q(eration)e Fo(\010)f Ft(ha)o(v)o(e)g(the)g
(form:)37 1348 y(\(14\))p 133 1280 1314 2 v 132 1337 2 57 v
238 1320 a Fn(Eval)k Ft(\()p Fo(\010)c(f)p Fn(x)456 1327 y
Fl(1)480 1320 y Fq(;)8 b Fn(x)522 1327 y Fl(2)544 1320 y Fo(g)p
Ft(\))15 b Fq(\032)p Ft([)p Fn(x)658 1327 y Fl(1)693 1320 y
Fo(7!)e Fn(Int)19 b(i)843 1327 y Fl(1)866 1320 y Fq(;)k Fn(x)923
1327 y Fl(2)959 1320 y Fo(7!)13 b Fn(Int)19 b(i)1109 1327 y
Fl(2)1132 1320 y Ft(])h Fn(as)25 b(rs)f(us)g(h)h Fq(\033)p
1446 1337 V 132 1393 V 144 1376 a Ft(=)-8 b Fo(\))22 b Fn(R)n(eturnInt)c
Ft(\()p Fn(i)483 1383 y Fl(1)517 1376 y Fo(\010)10 b Fn(i)576
1383 y Fl(2)599 1376 y Ft(\))548 b Fn(as)25 b(rs)f(us)g(h)h
Fq(\033)p 1446 1393 V 133 1395 1314 2 v 37 1525 a Fm(5.6)56
b(Up)r(dating)37 1640 y Ft(In)20 b(this)e(section)h(w)o(e)f(co)o(v)o(er)g
(the)h(up)q(dating)g(tec)o(hnology)g(necessary)f(for)g(a)g(graph)g(reduction)
h(mac)o(hine.)37 1697 y(Up)q(dates)d(happ)q(en)g(in)g(t)o(w)o(o)e(stages:)93
1810 y(1.)22 b(When)h(an)g(up)q(datable)h(closure)f(is)g(en)o(tered,)i(it)e
(pushes)g(an)g Fn(up)n(date)h(fr)n(ame)f Ft(on)o(to)f(the)g(up)q(date)151
1867 y(stac)o(k,)16 b(and)i(mak)o(es)e(the)h(argumen)o(t)f(and)h(return)g
(stac)o(ks)f(empt)o(y)l(.)25 b(An)18 b(up)q(date)f(frame)g(is)g(a)g(triple)
151 1923 y(\()p Fn(as)211 1930 y Fl(u)234 1923 y Fq(;)8 b Fn(rs)293
1930 y Fl(u)314 1923 y Fq(;)g Fn(a)358 1930 y Fl(u)381 1923
y Ft(\),)14 b(consisting)i(of:)206 2013 y Fo(\017)22 b Fn(as)293
2020 y Fl(u)316 2013 y Ft(,)15 b(the)g(previous)h(argumen)o(t)e(stac)o(k;)206
2083 y Fo(\017)22 b Fn(rs)289 2090 y Fl(u)312 2083 y Ft(,)15
b(the)g(previous)h(return)f(stac)o(k;)206 2152 y Fo(\017)22
b Fn(a)274 2159 y Fl(u)297 2152 y Ft(,)15 b(a)g(p)q(oin)o(ter)h(to)e(the)i
(closure)f(b)q(eing)i(en)o(tered,)e(and)g(whic)o(h)h(should)h(later)e(b)q(e)h
(up)q(dated.)93 2242 y(2.)22 b(When)15 b(ev)m(aluation)i(of)d(the)h(closure)h
(is)f(complete)h(an)f(up)q(date)g(is)h(triggered.)j(This)d(can)f(happ)q(en)h
(in)151 2298 y(one)f(of)g(t)o(w)o(o)f(w)o(a)o(ys:)206 2388
y Fo(\017)22 b Ft(If)14 b(the)h(v)m(alue)g(of)f(the)g(closure)h(is)f(a)g
(data)f(constructor)h(or)f(literal,)i(an)f(attempt)f(will)j(b)q(e)f(made)251
2445 y(to)k(p)q(op)h(a)g(contin)o(uation)g(from)f(the)h(return)f(stac)o(k,)h
(whic)o(h)h(will)g(fail)g(b)q(ecause)f(the)g(return)251 2501
y(stac)o(k)e(is)g(empt)o(y)l(.)29 b(This)19 b(failure)h(triggers)d(an)i(up)q
(date.)29 b(\(In)19 b(the)f(real)h(implemen)o(tation)g(w)o(e)251
2558 y(can)e(a)o(v)o(oid)f(making)h(the)f(test)g(b)o(y)g(merging)h(the)g
(return)f(and)h(up)q(date)g(stac)o(ks,)e(and)i(making)251 2614
y(the)e(up)q(date)h(in)o(to)f(a)g(sp)q(ecial)i(sort)e(of)f(contin)o(uation)i
(|)g(Section)g(10.1.\))206 2683 y Fo(\017)22 b Ft(If)12 b(the)f(v)m(alue)i
(of)e(the)h(closure)g(is)g(a)f(function,)i(the)e(function)i(will)g(attempt)d
(to)h(bind)i(argumen)o(ts)251 2740 y(whic)o(h)18 b(are)e(not)g(presen)o(t)h
(on)f(the)h(argumen)o(t)f(stac)o(k)g(\(b)q(ecause)h(they)g(w)o(ere)f
(squirreled)j(a)o(w)o(a)o(y)251 2796 y(in)d(the)f(up)q(date)h(frame\).)j
(This)d(failure)g(to)f(\014nd)h(enough)f(argumen)o(ts)g(triggers)f(an)h(up)q
(date.)934 2921 y(38)p eop
%%Page: 39 39
bop 37 199 a Ft(These)16 b(situations)g(are)f(made)h(precise)g(in)h(the)e
(follo)o(wing)i(rules.)k(First,)15 b(w)o(e)g(need)h(to)f(add)h(an)f(extra)g
(rule)37 256 y(whic)o(h)i(applies)g(when)f(en)o(tering)g(an)f(up)q(datable)i
(closure)f(\(that)e(is,)i(one)f(whose)h(up)q(date)g(\015ag)f(is)h
Fp(u)p Ft(\).)k(The)37 312 y(rule)d(is)e(similar)i(to)d(the)h(usual)h
(closure-en)o(try)g(rule)g(\(Rule)h(2\):)37 540 y(\(15\))p
133 359 1381 2 v 132 472 2 113 v 281 438 a Fn(Enter)i(a)36
b(as)28 b(rs)252 b(us)24 b(h)s Ft([)p Fn(a)17 b Fo(7!)c Ft(\()p
Fn(vs)18 b Fp(\\u)24 b({})f(->)15 b Fn(e)s Ft(\))g Fn(ws)1423
445 y Fl(f)1442 438 y Ft(])21 b Fq(\033)p 1513 472 V 132 585
V 144 551 a Ft(=)-8 b Fo(\))65 b Fn(Eval)19 b(e)g Fq(\032)h
Fo(fg)g(fg)h Ft(\()p Fn(as)t Fq(;)8 b Fn(rs)t Fq(;)g Fn(a)s
Ft(\))i(:)i Fn(us)24 b(h)555 b Fq(\033)p 1513 585 V 132 698
V 144 664 a Ft(where)21 b Fq(\032)12 b Ft(=)h([)p Fn(vs)i Fo(7!)f
Fn(ws)541 671 y Fl(f)559 664 y Ft(])p 1513 698 V 133 699 1381
2 v 37 764 a(The)h(di\013erence)g(is)f(that)f(the)h(argumen)o(t)f(stac)o(k,)g
(return)g(stac)o(k,)g(and)h(closure)h(b)q(eing)g(en)o(tered)f(are)f(formed)37
821 y(in)o(to)i(an)f(up)q(date)g(frame,)g(whic)o(h)h(is)g(pushed)g(on)o(to)e
(the)h(up)q(date)h(stac)o(k.)k(\(Naturally)l(,)14 b(the)g(real)h(implemen-)37
877 y(tation)e(manipulates)i(p)q(oin)o(ters)e(rather)g(than)g(cop)o(ying)h
(en)o(tire)g(stac)o(ks)e(|)i(Section)g(10.3.\))k(Since)c(closures)37
934 y(with)g(a)e(non-empt)o(y)h(argumen)o(t)e(list)j(are)e(nev)o(er)h(up)q
(datable)h(\(Section)f(4.2\),)f(w)o(e)g(only)h(deal)h(with)f(this)g(case)37
990 y(in)k(the)e(rule)h(giv)o(en.)37 1076 y(Next,)c(w)o(e)e(need)h(new)g
(rules)g(for)f(constructors)g(whic)o(h)i(see)e(an)h(empt)o(y)f(return)h(stac)
o(k.)17 b(When)11 b(this)g(happ)q(ens,)37 1133 y(they)20 b(up)q(date)f(the)g
(closure)h(p)q(oin)o(ted)g(to)e(b)o(y)h(the)g(up)q(date)h(frame,)f(restore)f
(the)i(argumen)o(t)e(and)h(return)37 1189 y(stac)o(ks)11 b(from)g(the)g(up)q
(date)h(frame,)f(and)h(try)f(again.)19 b(It)11 b(ma)o(y)g(b)q(e)h(that)e(the)
i(restored)f(return)g(stac)o(k)g(con)o(tains)37 1246 y(the)16
b(contin)o(uation,)f(but)h(it)f(to)q(o)g(ma)o(y)f(b)q(e)i(empt)o(y)l(,)f(in)h
(whic)o(h)g(case)f(a)g(second)h(up)q(date)g(is)g(p)q(erformed,)f(and)37
1302 y(so)g(on)g(un)o(til)i(the)e(contin)o(uation)h(is)g(exp)q(osed.)37
1575 y(\(16\))p 133 1346 1120 2 v 132 1459 2 113 v 281 1425
a Fn(R)n(eturnCon)i(c)f(ws)44 b Fo(fg)35 b(fg)21 b Ft(\()p
Fn(as)856 1432 y Fl(u)878 1425 y Fq(;)8 b Fn(rs)937 1432 y
Fl(u)959 1425 y Fq(;)g Fn(a)1003 1432 y Fl(u)1025 1425 y Ft(\))13
b(:)f Fn(us)24 b(h)44 b Fq(\033)p 1253 1459 V 132 1572 V 144
1538 a Ft(=)-8 b Fo(\))65 b Fn(R)n(eturnCon)18 b(c)f(ws)25
b(as)671 1545 y Fl(u)714 1538 y Fn(rs)752 1545 y Fl(u)1081
1538 y Fn(us)f(h)1171 1545 y Fl(u)1215 1538 y Fq(\033)p 1253
1572 V 132 1781 2 209 v 144 1651 a Ft(where)31 b Fn(vs)19 b
Ft(is)c(a)g(sequence)i(of)d(arbitrary)h(distinct)h(v)m(ariables)291
1708 y Fn(length)s Ft(\()p Fn(vs)t Ft(\))11 b(=)i Fn(length)s
Ft(\()p Fn(ws)t Ft(\))291 1764 y Fn(h)314 1771 y Fl(u)350 1764
y Ft(=)g Fn(h)s Ft([)p Fn(a)460 1771 y Fl(u)496 1764 y Fo(7!)g
Ft(\()p Fn(vs)18 b Fp(\\n)d Fo(fg)g Fp(->)g Fn(c)i(vs)t Ft(\))d
Fn(ws)t Ft(])p 1253 1781 V 133 1783 1120 2 v 37 1850 a(The)i(closure)g(to)f
(b)q(e)h(up)q(dated)h(\(address)e Fn(a)783 1857 y Fl(u)806
1850 y Ft(\))g(is)h(just)f(up)q(dated)h(with)g(a)f(standard-constructor)g
(closure.)37 1907 y(Only)20 b(a)d(rule)i(for)f Fn(R)n(eturnCon)i
Ft(need)f(b)q(e)g(giv)o(en.)28 b(It)18 b(is)h(not)f(p)q(ossible)h(for)f(the)g
Fn(R)n(eturnInt)j Ft(state)c(to)h(see)37 1963 y(an)g(empt)o(y)g(return)g
(stac)o(k,)f(b)q(ecause)i(that)f(w)o(ould)g(imply)h(that)e(a)h(closure)h
(should)g(b)q(e)f(up)q(dated)h(with)f(a)37 2020 y(primitiv)o(e)f(v)m(alue;)f
(but)f(no)h(closure)f(has)h(a)e(primitiv)o(e)j(t)o(yp)q(e)e(\(Section)h
(4.7\).)37 2106 y(Finally)l(,)g(w)o(e)d(need)h(a)f(rule)h(to)f(handle)i(the)f
(case)f(where)h(there)f(are)g(not)g(enough)h(argumen)o(ts)f(on)g(the)h(stac)o
(k)37 2162 y(to)h(b)q(e)h(b)q(ound)g(b)o(y)f(a)g(lam)o(b)q(da)h(abstraction,)
e(whic)o(h)i(triggers)f(an)g(up)q(date.)20 b(The)c(relev)m(an)o(t)g(rule)g
(is:)37 2511 y(\(17\))p 133 2206 1255 2 v 132 2319 2 113 v
350 2285 a Fn(Enter)k(a)163 b(as)39 b Fo(fg)20 b Ft(\()p Fn(as)875
2292 y Fl(u)898 2285 y Fq(;)8 b Fn(rs)957 2292 y Fl(u)979 2285
y Fq(;)g Fn(a)1023 2292 y Fl(u)1045 2285 y Ft(\))k(:)h Fn(us)24
b(h)44 b Fq(\033)p 1387 2319 V 132 2472 2 153 v 144 2398 a
Ft(suc)o(h)15 b(that)31 b Fn(h)19 b(a)d Ft(=)d(\()p Fn(vs)18
b Fp(\\n)d Fn(xs)k Fp(->)14 b Fn(e)s Ft(\))i Fn(ws)857 2405
y Fl(f)361 2455 y Fn(length)s Ft(\()p Fn(as)t Ft(\))11 b Fq(<)i
Fn(length)s Ft(\()p Fn(xs)t Ft(\))p 1387 2472 V 132 2585 2
113 v 144 2551 a(=)-8 b Fo(\))134 b Fn(Enter)20 b(a)25 b(as)16
b Ft(+)-23 b(+)13 b Fn(as)690 2558 y Fl(u)734 2551 y Fn(rs)772
2558 y Fl(u)1101 2551 y Fn(us)24 b(h)1191 2558 y Fl(u)1235
2551 y Fq(\033)p 1387 2585 V 132 2794 2 209 v 144 2664 a Ft(where)101
b Fn(xs)401 2671 y Fl(1)437 2664 y Ft(+)-23 b(+)13 b Fn(xs)537
2671 y Fl(2)573 2664 y Ft(=)g Fn(xs)361 2720 y(length)s Ft(\()p
Fn(xs)540 2727 y Fl(1)562 2720 y Ft(\))g(=)g Fn(length)s Ft(\()p
Fn(as)t Ft(\))361 2777 y Fn(h)384 2784 y Fl(u)420 2777 y Ft(=)g
Fn(h)s Ft([)p Fn(a)530 2784 y Fl(u)566 2777 y Fo(7!)g Ft(\(\()p
Fn(vs)i Ft(+)-23 b(+)14 b Fn(xs)816 2784 y Fl(1)839 2777 y
Ft(\))h Fp(\\n)f Fn(xs)974 2784 y Fl(2)1013 2777 y Fp(->)h
Fn(e)s Ft(\))g(\()p Fn(ws)1200 2784 y Fl(f)1231 2777 y Ft(+)-23
b(+)14 b Fn(as)t Ft(\)])p 1387 2794 V 133 2795 1255 2 v 934
2921 a(39)p eop
%%Page: 40 40
bop 37 199 a Ft(\(The)15 b(rule)g(will)h(only)e(apply)i(if)e(the)h(n)o(um)o
(b)q(er)f(of)g(argumen)o(ts)f(#)p Fn(xs)18 b Ft(is)d(greater)e(than)h(zero,)g
(so)g(the)g(closure)37 256 y(b)q(eing)k(en)o(tered)f(will)i(b)q(e)e(non-up)q
(datable;)i(hence)e(the)g Fp(\\n)g Ft(in)g(the)g(\014rst)f(line)i(of)f(the)g
(rule.\))24 b(The)17 b(closure)37 312 y(to)h(b)q(e)g(up)q(dated)g(\(address)g
Fn(a)546 319 y Fl(u)569 312 y Ft(\))f(has)h(as)f(its)h(v)m(alue)h(the)f(v)m
(alue)h(of)e(the)h(closure)g(b)q(eing)h(en)o(tered)f(\(address)37
369 y Fn(a)s Ft(\))h(applied)h(to)d(the)h(argumen)o(ts)g(on)g(the)g(stac)o(k)
f Fn(as)t Ft(.)28 b(It)18 b(is)h(therefore)e(up)q(dated)i(with)g(a)e(closure)
i(whose)37 425 y(co)q(de)f(is)f(\(\()p Fn(vs)h Ft(+)-23 b(+)16
b Fn(xs)388 432 y Fl(1)411 425 y Ft(\))h Fp(\\n)f Fn(xs)550
432 y Fl(2)590 425 y Fp(->)g Fn(e)s Ft(\);)h(the)g(b)q(o)q(dy)g
Fn(e)k Ft(is)c(the)g(same)f(as)g(that)g(of)h Fn(a)s Ft(,)g(but)g(it)g(has)g
(more)f(free)37 482 y(v)m(ariables)j(\()p Fn(xs)286 489 y Fl(1)326
482 y Ft(as)d(w)o(ell)i(as)f Fn(vs)t Ft(\))f(and)h(few)o(er)g(argumen)o(ts)f
(\()p Fn(xs)1105 489 y Fl(2)1145 482 y Ft(instead)h(of)g Fn(xs)t
Ft(\).)24 b(After)17 b(the)g(up)q(date)h(the)37 538 y Fn(Enter)i
Ft(is)c(retried.)37 624 y(This)k(concludes)g(the)f(basic)g(rules)h(for)e(up)q
(dating.)32 b(Ho)o(w)o(ev)o(er,)18 b(one)h(of)f(the)h(constrain)o(ts)f(in)i
(a)e(real)h(im-)37 680 y(plemen)o(tation)i(is)f(that)g(it)g(cannot)f(man)o
(ufacture)h(compiled)h(co)q(de)g(\\on)e(the)h(\015y",)g(so)g(w)o(e)f(need)i
(to)e(b)q(e)37 737 y(careful)c(ab)q(out)f(the)h(co)q(de)g(part)e(of)h
(closures)h(whic)o(h)g(are)f(created)g(b)o(y)g(up)q(dating.)21
b(The)14 b(co)q(de)h(required)h(for)37 793 y(constructors,)e(\()p
Fn(vs)19 b Fp(\\n)14 b Fo(fg)h Fp(->)g Fn(c)j(vs)t Ft(\))c(is)h(OK,)h(b)q
(ecause)g(w)o(e)f(can)g(precompile)i(it)f(for)e(eac)o(h)h(constructor)g
Fn(c)s Ft(.)37 879 y(The)e(co)q(de)h(for)e(partial)h(applications,)h(\(\()p
Fn(vs)h Ft(+)-23 b(+)14 b Fn(xs)897 886 y Fl(1)920 879 y Ft(\))e
Fp(\\n)g Fn(xs)1050 886 y Fl(2)1086 879 y Fp(->)g Fn(e)s Ft(\),)h(is)g(more)f
(tiresome,)h(since)h(it)f(suggests)37 936 y(that)20 b(w)o(e)g(need)i(to)d
(precompile)k(the)d(en)o(tire)h(b)q(o)q(dy)g Fn(e)j Ft(of)c(ev)o(ery)g
(function)h(for)f(ev)o(ery)g(p)q(ossible)j(partial)37 992 y(application.)f
(An)16 b(alternativ)o(e)f(rule)h(for)f(partial-application)i(up)q(dates)f(a)o
(v)o(oids)f(this)g(problem:)37 1370 y(\(17a\))p 156 1036 1184
2 v 155 1149 2 113 v 373 1115 a Fn(Enter)20 b(a)162 b(as)40
b Fo(fg)20 b Ft(\()p Fn(as)898 1122 y Fl(u)920 1115 y Fq(;)8
b Fn(rs)979 1122 y Fl(u)1001 1115 y Fq(;)g Fn(a)1045 1122 y
Fl(u)1068 1115 y Ft(\))k(:)g Fn(us)25 b(h)44 b Fq(\033)p 1338
1149 V 155 1302 2 153 v 167 1228 a Ft(suc)o(h)15 b(that)31
b Fn(h)18 b(a)f Ft(=)c(\()p Fn(vs)18 b Fp(\\n)d Fn(xs)j Fp(->)d
Fn(e)s Ft(\))g Fn(ws)879 1235 y Fl(f)384 1285 y Fn(length)s
Ft(\()p Fn(as)t Ft(\))c Fq(<)i Fn(length)s Ft(\()p Fn(xs)t
Ft(\))p 1338 1302 V 155 1415 2 113 v 167 1381 a(=)-8 b Fo(\))134
b Fn(Enter)20 b(a)k(as)16 b Ft(+)-23 b(+)14 b Fn(as)713 1388
y Fl(u)757 1381 y Fn(rs)795 1388 y Fl(u)1123 1381 y Fn(us)25
b(h)1214 1388 y Fl(u)1258 1381 y Fq(\033)p 1338 1415 V 155
1680 2 266 v 167 1494 a Ft(where)101 b Fn(xs)424 1501 y Fl(1)459
1494 y Ft(+)-23 b(+)14 b Fn(xs)560 1501 y Fl(2)596 1494 y Ft(=)f
Fn(xs)384 1550 y(length)s Ft(\()p Fn(xs)563 1557 y Fl(1)585
1550 y Ft(\))f(=)h Fn(length)s Ft(\()p Fn(as)t Ft(\))384 1607
y Fn(f)24 b Ft(is)16 b(an)f(arbitrary)g(v)m(ariable)384 1663
y Fn(h)407 1670 y Fl(u)442 1663 y Ft(=)e Fn(h)s Ft([)p Fn(a)552
1670 y Fl(u)589 1663 y Fo(7!)g Ft(\(\()p Fn(f)21 b Ft(:)12
b Fn(xs)783 1670 y Fl(1)807 1663 y Ft(\))i Fp(\\n)h Fo(fg)g
Fp(->)g Fn(f)24 b(xs)1104 1670 y Fl(1)1128 1663 y Ft(\))14
b(\()p Fn(a)i Ft(:)d Fn(as)t Ft(\)])p 1338 1680 V 156 1682
1184 2 v 37 1747 a(Here)i(the)f(closure)g(b)q(eing)h(en)o(tered,)f
Fn(a)s Ft(,)h(is)f(used)h(in)f(the)g(new)h(closure.)20 b(The)14
b(new)g(co)q(de)g(required,)h(namely)37 1803 y(\(\()p Fn(f)22
b Ft(:)12 b Fn(xs)174 1810 y Fl(1)197 1803 y Ft(\))i Fp(\\n)g
Fo(fg)g Fp(->)g Fn(f)24 b(xs)491 1810 y Fl(1)514 1803 y Ft(\),)14
b(can)g(b)q(e)h(shared)f(b)q(et)o(w)o(een)h(all)g(partial)g(applications)h
(to)d(the)i(same)f(n)o(um)o(b)q(er)37 1860 y(of)d(argumen)o(ts.)18
b(All)13 b(that)d(is)i(required)h(is)e(a)g(family)h(of)f(suc)o(h)h(co)q
(de-blo)q(c)o(ks,)h(one)e(for)g(eac)o(h)h(p)q(ossible)h(n)o(um)o(b)q(er)37
1916 y(of)i(argumen)o(ts.)934 2921 y(40)p eop
%%Page: 41 41
bop 121 213 a Fj(P)n(art)27 b(I)r(I)r(I:)h(Mapping)f(the)g(abstract)h(mac)n
(hine)e(to)h(sto)r(c)n(k)797 317 y(hardw)n(are)37 416 y Ft(W)l(e)15
b(ha)o(v)o(e)g(no)o(w)f(completed)h(the)g(abstract)f(description)i(of)e(the)h
(Spineless)i(T)l(agless)e(G-mac)o(hine.)20 b(Whilst)37 472
y(it)f(has)f(some)g(in)o(teresting)h(features,)f(its)g(real)h
(justi\014cation)g(is)f(that)g(it)g(maps)g(v)o(ery)g(nicely)i(on)o(to)d(sto)q
(c)o(k)37 528 y(hardw)o(are,)d(with)h(a)f(ric)o(h)h(set)g(of)f(design)h
(alternativ)o(es,)g(some)f(of)g(whic)o(h)i(w)o(e)e(ha)o(v)o(e)g(already)h
(indicated.)21 b(In)37 585 y(the)16 b(rest)f(of)f(the)i(pap)q(er)f(w)o(e)g
(describ)q(e)i(the)e(mapping)h(in)g(detail.)37 758 y Fs(6)67
b(T)-6 b(arget)23 b(language)37 889 y Ft(Our)16 b(goal)f(is,)h(of)e(course,)h
(to)g(generate)g(go)q(o)q(d)g(nativ)o(e)h(co)q(de)f(for)g(a)g(v)m(ariet)o(y)g
(of)g(sto)q(c)o(k)g(arc)o(hitectures.)20 b(One)37 945 y(approac)o(h)14
b(to)f(this)h(is)g(to)f(write)h(individual)j(co)q(de)d(generators)f(for)g
(eac)o(h)h(arc)o(hitecture,)g(and)g(this)g(is)g(lik)o(ely)37
1002 y(to)i(giv)o(e)g(the)f(b)q(est)h(results)h(in)f(the)g(end.)22
b(Unfortunately)l(,)16 b(to)f(comp)q(ete)h(with)g(more)g(mature)f(imp)q
(erativ)o(e)37 1058 y(languages,)e(whose)g(co)q(de)g(generators)e(ha)o(v)o(e)
h(ev)o(olv)o(ed)h(and)g(impro)o(v)o(ed)g(o)o(v)o(er)e(man)o(y)h(y)o(ears,)g
(w)o(e)g(w)o(ould)h(ha)o(v)o(e)37 1115 y(to)i(do)g(a)g(comparably)g(go)q(o)q
(d)h(job)f(of)f(co)q(de)i(generation,)f(whic)o(h)h(is)g(a)f(lot)g(of)g(w)o
(ork.)37 1200 y(Motiv)m(ated)g(b)o(y)f(this)h(concern,)g(w)o(e)f(generate)g
(co)q(de)h(in)h(the)e(C)g(language)h(as)f(our)g(primary)h(target,)e(rather)37
1257 y(than)21 b(generating)f(nativ)o(e)h(co)q(de)g(direct.)36
b(In)21 b(this)f(w)o(a)o(y)g(w)o(e)g(gain)g(instan)o(t)h(p)q(ortabilit)o(y)l
(,)h(b)q(ecause)f(C)f(is)37 1313 y(implemen)o(ted)f(on)e(a)g(wide)h(v)m
(ariet)o(y)f(of)g(arc)o(hitectures,)g(and)h(w)o(e)e(b)q(ene\014t)j(directly)f
(from)e(impro)o(v)o(emen)o(ts)37 1370 y(in)23 b(C)e(co)q(de)h(generation.)39
b(This)22 b(approac)o(h,)g(of)f(using)h(C)f(as)g(a)g(\\high-lev)o(el)j(assem)
o(bler")d(has)g(gained)37 1426 y(p)q(opularit)o(y)d(recen)o(tly)g(\(Bartlett)
e([1989];)g(Miranda)h([1991]\).)1108 1410 y Fl(4)1154 1426
y Ft(In)h(particular,)g(the)f(w)o(ork)f(of)g(T)l(arditi)i Fn(et)37
1483 y(al)g Ft(on)g(compiling)i(SML)e(to)g(C,)f(dev)o(elop)q(ed)j(indep)q
(enden)o(tly)h(and)d(concurren)o(tly)g(with)h(ours,)f(addresses)37
1539 y(essen)o(tially)f(the)e(same)g(problems)h(\(T)l(arditi,)f(Ac)o(hary)o
(a)g(&)g(Lee)h([1991]\).)37 1625 y(Rather)g(than)f(generating)g(C)g(directly)
l(,)h(w)o(e)f(go)f(via)i(an)f(in)o(ternal)h(datat)o(yp)q(e)e(called)j
(\\Abstract)d(C".)g(This)37 1682 y(allo)o(ws)20 b(the)f(follo)o(wing)g(sp)q
(ectrum)h(of)f(alternativ)o(es)g(for)f(the)h(\014nal)h(co)q(de)g(generation,)
f(with)h(increasing)37 1738 y(e\016ciency)d(and)f(decreasing)g(p)q(ortabilit)
o(y:)106 1861 y Fo(\017)22 b Ft(W)l(e)15 b(can)h(generate)f(ANSI-standard)g
(C,)g(whic)o(h)h(should)g(b)q(e)g(widely)h(p)q(ortable.)106
1955 y Fo(\017)22 b Ft(W)l(e)17 b(can)f(generate)h(C)f(whic)o(h)h(exploits)h
(v)m(arious)f(non-standard)f(extensions)i(to)e(C)g(supp)q(orted)h(b)o(y)151
2012 y(the)e(Gn)o(u)g(C)g(compiler)i(\(Stallman)f([1992]\).)106
2106 y Fo(\017)22 b Ft(W)l(e)15 b(can)h(generate)f(nativ)o(e)g(mac)o(hine)h
(co)q(de)g(directly)l(.)37 2229 y(So)g(far)e(w)o(e)h(ha)o(v)o(e)g(concen)o
(trated)g(only)h(on)f(the)g(\014rst)g(t)o(w)o(o)f(alternativ)o(es.)37
2315 y(Compiling)h(via)f(C)f(is)h(v)o(ery)f(attractiv)o(e)f(for)h(p)q
(ortabilit)o(y)h(reasons,)f(but)g(lik)o(e)i(all)f(go)q(o)q(d)f(things,)h(it)g
(do)q(es)f(not)37 2371 y(come)i(for)f(free.)19 b(In)c(the)g(rest)f(of)g(this)
h(section)g(w)o(e)f(describ)q(e)i(a)e(few)g(tric)o(ks)g(whic)o(h)i(substan)o
(tially)f(impro)o(v)o(e)37 2428 y(the)i(co)q(de)g(w)o(e)f(can)h(generate)f
(using)h(this)g(route,)f(usually)i(b)o(y)e(exploiting)i(non-standard)e
(extensions)i(to)37 2484 y(C)d(pro)o(vided)h(b)o(y)g(Gn)o(u)f(C.)p
37 2524 735 2 v 86 2551 a Fk(4)107 2567 y Fu(Here,)e(\\Miranda")i(is)f(not)g
(the)g(trade)g(mark.)k(It)c(is)g(the)f(last)i(name)f(of)f(a)g(researc)o(her)i
(at)e(Queen)h(Mary)g(and)g(W)m(est\014eld)37 2612 y(College,)h(London.)934
2921 y Ft(41)p eop
%%Page: 42 42
bop 37 199 a Fm(6.1)56 b(Mapping)19 b(the)f(STG)h(mac)n(hine)f(to)g(C)37
315 y Ft(A)o(t)j(\014rst)g(it)g(app)q(ears)h(sensible)h(to)d(try)h(to)g(map)g
(functions)h(from)e(the)h(original)i(functional)f(program)37
371 y(on)o(to)17 b(C)h(functions,)h(but)f(w)o(e)f(so)q(on)h(abandoned)g(this)
g(approac)o(h.)28 b(The)18 b(mis-matc)o(h)g(b)q(et)o(w)o(een)g(C)f(and)h(a)37
428 y(non-strict)e(higher-order)g(functional)g(language)g(is)f(to)q(o)g
(great.)37 513 y(Instead,)g(the)f(argumen)o(t)g(stac)o(ks)f(and)i(con)o(trol)
f(stac)o(k)g(are)g(mapp)q(ed)h(on)o(to)e(explicit)k(C)d(arra)o(ys,)f(b)o
(ypassing)37 570 y(the)k(usual)g(C)f(parameter-passing)h(mec)o(hanism.)24
b(All)17 b(\\registers",)f(suc)o(h)h(as)f(the)g(stac)o(k)g(p)q(oin)o(ters,)h
(heap)37 626 y(p)q(oin)o(ter,)f(heap)f(limit,)i(and)e(other)g(registers)g(in)
o(tro)q(duced)h(later,)f(are)g(held)h(in)g(global)g(v)m(ariables.)37
712 y(This)21 b(approac)o(h)f(results)g(in)h(a)f(great)f(deal)i(of)f
(global-v)m(ariable)i(manipulation.)36 b(The)20 b(o)o(v)o(erheads)g(can)37
769 y(b)q(e)h(reduced)h(without)e(losing)h(p)q(ortabilit)o(y)l(,)h(b)o(y)f
(cac)o(hing)g(suc)o(h)f(globals)h(in)g(\(register-allo)q(cated\))g(lo)q(cal)
37 825 y(v)m(ariables)12 b(during)g(the)f(execution)h(of)e(a)g(single)i(co)q
(de-blo)q(c)o(k,)h(based)e(on)g(a)f(simple)i(usage)f(analysis)g(\(T)l
(arditi,)37 882 y(Ac)o(hary)o(a)g(&)g(Lee)h([1991]\).)k(A)o(t)10
b(the)h(exp)q(ense)i(of)d(p)q(ortabilit)o(y)l(,)j(the)e(o)o(v)o(erheads)f
(can)h(b)q(e)h(eliminated)h(en)o(tirely)l(,)37 938 y(b)o(y)e(telling)h(the)f
(C)f(compiler)i(to)e(k)o(eep)h(particular)h(globals)f(in)g(sp)q(eci\014ed)i
(registers)d(p)q(ermanen)o(tly)l(,)j(a)d(\(highly)37 995 y(non-standard,)15
b(arc)o(hitecture-sp)q(eci\014c\))j(facilit)o(y)e(pro)o(vided)g(b)o(y)f(the)g
(Gn)o(u)g(C)g(compiler.)37 1146 y Fm(6.2)56 b(Compiling)17
b(jumps)37 1261 y Ft(The)i(main)f(di\016cult)o(y)h(with)f(generating)g(C)f
(concerns)i(lab)q(els.)29 b(W)l(e)18 b(use)g(the)g(term)f Fn(c)n(o)n(de)i
(lab)n(el)d Ft(\(or)h(just)37 1318 y(lab)q(el\))e(to)d(mean)h(an)f(iden)o
(ti\014er)j(for)d(a)h(co)q(de)g(sequence.)20 b(The)13 b(imp)q(ortan)o(t)g(c)o
(haracteristics)g(of)f(a)h(co)q(de)g(lab)q(el)37 1374 y(are)i(that:)106
1497 y Fo(\017)22 b Ft(It)15 b(can)h(b)q(e)g(used)f(to)g(name)g(an)g
(arbitrary)g(blo)q(c)o(k)h(of)f(co)q(de.)106 1591 y Fo(\017)22
b Ft(It)16 b(can)f(b)q(e)h(manipulated;)h(for)d(example,)i(it)g(can)f(b)q(e)h
(pushed)h(on)o(to)d(a)h(stac)o(k,)f(stored)h(in)i(a)e(closure,)151
1648 y(or)g(placed)h(in)g(a)f(table.)106 1742 y Fo(\017)22
b Ft(It)15 b(can)h(b)q(e)g(used)f(as)g(the)g(destination)i(of)d(a)h(jump.)37
1865 y(W)l(e)g(usually)h(think)f(of)f(lab)q(els)j(as)d(b)q(eing)i(represen)o
(ted)f(b)o(y)f(co)q(de)h(addresses.)20 b(The)15 b(trouble)g(is)g(that)f(C)g
(has)37 1921 y(nothing)j(whic)o(h)g(directly)g(corresp)q(onds)g(to)e(co)q(de)
i(lab)q(els.)24 b(There)16 b(are)g(t)o(w)o(o)e(w)o(a)o(ys)h(out)h(of)g(this)g
(dilemma,)37 1978 y(whic)o(h)h(w)o(e)d(outline)j(in)f(the)f(follo)o(wing)h
(subsections.)37 2127 y Fr(6.2.1)52 b(Using)18 b(a)g(gian)o(t)g
Fp(switch)37 2243 y Ft(The)d(\014rst)g(solution)g(is)g(to)f(map)h(lab)q(els)h
(on)o(to)e(in)o(teger)h(tags,)e(and)i(em)o(b)q(ed)g(the)g(en)o(tire)g
(program)f(in)h(a)f(lo)q(op)37 2299 y(with)i(the)f(follo)o(wing)h(form:)228
2385 y Fp(int)24 b(cont)f(=)h(1;)228 2442 y(while)g(\(TRUE\))f(do)276
2498 y(switch)g(\(cont\))g({)419 2555 y(1:)143 b(...code)23
b(for)h(label)f(1...;)419 2611 y(2:)143 b(...code)23 b(for)h(label)f(2...;)
419 2667 y(...)h(and)f(so)h(on)f(...)276 2724 y(})934 2921
y Ft(42)p eop
%%Page: 43 43
bop 37 199 a Ft(No)o(w)16 b(a)h(jump)f(can)h(b)q(e)g(implemen)o(ted)h(b)o(y)f
(assigning)g(to)f Fp(cont)g Ft(follo)o(w)o(ed)h(b)o(y)f(a)g
Fp(break)g Ft(statemen)o(t.)23 b(The)37 256 y Fp(switch)15
b Ft(statemen)o(t)f(will)j(then)e(re-execute)h(with)g(the)f(new)h(lab)q(el.)
37 342 y(The)f(shortcomings)e(of)h(the)g(tec)o(hnique)h(are)f(clear.)20
b(Firstly)l(,)14 b(a)g(la)o(y)o(er)g(of)f(indirection)j(has)e(b)q(een)h(imp)q
(osed,)37 398 y(b)q(ecause)i(lab)q(els)f(are)f(not)g(implemen)o(ted)i
(directly)g(as)d(co)q(de)i(p)q(oin)o(ters.)37 484 y(Secondly)l(,)h(and)e
(more)f(seriously)l(,)i(separate)e(compilation)j(is)e(made)g(m)o(uc)o(h)g
(more)f(di\016cult.)22 b(The)15 b(C)f(co)q(de)37 541 y(for)19
b(the)h(en)o(tire)g(program,)f(including)j(the)e(run-time)g(system,)g(has)f
(to)g(b)q(e)h(gathered)f(together)g(in)o(to)g(a)37 597 y(single)f(gian)o(t)e
(C)g(pro)q(cedure)i(and)e(then)h(compiled.)25 b(Not)16 b(only)h(do)q(es)f
(this)h(stress)f(the)g(C)h(compiler)g(quite)37 653 y(substan)o(tially)l(,)f
(and)f(imp)q(ose)g(hea)o(vy)g(recompilation)h(costs)e(on)h(ev)o(en)g(lo)q
(cal)g(c)o(hanges,)g(but)f(it)h(also)g(means)37 710 y(that)20
b(a)g(sp)q(ecial)i(link)o(er)g(has)e(to)g(b)q(e)h(written)f(to)g(paste)g
(together)f(the)i(C)f(co)q(de)h(generated)f(from)g(eac)o(h)37
766 y(separately-compiled)e(source-language)d(mo)q(dule.)37
916 y Fr(6.2.2)52 b(Using)18 b(a)g(tin)o(y)f(in)o(terpreter)37
1031 y Ft(Because)j(of)f(these)g(problems)h(w)o(e)f(use)g(an)g(alternativ)o
(e)h(metho)q(d,)g(based)f(on)g(a)g(nice)h(tric)o(k.)32 b(The)19
b(idea)37 1088 y(is)g(to)e(compile)i(eac)o(h)e(lab)q(elled)k(blo)q(c)o(k)d
(of)f(co)q(de)h(to)f(a)g(parameter-less)h(C)f(function)i(whose)e(name)h(is)g
(the)37 1144 y(required)d(lab)q(el.)21 b(No)o(w,)13 b(C)h(do)q(es)g(treat)e
(functions)j(as)e(storable)h(v)m(alues,)g(represen)o(ting)h(eac)o(h)e(b)o(y)h
(a)f(p)q(oin)o(ter)37 1201 y(to)j(its)g(co)q(de.)22 b(The)16
b(only)h(problem)f(is)h(ho)o(w)e(to)g(jump)h(to)f(suc)o(h)i(a)e(co)q(de)i
(blo)q(c)o(k.)22 b(The)16 b(only)h(mec)o(hanism)f(C)37 1257
y(pro)o(vides)i(is)g(to)f(call)i(the)e(function,)i(but)e(then)h(ev)o(ery)f
(jump)h(w)o(ould)g(mak)o(e)f(C's)g(return)g(stac)o(k)g(gro)o(w)f(b)o(y)37
1314 y(one)g(more)f(w)o(ord,)f(causing)i(certain)f(stac)o(k)g(o)o(v)o
(er\015o)o(w.)37 1400 y(A)e(C)f(compiler)i(whic)o(h)f(implemen)o(ted)h(a)f
(tail)g(call)g(as)f(a)g(jump)h(w)o(ould)g(not)f(su\013er)g(from)g(this)h
(problem,)g(but)37 1456 y(it)k(w)o(ould)f(hardly)h(b)q(e)f(a)g(p)q(ortable)g
(solution)h(to)e Fn(r)n(e)n(quir)n(e)h Ft(suc)o(h)g(an)g(optimisation)g(for)g
(correct)f(op)q(eration.)37 1512 y(F)l(urthermore,)k(C)f(is)h(complicated)g
(enough)g(to)f(mak)o(e)g(the)g(tail-call)i(optimisation)f(quite)g(hard)g(to)e
(get)37 1569 y(righ)o(t)d(\(in)g(the)f(presence)h(of)f(v)m(ariadic)i
(functions,)f(for)f(example\))h(and)f(no)h(C)f(compiler)h(kno)o(wn)f(to)g(us)
h(do)q(es)37 1625 y(so.)37 1711 y(So)h(here)g(is)g(the)g(tric)o(k:)20
b(eac)o(h)14 b(parameterless)h(function,)g(represen)o(ting)h(a)e(co)q(de)h
(blo)q(c)o(k,)g Fn(r)n(eturns)g Ft(the)f(co)q(de)37 1768 y(p)q(oin)o(ter)19
b(to)f(whic)o(h)i(it)e(w)o(ould)h(lik)o(e)h(to)e(jump,)h(rather)f(than)g
Fn(c)n(al)r(ling)f Ft(it.)31 b(The)18 b(execution)i(of)e(the)h(en)o(tire)37
1824 y(program)c(is)g(con)o(trolled)h(b)o(y)f(the)h(follo)o(wing)g(one-line)h
(\\in)o(terpreter":)228 1910 y Fp(while)24 b(\(TRUE\))f({)g(cont)h(=)f
(\(*cont\)\(\);)g(})37 1996 y Ft(That)15 b(is,)g Fp(cont)f
Ft(is)h(the)g(address)g(of)f(the)h(co)q(de)g(blo)q(c)o(k)g(\(that)f(is,)h(C)g
(function\))g(to)f(b)q(e)h(executed)h(next.)k(The)37 2053 y(function)c(to)e
(whic)o(h)h(it)g(p)q(oin)o(ts)f(is)h(called,)h(and)f(returns)f(the)h(address)
f(of)g(the)h(next)f(one,)g(and)h(so)f(on.)20 b(The)37 2109
y(lo)q(op)14 b(is)g(\014nally)g(brok)o(en)f(b)o(y)g(a)g(long-jump,)h(though)f
(one)g(could)h(equally)h(w)o(ell)f(test)f Fp(cont)f Ft(for)h(a)f(particular)
37 2166 y(v)m(alue)17 b(instead,)e(for)g(a)g(fairly)h(minor)f(cost.)37
2252 y(Here,)h(for)e(example,)i(is)g(a)e(co)q(de)i(blo)q(c)o(k)g(whic)o(h)g
(jumps)g(to)e(a)h(lab)q(el)i(found)e(on)g(top)g(of)g(the)g(return)g(stac)o
(k:)228 2338 y Fp(CodeLabel)23 b(f\(\))g({)419 2394 y(CodeLabel)g(lbl)g(=)h
(*RetSp--;)419 2451 y(return\()f(lbl)h(\);)228 2507 y(})37
2593 y Ft(The)e(result)f(is)h(a)f(fully-p)q(ortable)i(implemen)o(tation)g
(whic)o(h)f(supp)q(orts)f(separate)f(compilation)j(in)f(the)37
2649 y(usual)16 b(w)o(a)o(y)l(,)e(with)i(a)f(standard)g(link)o(er.)21
b(Lab)q(els)16 b(are)f(represen)o(ted)h(directly)g(b)o(y)f(co)q(de)h
(addresses.)37 2735 y(T)l(emp)q(orary)i(v)m(ariables,)h(used)f(within)h(a)e
(single)i(co)q(de)f(blo)q(c)o(k,)g(are)f(declared)i(as)e(lo)q(cal)i(v)m
(ariables)g(of)e(the)37 2792 y(C)h(function)h(generated)g(for)e(the)i(co)q
(de)f(blo)q(c)o(k.)30 b(Their)19 b(scop)q(e)g(is)f(thereb)o(y)g(limited,)j
(so)d(that)f(a)h(go)q(o)q(d)g(C)934 2921 y(43)p eop
%%Page: 44 44
bop 37 199 a Ft(compiler)17 b(will)g(put)e(them)g(in)h(registers)f(where)h(p)
q(ossible.)37 285 y(It)h(turns)g(out)f(that)g(this)h(idea)h(is)f(actually)g
(v)o(ery)g(old,)g(and)g(that)f(w)o(e)g(only)h(rein)o(v)o(en)o(ted)h(it.)24
b(Lik)o(e)18 b(sev)o(eral)37 342 y(other)d(clev)o(er)i(ideas,)e(Steele)i
(seems)e(to)g(ha)o(v)o(e)g(b)q(een)h(its)g(in)o(v)o(en)o(tor;)f(he)g(called)i
(it)f(the)f(\\UUO)h(handler")g(in)37 398 y(his)f(Rabbit)h(compiler)f(for)f
(Sc)o(heme)g(\(Steele)h([1978]\).)j(The)c(same)g(idea)h(is)g(used)f(b)o(y)h
(T)l(arditi,)f(Ac)o(hary)o(a)g(&)37 455 y(Lee)i([1991],)d(who)i(use)h(C)f(as)
g(a)g(target)f(for)g(their)i(SML)f(compiler.)37 606 y Fm(6.3)56
b(Optimising)16 b(the)j(tin)n(y)f(in)n(terpreter)37 721 y Ft(In)e(the)g(p)q
(ortable)f(tin)o(y)h(in)o(terpreter)f(describ)q(ed)i(ab)q(o)o(v)o(e,)e(a)g
(\\jump")f(has)h(the)h(follo)o(wing)g(o)o(v)o(erheads:)106
845 y Fo(\017)22 b Ft(the)15 b(epilogue)h(generated)e(b)o(y)h(the)f(C)g
(compiler)i(for)e(the)g(curren)o(t)h(C)f(function,)h(concluding)h(with)f(a)
151 901 y(return)g(instruction,)h(whic)o(h)g(p)q(ops)g(the)f(return)g
(address)g(to)g(return)g(to)g(the)g(\\in)o(terpreter";)106
995 y Fo(\017)22 b Ft(a)15 b(jump)g(to)g(implemen)o(t)h(the)g(in)o
(terpreter's)f(lo)q(op;)106 1089 y Fo(\017)22 b Ft(a)15 b(subroutine)h(call)g
(instruction,)g(whic)o(h)g(pushes)g(the)g(in)o(terpreter's)f(return)g
(address;)106 1182 y Fo(\017)22 b Ft(the)15 b(prologue)h(generated)f(b)o(y)g
(the)h(C)e(compiler)j(for)e(the)g(new)g(C)g(function.)37 1306
y(A)o(t)h(the)h(exp)q(ense)g(of)f(p)q(ortabilit)o(y)l(,)h(w)o(e)f(can)h(mak)o
(e)e(some)h(arc)o(hitecture-)h(and)f(compiler-sp)q(eci\014)q(c)j(optimi-)37
1362 y(sations)d(to)e(this)i(jump)f(sequence:)37 1486 y Fr(Eliminating)21
b(register)c(sa)o(v)o(es.)j Ft(F)l(or)d(arc)o(hitectures)g(with)g(a)g
(\014xed)h(register)f(set,)g(most)f(C)h(compilers)151 1542
y(implemen)o(t)22 b(a)f(callee-sa)o(v)o(es)h(con)o(v)o(en)o(tion)f(for)g(all)
h(registers)f(except)g(a)g(small)h(n)o(um)o(b)q(er)f(of)g(w)o(ork)151
1598 y(registers.)f(There)c(is)f(a)g(sa)o(v)o(e)g(sequence)h(at)f(the)g
(start)f(of)h(eac)o(h)h(function)g(and)f(a)g(restore)g(sequence)151
1655 y(at)g(the)g(end.)151 1730 y(Gn)o(u)f(C)f(pro)o(vides)h(a)g(compiler)h
(\015ag)e(whic)o(h)i(mak)o(es)e(the)h(compiler)h(use)f(a)f(caller-sa)o(v)o
(es)h(con)o(v)o(en)o(tion.)151 1787 y(In)21 b(conjunction)g(with)f(the)g
(direct-jump)i(optimisation)e(describ)q(ed)i(b)q(elo)o(w)f(this)f(eliminates)
i(all)151 1843 y(register)15 b(sa)o(v)o(e)g(instructions.)37
1937 y Fr(Eliminating)21 b(the)d(frame)e(p)q(oin)o(ter.)23
b Ft(Most)13 b(C)h(compilers)h(generate)f(instructions)h(at)e(the)h(b)q
(eginning)151 1993 y(and)h(end)h(of)e(functions)i(to)e(set)h(up)g(a)g(frame)f
(p)q(oin)o(ter)h(register.)20 b(This)c(is)f(redundan)o(t,)g(b)q(ecause)h(the)
151 2050 y(compiler)f(can)e(alw)o(a)o(ys)g(\014gure)g(out)g(the)g(o\013sets)f
(of)h(lo)q(cal)i(v)m(ariables)f(from)f(the)g(stac)o(k)g(p)q(oin)o(ter)g
(itself,)151 2106 y(but)i(it)h(is)g(vital)f(for)g(debuggers.)151
2181 y(Gn)o(u)f(C)g(pro)o(vides)g(a)g(compiler)i(\015ag)d(to)h(suppress)g
(frame-p)q(oin)o(ter)h(manipulation,)g(at)f(the)g(exp)q(ense)151
2238 y(of)h(confusing)h(the)f(debugger.)37 2332 y Fr(Generating)k(direct)f
(jumps.)j Ft(Instead)28 b(of)f(generating)h Fp(return\()22
b(lbl)i(\))j Ft(w)o(e)g(actually)h(generate)151 2388 y Fp(JUMP\()23
b(lbl)h(\))p Ft(,)19 b(where)f Fp(JUMP)g Ft(is)h(a)g(macro.)29
b(F)l(or)18 b(a)g(p)q(ortable)h(implemen)o(tation,)h Fp(JUMP)e
Ft(expands)151 2444 y(to)h(a)f Fp(return)h Ft(statemen)o(t,)f(but)h(the)h
(implemen)o(tation)g(can)f(b)q(e)h(made)f(faster)f(b)o(y)h(making)h
Fp(JUMP)151 2501 y Ft(expand)15 b(to)e(an)h(in-line)j(assem)o(bly-co)q(de)e
(instruction)g(whic)o(h)g(really)g(do)q(es)g(tak)o(e)e(a)h(jump.)19
b(\(Most)13 b(C)151 2557 y(compilers)h(pro)o(vide)g(an)f(assem)o
(bly-language)g(trap)q(do)q(or,)g(whic)o(h)h(w)o(e)e(exploit)i(here.\))20
b(Using)13 b(in-line)151 2614 y(assem)o(bly)g(co)q(de)g(in)h(this)f(w)o(a)o
(y)e(has)i(its)g(pitfalls,)h(esp)q(ecially)h(if)e(w)o(e)g(sim)o(ultaneously)h
(try)e(to)g(use)h(lo)q(cal)151 2670 y(v)m(ariables.)21 b(Miranda)16
b(giv)o(es)f(details)h(of)f(the)g(tric)o(ky)g(things)h(one)f(has)g(to)g(do)g
(\(Miranda)g([1991]\).)934 2921 y(44)p eop
%%Page: 45 45
bop 37 199 a Fm(6.4)56 b(Debugging)37 315 y Ft(The)20 b(use)f(of)f(a)h(tin)o
(y)g(in)o(terpreter)g(turned)h(out)e(to)g(ha)o(v)o(e)h(a)g(v)o(ery)f(useful)i
(prop)q(ert)o(y)f(whic)o(h)h(w)o(e)e(had)h(not)37 371 y(an)o(ticipated:)i(it)
16 b(is)f(a)g(tremendous)h(debugging)g(aid.)37 457 y(The)g(STG)g(mac)o(hine)g
(frequen)o(tly)g(tak)o(es)f(an)g(indirect)j(jump,)d(to)g(the)h(co)q(de)g(p)q
(oin)o(ted)g(to)f(b)o(y)h(a)f(closure.)22 b(If)37 513 y(a)15
b(bug)f(has)h(caused)g(a)f(closure)h(to)f(b)q(e)h(corrupted,)f(this)h
(indirect)h(jump)f(usually)h(causes)e(a)g(segmen)o(tation)37
570 y(fault)k(or)f(illegal)i(instruction.)27 b(The)18 b(di\016cult)o(y)h(is)e
(that)g(there)g(usually)i(no)e(w)o(a)o(y)g(of)g(bac)o(king)g(up)h(to)f(the)37
626 y(co)q(de)f(whic)o(h)g(p)q(erformed)f(the)g(jump,)g(whic)o(h)h(is)g(the)f
(\014rst)f(step)h(in)h(iden)o(tifying)h(the)e(source)g(of)g(the)g(error.)37
712 y(Using)d(the)f(\(unoptimised\))h(tin)o(y)f(in)o(terpreter)g(pro)o(vides)
g(an)g(easy)g(solution,)h(b)q(ecause)g(it)f(can)g(easily)h(record)37
769 y(a)i(trail)h(of)e(the)i(most)e(recen)o(t)h(few)g(jumps.)20
b(Since)15 b(ev)o(ery)f(jump)g(passes)g(through)g(the)g(tin)o(y)h(in)o
(terpreter,)f(it)37 825 y(faithfully)j(records)e(the)h(address)f(of)g(the)g
(co)q(de)h(blo)q(c)o(k)g(con)o(taining)g(the)f(fatal)g(jump.)37
911 y(F)l(urthermore,)23 b(it)e(is)h(easy)g(to)e(add)i(to)f(the)g(tin)o(y)h
(in)o(terpreter's)f(lo)q(op)h(a)f(call)i(to)e(a)g(h)o(ygiene-c)o(hec)o(king)
37 968 y(routine,)13 b(whic)o(h)f(c)o(hec)o(ks)f(that)f(the)i(mac)o(hine)g
(state)e(lo)q(oks)h(plausible.)21 b(While)13 b(it)e(slo)o(ws)g(do)o(wn)g(the)
g(program)37 1024 y(considerably)l(,)21 b(w)o(e)e(ha)o(v)o(e)f(found)h(this)g
(h)o(ygiene-c)o(hec)o(king)i(an)d(in)o(v)m(aluable)k(aid)d(for)f(trapping)h
(the)f(p)q(oin)o(t)37 1081 y(at)e(whic)o(h)i(the)e(mac)o(hine)h(state)f(b)q
(ecomes)h(corrupt,)f(rather)g(than)g(the)h(p)q(oin)o(t)g(at)f(whic)o(h)h(the)
g(corruption)37 1137 y(causes)f(a)f(crash,)f(whic)o(h)j(is)e(often)g(m)o(uc)o
(h)g(m)o(uc)o(h)h(later.)37 1223 y(It)c(is)h(hard)e(to)h(o)o(v)o(erstate)e
(the)i(usefulness)h(of)e(this)h(tric)o(k,)g(esp)q(ecially)j(since)e(it)f(has)
f(no)h(impact)g(at)f(all)i(on)f(the)37 1280 y(compiler)18 b(and)e(the)g(co)q
(de)h(it)f(generates.)23 b(Only)17 b(p)q(eople)g(who)f(ha)o(v)o(e)g(sp)q(en)o
(t)g(all)h(nigh)o(t)g(trying)f(to)f(\014nd)i(the)37 1336 y(cause)g(of)f(the)h
(heap)g(corruption)g(whic)o(h)g(subsequen)o(tly)h(led)f(to)f(a)g(system)g
(crash)h(can)g(truly)f(appreciate)37 1392 y(it!)37 1565 y Fs(7)67
b(The)23 b(heap)37 1696 y Ft(The)17 b(heap)f(is)h(a)f(collection)i(of)d
Fn(closur)n(es)h Ft(of)f(v)m(ariable)j(size,)f(eac)o(h)f(iden)o(ti\014ed)i(b)
o(y)e(a)g(unique)i Fn(addr)n(ess)p Ft(.)k(W)l(e)37 1753 y(use)16
b(the)f(term)g Fn(p)n(ointer)g Ft(to)g(refer)g(to)f(the)h(address)h(of)e(a)h
(closure.)37 1904 y Fm(7.1)56 b(Ho)n(w)20 b(closures)e(are)g(represen)n(ted)
37 2019 y Ft(Eac)o(h)g(closure)g(o)q(ccupies)i(a)d(con)o(tiguous)h(sequence)h
(of)e(mac)o(hine)h(w)o(ords,)g(whic)o(h)g(is)g(alw)o(a)o(ys)f(laid)i(out)e
(as)37 2076 y(sho)o(wn)e(in)h(Figure)g(4.)37 2162 y(The)i(\014rst)g(w)o(ord)f
(of)g(a)h(closure)g(is)g(called)i(its)e Fn(info)g(p)n(ointer)p
Ft(,)g(and)g(p)q(oin)o(ts)g(to)f(its)h Fn(info)g(table)p Ft(.)27
b(F)l(ollo)o(wing)37 2218 y(the)17 b(info)g(p)q(oin)o(ter)g(is)g(a)f(blo)q(c)
o(k)i(of)e(w)o(ords)g(eac)o(h)g(of)g(whic)o(h)i(con)o(tains)e(a)h(p)q(oin)o
(ter,)g(follo)o(w)o(ed)f(b)o(y)h(a)f(blo)q(c)o(k)h(of)37 2275
y(w)o(ords)e(con)o(taining)g(no)g(p)q(oin)o(ters.)20 b(\(The)15
b(distinction)i(b)q(et)o(w)o(een)e(the)g(t)o(w)o(o)f(is)h(that)f(the)h
(garbage)f(collector)37 2331 y(m)o(ust)j(follo)o(w)f(the)h(former)f(but)h
(not)f(the)h(latter.\))23 b(There)17 b(is)h(a)e(single,)i(statically-allo)q
(cated,)g(info)g(table)37 2387 y(asso)q(ciated)i(with)g(eac)o(h)g
Fn(bind)k Ft(in)c(the)g(program)f(text)g(\(Figure)g(3\).)33
b(Eac)o(h)19 b(dynamic)i(instance)f(of)g(this)37 2444 y(binding)e(is)d(a)g
(heap-allo)q(cated)i(closure)f(whose)f(info-p)q(oin)o(ter)h(refers)f(to)g
(its)g(static)g(info)h(table)g(\(Rule)g(3\).)37 2530 y(The)11
b(info)g(table)f(con)o(tains)g(a)g(n)o(um)o(b)q(er)h(of)e(\014elds)j(whic)o
(h)f(will)h(b)q(e)f(describ)q(ed)h(later,)e(but)h(the)f(most)f(imp)q(ortan)o
(t)37 2586 y(is)16 b(the)f(\014rst)g(\014eld,)h(whic)o(h)f(con)o(tains)g(the)
h(lab)q(el)g(of)f(the)g(closure's)g Fn(standar)n(d-entry)h(c)n(o)n(de)p
Ft(.)k(The)15 b(op)q(eration)37 2643 y(of)g Fn(entering)f Ft(a)h(closure)h
(is)g(p)q(erformed)f(b)o(y:)106 2766 y Fo(\017)22 b Ft(loading)16
b(the)g(address)f(of)g(the)g(closure)h(in)o(to)f(the)g Fp(Node)g
Ft(register,)g(and)934 2921 y(45)p eop
%%Page: 46 46
bop 754 735 a Fd(t)746 633 y(t)746 532 y(t)390 296 y(t)p 192
152 1514 4 v 192 988 4 837 v 1702 988 V 192 991 1514 4 v 388
532 4 233 v 390 534 165 4 v 514 532 a Fi(-)p 585 478 333 4
v 585 872 4 394 v 915 872 V 585 875 333 4 v 754 729 424 4 v
1136 727 a(-)p 754 631 V 1136 629 a(-)p 754 534 V 1136 532
a(-)p 589 778 327 4 v 589 680 V 589 583 V 1044 349 4 132 v
1440 219 199 4 v 1637 349 4 132 v 1440 350 199 4 v 1172 218
a Fy(.)21 b(.)g(.)g(.)g(.)f(.)h(.)g(.)g(.)1172 349 y(.)g(.)g(.)g(.)g(.)f(.)h
(.)g(.)g(.)p 915 350 263 4 v 915 219 V -799 w(.)f(.)h(.)g(.)g(.)g(.)f(.)h(.)g
(.)648 218 y(.)f(.)h(.)g(.)g(.)g(.)f(.)h(.)g(.)p 259 219 394
4 v 257 349 4 132 v 259 350 394 4 v 587 349 4 132 v 1211 547
a Ft(Standard)15 b(en)o(try)g(co)q(de)1211 645 y(Ev)m(acuation)h(co)q(de)1211
742 y(Sca)o(v)o(enge)f(co)q(de)623 843 y(Other)g(info...)652
450 y(Info)h(table)638 300 y(P)o(oin)o(ter)e(w)o(ords)264 b(Non-p)q(oin)o
(ter)16 b(w)o(ords)293 270 y(Info)f(p)q(oin)o(ter)628 1088
y(Figure)g(4:)20 b(The)15 b(la)o(y)o(out)g(of)g(a)g(closure)106
1225 y Fo(\017)22 b Ft(jumping)16 b(to)d(the)i(standard-en)o(try)f(co)q(de)h
(for)f(the)h(closure,)g(whose)f(lab)q(el)j(is)e(usually)h(fetc)o(hed)f(from)
151 1282 y(the)g(info)h(table)g(b)o(y)f(indirecting)i(from)e
Fp(Node)o Ft(.)37 1405 y(The)20 b(standard-en)o(try)g(co)q(de)g(can)g(access)
g(the)g(v)m(arious)g(\014elds)h(of)e(the)h(closure)h(b)o(y)e(indexing)j(from)
d(the)37 1461 y Fp(Node)c Ft(register.)20 b(The)15 b(rest)g(of)g(the)g(info)h
(table)f(con)o(tains:)106 1585 y Fo(\017)22 b Ft(Enough)14
b(information)g(to)g(enable)h(the)f(garbage-collector)g(to)f(do)h(its)h(job.)
k(In)14 b(fact)g(w)o(e)g(implemen)o(t)151 1641 y(this)i(information)f(as)g(t)
o(w)o(o)f(co)q(de)i(lab)q(els,)g(whic)o(h)g(are)f(describ)q(ed)i(further)e
(in)h(Section)g(7.3.)106 1735 y Fo(\017)22 b Ft(Debugging)16
b(information)f(for)g(insp)q(ection)i(b)o(y)e(a)g(debugger)g(or)g(trace)g
(generator.)106 1829 y Fo(\017)22 b Ft(F)l(or)13 b(our)g(parallel)h(implemen)
o(tation,)h(enough)e(information)h(to)e(enable)i(the)g(closure)g(to)e(b)q(e)i
(\015ushed)151 1885 y(in)o(to)h(global)h(memory)l(.)k(This,)15
b(to)q(o,)f(is)i(actually)g(implemen)o(ted)h(as)e(a)g(co)q(de)g(lab)q(el.)37
2009 y(It)h(is)h(usual)g(for)e(heap-allo)q(cated)i(ob)s(jects)f(to)f(con)o
(tain)h(la)o(y)o(out)f(information,)h(to)f(sp)q(ecify)j(their)e(size)h(and)37
2065 y(whic)o(h)23 b(of)e(their)h(\014elds)h(con)o(tain)f(p)q(oin)o(ters.)39
b(In)23 b(con)o(trast,)e(our)h(closures)g(do)f(not)h(con)o(tain)f(an)o(y)h
(suc)o(h)37 2122 y(information.)e(Rather,)14 b(as)f(w)o(e)h(shall)h(see,)f
(size)h(and)f(la)o(y)o(out)f(information)h(is)h(enco)q(ded)g(in)g(the)f(info)
g(table.)37 2207 y Fn(Indir)n(e)n(ction)f(closur)n(es)f Ft(are)g(generated)h
(b)o(y)f(up)q(date)i(op)q(erations,)f(and)g(they)f(ha)o(v)o(e)h(a)f
(particularly)i(e\016cien)o(t)37 2264 y(represen)o(tation:)p
996 2346 207 4 v 1161 2344 a Fi(-)p 919 2400 4 94 v 674 2305
457 4 v 674 2399 4 94 v 1127 2399 V 674 2402 457 4 v 696 2363
a Fy(Ind)p 759 2363 13 2 v 15 w(Info)376 b(P)o(oin)o(ter)14
b(to)g(another)h(closure)37 2465 y Ft(The)22 b(standard-en)o(try)f(co)q(de)g
(for)g Fp(Ind_Info)f Ft(consists)h(of)g(only)h(t)o(w)o(o)e(instructions:)33
b(one)21 b(to)f(load)i(the)37 2522 y(indirection)c(p)q(oin)o(ter)e(from)e
(the)h(closure)h(in)o(to)f Fp(Node)g Ft(and)g(a)g(second)h(to)f(en)o(ter)g
(the)g(new)g(closure.)37 2608 y(In)k(retrosp)q(ect,)e(this)h(represen)o
(tation)f(is)h(quite)g(similar)h(to)e(that)f(c)o(hosen)i(b)o(y)f(the)h
(Chalmers)f(group)h(for)37 2664 y(their)i(G-mac)o(hine)g(implemen)o(tation)g
(\(Johnsson)f([1987]\).)29 b(In)19 b(their)h(system,)f(ev)o(ery)g(heap)g
(cell)h(has)f(a)37 2721 y(one-w)o(ord)d(\\tag")e(whic)o(h)j(p)q(oin)o(ts)f
(to)f(a)g(table)h(of)g(en)o(try)f(p)q(oin)o(ts)h(for)f(the)h(v)m(arious)g(op)
q(erations)g(that)f(could)37 2777 y(b)q(e)20 b(p)q(erformed)f(on)f(the)h
(cell.)32 b(Our)19 b(system)f(di\013ers)h(from)f(theirs)h(in)g(t)o(w)o(o)f
(resp)q(ects.)30 b(First,)19 b(and)g(most)934 2921 y(46)p eop
%%Page: 47 47
bop 37 199 a Ft(imp)q(ortan)o(t,)17 b(rather)f(than)h(ha)o(ving)h(a)e
(\014xed)i(collection)h(of)d(\\tags",)g(w)o(e)g(generate)h(a)g(new)g(info)g
(table)h(for)37 256 y(eac)o(h)e Fn(bind)k Ft(in)c(the)g(program)e(text,)h
(together)g(with)g(its)h(asso)q(ciated)g(co)q(de.)21 b(This)16
b(essen)o(tially)h(eliminates)37 312 y(the)c(\\in)o(terpretiv)o(e)g(un)o
(wind")g(used)h(b)o(y)e(the)h(G-mac)o(hine.)19 b(Second,)14
b(the)e(op)q(eration)h(of)f(en)o(tering)h(a)f(closure)37 369
y(in)o(v)o(olv)o(es)i(an)f(indirection)i(to)d(\014nd)i(the)f(co)q(de)h(lab)q
(el)h(to)d(jump)h(to;)g(this)g(indirection)i(can)f(b)q(e)f(a)o(v)o(oided)g
(when)37 425 y(generating)j(nativ)o(e)f(co)q(de)h(directly)l(,)g(as)f
(Section)h(7.6)f(discusses.)37 576 y Fm(7.2)56 b(Allo)r(cation)37
692 y Ft(The)12 b(closures)h(for)e(top-lev)o(el)i(globals)f(are)f(allo)q
(cated)i(statically)f(at)f(\014xed)i(addresses;)f(w)o(e)g(call)g(them)g
Fn(static)37 748 y(closur)n(es)p Ft(.)23 b(A)16 b(static)g(closure)h(is)g
(not)f(necessarily)h(imm)o(utable,)g(ho)o(w)o(ev)o(er,)f(b)q(ecause)h(it)f
(ma)o(y)g(b)q(e)h(a)f(th)o(unk)37 805 y(whic)o(h)i(is)f(up)q(dated)g(during)g
(execution.)25 b(\(The)16 b(alert)g(reader)g(will)j(sp)q(ot)d(that)f(this)i
(p)q(olicy)h(giv)o(es)f(rise)g(to)37 861 y(a)e(garbage-collection)i(problem,)
e(whic)o(h)h(w)o(e)f(return)g(to)g(in)h(Section)g(10.8.\))37
947 y(All)j(other)e(closures)h(are)f(allo)q(cated)h(dynamically)h(from)e(the)
g(heap.)27 b(As)17 b(is)h(no)o(w)e(w)o(ell)j(understo)q(o)q(d,)f(for)37
1003 y(go)q(o)q(d)c(p)q(erformance)g(it)g(is)g(essen)o(tial)h(to)e(allo)q
(cate)h(from)f(a)h(con)o(tiguous)g(blo)q(c)o(k)g(of)f(free)h(space,)g(rather)
f(than)37 1060 y(from)f(a)h(free)f(list)i(\(App)q(el)g([1987]\).)j(F)l(ree)12
b(space)h(is)g(delimited)i(b)o(y)e(t)o(w)o(o)e(sp)q(ecial)k(registers:)j(the)
13 b Fp(Hp)f Ft(register)37 1116 y(p)q(oin)o(ts)j(to)f(one)g(end)h(of)e(it,)i
(while)g(the)g Fp(HLimit)e Ft(register)h(p)q(oin)o(ts)g(to)g(the)g(other.)19
b(Allo)q(cation)d(is)f(done)f(on)g(a)37 1173 y(basic-blo)q(c)o(k)j(basis,)f
(so)e(that)h(only)h(one)f(free-space)h(exhaustion)f(c)o(hec)o(k)h(is)g(made)f
(for)f(eac)o(h)i(basic)g(blo)q(c)o(k.)37 1324 y Fm(7.3)56 b(Tw)n(o-space)19
b(garbage)g(collection)37 1439 y Ft(Garbage)12 b(collection)j(is)e(p)q
(erformed)f(b)o(y)h(a)f(t)o(w)o(o-space)g(stop-and-cop)o(y)g(collector)i
(\(Bak)o(er)e([1978]\).)k(Av)m(ail-)37 1496 y(able)j(memory)f(is)h(divided)h
(in)o(to)e(t)o(w)o(o)f(semi-spaces.)30 b(When)19 b(garbage)e(collection)j(is)
f(initiated,)h(all)f(liv)o(e)37 1552 y(closures)d(are)f(copied)i(from)d(one)h
(semi-space)i(to)d(\(one)h(end)h(of)t(\))e(the)h(other.)37
1638 y(This)h(cop)o(ying)g(pro)q(cess)f(in)o(v)o(olv)o(es)h(t)o(w)o(o)e
(basic)i(op)q(erations)f(on)g(closures:)106 1762 y Fo(\017)22
b Ft(Eac)o(h)15 b(liv)o(e)h(closure)g(m)o(ust)f(b)q(e)h Fn(evacuate)n(d)g
Ft(from)e(from-space)h(to)f(to-space.)106 1855 y Fo(\017)22
b Ft(As)15 b(to-space)f(is)h(scanned)h(linearly)l(,)g(eac)o(h)f(closure)g(m)o
(ust)f(b)q(e)h Fn(sc)n(avenge)n(d)p Ft(;)e(that)h(is,)h(eac)o(h)f(closure)i
(to)151 1912 y(whic)o(h)h(it)g(p)q(oin)o(ts)g(m)o(ust)e(b)q(e)i(ev)m
(acuated,)g(unless)h(it)f(has)f(already)g(b)q(een)i(ev)m(acuated,)f(and)f
(the)h(new)151 1968 y(to-space)e(p)q(oin)o(ter)h(substituted)g(for)e(the)i
(old)f(from-space)g(p)q(oin)o(ter.)37 2092 y(The)j(un)o(usual)f(feature)g(of)
f(our)h(system)f(is)h(that)f(these)h(t)o(w)o(o)f(op)q(erations,)h(ev)m
(acuation)g(and)g(sca)o(v)o(enging,)37 2148 y(are)c(implemen)o(ted)h(b)o(y)f
(co)q(de)g(p)q(oin)o(ted)h(to)e(from)g(the)h(info)g(table)g(of)g(eac)o(h)g
(closure.)19 b(These)13 b(co)q(de)h(sequences)37 2205 y(\\kno)o(w")20
b(the)g(exact)g(structure)g(of)g(the)g(closure,)i(and)f(therefore)e(can)i(op)
q(erate)f(without)g(in)o(terpretiv)o(e)37 2261 y(lo)q(ops,)c(and)f(without)g
(an)o(y)g(further)g(la)o(y)o(out)g(information.)37 2347 y(The)h(ev)m
(acuation)g(co)q(de,)f(whic)o(h)h(is)g(called)h(as)e(a)g(C)g(function,)g(do)q
(es)h(the)f(follo)o(wing:)106 2470 y Fo(\017)22 b Ft(It)15
b(copies)h(the)g(closure)g(in)o(to)f(to-space.)106 2564 y Fo(\017)22
b Ft(It)17 b(o)o(v)o(erwrites)g(the)g(closure)h(in)g(from-space)f(with)g(a)g
Fn(forwar)n(ding)i(p)n(ointer)p Ft(,)e(whic)o(h)h(p)q(oin)o(ts)f(to)g(the)151
2621 y(newly-allo)q(cated)g(cop)o(y)e(of)g(the)g(closure)h(in)g(to-space.)106
2714 y Fo(\017)22 b Ft(It)15 b(returns)g(the)h(new)f(to-space)g(address)g(of)
g(the)g(closure)h(to)f(the)g(caller.)934 2921 y(47)p eop
%%Page: 48 48
bop 37 199 a Ft(The)19 b(sca)o(v)o(enging)e(co)q(de)i(of)e(a)g(closure,)i
(also)f(called)h(as)f(a)f(C)h(function,)h(do)q(es)f(the)f(follo)o(wing.)29
b(F)l(or)17 b(eac)o(h)37 256 y(p)q(oin)o(ter)f(in)g(the)g(closure,)106
379 y Fo(\017)22 b Ft(it)16 b(calls)g(the)f(ev)m(acuation)h(co)q(de)g(for)f
(the)g(closure)h(to)e(whic)o(h)i(it)g(p)q(oin)o(ts;)106 473
y Fo(\017)22 b Ft(it)c(replaces)h(the)e(p)q(oin)o(ter)h(in)h(the)e(original)i
(closure)f(with)g(the)g(to-space)g(p)q(oin)o(ter)g(returned)g(from)151
529 y(this)e(ev)m(acuation)g(call.)37 653 y(The)d(sca)o(v)o(enging)g(co)q(de)
g(kno)o(ws)f(whic)o(h)i(of)e(the)h(argumen)o(t)f(\014elds)h(con)o(tain)g
(closure)h(addresses)e(\(and)h(hence)37 709 y(m)o(ust)i(b)q(e)h(ev)m
(acuated\),)f(and)h(whic)o(h)g(are)e(not)h(\(and)g(hence)i(m)o(ust)d
Fn(not)h Ft(b)q(e)h(ev)m(acuated\).)37 795 y(A)g(C)f(function)i(do)q(es)e
(the)h(once-p)q(er-collection)j(w)o(ork)14 b(of)h(switc)o(hing)i(spaces)e
(and)h(accum)o(ulating)g(statis-)37 852 y(tical)f(information,)f(but)g
(almost)f(all)i(the)f(w)o(ork)f(of)h(garbage-collection)h(is)f(carried)g(out)
g(b)o(y)g(the)g(ev)m(acuate)37 908 y(and)i(sca)o(v)o(enge)g(routines)g(of)f
(the)h(closures)g(in)g(the)g(heap.)22 b(As)15 b(in)i(the)f(case)f(of)h(the)f
(standard-en)o(try)g(co)q(de)37 964 y(of)j(a)g(closure,)h(the)f(info-table)h
(dispatc)o(h)f(mec)o(hanism)h(for)e(ev)m(acuation)i(and)f(sca)o(v)o(enging)g
(pro)o(vides)h(the)37 1021 y(opp)q(ortunit)o(y)d(to)e(deal)i(with)g(sev)o
(eral)f(sp)q(ecial)i(cases)e(\\for)g(free")g(\(that)f(is,)h(without)g(an)o(y)
g(further)g(tests\):)37 1157 y Fr(F)l(orw)o(arding)i(p)q(oin)o(ters.)23
b Ft(A)15 b(forw)o(arding)f(p)q(oin)o(ter)h(handles)i(the)e(situation)g
(where)h(a)e(second)i(attempt)151 1213 y(is)23 b(made)f(to)g(ev)m(acuate)g
(the)g(closure;)k(an)d(attempt)e(to)g(ev)m(acuate)i(a)f(closure)h(whic)o(h)g
(has)f(b)q(een)151 1270 y(o)o(v)o(erwritten)f(with)h(a)f(forw)o(arding)g(p)q
(oin)o(ter)i(simply)g(returns)e(the)h(to-space)f(address)h(found)g(in)151
1326 y(the)g(forw)o(arding)f(p)q(oin)o(ter.)41 b(There)22 b(is)g(a)g(nice)h
(optimisation)g(a)o(v)m(ailable)g(here.)41 b(Most)20 b(systems)151
1383 y(distinguish)h(a)d(forw)o(arding)g(p)q(oin)o(ter)h(b)o(y)g(some)f(sort)
g(of)g(tag)g(bit,)h(whic)o(h)h(has)e(to)g(b)q(e)i(tested)e(just)151
1439 y(b)q(efore)23 b(ev)m(acuating.)42 b(Instead,)24 b(w)o(e)e(mak)o(e)g(a)g
(forw)o(arding)f(p)q(oin)o(ter)i(lo)q(ok)g(just)f(lik)o(e)h(an)o(y)f(other)
151 1495 y(closure:)29 b(it)19 b(has)g(an)g(info)h(p)q(oin)o(ter)g(and)f(one)
h(\014eld)g(whic)o(h)g(p)q(oin)o(ts)g(to)e(the)i(to-space)f(cop)o(y)l(.)32
b(The)151 1552 y(info)22 b(table)g(for)f(a)g(forw)o(arding)f(p)q(oin)o(ter)i
(has)g(rather)e(simple)j(\\ev)m(acuation")f(co)q(de,)h(whic)o(h)f(just)151
1608 y(returns)16 b(the)g(to-space)f(address)h(found)g(in)h(the)f(forw)o
(arding)f(p)q(oin)o(ter!)23 b(So)15 b(to)g(ev)m(acuate)i(a)e(closure)151
1665 y(one)20 b(simply)h(jumps)f(to)g(its)g(ev)m(acuation)h(co)q(de,)g
(regardless)f(of)g(whether)g(the)g(closure)g(is)h(no)o(w)e(a)151
1721 y(forw)o(arding)c(p)q(oin)o(ter)g(or)g(not.)20 b(No)14
b(forw)o(arding-p)q(oin)o(ter)i(test)e(is)i(p)q(erformed.)151
1796 y(All)h(heap-allo)q(cated)h(closures)e(are)g(at)f(least)h(t)o(w)o(o)f(w)
o(ords)g(long,)h(in)g(order)g(to)f(lea)o(v)o(e)h(enough)h(space)151
1853 y(for)e(a)g(forw)o(arding)f(p)q(oin)o(ter.)37 1947 y Fr(Indirections.)24
b Ft(All)17 b(indirections)i(can)e(easily)h(b)q(e)f(remo)o(v)o(ed)f(during)i
(garbage)d(collection,)k(b)o(y)d(another)151 2003 y(nice)j(tric)o(k.)28
b(All)19 b(that)e(is)h(required)h(is)g(that)e(the)h(ev)m(acuation)g(routine)h
(of)e(an)h(indirection)i(jumps)151 2060 y(to)e(the)h(ev)m(acuation)g(routine)
g(of)f(the)h(closure)g(to)f(whic)o(h)h(the)g(indirection)i(p)q(oin)o(ts!)30
b(\(The)19 b(use)f(of)151 2116 y(\\jumps)c(to")f(rather)h(than)g(\\calls")g
(is)h(delib)q(erate)h(|)e(this)h(is)g(a)e(tail)i(call!\))20
b(Since)c(indirections)g(are)151 2172 y(thereb)o(y)f(nev)o(er)h(mo)o(v)o(ed)e
(in)o(to)i(to-space,)e(they)i(don't)e(ha)o(v)o(e)h(a)g(sca)o(v)o(enging)g
(routine.)37 2266 y Fr(Static)20 b(closures.)i Ft(Some)12 b(closures,)i
(notably)e(those)h(for)f(global)h(closures)g(\(Section)g(5.1\),)f(are)g(allo)
q(cated)151 2323 y(at)k(\014xed,)i(static)e(lo)q(cations.)25
b(These)18 b(closures)f(m)o(ust)f(not)h(b)q(e)g(mo)o(v)o(ed)f(b)o(y)h(the)g
(garbage)f(collector.)151 2379 y(This)k(is)g(easily)g(arranged)f(b)o(y)g
(making)g(their)h(ev)m(acuation)g(co)q(de)g(return)f(immediately)i(without)
151 2436 y(mo)o(ving)15 b(the)h(closure.)151 2511 y(Constructor)j(closures)h
(can)g(exist)g(in)g(b)q(oth)g(static)f(and)h(dynamic)h(space)f(\(Section)g
(4.4\),)f(so)g(in)151 2567 y(fact)g(w)o(e)h(need)g(t)o(w)o(o)f(info)h(tables)
g(for)f(eac)o(h)h(constructor,)g(one)f(for)h(eac)o(h)f(of)h(these)g(cases.)33
b(\(The)151 2624 y(standard-en)o(try)15 b(co)q(de)h(for)e(the)h(constructor)g
(can)g(still)i(b)q(e)f(shared,)f(of)f(course.\))37 2718 y Fr(Small)19
b(in)o(tegers.)j Ft(A)11 b(\014xed-precision)j(in)o(teger)d(\(of)g(t)o(yp)q
(e)g Fp(Int)p Ft(\))f(is)i(represen)o(ted)g(b)o(y)f(the)g Fp(MkInt)g
Ft(construc-)151 2774 y(tor)16 b(applied)i(to)d(the)i(primitiv)o(e)g(in)o
(teger)g(v)m(alue)g(\(Section)g(4.7\).)22 b(This)16 b(in)h(turn)g(is)f
(represen)o(ted)h(b)o(y)934 2921 y(48)p eop
%%Page: 49 49
bop 151 199 a Ft(a)14 b(t)o(w)o(o-w)o(ord)f(closure)i(consisting)g(of)f(the)g
Fp(MkInt)g Ft(info)g(p)q(oin)o(ter)h(and)g(the)f(primitiv)o(e)i(in)o(teger)e
(v)m(alue.)151 256 y(The)j(ev)m(acuation)g(co)q(de)g(for)e
Fp(MkInt)h Ft(sees)g(if)h(the)f(v)m(alue)i(of)e(the)g(in)o(teger)h(lies)g(in)
g(a)f(pre-determined)151 312 y(range)i(and,)g(if)g(so,)g(uses)g(the)g(in)o
(teger)h(to)e(index)i(a)f(table)g(of)f(statically-allo)q(cated)j
Fp(Int)e Ft(closures,)151 369 y(returning)j(the)f(address)h(of)e(this)i
(static)f(closure.)36 b(The)20 b(e\013ect)g(is)h(that)f(all)h(small)g(in)o
(tegers)f(are)151 425 y(\\commoned)13 b(up")h(b)o(y)f(the)g(garbage)f
(collector,)i(and)g(made)f(to)g(p)q(oin)o(t)h(to)e(one)h(of)g(a)g(\014xed)h
(collection)151 482 y(of)h(small-in)o(teger)h(closures.)151
557 y(If)j(the)f(in)o(teger)g(is)h(not)f(in)h(the)f(range)g(of)g(the)g
(table,)h(the)f(closure)h(is)g(ev)m(acuated)g(to)e(to-space)h(as)151
613 y(usual.)31 b(There)18 b(is)h(an)g(easy)f(re\014nemen)o(t:)27
b(giv)o(e)19 b(the)f(new)h(cop)o(y)f(a)g(di\013eren)o(t)h(info)g(p)q(oin)o
(ter)g(whic)o(h)151 670 y(w)o(on't)14 b(p)q(erform)h(the)g(test)g(again)g
(next)h(time)f(\(b)q(ecause)h(it)f(will)i(certainly)f(fail)g(again\).)151
745 y(The)i(small-in)o(teger)h(c)o(hec)o(k)f(could)g(of)f(course)h(b)q(e)g
(made)g(at)f(the)g(time)h(an)g Fp(Int)f Ft(is)h(allo)q(cated,)h(but)151
801 y(that)h(means)h(generating)f(extra)g(co)q(de)i(in)f(lots)f(of)h(places,)
h(whereas)f(doing)g(it)g(in)g(the)g(garbage)151 858 y(collector)16
b(requires)g(just)f(one)g(c)o(h)o(unk)h(of)f(extra)f(co)q(de.)21
b(The)15 b(same)g(optimisation)h(applies)h(to)e Fp(Char)151
914 y Ft(closures)h(and)f(all)h(other)f(constructors)g(isomorphic)h(to)e
Fp(Int)h Ft(or)g Fp(Char)o Ft(.)37 1065 y Fm(7.4)56 b(Other)18
b(garbage)h(collector)e(v)m(arian)n(ts)37 1181 y Ft(Tw)o(o-space)g(garbage)e
(collection)k(w)o(orks)c(w)o(ell)j(un)o(til)f(the)g(residency)h(of)e(the)h
(program)e(approac)o(hes)i(half)37 1237 y(the)g(real)g(memory)f(a)o(v)m
(ailable,)i(at)e(whic)o(h)h(p)q(oin)o(t)g(the)f(virtual)h(memory)f(system)g
(b)q(egins)i(to)e(thrash.)23 b(W)l(e)37 1294 y(ha)o(v)o(e)15
b(implemen)o(ted)i(a)d(dual-mo)q(de)j(collector,)e(whic)o(h)h(switc)o(hes)f
(dynamically)i(b)q(et)o(w)o(een)e(a)g(single-space)37 1350
y(compacting)21 b(collector)g(and)g(a)f(t)o(w)o(o-space)g(collector)h(to)f
(try)g(to)g(minimise)i(paging,)g(with)f(encourag-)37 1406 y(ing)e(early)g
(results)g(\(Sansom)e([1991]\).)27 b(W)l(e)19 b(are)f(dev)o(eloping)i(a)e
(further)g(extension)h(to)e(a)h(generational)37 1463 y(collector,)e(based)g
(on)f(App)q(el's)h(simple)h(t)o(w)o(o-generation)d(sc)o(heme)i(\(App)q(el)g
([1989]\).)37 1614 y Fm(7.5)56 b(T)-5 b(rading)19 b(co)r(de)f(size)g(for)h
(sp)r(eed)37 1730 y Ft(The)11 b(info-table)h(dispatc)o(h)f(mec)o(hanism)g
(outlined)g(ab)q(o)o(v)o(e)f(allo)o(ws)h(some)f(in)o(teresting)h(space-time)g
(tradeo\013s)37 1786 y(to)k(b)q(e)h(made.)37 1872 y(So)21 b(far)f(w)o(e)g(ha)
o(v)o(e)g(assumed)h(that)e(eac)o(h)i(kind)h(of)e(closure)h(has)f(its)h(o)o
(wn)f(ev)m(acuation)h(and)g(sca)o(v)o(enging)37 1928 y(co)q(de,)15
b(whic)o(h)h(\\kno)o(ws)d(ab)q(out")h(its)h(size)g(and)g(la)o(y)o(out.)k
(This)c(requires)g(new)g(ev)m(acuation)g(and)g(sca)o(v)o(enging)37
1985 y(routines)20 b(to)f(b)q(e)g(compiled)i(for)e(eac)o(h)g(closure)h(in)g
(the)f(program.)30 b(But)19 b(since)i(the)e(garbage)f(collection)37
2041 y(routines)i(for)e(a)g(closure)i(dep)q(end)g(only)f(on)g(its)g
Fn(structur)n(e)p Ft(,)g(it)g(is)h(often)e(p)q(ossible)i(to)f(share)f(them.)
31 b(F)l(or)37 2098 y(example,)17 b(all)g(closures)g(whic)o(h)g(consist)g(of)
f(exactly)g(one)g(p)q(oin)o(ter)h(\014eld)g(\(apart)e(from)h(the)g(info)h(p)q
(oin)o(ter\))37 2154 y(can)f(share)e(the)h(same)g(ev)m(acuation)h(and)f(sca)o
(v)o(enging)g(routines.)20 b(Indeed)c(our)f(run)o(time)g(system)g(con)o
(tains)37 2211 y(standard)g(garbage-collection)i(routines)e(for)g(a)g(n)o(um)
o(b)q(er)g(of)g(common)g(la)o(y)o(outs.)37 2297 y(What)g(if)h(a)f(closure)i
(m)o(ust)e(b)q(e)h(constructed)f(whic)o(h)i(do)q(es)f(not)f(matc)o(h)g(one)g
(of)g(these)h(standard)f(la)o(y)o(outs?)37 2353 y(It)i(is)f(p)q(ossible)i(to)
d(compile)i(sp)q(ecial)h(garbage-collection)f(co)q(de)g(for)e(it,)h(but)g
(actually)h(w)o(e)f(adopt)f(a)h(com-)37 2410 y(promise)j(p)q(osition)g(whic)o
(h)f(allo)o(ws)h(us)f(to)f(pro)o(vide)h Fn(al)r(l)g Ft(ev)m(acuation)h(and)f
(sca)o(v)o(enging)g(routines)g(as)g(part)37 2466 y(of)d(the)g(run)o(time)g
(system.)k(Instead)c(of)g(generating)g(co)q(de)g(for)f(garbage-collection)i
(routines)f(for)f(a)h(\\non-)37 2522 y(standard")j(closure,)h(w)o(e)e(pro)o
(vide)i(\\generic")f(ev)m(acuation)h(and)f(sca)o(v)o(enging)g(routines)g(in)h
(the)f(run)o(time)37 2579 y(system.)33 b(These)21 b(routines)f(lo)q(ok)g(in)g
(the)g(closure's)g(info)g(table)g(to)f(\014nd)i(certain)f(la)o(y)o(out)f
(information,)37 2635 y(namely)14 b(the)g(n)o(um)o(b)q(er)f(of)g(p)q(oin)o
(ter)h(w)o(ords)e(and)i(non-p)q(oin)o(ter)g(w)o(ords)f(in)h(the)f(closure.)20
b(\(This)14 b(is)f(con)o(tained)37 2692 y(in)j(the)f(\\Other)f(info")h
(\014eld)h(of)e(Figure)h(4.\))k(They)14 b(then)h(eac)o(h)g(use)g(a)f(lo)q(op)
h(to)f(do)h(their)g(w)o(ork,)e(instead)i(of)37 2748 y(ha)o(ving)h(the)g(lo)q
(op)g(unrolled)h(as)e(the)g(sp)q(ecial-purp)q(ose)j(routines)e(do.)k(Notice)c
(that)f(the)g(la)o(y)o(out)g(informa-)934 2921 y(49)p eop
%%Page: 50 50
bop 37 199 a Ft(tion)14 b(is)h(stored)e(in)i(the)f(\(static\))e(info)j
(table,)f(so)f(there)h(is)g(no)g(extra)f(cost)g(in)i(allo)q(cating)g(the)f
(closure.)20 b(The)37 256 y(only)c(extra)f(execution)h(cost)f(is)g(in)i
(executing)f(the)f(lo)q(ops)h(in)g(the)f(garbage)f(collection)j(routines.)37
342 y(It)11 b(is)g(for)e(the)i(b)q(ene\014t)g(of)f(these)g(\\generic")h
(routines)g(that)e(closures)i(are)f(laid)h(out)f(with)h(p)q(oin)o(ters)f
(preceding)37 398 y(non-p)q(oin)o(ters.)20 b(This)12 b(con)o(v)o(en)o(tion)g
(means)g(that)f(only)i(t)o(w)o(o)d(n)o(um)o(b)q(ers)i(are)g(required)h(to)e
(enco)q(de)i(the)f(la)o(y)o(out)37 455 y(information.)24 b(It)17
b(also)f(mak)o(es)g(it)h(more)f(lik)o(ely)i(that)e(a)g(closure's)h(la)o(y)o
(out)e(will)k(\\\014t")c(a)h(standard)h(la)o(y)o(out)37 511
y(directly)h(supp)q(orted)e(b)o(y)g(the)g(run)o(time)h(system.)k(F)l(or)16
b(example,)g(all)h(closures)g(with)f(t)o(w)o(o)f(w)o(ords)g(of)h(non-)37
568 y(p)q(oin)o(ters)j(and)g(t)o(w)o(o)e(of)h(p)q(oin)o(ters)h(can)f(use)h
(the)g(same)f(routines;)i(if)f(the)f(la)o(y)o(out)g(con)o(v)o(en)o(tion)h(w)o
(as)e(more)37 624 y(lib)q(eral,)e(there)e(w)o(ould)g(b)q(e)g(a)f(n)o(um)o(b)q
(er)h(of)f(di\013eren)o(t)h(p)q(ossible)i(la)o(y)o(outs)c(of)i(suc)o(h)f
(closures.)20 b(The)13 b(con)o(v)o(en)o(tion)37 680 y(carries)j(no)f(run)o
(time)h(cost,)e(of)h(course.)37 828 y Fm(7.6)56 b(The)19 b(standard-en)n(try)
f(co)r(de)g(for)h(a)f(closure)37 943 y Ft(There)i(is)h(one)e(particular)i
(place)f(where)g(w)o(e)g(ha)o(v)o(e)f(found)h(that)f(the)h(use)g(of)f(C)h
(prev)o(en)o(ts)f(an)h(ob)o(vious)37 1000 y(co)q(de)g(impro)o(v)o(emen)o(t.)
29 b(The)19 b(info)g(p)q(oin)o(ter)g(of)f(a)g(closure)h(p)q(oin)o(ts)g(to)f
(a)g(table)h(con)o(taining)g(a)g(n)o(um)o(b)q(er)f(of)37 1056
y(co)q(de)e(lab)q(els.)22 b(One)16 b(of)e(these)i(is)g(used)f(m)o(uc)o(h)h
(more)e(than)h(the)h(others,)e(namely)i(the)f(one)g(used)h(when)g(the)37
1113 y(closure)g(is)g(en)o(tered.)37 1199 y(It)22 b(w)o(ould)f(b)q(e)h(b)q
(etter)f(to)g(arrange)f(that)h(the)g(info)g(p)q(oin)o(ter)h(p)q(oin)o(ted)g
Fn(dir)n(e)n(ctly)f Ft(to)f(this)i(co)q(de,)h(placing)37 1255
y(the)d(rest)f(of)g(the)h(info)g(table)g Fn(just)g(b)n(efor)n(e)f
Ft(the)g(co)q(de.)34 b(Then,)20 b(en)o(tering)g(the)g(closure)g(tak)o(es)f
(one)g(few)o(er)37 1312 y(indirections,)h(but)d(the)g(other)g(info-table)h
(en)o(tries)g(are)e(still)j(a)o(v)m(ailable)g(b)o(y)e(using)g(negativ)o(e)h
(o\013set)e(from)37 1368 y(the)g(info)f(p)q(oin)o(ter.)37 1454
y(This)c(is)g(usually)g(quite)g(easy)f(to)g(arrange)f(when)i(generating)f
(nativ)o(e)g(co)q(de,)i(but)e(ev)o(en)g(the)h(Gn)o(u)f(C)g(compiler)37
1511 y(do)q(esn't)21 b(allo)o(w)f(the)g(programmer)g(to)f(sp)q(ecify)j(that)d
(an)h(arra)o(y)f(\(the)i(info)f(table\))h(m)o(ust)e(immediately)37
1567 y(precede)e(the)e(\014rst)g(w)o(ord)f(of)h(the)g(co)q(de)h(for)f(a)g
(function!)37 1653 y(W)l(e)21 b(abstract)e(a)o(w)o(a)o(y)g(from)h(this)h
(issue)g(b)o(y)g(using)g(a)f(C)g(macro)g Fp(ENTER\()j(c)h(\))p
Ft(,)d(where)g Fp(c)f Ft(con)o(tains)h(the)37 1709 y(address)16
b(of)f(the)g(closure)h(to)e(b)q(e)i(en)o(tered.)k(The)c(usual)g(de\014nition)
h(of)d Fp(ENTER)h Ft(is:)228 1795 y Fp(#define)23 b(ENTER\(c\))47
b(JUMP\(**c\))37 1965 y Fs(8)67 b(Stac)n(ks)37 2096 y Ft(The)16
b(abstract)e(mac)o(hine)i(con)o(tains)f(three)h(stac)o(ks:)106
2200 y Fo(\017)22 b Ft(The)12 b(argumen)o(t)f(stac)o(k,)h(whic)o(h)h(con)o
(tains)f(a)f(mixture)i(of)e(closure)i(addresses)f(and)g(primitiv)o(e)h(v)m
(alues.)106 2286 y Fo(\017)22 b Ft(The)16 b(return)f(stac)o(k,)f(whic)o(h)i
(con)o(tains)f(contin)o(uations)h(for)e Fp(case)h Ft(expressions.)106
2372 y Fo(\017)22 b Ft(The)16 b(up)q(date)f(stac)o(k,)f(whic)o(h)i(con)o
(tains)g(up)q(date)g(frames.)37 2477 y(The)g(question)g(is:)k(ho)o(w)15
b(are)g(these)g(stac)o(ks)f(to)h(b)q(e)h(mapp)q(ed)g(on)o(to)e(a)h(concrete)g
(mac)o(hine?)37 2624 y Fm(8.1)56 b(One)19 b(stac)n(k?)37 2740
y Ft(The)g(three)f(stac)o(ks)f(all)i(op)q(erate)e(in)i(sync)o(hron)o(y)l(,)g
(so)e(it)h(w)o(ould)h(b)q(e)f(p)q(ossible)i(to)d(represen)o(t)h(them)g(all)h
(b)o(y)37 2796 y(a)e(single)i(concrete)f(stac)o(k.)25 b(The)18
b(ma)s(jor)d(reason)i(w)o(e)g(c)o(ho)q(ose)h(not)e(to)h(do)g(so)g(is)h(to)f
(a)o(v)o(oid)g(confusing)h(the)934 2921 y(50)p eop
%%Page: 51 51
bop 37 199 a Ft(garbage)15 b(collector.)20 b(The)c(garbage)e(collector)i(m)o
(ust)f(use)g(all)h(the)f(p)q(oin)o(ters)h(in)g(the)f(stac)o(k)g(as)f(a)h
(source)g(of)37 256 y(ro)q(ots,)f(and)h(m)o(ust)f(up)q(date)h(them)g(to)f(p)q
(oin)o(t)h(to)f(the)h(new)g(lo)q(cations)g(of)g(the)f(closures.)21
b(Th)o(us,)14 b(it)h(needs)h(to)37 312 y(kno)o(w)h(whic)o(h)g(stac)o(k)f(lo)q
(cations)h(are)g(closure)g(addresses)g(and)g(whic)o(h)g(are)f(co)q(de)i
(addresses)e(or)h(primitiv)o(e)37 369 y(v)m(alues.)37 455 y(There)12
b(are)g(a)f(couple)i(of)e(w)o(a)o(ys)g(around)h(this)g(problem,)g(while)i
(retaining)e(a)f(single)i(stac)o(k.)18 b(One)13 b(p)q(ossibilit)o(y)37
511 y(is)k(to)e(distinguish)k(p)q(oin)o(ters)d(from)f(non-p)q(oin)o(ters)i
(with)f(a)g(tag)f(bit)i(\(usually)g(the)f(least-signi\014can)o(t)h(bit\).)37
568 y(This)f(is)f(a)f(n)o(uisance,)h(b)q(ecause)h(it)e(mak)o(es)g(arithmetic)
h(slo)o(w)o(er,)f(and)h(b)q(ecause)g(it)g(mak)o(es)f(standard)g(32-bit)37
624 y(\015oating-p)q(oin)o(t)i(n)o(um)o(b)q(ers)g(imp)q(ossible.)22
b(It)15 b(is)h(also)f(rather)g(against)g(the)g(spirit)h(of)f(our)g(implemen)o
(tation,)37 680 y(where)h(all)g(t)o(yp)q(e)f(information)h(is)f(static,)g
(requiring)h(no)g(run)o(time)f(testing.)37 766 y(Another)h(p)q(ossibilit)o(y)
l(,)i(describ)q(ed)g(in)e(an)g(earlier)h(v)o(ersion)f(of)f(the)h(Spineless)i
(T)l(agless)e(G-mac)o(hine)g(\(P)o(ey-)37 823 y(ton)21 b(Jones)h(&)g(Salkild)
h([1989]\))c(uses)j(static)f(bit-masks)g(asso)q(ciated)g(with)h(the)f(co)q
(de)h(p)q(oin)o(ted)g(to)f(b)o(y)37 879 y(return)e(addresses)g(on)f(the)h
(stac)o(k)e(to)h(giv)o(e)h(the)f(stac)o(k)g(la)o(y)o(out.)29
b(This)19 b(w)o(orks)f(\014ne,)h(but)g(since)g(then)g(w)o(e)37
936 y(ha)o(v)o(e)12 b(in)o(tro)q(duced)i(the)f(idea)g(of)f(fully-\015edged)i
(un)o(b)q(o)o(xed)f(v)m(alues,)h(whic)o(h)f(fatally)g(w)o(ounds)f(this)h(tec)
o(hnique.)37 992 y(Consider,)j(for)e(example,)i(the)f(program)228
1078 y Fp(pick)24 b(b)f(f)h(g)g(=)g(if)f(b)h(then)f(f)h(else)f(g)228
1135 y(h)h(b)g(n)g(=)f(pick)h(b)f(\(+#)h(1#\))f(\(-#)h(1#\))f(n)37
1221 y Ft(Here,)d(when)g Fp(pick)e Ft(is)h(called,)i(the)e(four)g(argumen)o
(ts)f Fp(b)p Ft(,)h Fp(\(+#)24 b(1#\))o Ft(,)c Fp(\(-#)j(1#\))p
Ft(,)c(and)g Fp(n)g Ft(will)h(b)q(e)g(on)f(the)37 1277 y(argumen)o(t)j(stac)o
(k.)42 b(The)22 b(last)h(of)f(these)h(will)h(presumably)g(b)q(e)f(primitiv)o
(e,)i(since)f(later)f Fp(\(+#)g(1#\))f Ft(or)37 1334 y Fp(\(-#)i(1#\))19
b Ft(will)i(b)q(e)f(applied)i(to)d(them.)33 b(No)o(w)19 b(here)h(is)g(the)f
(p)q(oin)o(t:)29 b Fn(if)20 b(garb)n(age)h(c)n(ol)r(le)n(ction)e(is)g
(initiate)n(d)37 1390 y(during)h(the)f(evaluation)g(of)g Fp(b)p
Fn(,)g(ther)n(e)g(is)g(no)f(c)n(ontext)h(information)g(available)f(to)h(tel)r
(l)g(that)g(the)h(b)n(ottom)37 1446 y(ar)n(gument)d(on)f(the)g(stack)g(is)g
(primitive)p Ft(.)37 1532 y(T)l(o)e(conclude,)h(using)g(a)e(single)i(stac)o
(k)e(seems)h(to)f(require)i(run)o(time)f(tagging;)f(previous)i(w)o(a)o(ys)d
(of)i(a)o(v)o(oiding)37 1589 y(this)i(cannot)f(cop)q(e)h(with)f
(fully-\015edged)j(un)o(b)q(o)o(xed)e(v)m(alues.)37 1740 y
Fm(8.2)56 b(Tw)n(o)20 b(stac)n(ks)37 1855 y Ft(The)13 b(ob)o(vious)g
(solution,)g(whic)o(h)g(w)o(e)f(use,)h(is)g(to)f(pro)o(vide)g(t)o(w)o(o)f
(concrete)i(stac)o(ks,)f(the)g(A-stac)o(k)g(for)g(p)q(oin)o(ters)37
1912 y(and)19 b(the)f(B-stac)o(k)f(for)h(non-p)q(oin)o(ters.)28
b(This)19 b(w)o(as)e(the)h(solution)h(adopted)f(b)o(y)g(the)g(G-mac)o(hine,)h
(where)37 1968 y(the)i(non-p)q(oin)o(ter)h(stac)o(k)e(w)o(as)g(called)i(the)f
(V-stac)o(k,)g(and)g(a)f(n)o(um)o(b)q(er)h(of)g(subsequen)o(t)g(systems.)36
b(The)37 2025 y(nomenclature)18 b(w)o(e)f(use)g(is)g(tak)o(en)f(from)g(the)h
(ABC)g(mac)o(hine)h(\(Ko)q(opman)e([1990]\),)f(where)i(\\A")f(stands)37
2081 y(for)e(\\argumen)o(t")f(and)i(\\B")f(for)f(basic)i(v)m(alue.)21
b(Ho)o(w)o(ev)o(er,)13 b(our)h(argumen)o(t)g(stac)o(k)g(is)g(split)i(b)q(et)o
(w)o(een)e(the)h(A)37 2138 y(and)j(B)f(stac)o(ks,)g(and)g(the)g(B)h(stac)o(k)
e(con)o(tains)i(other)e(things)i(b)q(esides)h(non-p)q(oin)o(ter)f(argumen)o
(ts,)e(as)h(will)37 2194 y(b)q(ecome)f(apparen)o(t.)j(The)d(detailed)g
(mapping)g(of)e(eac)o(h)h(of)g(the)g(abstract)f(stac)o(ks)g(to)g(these)h(t)o
(w)o(o)f(concrete)37 2251 y(stac)o(ks)h(is)h(giv)o(en)f(in)h(subsequen)o(t)g
(sections.)37 2337 y(The)k(stac)o(k)e(p)q(oin)o(ters)h(are)f(held)i(in)g(sp)q
(ecial)h(registers)d Fp(SpA)h Ft(and)g Fp(SpB)o Ft(.)31 b(Lik)o(e)20
b(other)e(t)o(win-stac)o(k)g(imple-)37 2393 y(men)o(tations,)d(w)o(e)g(mak)o
(e)g(the)g(t)o(w)o(o)f(stac)o(ks)g(gro)o(w)g(to)o(w)o(ards)g(eac)o(h)h
(other,)f(to)h(a)o(v)o(oid)g(the)g(risk)g(that)g(one)g(will)37
2450 y(o)o(v)o(er\015o)o(w)j(while)i(the)e(other)h(has)f(plen)o(t)o(y)h(of)f
(space)h(left;)h(in)f(this)g(pap)q(er,)h(the)e(A-stac)o(k)g(gro)o(ws)g(to)o
(w)o(ards)37 2506 y(lo)o(w)o(er)13 b(addresses.)20 b(In)14
b(our)f(sequen)o(tial)h(implemen)o(tation,)h(this)e(stac)o(k)g(space)g(is)h
(allo)q(cated)g(in)g(a)f(\014xed-size)37 2562 y(area,)i(separate)f(from)h
(the)g(heap.)934 2921 y(51)p eop
%%Page: 52 52
bop 37 199 a Fs(9)67 b(Compiling)24 b(the)f(STG)f(language)h(to)f(C)37
330 y Ft(W)l(e)c(are)g(no)o(w)f(at)g(last)h(ready)f(to)h(discuss)g(the)g(co)q
(de)h(whic)o(h)f(is)g(generated)g(for)f(eac)o(h)h(of)g(the)f(constructs)37
387 y(in)g(the)e(STG)g(language.)21 b(This)16 b(section)g(is)g(rather)f(long)
g(and)h(detailed.)22 b(W)l(e)15 b(mak)o(e)g(no)g(ap)q(ology)h(for)f(this)37
443 y(b)q(ecause,)g(as)f(remark)o(ed)f(earlier,)i(an)e(abstract)g(mac)o(hine)
i(can)f(only)g(b)q(e)h(considered)g(a)e(success)i(if)f(it)g(maps)37
500 y(w)o(ell)j(on)o(to)d(concrete)h(arc)o(hitectures,)g(with)h(plen)o(t)o(y)
g(of)e(opp)q(ortunities)j(for)d(optimisations.)37 586 y(W)l(e)j(b)q(egin)h
(with)e(an)g(o)o(v)o(erview)h(of)e(the)i(co)q(de)g(generation)f(pro)q(cess)h
(for)e(an)i(arbitrary)e(STG)h(expression,)37 642 y(b)o(y)g(considering)g(the)
g(v)m(arious)f(syn)o(tactic)h(forms)e(an)h(expression)h(can)f(tak)o(e)g
(\(Figure)g(3\):)106 765 y Fo(\017)22 b Fn(Cal)r(ls)14 b(to)h(non-built-in)f
(functions)f Ft(\(Section)i(9.2\).)j(The)c(expression)g Fn(f)24
b(a)1415 772 y Fl(1)1438 765 y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(a)1563
772 y Fl(n)1600 765 y Ft(is)14 b(compiled)i(to)151 822 y(a)h(sequence)h(of)f
(statemen)o(ts)e(whic)o(h)j(pushes)g(the)f(argumen)o(ts)f Fn(a)1272
829 y Fl(1)1296 822 y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(a)1421 829
y Fl(n)1461 822 y Ft(on)o(to)16 b(the)h(appropriate)151 878
y(stac)o(ks,)d(adjusts)g(the)g(A)h(and)g(B)g(stac)o(k)e(p)q(oin)o(ters)i(to)f
(their)h(\014nal)h(v)m(alues,)f(and)g(en)o(ters)f(the)h(function)151
935 y Fn(f)10 b Ft(.)19 b(As)c(w)o(e)f(discuss)i(later,)f(this)g(\\en)o(ter")
f(ma)o(y)g(tak)o(e)g(the)g(form)g(of)h(en)o(tering)g(the)g(closure)g(b)q
(ound)h(to)151 991 y Fn(f)25 b Ft(via)15 b(its)h(info)f(table,)h(or)e(of)h
(jumping)h(direct)g(to)f(the)g(appropriate)g(co)q(de)h(for)e
Fn(f)c Ft(.)106 1085 y Fo(\017)22 b Fp(let\(rec\))15 b Fn(expr)n(essions)f
Ft(\(Section)i(9.3\).)i(The)e Fp(let)e Ft(expression)697 1187
y Fp(let)h Fn(x)805 1194 y Fl(1)844 1187 y Fp(=)g Fn(lf)909
1194 y Fl(1)932 1187 y Fp(;)22 b Fq(:)8 b(:)g(:)e Fp(;)15 b
Fn(x)1099 1194 y Fl(n)1138 1187 y Fp(=)g Fn(lf)1203 1194 y
Fl(n)1242 1187 y Fp(in)f Fn(e)151 1289 y Ft(is)j(compiled)i(to)d(a)g
(sequence)i(of)e(statemen)o(ts)f(whic)o(h)j(allo)q(cates)f(a)f(closure)i(in)f
(the)g(heap)g(for)f(eac)o(h)151 1346 y(lam)o(b)q(da-form)p
Fn(lf)431 1353 y Fl(1)454 1346 y Fq(;)8 b(:)g(:)g(:)d(;)j Fn(lf)582
1353 y Fl(n)604 1346 y Ft(,)18 b(follo)o(w)o(ed)g(b)o(y)f(the)g(co)q(de)h
(for)f Fn(e)s Ft(.)27 b Fp(letrec)16 b Ft(expressions)i(are)f(treated)g(in)
151 1402 y(the)k(same)g(w)o(a)o(y)l(,)g(the)g(only)h(di\013erence)g(b)q(eing)
h(that)d(the)h(closures)h(allo)q(cated)g(thereb)o(y)f(ma)o(y)f(b)q(e)151
1459 y(cyclic.)151 1534 y(If)c(the)f(lam)o(b)q(da-form)p Fn(lf)555
1541 y Fl(i)585 1534 y Ft(is)h(not)e(a)h(standard)g(constructor,)f(the)h(co)q
(de)h(generator)e(also)i(pro)q(duces:)202 1628 y Fr({)23 b
Ft(A)14 b(separate)g(blo)q(c)o(k)h(of)f(co)q(de)h(lab)q(elled)i
Fn(x)940 1635 y Fl(i)955 1628 y Fp(_entry)o Ft(,)d(obtained)h(b)o(y)f
(compiling)i(the)f(b)q(o)q(dy)g(of)e Fn(lf)1847 1635 y Fl(i)1862
1628 y Ft(.)251 1684 y(\(See)h(Section)h(9.2.1)e(for)g(wh)o(y)h(it)g(ma)o(y)f
(b)q(e)i(useful)g(to)e(giv)o(e)h(this)h(co)q(de)f(an)g(extra)g(en)o(try)f(p)q
(oin)o(t.\))202 1757 y Fr({)23 b Ft(The)c(declaration)h(for)e(a)g
(statically-initiali)q(sed)k(arra)o(y)c Fn(x)1252 1764 y Fl(i)1267
1757 y Fp(_info)o Ft(,)i(whic)o(h)f(is)g(the)g(info)h(table)251
1814 y(for)14 b Fn(x)341 1821 y Fl(i)357 1814 y Ft(.)20 b(The)15
b(\014rst)f(elemen)o(t)i(of)e(the)h(info)h(table)f(is)g(\(the)g(lab)q(el)h
(of)t(\))e(the)h(standard-en)o(try)f(co)q(de)251 1870 y Fn(x)272
1877 y Fl(i)288 1870 y Fp(_entry)o Ft(.)151 1964 y(Both)i(of)h(these)f
(declarations)h(are)g(hoisted)g(out)f(to)g(the)g(top)g(lev)o(el,)i(rather)e
(than)g(app)q(earing)i(em-)151 2020 y(b)q(edded)j(in)e(the)g(middle)i(of)d
(the)h(co)q(de)g(for)g(the)f Fp(let)h Ft(expression.)31 b(In)20
b(our)e(co)q(de)i(generator)e(this)151 2077 y(\015attening)f(pro)q(cess)f(is)
h(p)q(erformed)f Fn(after)g Ft(co)q(de)h(generation,)f(the)g(in)o(termediate)
h(data)f(t)o(yp)q(e)g(\(Ab-)151 2133 y(stract)e(C\))h(p)q(ermitting)h(nested)
g(declarations.)151 2208 y(If)h(the)f(lam)o(b)q(da-form)p Fn(is)g
Ft(a)g(standard)g(constructor,)f(the)i(shared)f(info)h(table)g(for)f(the)g
(appropriate)151 2265 y(constructor)f(can)g(b)q(e)h(used,)f(and)h(there)f(is)
h(no)f(need)h(to)e(generate)h Fn(x)1331 2272 y Fl(i)1347 2265
y Fp(_info)f Ft(and)i Fn(x)1591 2272 y Fl(i)1606 2265 y Fp(_entry)o
Ft(.)106 2359 y Fo(\017)22 b Fn(Liter)n(als)17 b(and)i(c)n(al)r(ls)f(of)g
(built-in)h(op)n(er)n(ators)e Ft(\(Section)i(9.5\).)26 b(A)18
b(primitiv)o(e)h(literal)g Fn(k)j Ft(is)c(compiled)151 2415
y(to)c(statemen)o(ts)e(whic)o(h)j(load)g Fn(k)j Ft(in)o(to)c(a)g(register)g
(\(exactly)g(whic)o(h)h(register)f(dep)q(ends)h(on)f Fn(k)5
b Ft('s)14 b(t)o(yp)q(e\),)151 2471 y(adjusts)i(the)g(A)f(and)i(B)f(stac)o(k)
f(p)q(oin)o(ters)h(to)f(their)i(\014nal)f(v)m(alues,)h(and)f(returns)g(to)f
(the)h(address)g(on)151 2528 y(top)d(of)g(the)h(B)f(stac)o(k.)19
b(A)13 b(call)i(to)e(a)g(built-in)j(op)q(eration)d(w)o(orks)g(in)h(the)g
(same)f(w)o(a)o(y)f(except)i(that)f(the)151 2584 y(op)q(eration)j(is)f(p)q
(erformed)h(\014rst.)151 2660 y(This)i(mak)o(es)f(it)h(sound)g(as)g(if)g(ev)o
(ery)f(built-in)j(op)q(eration)e(is)g(asso)q(ciated)g(with)g(a)f(return,)h
(but)g(an)151 2716 y(easy)d(optimisation)h(allo)o(ws)f(sequences)i(of)d
(built-in)k(op)q(erations)d(to)g(b)q(e)h(compiled)h(\(Section)f(9.5\).)934
2921 y(52)p eop
%%Page: 53 53
bop 106 199 a Fo(\017)22 b Fp(case)16 b Fn(expr)n(essions)d
Ft(\(Section)j(9.4\).)j(The)c(primitiv)o(e)i Fp(case)d Ft(expression)860
286 y Fp(case)h Fn(e)j Fp(of)d Fn(p)n(alts)151 373 y Ft(is)i(compiled)g(to)e
(co)q(de)i(whic)o(h)f(sa)o(v)o(es)g(an)o(y)f(v)o(olatile)i(v)m(ariables)g
(used)f(b)o(y)g Fn(p)n(alts)j Ft(on)d(the)g(stac)o(ks,)f(and)151
429 y(pushes)j(a)f(return)g(address)g(on)g(the)g(B)h(stac)o(k,)e(follo)o(w)o
(ed)h(b)o(y)h(the)f(co)q(de)g(for)g Fn(e)s Ft(.)26 b(An)17
b(arbitrary)g(but)151 486 y(unique)g(lab)q(el)h(is)e(in)o(v)o(en)o(ted)h(for)
e(the)h(return)g(address,)f(whic)o(h)i(is)f(used)h(to)e(lab)q(el)i(a)f
(separate)f(blo)q(c)o(k)151 542 y(of)g(co)q(de)h(compiled)h(from)d
Fn(p)n(alts)t Ft(.)151 615 y(The)j(co)q(de)g(compiled)h(for)e
Fn(p)n(alts)k Ft(p)q(erforms)c(case)h(analysis)g(on)g(the)f(v)m(alue)i
(returned)f(\(if)g(there)f(are)151 671 y(an)o(y)e(non-default)i(alternativ)o
(es\))e(follo)o(w)o(ed)h(b)o(y)f(the)h(co)q(de)g(for)e(eac)o(h)i(alternativ)o
(e)g(expression.)20 b(Lik)o(e)151 728 y(the)15 b(co)q(de)h(for)f(lam)o(b)q
(da-forms,)f(this)i(en)o(tire)g(co)q(de)f(blo)q(c)o(k)h(is)g(hoisted)g(to)f
(the)g(top)g(lev)o(el.)151 800 y(The)f(co)q(de)g(for)e(algebraic)j
Fp(case)d Ft(expressions)i(is)g(similar,)h(except)f(that)e(\(the)h(address)h
(of)t(\))e(a)h(return)151 857 y(v)o(ector)i(is)g(pushed)i(instead)e(of)g(a)g
(return)g(address)g(\(Section)h(9.4.3\).)106 946 y Fo(\017)22
b Fn(T)m(op)c(level)f(bindings)e Ft(\(Section)j(9.1\).)25 b(The)17
b(top-lev)o(el)h(bindings)h(are)e(treated)g(a)g(little)h(di\013eren)o(tly)151
1002 y(to)e(nested)h(ones.)24 b(Eac)o(h)16 b(declaration)h
Fn(g)845 1009 y Fl(i)877 1002 y Fp(=)f Fn(lf)943 1009 y Fl(i)974
1002 y Ft(is)h(compiled)h(to)e(the)h(declaration)g(of)f(a)g(statically-)151
1059 y(initialised)21 b(arra)o(y)c Fn(g)504 1066 y Fl(i)520
1059 y Fp(_closure)o Ft(,)h(whic)o(h)h(represen)o(ts)f(the)h(static)f
(closure)h(for)e Fn(g)1549 1066 y Fl(i)1564 1059 y Ft(.)29
b(An)19 b(info)g(table)151 1115 y Fn(g)172 1122 y Fl(i)187
1115 y Fp(_info)f Ft(and)g(standard-en)o(try)f(co)q(de-blo)q(c)o(k)i
Fn(g)975 1122 y Fl(i)991 1115 y Fp(_entry)e Ft(are)g(also)h(pro)q(duced)h
(just)f(as)f(for)g(nested)151 1171 y(bindings.)106 1260 y Fo(\017)22
b Fn(Standar)n(d)c(c)n(onstructors)e Ft(\(Section)h(9.4.2\).)22
b(As)16 b(already)h(men)o(tioned,)g(no)g(co)q(de)g(is)g(generated)g(for)151
1317 y(lam)o(b)q(da-forms)g(whic)o(h)g(are)g(standard)f(constructors,)g(the)g
(shared)h(info)g(table)h(and)e(co)q(de)i(for)e(the)151 1373
y(constructor)e(b)q(eing)i(used)f(instead.)20 b(It)15 b(is)g(therefore)f
(necessary)h(to)f(generate)h(this)g(info)g(table)g(and)151
1430 y(en)o(try)g(co)q(de)h(for)e(eac)o(h)i(constructor)e(declared)i(in)g
(the)g(mo)q(dule.)37 1540 y(T)l(o)g(mak)o(e)g(these)g(ideas)h(concrete,)f
(Figure)g(5)g(giv)o(es)g(the)h(co)q(de)f(compiled)i(for)e Fp(map)o
Ft(,)g(whose)g(STG)g(co)q(de)g(is)37 1597 y(as)f(follo)o(ws)h(\(see)f
(Section)h(4.1\):)133 1683 y Fp(map)23 b(=)h({})g(\\n)f({f,xs})g(->)419
1739 y(case)h(xs)f(of)467 1795 y(Nil)g({})143 b(->)24 b(Nil)f({})467
1852 y(Cons)g({y,ys})g(->)h(let)f(fy)h(=)g({f,y})f(\\u)h({})f(->)h(f)f({y})
920 1908 y(mfy)h(=)g({f,ys})f(\\u)g({})h(->)f(map)h({f,ys})825
1965 y(in)g(Cons)f({fy,mfy})37 2051 y Ft(This)17 b(co)q(de)g(is)g(written)f
(assuming)h(that)f(lists)h(use)f(a)g(v)o(ectored)g(return)h(con)o(v)o(en)o
(tion,)f(and)g Fp(Cons)g Ft(returns)37 2107 y(its)g(argumen)o(ts)e(in)i
(registers,)f(matters)f(whic)o(h)i(are)f(explained)i(more)e(fully)h(in)h
(Section)f(9.4.)37 2193 y(The)e(rest)g(of)f(this)h(section)g(explores)h(co)q
(de)f(generation)g(in)h(more)e(detail.)20 b(Eac)o(h)14 b(subsection)h
(corresp)q(onds)37 2250 y(to)i(the)g(similarly-n)o(um)o(b)q(ered)j
(subsection)e(of)f(Section)h(5)f(whic)o(h)h(giv)o(es)f(!the)g(op)q(erational)
h(seman)o(tics)f(of)37 2306 y(the)f(STG)f(language.)37 2455
y Fm(9.1)56 b(The)19 b(initial)e(state)37 2570 y Ft(The)k(mac)o(hine)h(is)f
(initialised)j(to)c(ev)m(aluate)h(the)g(global)g Fp(main)p
Ft(,)g(with)g(empt)o(y)f(argumen)o(t,)h(return)g(and)37 2627
y(up)q(date)g(stac)o(ks)d(\(Section)j(5.1\).)31 b(The)20 b(abstract)f(mac)o
(hine's)h(initial)h(heap)f(is)g(not)g(empt)o(y)l(,)g(but)g(rather)37
2683 y(con)o(tains)14 b(a)e(closure)i(for)f(eac)o(h)g(globally-de\014ned)j(v)
m(ariable.)k(W)l(e)13 b(implemen)o(t)i(this)e(b)o(y)g(allo)q(cating)h(a)f
(static)37 2740 y(closure)i(for)f(eac)o(h)g(suc)o(h)h(v)m(ariable)g
(\(Section)g(7.2\).)j(Eac)o(h)c(of)g(these)g(closures)h(can)f(b)q(e)h
(referred)f(to)g(directly)37 2796 y(b)o(y)i(its)f(C)g(lab)q(el,)h(th)o(us)f
(e\013ectiv)o(ely)i(using)f(the)f(link)o(er)h(to)f(implemen)o(t)h(the)g
(global)f(en)o(vironmen)o(t)h Fq(\033)r Ft(.)934 2921 y(53)p
eop
%%Page: 54 54
bop 37 159 1713 2 v 37 2703 2 2545 v 67 203 a Fp(StgWord)23
b(map_closure[])f(=)h({map_info};)67 260 y(StgWord)g(map_info[])f(=)i
({map_entry,)e(...rest)h(of)h(info)f(table...})67 316 y(map_entry\(\))f({)162
372 y(...argument)h(satisfaction)f(check...)162 429 y(JUMP\()h(map_direct)g
(\);)67 485 y(})67 542 y(map_direct\(\))f({)162 598 y(...stack)h(overflow)g
(check...)162 655 y(SpB[1])g(=)h(ret_vec1;)f(SpB)g(=)h(SpB+1;)118
b(/*)24 b(Push)f(return)g(vector)g(*/)162 711 y(Node)h(=)f(SpA[1];)95
b(ENTER\()23 b(Node)g(\);)95 b(/*)24 b(Enter)f(xs)h(*/)67 768
y(})67 881 y(StgWord)f(ret_vec1[])f(=)i({ret_nil1,)e(upd_nil,)h(ret_cons1,)g
(upd_cons};)67 937 y(ret_nil1\(\))f({)162 993 y(SpA)i(=)f(SpA+2;)572
b(/*)24 b(Pop)f(args)h(*/)162 1050 y(SpB)g(=)f(SpB-1;)g(RetVecReg)g(=)h
(SpB[1];)94 b(/*)24 b(Grab)f(return)g(vector)g(*/)162 1106
y(JUMP\()g(RetVecReg[0])g(\);)67 1163 y(})67 1219 y(ret_cons1\(\))f({)i(/*)f
(Head)h(and)f(tail)h(in)f(regs)g(RetData1)g(and)h(RetData2)e(*/)162
1276 y(/*)i(Allocate)f(fy)g(and)h(mfy)47 b(*/)162 1332 y(Hp)24
b(=)g(Hp)f(+)h(6;)162 1389 y(...heap)f(overflow)g(check...)162
1445 y(Hp[-5])g(=)h(fy_info;)f(Hp[-4])g(=)h(SpA[0];)e(Hp[-3])h(=)h(RetData1;)
162 1502 y(Hp[-2])f(=)h(mfy_info;)f(Hp[-1])g(=)g(SpA[0];)g(Hp[0])g(=)h
(RetData2;)162 1614 y(/*)g(Return)f(the)g(cons)h(cell)f(*/)162
1671 y(RetData1)g(=)h(&Hp[-5];)e(RetData2)h(=)h(&Hp[-2];)162
1727 y(SpB)g(=)f(SpB-1;)g(RetVecReg)g(=)h(SpB[1];)f(SpA)g(=)h(SpA+2;)162
1784 y(JUMP\()f(RetVecReg[2])g(\);)67 1840 y(})67 1953 y(StgWord)g(fy_info[])
f(=)i({fy_entry,)f(...rest)f(of)i(info)f(table...})67 2010
y(fy_entry\(\))f({)162 2066 y(...push)h(update)g(frame...)238
b(/*)23 b(This)h(is)f(an)h(updatable)e(thunk)i(*/)162 2123
y(...stack)f(overflow)g(check...)162 2179 y(SpA[-1])g(=)h(Node[2];)f(SpA)g(=)
h(SpA-1;)71 b(/*)23 b(Push)g(y)h(*/)162 2235 y(Node)g(=)f(Node[1];)g(ENTER\()
g(Node)g(\);)96 b(/*)23 b(Enter)g(f)h(*/)67 2292 y(})67 2405
y(StgWord)f(mfy[])g(=)47 b({mfy_entry,)23 b(...rest)g(of)g(info)h(table...})
67 2461 y(mfy_entry\(\))e({)162 2518 y(...stack)h(overflow)g(check)g(...)162
2574 y(SpA[-1])g(=)h(Node[2];)f(SpA[-2])g(=)g(Node[1];)g(SpA)g(=)h(SpA-2;)f
(/*)h(Push)f(f,ys)g(*/)162 2631 y(JUMP\()g(map_direct)g(\);)67
2687 y(})p 1748 2703 V 37 2705 1713 2 v 583 2782 a Ft(Figure)16
b(5:)j(The)d(co)q(de)g(generated)f(for)f Fp(map)934 2921 y
Ft(54)p eop
%%Page: 55 55
bop 37 199 a Fm(9.2)56 b(Applications)37 315 y Ft(The)14 b(co)q(de)f
(generated)g(for)f(applications)i(follo)o(ws)f(directly)h(from)e(Rule)j(1)d
(in)i(the)f(op)q(erational)g(seman)o(tics,)37 371 y(and)j(consists)f(of)g(t)o
(w)o(o)f(steps:)106 494 y Fo(\017)22 b Ft(push)16 b(the)f(argumen)o(ts)g(on)g
(the)g(stac)o(k)f(and)i(adjust)f(the)g(stac)o(k)f(p)q(oin)o(ter,)106
588 y Fo(\017)22 b Ft(en)o(ter)15 b(the)g(closure)h(whic)o(h)g(represen)o(ts)
g(the)f(function.)37 712 y(W)l(e)h(discuss)h(these)f(steps)f(separately)h(b)q
(elo)o(w.)22 b(Before)15 b(doing)i(so,)e(here)h(is)g(a)f(small)h(example.)22
b(Consider)37 768 y(the)16 b(binding)228 854 y Fp(apply3)23
b(=)h({})g(\\n)f({f,x})h(->)f(f)h({x,x,x})37 940 y Ft(The)16
b(follo)o(wing)h(co)q(de)f(is)g(generated)g(for)f(the)h(application)h
Fp(f)24 b({x,x,x})o Ft(.)d(When)16 b(this)g(co)q(de)g(is)g(executed,)37
996 y(a)f(p)q(oin)o(ter)h(to)f Fp(f)g Ft(is)g(on)g(top)g(of)g(the)g(A)h(stac)
o(k,)e(and)h(under)h(it)f(is)h(a)f(p)q(oin)o(ter)h(to)e Fp(x)p
Ft(.)228 1082 y Fp(Node)24 b(=)f(SpA[0];)238 b(/*)24 b(Grab)f(f)h(into)f
(Node)g(register)g(*/)228 1139 y(t)h(=)g(SpA[1];)309 b(/*)24
b(Grab)f(x)h(into)f(a)h(local)f(variable)g(*/)228 1195 y(SpA[0])g(=)h(t;)310
b(/*)24 b(Push)f(extra)g(args)h(*/)228 1252 y(SpA[-1])f(=)h(t;)228
1308 y(SpA)g(=)g(SpA)f(-)h(1;)238 b(/*)24 b(Adjust)f(stack)g(pointer)g(*/)228
1365 y(ENTER\()g(Node)h(\);)238 b(/*)24 b(Enter)f(f)h(*/)37
1514 y Fr(9.2.1)52 b(En)o(tering)18 b(a)g(closure)37 1630 y
Ft(What)h(do)q(es)h(it)f(mean)h(to)f(\\en)o(ter")f(a)h(closure?)34
b(After)19 b(all,)i(the)f(op)q(erational)g(seman)o(tics)f(has)g(quite)h(a)37
1686 y(few)14 b(rules)g(dealing)h(with)f(the)g Fn(Enter)k Ft(state.)g(The)c
(Spineless)i(T)l(agless)d(mac)o(hine)i(dev)o(olv)o(es)e(resp)q(onsibili)q(t)o
(y)37 1743 y(for)k(all)i(these)f(complications)h(to)e(the)g(closure)i(b)q
(eing)g(en)o(tered,)f(so)f(that)g(the)g(co)q(de)i(to)e(en)o(ter)g(a)g
(closure)37 1799 y(is)g(simple)h(and)e(uniform.)23 b(W)l(e)16
b(establish)h(the)f(follo)o(wing)h(v)o(ery)f(simple)h(en)o(try)f(con)o(v)o
(en)o(tion)g(for)g(closures:)37 1855 y Fn(when)i(a)g(closur)n(e)g(is)f(enter)
n(e)n(d)g(a)h(p)n(articular)h(r)n(e)n(gister,)e(the)h Fp(Node)f
Fn(r)n(e)n(gister,)h(p)n(oints)f(to)h(the)g(closur)n(e)p Ft(.)25
b(The)37 1912 y(co)q(de)17 b(for)e(the)h(closure)g(can)g(access)g(its)g(free)
g(v)m(ariables)h(b)o(y)f(indexing)h(directly)g(from)e(the)h
Fp(Node)f Ft(register.)37 1968 y(All)i(the)d(\\caller")i(has)e(to)g(do)h(is)g
(to)g(load)g(a)f(p)q(oin)o(ter)h(to)f(the)h(closure)h(in)o(to)e(the)h
Fp(Node)f Ft(register,)h(and)g(jump)37 2025 y(to)g(the)h(standard-en)o(try)e
(co)q(de)i(for)f(the)g(closure)i(via)e(its)h(info)f(p)q(oin)o(ter.)21
b(\(As)15 b(previously)i(discussed,)g(this)37 2081 y(jump)h(can)f(in)o(v)o
(olv)o(e)g(either)h(one)f(or)f(t)o(w)o(o)g(indirections,)j(dep)q(ending)g(on)
d(the)h(particular)h(represen)o(tation)37 2138 y(c)o(hosen)e(for)f(closures)g
(and)h(info)f(tables)h(|)g(Section)g(7.6.\))37 2224 y(It)11
b(is)h(p)q(ossible)g(to)e(mak)o(e)g(some)h(useful)h(optimisations)f(to)f
(this)h(pro)q(cess,)h(when)f(en)o(tering)g(a)f(non-up)q(datable)37
2280 y(closure.)23 b(Man)o(y)15 b(functions)i(are)e(de\014ned)i(at)f(the)g
(top)f(lev)o(el)i(of)f(the)g(program,)e(or)h(in)i(standard)e(libraries)37
2337 y(\()p Fp(map)p Ft(,)23 b(for)f(example\).)42 b(En)o(try)21
b(to)h(suc)o(h)h(functions)g(can)f(b)q(e)h(made)f(m)o(uc)o(h)h(more)f
(e\016cien)o(t)h(than)f(the)37 2393 y(standard)15 b(en)o(try)g(mec)o(hanism)h
(just)f(describ)q(ed:)106 2516 y Fo(\017)22 b Ft(Suc)o(h)17
b(a)f(function)h(has)f(no)h(free)f(v)m(ariables,)i(so)e(there)g(is)h(no)f(p)q
(oin)o(t)h(in)g(making)g Fp(Node)e Ft(p)q(oin)o(t)i(to)f(its)151
2573 y(closure.)106 2667 y Fo(\017)22 b Ft(The)d(co)q(de)g(lab)q(el)h(for)e
(the)g(function)i(is)f(statically)g(determined,)h(so)e(the)h(jump)f(can)h(b)q
(e)g(a)f(direct)151 2723 y(one,)d(rather)g(than)g(indirecting)i(via)f(the)f
(info)h(p)q(oin)o(ter.)934 2921 y(55)p eop
%%Page: 56 56
bop 106 199 a Fo(\017)22 b Ft(The)16 b(co)q(de)h(generator)d(kno)o(ws)i(ho)o
(w)f(man)o(y)g(argumen)o(ts)g(\(if)h(an)o(y\))f(the)h(closure)h(is)f(exp)q
(ecting,)h(so)e(if)151 256 y(at)g(least)g(this)h(n)o(um)o(b)q(er)g(of)f
(argumen)o(ts)f(is)i(b)q(eing)h(supplied)g(b)o(y)f(the)f(call,)h(the)g(jump)f
(can)h(b)q(e)g(made)151 312 y(to)e(a)h(p)q(oin)o(t)g(\(called)h(the)f
Fn(dir)n(e)n(ct-entry)h(p)n(oint)p Ft(\))e(just)g(after)g(the)h(argumen)o(t)f
(satisfaction)h(c)o(hec)o(k)g(\(see)151 369 y(Section)j(9.3.2)e(b)q(elo)o
(w\).)25 b(Indeed,)19 b(with)f(a)e(bit)i(more)f(clev)o(erness,)h(the)f(stac)o
(k)f(and)i(heap)f(o)o(v)o(er\015o)o(w)151 425 y(c)o(hec)o(ks)f(can)f(often)g
(b)q(e)h(b)o(ypassed)f(as)g(w)o(ell.)106 519 y Fo(\017)22 b
Ft(The)14 b(argumen)o(t-passing)g(con)o(v)o(en)o(tion)g(at)f(the)g(direct-en)
o(try)i(p)q(oin)o(t)f(can)g(b)q(e)g(di\013eren)o(t)g(to)f(the)h(stan-)151
575 y(dard)h(ones.)20 b(In)c(particular,)g(argumen)o(ts)e(can)h(b)q(e)h
(passed)g(in)g(registers.)151 650 y(This)11 b(should)h(b)q(e)g(b)q
(ene\014cial,)i(but)c(p)q(erhaps)i(less)f(so)g(than)f(in)i(a)e(strict)h
(language,)g(b)q(ecause)h(functions)151 707 y(frequen)o(tly)18
b(b)q(egin)g(b)o(y)f(ev)m(aluating)h(one)g(of)e(their)i(argumen)o(ts,)e(so)h
(the)g(others)g(ha)o(v)o(e)f(to)h(b)q(e)g(sa)o(v)o(ed)151 763
y(on)e(the)h(stac)o(k)e(an)o(yw)o(a)o(y)l(.)19 b(W)l(e)c(ha)o(v)o(e)g(not)g
(y)o(et)f(implemen)o(ted)j(this)f(idea.)37 887 y(Of)i(these)g(impro)o(v)o
(emen)o(ts,)f(all)i(but)e(the)h(\014rst)f(can)h(b)q(e)g(applied)h(to)e(lo)q
(cally-de\014ned)k(functions)d(as)f(w)o(ell.)37 943 y(F)l(or)e(example,)h
(consider)g(the)f(expression)228 1029 y Fp(f)24 b(=)g({})f(\\n)h({x,y})f(->)h
(let)f(g)h(=)g({x})f(\\n)h({z})f(->)h(+)g({x,z})682 1086 y(in)f(g)h({y})37
1172 y Ft(The)19 b(call)h(to)d Fp(g)h Ft(can)h(b)q(e)g(made)f(b)o(y)h
(pushing)g(its)g(argumen)o(t)e Fp(y)i Ft(on)o(to)e(the)h(stac)o(k,)g(loading)
i(a)e(p)q(oin)o(ter)h(to)37 1228 y(the)f(closure)f(for)g Fp(g)g
Ft(in)o(to)g Fp(Node)o Ft(,)g(and)h(then)f(jumping)h(directly)g(to)f(the)g
(appropriate)g(co)q(de)h(for)e Fp(g)p Ft(.)25 b(Since)37 1285
y(the)16 b(call)h(is)f(to)f(a)h(function)g(whose)g(de\014nition)h(is)g
(statically)f(visible,)i(the)e(co)q(de)g(generator)f(can)g(compile)37
1341 y(direct)h(jumps,)f(including)j(b)o(ypassing)e(the)f(argumen)o(t)g
(satisfaction)g(c)o(hec)o(k)g(where)h(appropriate.)37 1427
y(W)l(e)i(need)h(to)e(tak)o(e)h(a)f(bit)i(more)e(care)h(when)g(en)o(tering)h
(an)e Fn(up)n(datable)i Ft(closure.)28 b(In)19 b(this)f(case)g(w)o(e)g
Fn(must)37 1483 y Ft(jump)j(to)g(it)g(via)g(its)g(info)g(p)q(oin)o(ter,)h
(and)f(nev)o(er)g(directly)h(to)e(its)h(standard-en)o(try)f(co)q(de,)i(b)q
(ecause)g(an)37 1540 y(up)q(date)15 b(migh)o(t)f(ha)o(v)o(e)f(c)o(hanged)h
(the)g(info)h(p)q(oin)o(ter!)20 b(A)o(t)13 b(\014rst)g(it)h(seems)g(that)g(w)
o(e)f(m)o(ust)g(also)h(alw)o(a)o(ys)f(mak)o(e)37 1596 y Fp(Node)k
Ft(p)q(oin)o(t)g(to)f(the)g(closure,)i(since)f(the)g(standard-en)o(try)f(co)q
(de)h(for)f(an)h(up)q(datable)h(closure)f(b)q(egins)h(b)o(y)37
1653 y(pushing)g(an)f(up)q(date)g(frame)f(recording)h(the)g(address)g(of)f
(the)h(closure)g(to)f(b)q(e)h(up)q(dated.)25 b(But)17 b(since)h(the)37
1709 y(co)q(de)f(to)f(push)h(the)f(up)q(date)h(frame)f(is)h(compiled)h
(individuall)q(y)h(for)c(eac)o(h)i(closure,)g(w)o(e)f(can)g(arrange)g(for)37
1766 y(it)g(to)f(include)i(the)e(static)g(address)h(of)e(the)i(closure)g(in)g
(the)f(up)q(date)h(frame,)e(rather)h(than)g Fp(Node)o Ft(.)37
1852 y(No)j(optimisations)g(at)e(all)j(apply)f(when)f(en)o(tering)h(the)g
(closure)g(for)e(a)h(lam)o(b)q(da-b)q(ound)i(v)m(ariable,)g(as)e(in)37
1908 y(the)f(case)f(of)g Fp(apply3)f Ft(ab)q(o)o(v)o(e.)37
2058 y Fr(9.2.2)52 b(Pushing)18 b(the)g(argumen)o(ts)37 2173
y Ft(\\Pushing)e(the)g(argumen)o(ts)e(on)o(to)g(the)i(stac)o(k")e(is)h(not)g
(quite)h(as)f(simple)i(as)d(it)i(sounds.)37 2259 y(Firstly)l(,)e(the)f
(argumen)o(ts)e(ma)o(y)h(b)q(e)i(a)e(mixture)h(of)g(p)q(oin)o(ters)g(and)g
(non-p)q(oin)o(ters)g(so)g(eac)o(h)f(m)o(ust)g(b)q(e)i(pushed)37
2315 y(on)k(the)f(appropriate)h(stac)o(k.)25 b(The)18 b(argumen)o(t)e(stac)o
(k)h(of)g(the)g(op)q(erational)h(seman)o(tics)g(is)f(thereb)o(y)h(split)37
2372 y(b)q(et)o(w)o(een)e(the)f(A)h(and)f(B)g(stac)o(ks.)37
2458 y(Secondly)l(,)f(in)e(our)f(implemen)o(tation)i(the)e(en)o(vironmen)o(t)
h Fq(\032)e Ft(of)h(the)g(op)q(erational)h(seman)o(tics)g(is)f(represen)o
(ted)37 2514 y(partly)17 b(b)o(y)g(lo)q(cations)h(in)g(the)f(stac)o(ks.)24
b(This)17 b(is)h(quite)f(con)o(v)o(en)o(tional)h(in)f(man)o(y)g(language)g
(implemen)o(ta-)37 2571 y(tions.)32 b(It)19 b(means,)h(though,)g(that)e(the)h
(stac)o(ks)g(m)o(ust)f(b)q(e)i(cleared)g(of)f(the)g(accum)o(ulated)h(en)o
(vironmen)o(t)37 2627 y(\(or)f(p)q(erhaps)h(just)f(part)g(of)g(it)h(|)g(see)f
(Section)i(9.4.1\))c(b)q(efore)j(pushing)h(the)e(argumen)o(ts)g(to)g(the)g
(call.)37 2684 y(Of)f(course,)f(w)o(e)g(need)h(to)e(tak)o(e)h(a)f(little)j
(care)e(here:)24 b(w)o(e)17 b(m)o(ust)f(not)h(o)o(v)o(erwrite)f(a)h(stac)o(k)
f(lo)q(cation)i(whic)o(h)37 2740 y(con)o(tains)f(a)e(v)m(alue)i(whic)o(h)g
(is)g(required)g(for)e(another)g(argumen)o(t)h(p)q(osition.)23
b(There)16 b(are)g(sev)o(eral)g(w)o(a)o(ys)f(to)934 2921 y(56)p
eop
%%Page: 57 57
bop 37 199 a Ft(solv)o(e)20 b(this,)g(the)f(simplest)i(b)q(eing)f(to)f(mo)o
(v)o(e)f(all)i(the)g(threatened)f(liv)o(e)i(stac)o(k)d(lo)q(cations)i(in)o
(to)f(registers)37 256 y(\(when)d(generating)f(C,)g(lo)q(cal)h(v)m
(ariables\))g(b)q(efore)g(starting)e(to)h(o)o(v)o(erwrite)f(them.)37
342 y(Here)i(is)g(an)f(example:)228 428 y Fp(f)24 b(=)g({})f(\\n)h({x,y})f
(->)h(g)g({y,x})37 514 y Ft(On)17 b(en)o(try)f(to)f Fp(f)p
Ft(,)h Fp(x)g Ft(and)g Fp(y)g Ft(will)i(b)q(e)f(on)f(the)g(stac)o(k.)22
b(It)16 b(immediately)i(calls)f Fp(g)f Ft(whic)o(h)h(requires)g(the)f(same)37
570 y(argumen)o(ts,)k(but)g(in)g(the)g(other)f(order,)h(so)g(at)f(least)g
(one)h(register)g(m)o(ust)f(b)q(e)h(used)g(during)h(the)f(stac)o(k)37
627 y(rearrangemen)o(t.)37 713 y(Suc)o(h)d(argumen)o(t-sh)o(u\017ing)f(is)h
(rather)e(un)o(usual.)24 b(It)16 b(is)h(m)o(uc)o(h)f(more)g(common)f(for)h
(the)g(same)g(argumen)o(t)37 769 y(to)f(app)q(ear)g(in)g(the)g(same)f(p)q
(osition,)i(in)g(whic)o(h)f(case)g(no)g(co)q(de)g(need)h(b)q(e)f(generated)g
(at)f(all.)21 b(This)15 b(is)g(often)37 825 y(the)h(case)f(for)g(recursiv)o
(e)g(functions)h(whic)o(h)g(pass)f(some)g(argumen)o(ts)g(along)g(unc)o
(hanged.)37 977 y Fm(9.3)56 b Fe(let\(rec\))16 b Fm(expressions)37
1092 y Ft(As)h(men)o(tioned)g(earlier,)g Fp(let)f Ft(and)h
Fp(letrec)e Ft(expressions)j(alw)o(a)o(ys)d(compile)j(to)e(co)q(de)h(whic)o
(h)g(allo)q(cates)g(a)37 1148 y(closure)g(in)f(the)f(heap)h(for)f(eac)o(h)g
(de\014nition,)i(follo)o(w)o(ed)e(b)o(y)h(co)q(de)g(to)e(ev)m(aluate)j(the)e
(b)q(o)q(dy)h(of)f(the)g(let\(rec\).)37 1205 y(Eac)o(h)h(of)e(these)i
(closures)g(consists)f(of)g(an)g(info)g(p)q(oin)o(ter,)h(and)f(a)g(\014eld)i
(for)d(eac)o(h)h(of)g(its)h(free)f(v)m(ariables.)37 1291 y(F)l(or)g(example,)
h(the)f(expression)742 1343 y Fp(let)g Fn(f)25 b Fp(=)15 b
Fn(fs)j Fp(\\)p Fq(\031)f Fn(xs)h Fp(->)d Fn(b)742 1400 y Fp(in)g
Fn(e)37 1480 y Ft(compiles)i(to)d(co)q(de)i(whic)o(h)f(allo)q(cates)h(a)e
(closure)i(for)e Fn(f)c Ft(,)k(and)i(then)f(con)o(tin)o(ues)g(with)h(co)q(de)
f(to)f(ev)m(aluate)i Fn(e)s Ft(.)37 1536 y(F)l(or)f(example,)h(consider)g
(the)f(de\014nition)i(of)e Fp(compose)o Ft(:)228 1622 y Fp(compose)23
b(=)h({})g(\\n)f({f,g,x})g(->)h(let)f(gx)h(=)f({g,x})h(\\u)f({})h(->)f(g)h
({x})873 1678 y(in)f(f)h({gx})37 1764 y Ft(The)16 b(co)q(de)g(for)e(the)i(b)q
(o)q(dy)f(of)g Fp(compose)f Ft(runs)i(as)f(follo)o(ws:)228
1850 y Fp(/*)24 b(Allocate)f(heap)g(block)g(*/)228 1907 y(Hp)h(=)g(Hp)f(-)h
(3;)477 b(/*)24 b(Allocate)e(some)i(heap)f(*/)228 1963 y(if)h(\(Hp)f(<)h
(HLimit\))381 b(/*)24 b(Heap)f(exhaustion)f(check)i(*/)419
2020 y({)g(...trigger)f(GC...)g(};)228 2133 y(/*)h(Fill)f(in)h(closure)f(for)
g(gx)h(*/)228 2189 y(Hp[0])g(=)f(&gx_info;)357 b(/*)24 b(info)f(pointer)g(*/)
228 2246 y(Hp[1])h(=)f(SpA[1];)405 b(/*)24 b(g)f(*/)228 2302
y(Hp[2])h(=)f(SpA[2];)405 b(/*)24 b(x)f(*/)228 2415 y(/*)h(Call)f(f)h(*/)228
2471 y(Node)g(=)f(SpA[0];)429 b(/*)24 b(Grab)f(f)h(into)f(Node)g(*/)228
2528 y(SpA[2])g(=)h(&Hp[0];)381 b(/*)24 b(Push)f(gx)h(*/)228
2584 y(SpA)g(=)g(SpA)f(+)h(2;)429 b(/*)24 b(Adjust)f(SpA)g(*/)228
2641 y(ENTER\()g(Node)h(\);)37 2727 y Ft(Here,)16 b Fp(gx_info)e
Ft(is)h(the)h(statically-allo)q(cated)h(info)f(table)f(for)g
Fp(gx)o Ft(:)934 2921 y(57)p eop
%%Page: 58 58
bop 228 199 a Fp(static)23 b(int)h(gx_info[])f(=)419 256 y({)167
b(&gx_entry,)610 312 y(&scavenge_2,)610 369 y(&evacuate_2,)610
425 y(...)419 482 y(})37 568 y Ft(In)18 b(this)g(info)f(table,)h
Fp(gx_entry)e Ft(is)i(the)f(name)g(of)g(the)g(C)g(function)h(whic)o(h)g
(implemen)o(ts)g(the)f(standard-)37 624 y(en)o(try)f(co)q(de)h(for)e(the)h
(closure)h Fp(gx)o Ft(.)22 b Fp(scavenge_2)15 b Ft(and)h Fp(evacuate_2)f
Ft(are)g(run)o(time)i(system)e(routines)i(for)37 680 y(p)q(erforming)f
(garbage)e(collection)j(on)f(closures)f(con)o(taining)h(t)o(w)o(o)e(p)q(oin)o
(ters)i(\(Section)g(7.3\).)37 828 y Fr(9.3.1)52 b(Allo)q(cation)37
943 y Ft(The)16 b(allo)q(cation)g(of)f(these)g(closures)h(is)g(straigh)o
(tforw)o(ard,)d(and)i(w)o(as)f(discussed)j(in)f(Section)g(7.2.)37
1029 y(References)k(to)e(dynamically-allo)q(cated)k(closures)d(within)h(a)e
(single)i(instruction)f(sequence)h(are)e(made)37 1086 y(b)o(y)d(o\013setting)
e(from)h(the)g(heap)h(p)q(oin)o(ter.)20 b(\(The)15 b(co)q(de)f(generator)g(k)
o(eeps)g(trac)o(k)g(of)g(the)g(ph)o(ysical)i(p)q(osition)37
1142 y(of)i(the)g(heap)g(p)q(oin)o(ter,)g(so)g(that)f(correct)g(o\013sets)g
(can)g(b)q(e)i(made)f(ev)o(en)g(if)g(it)g(is)g(mo)o(v)o(ed)f(b)o(y)h
(instructions)37 1198 y(within)f(the)e(basic)h(blo)q(c)o(k.\))37
1284 y(Notice)i(the)e(use)h(here)g(of)f(the)h(term)f(\\single)i(instruction)f
(sequence".)25 b(In)17 b(particular,)h(this)f(metho)q(d)f(of)37
1341 y(addressing)i(cannot)f(surviv)o(e)h(o)o(v)o(er)e(the)i(ev)m(aluation)g
(triggered)f(b)o(y)h(a)f Fp(case)f Ft(expression,)i(b)q(ecause)h(suc)o(h)37
1397 y(an)d(ev)m(aluation)h(ma)o(y)d(tak)o(e)h(an)g(un)o(b)q(ounded)i(amoun)o
(t)e(of)g(computation.)21 b(Not)15 b(only)h(ma)o(y)e(this)i(mo)o(v)o(e)f(the)
37 1454 y(heap)j(p)q(oin)o(ter)f(unpredictably)l(,)j(but)d(it)g(ma)o(y)f
(trigger)h(garbage)f(collection,)j(whic)o(h)e(ma)o(y)g(rearrange)f(the)37
1510 y(relativ)o(e)h(p)q(ositions)h(of)d(the)i(closures.)24
b(In)17 b(short,)e(at)h(the)g(p)q(oin)o(ts)h(in)g(the)f(op)q(erational)h
(seman)o(tics)g(where)37 1567 y(the)f(en)o(vironmen)o(t)h Fq(\032)e
Ft(is)h(sa)o(v)o(ed)g(on)f(the)h(return)g(stac)o(k,)f(a)h(p)q(oin)o(ter)g(to)
f(eac)o(h)h(liv)o(e)h(closure)g(m)o(ust)e(b)q(e)h(sa)o(v)o(ed)37
1623 y(on)g(the)f(p)q(oin)o(ter)h(stac)o(k)e(\(Section)i(9.4.1\).)37
1770 y Fr(9.3.2)52 b(The)18 b(co)q(de)g(for)f(a)h(closure)37
1886 y Ft(Muc)o(h)d(more)e(in)o(teresting,)i(of)f(course,)g(is)g(the)h
(standard-en)o(try)e(co)q(de)i(for)e(the)i(closure.)20 b(This)15
b(is)f(the)g(co)q(de)37 1942 y(whic)o(h)22 b(will)g(get)e(executed)h(if)g
(the)g(closure)g(is)g(ev)o(er)g(en)o(tered.)36 b(The)20 b(standard-en)o(try)g
(co)q(de)h(for)f(ev)o(ery)37 1999 y(closure)c(b)q(egins)h(with)e(the)h(follo)
o(wing)g(sequence:)37 2110 y Fr(Argumen)o(t)h(satisfaction)i(c)o(hec)o(k.)j
Ft(This)c(concerns)g(up)q(dating,)h(and)f(is)h(discussed)g(in)g(Section)g
(10.2.)151 2167 y(It)c(is)h(only)g(generated)f(if)h(there)f(are)g(one)g(or)g
(more)g(argumen)o(ts.)37 2256 y Fr(Stac)o(k)j(o)o(v)o(er\015o)o(w)d(c)o(hec)o
(k.)22 b Ft(If)14 b(the)g(execution)h(of)e(the)h(closure)h(can)f(cause)g
(either)h(stac)o(k)e(to)g(o)o(v)o(er\015o)o(w,)f(or)151 2312
y(\(if)h(the)f(stac)o(ks)f(are)h(organised)h(to)f(gro)o(w)f(to)o(w)o(ards)f
(eac)o(h)j(other\))e(collide,)k(execution)e(is)g(halted.)20
b(\(On)151 2368 y(a)13 b(parallel)h(mac)o(hine,)g(whic)o(h)g(w)o(orks)e(with)
i(man)o(y)e(stac)o(ks,)h(di\013eren)o(t)g(action)g(is)h(tak)o(en.\))k(This)c
(stac)o(k)151 2425 y(o)o(v)o(er\015o)o(w)g(c)o(hec)o(k)h(can)g(\\lo)q(ok)g
(ahead")f(in)o(to)h(all)h(the)f(branc)o(hes)g(of)g(an)o(y)f
Fp(case)g Ft(expressions)i(in)o(v)o(olv)o(ed)151 2481 y(in)e(the)g(ev)m
(aluation)g(of)f(the)h(closure,)g(taking)f(the)h(w)o(orst-case)e(path)h(as)g
(the)h(o)o(v)o(er\015o)o(w)e(criterion.)20 b(Of)151 2538 y(course,)15
b(if)h(there)f(is)h(no)f(net)g(stac)o(k)g(gro)o(wth,)e(no)i(c)o(hec)o(k)h(is)
f(p)q(erformed.)37 2627 y Fr(Heap)j(o)o(v)o(er\015o)o(w)d(c)o(hec)o(k.)22
b Ft(A)16 b(similar)i(c)o(hec)o(k)e(is)h(p)q(erformed)g(for)f(heap)h(o)o(v)o
(er\015o)o(w,)e(if)h(an)o(y)g(heap)h(is)g(allo-)151 2683 y(cated.)j(This)c(w)
o(as)f(discussed)i(in)f(Section)g(7.2.)j(The)d(heap)g(c)o(hec)o(k)f(cannot)g
(lo)q(ok)h(ahead)f(in)o(to)h Fp(case)151 2740 y Ft(branc)o(hes,)e(b)q(ecause)
h(the)e(ev)m(aluation)i(implied)h(b)o(y)e(a)f Fp(case)g Ft(can)h(p)q(erform)f
(an)h(un)o(b)q(ounded)h(amoun)o(t)151 2796 y(of)g(computation.)934
2921 y(58)p eop
%%Page: 59 59
bop 37 199 a Fr(Info)18 b(p)q(oin)o(ter)g(up)q(date.)23 b Ft(In)g(the)e(case)
h(of)f(an)g(up)q(datable)i(closure,)h(its)d(info)h(p)q(oin)o(ter)g(ma)o(y)f
(no)o(w)g(b)q(e)151 256 y(o)o(v)o(erwritten)14 b(with)h(a)f(\\blac)o(k)g
(hole")h(info)g(p)q(oin)o(ter)g(or,)f(in)h(a)f(parallel)i(system,)e(a)g
(\\queue)h(me")g(info)151 312 y(p)q(oin)o(ter.)21 b(This)15
b(is)h(discussed)h(in)f(more)f(detail)h(b)q(elo)o(w)g(\(Section)f(9.3.3\).)37
406 y Fr(Up)q(date)k(frame)e(construction.)24 b Ft(F)l(or)12
b(up)q(datable)i(closures)f(only)l(,)h(an)e(up)q(date)i(frame)e(is)h(pushed)h
(on)o(to)151 462 y(the)i(up)q(date)g(stac)o(k.)k(This)c(action)g(causes)f(a)g
(later)h(up)q(date,)g(whic)o(h)g(o)o(v)o(erwrites)f(the)g(closure)i(with)151
519 y(its)e(head)h(normal)f(form.)k(The)c(implemen)o(tation)i(of)d(up)q
(dates,)h(and)h(the)f(mapping)h(of)e(the)h(up)q(date)151 575
y(stac)o(k,)f(are)h(discussed)i(in)f(detail)g(in)g(Section)g(10.)37
699 y(Co)q(de)i(is)g(no)o(w)e(generated)i(for)e(the)i(b)q(o)q(dy)f(of)g(the)h
(closure,)g(with)f(the)h(free)f(v)m(ariables)h(b)q(ound)h(to)d(appro-)37
755 y(priate)f(o\013sets)e(from)g(the)h Fp(Node)f Ft(register,)h(and)g(the)g
(argumen)o(ts)f(to)h(o\013sets)f(from)g(the)h(appropriate)g(stac)o(k)37
812 y(p)q(oin)o(ters.)20 b(\(Lik)o(e)15 b(man)o(y)f(other)g(compilers,)h
(ours)f(k)o(eeps)g(trac)o(k)g(of)g(where)g(the)g(stac)o(k)g(p)q(oin)o(ters)g
(are)g(p)q(oin)o(t-)37 868 y(ing)k(within)g(the)f(curren)o(t)f(activ)m(ation)
i(record,)f(so)f(that)g(at)g(an)o(y)h(momen)o(t)f(it)h(can)g(generate)f(the)h
(correct)37 925 y(o\013set)e(from)f(the)h(curren)o(t)h(stac)o(k)e(p)q(oin)o
(ter.\))37 1074 y Fr(9.3.3)52 b(Blac)o(k)18 b(holes)37 1189
y Ft(When)f(an)g(up)q(datable)h(closure)f(is)g(en)o(tered,)f(its)h
(standard-en)o(try)f(co)q(de)h(has)g(the)f(opp)q(ortunit)o(y)h(to)f(o)o(v)o
(er-)37 1246 y(write)k(the)g(closure's)g(info)g(p)q(oin)o(ter)g(with)h(a)e
(standard)g(\\blac)o(k)h(hole")g(info)g(p)q(oin)o(ter)h(pro)o(vided)f(b)o(y)g
(the)37 1302 y(run)o(time)c(system.)k(Whilst)15 b(this)h(op)q(eration)g
(costs)e(an)h(instruction,)h(it)g(has)f(t)o(w)o(o)e(adv)m(an)o(tages:)106
1426 y Fo(\017)22 b Ft(If)13 b(the)f(closure)h(is)f(ev)o(er)g(re-en)o(tered)h
(b)q(efore)f(it)h(is)f(up)q(dated,)i(the)e(blac)o(k)h(hole)f(en)o(try)g(co)q
(de)h(can)f(rep)q(ort)151 1482 y(an)g(error.)19 b(This)13 b(situation)g(o)q
(ccurs)f(in)i(programs)d(where)h(a)h(v)m(alue)g(dep)q(ends)h(on)e(itself;)i
(for)e(example)342 1595 y Fp(letrec)23 b(a)h(=)g(1+a)47 b(in)23
b(a)106 1707 y Fo(\017)f Ft(If)e(a)f(closure)g(is)h(left)g(undisturb)q(ed)h
(un)o(til)f(it)g(is)g(\014nally)g(up)q(dated)g(with)g(its)f(head)h(normal)f
(form,)151 1764 y(there)c(is)h(a)f(serious)h(risk)f(of)g(a)g
Fn(sp)n(ac)n(e)g(le)n(ak)p Ft(.)k(F)l(or)c(example,)h(consider)g(the)f(STG)g
(de\014nitions)342 1876 y Fp(ns)24 b(=)f({})h(\\u)g({x})f(->)h(..x..)342
1933 y(l)g(=)f({})h(\\u)g({ns})f(->)h(last)f({ns})151 2045
y Ft(where)13 b Fp(..x..)e Ft(pro)q(duces)j(some)e(v)o(ery)g(long)h(list.)19
b(and)13 b Fp(last)f Ft(returns)g(the)g(last)h(elemen)o(t)g(of)f(a)g(list.)20
b(If)151 2101 y(the)13 b(th)o(unk)g(for)f Fp(l)h Ft(is)h(left)f(undisturb)q
(ed)i(un)o(til)f(it)f(is)g(\014nally)i(up)q(dated)f(with)f(the)g(last)g
(elemen)o(t)g(of)g(the)151 2158 y(list)h Fp(ns)p Ft(,)g(it)f(will)i(retain)f
(a)f(p)q(oin)o(ter)h(to)f(the)h(en)o(tire)g(list,)g(rather)f(than)g
(consuming)i(it)e(incremen)o(tally)l(.)151 2214 y(\(This)18
b(nice)g(example)h(is)e(due)h(to)f(Jones)h([1991].\))24 b(Ov)o(erwriting)18
b(the)f(th)o(unk)h(for)f Fp(l)g Ft(with)g(a)g(blac)o(k)151
2271 y(hole)j(immediately)g(it)f(is)h(en)o(tered)f(solv)o(es)g(this)g(space)h
(leak,)f(b)q(ecause)h(a)f(blac)o(k)g(hole)h(retains)f(no)151
2327 y(p)q(oin)o(ters.)37 2451 y(It)14 b(is)h(also)f(p)q(ossible)h(to)f
(obtain)g(b)q(oth)g(these)g(adv)m(an)o(tages)f(in)i(a)e(sligh)o(tly)i(more)f
(subtle)g(w)o(a)o(y)l(,)f(without)h(p)q(er-)37 2507 y(forming)g(the)f(blac)o
(k-hole)i(o)o(v)o(erwriting)f(op)q(eration.)19 b(Firstly)l(,)14
b(non-termination)g(of)g(the)f(form)g(detectable)37 2564 y(b)o(y)20
b(blac)o(k)g(holes)h(alw)o(a)o(ys)e(results)h(in)h(stac)o(k)e(o)o(v)o
(er\015o)o(w.)32 b(The)20 b(cause)g(of)f(the)h(stac)o(k)f(o)o(v)o(er\015o)o
(w)g(can)h(then)37 2620 y(easily)d(b)q(e)f(determined)h(b)o(y)e(noticing)i
(that)e(there)g(is)h(more)f(than)g(one)h(p)q(oin)o(ter)g(on)f(the)h(up)q
(date)g(stac)o(k)f(to)37 2676 y(the)h(same)f(closure.)20 b(This)c(can)f(only)
h(happ)q(en)g(if)g(its)f(v)m(alue)h(dep)q(ends)h(on)e(itself.)21
b(It)15 b(is)h(also)f(p)q(ossible)i(that)37 2733 y(the)g(error)f(message)g
(obtainable)i(from)d(a)i(p)q(ost-mortem)e(of)h(the)h(up)q(date)g(stac)o(k)f
(could)h(b)q(e)g(rather)f(more)37 2789 y(informativ)o(e,)g(b)q(ecause)h(the)f
(en)o(tire)h(collection)g(of)f(closures)h(in)o(v)o(olv)o(ed)f(in)h(the)f
(self-dep)q(enden)o(t)i(lo)q(op)f(can)934 2921 y(59)p eop
%%Page: 60 60
bop 37 199 a Ft(b)q(e)15 b(iden)o(ti\014ed)g(and,)f(since)h(they)e(all)i
(still)g(ha)o(v)o(e)e(their)h(original)h(info)f(tables)g(attac)o(hed,)f
(their)h(source)f(co)q(de)37 256 y(lo)q(cation)j(information)g(could)g(b)q(e)
g(sho)o(wn)f(to)q(o.)37 342 y(Secondly)l(,)f(w)o(e)c(address)i(the)f
(space-leak)h(question.)19 b(In)11 b(the)h(ab)q(o)o(v)o(e)e(example,)i(the)g
(p)q(oin)o(ter)f(to)g Fp(ns)f Ft(retained)37 398 y(b)o(y)15
b Fp(l)f Ft(only)h(matters)f(at)f(garbage-collection)j(time.)k(In)15
b(almost)f(all)i(cases)e(a)g(th)o(unk)h(will)h(b)q(e)f(en)o(tered)g(and)37
455 y(up)q(dated)h(b)q(et)o(w)o(een)f(garbage)f(collections,)i(so)e(that)g
(no)h(space)g(impro)o(v)o(emen)o(t)f(is)h(gained)h(b)o(y)e(o)o(v)o(erwriting)
37 511 y(with)20 b(a)f(blac)o(k)h(hole.)33 b(What)18 b(w)o(e)h(w)o(ould)h
(lik)o(e)g(to)f(do)g(is)h(to)e Fn(black-hole)i(only)g(those)g(thunks)g(which)
g(ar)n(e)37 568 y(under)f(evaluation)g(at)g(garb)n(age)g(c)n(ol)r(le)n(ction)
e(time)p Ft(.)27 b(Happily)l(,)20 b(they)e(are)f(exactly)h(the)g(th)o(unks)g
(to)f(whic)o(h)37 624 y(the)12 b(up)q(date)h(stac)o(k)d(p)q(oin)o(ts!)20
b(So)11 b(w)o(e)g(can)h(safely)g(omit)g(the)g(blac)o(k-hole)h(up)q(date)f(on)
g(th)o(unk)f(en)o(try)l(,)h(pro)o(vided)37 680 y(that)17 b(instead)g(w)o(e)g
(b)q(egin)h(garbage)d(collection)k(b)o(y)e(blac)o(k-holing)h(all)g(the)f(th)o
(unks)g(p)q(oin)o(ted)h(to)e(from)g(the)37 737 y(up)q(date)g(stac)o(k.)37
823 y(Since)j(b)q(oth)f(these)f(tec)o(hniques)i(rely)f(on)f(the)g(up)q(date)h
(stac)o(k,)f(they)g(only)h(apply)g(to)e(up)q(datable)j(th)o(unks)37
879 y(\(up)q(date)f(\015ag)f Fp(u)p Ft(\).)25 b(If)17 b(a)g(th)o(unk)g(is)h
(non-up)q(datable)h(\(up)q(date)e(\015ag)g Fp(n)p Ft(\))g(it)g(m)o(ust)g
(still)h(b)q(e)g(blac)o(k-holed)h(b)o(y)37 936 y(its)f(standard-en)o(try)e
(co)q(de.)26 b(F)l(or)16 b(this)h(reason)g(in)h(our)e(implemen)o(tation)j(w)o
(e)d(ha)o(v)o(e)h(t)o(w)o(o)f(v)m(arian)o(ts)g(of)h(the)37
992 y Fp(n)i Ft(up)q(date)g(\015ag:)25 b Fp(r)19 b Ft(for)e
Fn(r)n(e)n(entr)n(ant)g Ft(\(the)h(closure)h(ma)o(y)f(b)q(e)h(en)o(tered)g
(man)o(y)e(times,)i(and)g(should)g(not)f(b)q(e)37 1049 y(blac)o(k-holed\),)f
(and)f Fp(s)f Ft(for)g Fn(single-entry)f Ft(\(the)i(closure)g(will)h(b)q(e)g
(en)o(tered)f(at)e(most)h(once,)h(and)g(should)g(b)q(e)37 1105
y(blac)o(k-holed\).)21 b(The)15 b Fp(r)f Ft(\015ag)g(is)h(used)f(for)g
(manifest)g(functions,)h(constructors)f(and)g(partial)h(applications,)37
1162 y(while)h(the)d Fp(s)h Ft(\015ag)f(is)h(only)g(used)g(for)f(th)o(unks)h
(where)g(up)q(date)g(analysis)h(has)e(determined)i(that)e(an)g(up)q(date)37
1218 y(is)j(not)f(required.)37 1304 y(In)20 b(a)e(parallel)i(system,)e(the)h
(standard-en)o(try)e(co)q(de)i(for)f(an)h(up)q(datable)g(th)o(unk)g(should)g
(o)o(v)o(erwrite)f(the)37 1360 y(th)o(unk)d(with)f(a)g(\\queue)h(me")f(info)g
(p)q(oin)o(ter)h(\(Section)g(3.1.3\).)i(Unlik)o(e)f(the)e(blac)o(k-holing)i
(of)e(a)g(sequen)o(tial)37 1417 y(system,)h(this)h(op)q(eration)f(cannot)g(b)
q(e)h(p)q(ostp)q(oned)g(un)o(til)g(garbage)e(collection.)37
1568 y Fm(9.4)56 b Fe(case)17 b Fm(expressions)37 1684 y Ft(P)o(attern)e
(matc)o(hing,)h(via)h Fp(case)e Ft(expressions,)i(is)f(utterly)h(p)q(erv)m
(asiv)o(e)g(in)g(lazy)f(functional)h(programs,)e(all)37 1740
y(the)g(more)f(so)h(in)g(the)g(Spineless)i(T)l(agless)e(G-mac)o(hine)g(b)q
(ecause)h(the)e(b)q(o)o(xing)i(and)e(un)o(b)q(o)o(xing)i(op)q(erations)37
1796 y(of)h(arithmetic)g(are)f(done)h(using)g Fp(case)f Ft(expressions)h
(rather)f(than)g(b)o(y)g(some)h Fn(ad)g(ho)n(c)g Ft(mec)o(hanism.)24
b(One)37 1853 y(of)14 b(the)g(strengths)f(of)h(the)g(Spineless)i(T)l(agless)e
(G-Mac)o(hine)h(is)f(that)g(there)g(is)g(a)g(rather)f(ric)o(h)i(design)g
(space)37 1909 y(for)g(ho)o(w)g(pattern-matc)o(hing)g(can)g(b)q(e)h(implemen)
o(ted,)h(including)g(some)e(rather)g(e\016cien)o(t)h(options.)37
1995 y Fp(case)21 b Ft(expressions)h(\(and)g(only)g Fp(case)e
Ft(expressions\))i(cause)g(ev)m(aluation)h(to)d(tak)o(e)h(place.)39
b(In)22 b(the)g(op-)37 2052 y(erational)e(seman)o(tics)e(this)i(is)f
(expressed)g(b)o(y)g(pushing)h(a)e(contin)o(uation)i(on)o(to)e(the)h(return)f
(stac)o(k,)h(and)37 2108 y(ev)m(aluating)f(the)f(expression)h(to)e(b)q(e)i
(scrutinised)g(\(Rule)g(4\).)24 b(This)17 b(is)g(mirrored)g(precisely)i(b)o
(y)e(the)f(co)q(de)37 2165 y(generated)g(for)e Fp(case)h Ft(expressions.)37
2251 y(In)i(co)q(de)g(generation)f(for)f(most)g(languages)h(the)g(act)g(of)g
(pushing)h(a)e(contin)o(uation)i(\(or)e(return)h(address\))37
2307 y(is)k(immediately)g(follo)o(w)o(ed)g(b)o(y)f(a)f(function)i(call.)32
b(It)19 b(is)g(w)o(orth)f(noticing)i(in)g(passing)f(that)g(this)g(is)g(not)37
2364 y(the)h(case)g(for)f(the)h(STG)f(language;)j(there)e(ma)o(y)f(b)q(e)h(a)
g(signi\014can)o(t)g(gap)g(b)q(et)o(w)o(een)g(the)g(instruction\(s\))37
2420 y(whic)o(h)14 b(push)g(the)e(contin)o(uation)i(and)f(the)g(instruction)h
(\(if)f(an)o(y\))f(whic)o(h)h(actually)h(transfers)e(con)o(trol.)19
b(F)l(or)37 2476 y(example,)d(consider)g(the)g(expression)228
2562 y Fp(case)24 b(\(case)f(f)h(x)f(of)h(...\))228 2619 y(of)g(...)37
2705 y Ft(The)15 b(contin)o(uation)g(for)e(the)h(outer)g Fp(case)g
Ft(is)g(pushed,)h(then)g(the)f(contin)o(uation)h(for)e(the)h(inner)h
Fp(case)p Ft(,)f(and)37 2761 y(then)i(the)f(call)i(to)d Fp(f)h
Ft(is)h(made.)k(F)l(ew)15 b(programmers)f(write)h(this)g(sort)g(of)f(co)q
(de,)i(but)f(it)h(arises)f(as)g(a)g(result)934 2921 y(60)p
eop
%%Page: 61 61
bop 37 199 a Ft(of)16 b(program)f(transformations)f(within)j(the)f(compiler.)
23 b(The)16 b(order)g(of)f(the)h(t)o(w)o(o)f Fp(case)g Ft(expressions)i(can)
37 256 y(b)q(e)f(in)o(terc)o(hanged,)g(but)f(only)h(at)e(the)i(risk)f(of)g
(co)q(de)h(duplication.)37 342 y(The)h(main)g(p)q(oin)o(t)g(of)f(in)o(terest)
g(is)h(ho)o(w)f(contin)o(uations)h(are)f(represen)o(ted.)23
b(Recall)c(that)c(a)h(contin)o(uation)37 398 y(in)h(the)e(op)q(erational)h
(seman)o(tics)f(consists)g(of)g(t)o(w)o(o)f(parts:)93 521 y(1.)22
b(The)16 b(alternativ)o(es)f(of)g(the)g Fp(case)g Ft(expression.)93
615 y(2.)22 b(The)16 b(en)o(vironmen)o(t)f Fq(\032)g Ft(in)h(whic)o(h)g(they)
f(should)h(b)q(e)g(executed.)37 739 y(The)g(represen)o(tation)g(of)f
(alternativ)o(es)g(is)h(in)o(timately)g(connected)h(with)f(the)f(co)q(de)h
(generated)f(for)g(prim-)37 795 y(itiv)o(e)23 b(v)m(alues)g(and)f
(constructors,)g(so)g(w)o(e)f(defer)h(discussion)i(of)d(the)h(\014rst)f
(topic)h(un)o(til)h(the)f(follo)o(wing)37 852 y(sections.)f(En)o(vironmen)o
(t-sa)o(ving)15 b(is)h(indep)q(enden)o(t)i(of)c(constructors,)g(so)h(w)o(e)g
(discuss)h(it)g(\014rst.)37 1001 y Fr(9.4.1)52 b(Sa)o(ving)18
b(the)g(lo)q(cal)h(en)o(vironmen)o(t)37 1116 y Ft(The)f(lo)q(cal)g(en)o
(vironmen)o(t)g(is)f(sa)o(v)o(ed)g(b)o(y)g(sa)o(ving)g(in)h(the)f(stac)o(ks)g
(the)g(v)m(alues)h(of)f(all)h(v)m(ariables)g(whic)o(h)g(are)37
1173 y(liv)o(e)c(\(that)e(is,)h(free\))f(in)h(an)o(y)f(of)g(the)h(alternativ)
o(es.)19 b(The)13 b(w)o(a)o(y)e(in)i(whic)o(h)h(a)e(liv)o(e)i(v)m(ariable)f
(is)g(sa)o(v)o(ed)f(dep)q(ends)37 1229 y(on)k(where)f(it)h(curren)o(tly)f
(resides:)106 1353 y Fo(\017)22 b Ft(It)16 b(ma)o(y)e(already)i(b)q(e)g(in)g
(a)f(stac)o(k,)g(for)g(example)h(if)g(it)f(w)o(as)g(an)g(argumen)o(t)g(to)g
(the)g(curren)o(t)h(closure.)151 1409 y(No)f(co)q(de)h(need)g(b)q(e)g
(generated.)106 1503 y Fo(\017)22 b Ft(It)16 b(ma)o(y)f(b)q(e)h(in)g(a)g
(register,)f(or)g(it)h(ma)o(y)f(b)q(e)h(b)q(ound)h(to)e(an)g(o\013set)g(from)
g(the)h(heap)g(p)q(oin)o(ter.)21 b(In)c(this)151 1559 y(case)e(it)h(m)o(ust)e
(b)q(e)i(sa)o(v)o(ed)f(in)h(the)f(appropriate)h(stac)o(k.)106
1653 y Fo(\017)22 b Ft(It)g(ma)o(y)f(b)q(e)i(in)g(the)f(closure)g(curren)o
(tly)h(p)q(oin)o(ted)f(to)g(b)o(y)g Fp(Node)o Ft(.)40 b(In)22
b(this)h(case)f(there)g(are)f(t)o(w)o(o)151 1710 y(p)q(ossibilitie)q(s:)h(sa)
o(v)o(e)15 b(the)g(v)m(ariable)i(itself,)e(or)g(sa)o(v)o(e)f
Fp(Node)p Ft(.)151 1785 y(The)h(latter)f(reduces)h(the)g(n)o(um)o(b)q(er)f
(of)g(sa)o(v)o(es)g(b)q(ecause)h(sa)o(ving)g Fp(Node)e Ft(e\013ectiv)o(ely)j
(sa)o(v)o(es)d(the)i(v)m(alues)151 1841 y(of)d(sev)o(eral)h(v)m(ariables)h
(at)e(once.)20 b(On)13 b(the)g(other)f(hand,)i(an)e(extra)g(memory)h(access)f
(is)i(subsequen)o(tly)151 1898 y(required)i(to)f(get)g(the)g(v)m(alue)h(of)f
(the)g(v)m(ariable.)151 1973 y(Another)g(problem)h(with)g(sa)o(ving)f
Fp(Node)g Ft(is)h(that)f(the)g Fn(entir)n(e)g Ft(con)o(ten)o(ts)f(of)h(the)h
(closure)g(m)o(ust)f(then)151 2029 y(b)q(e)h(retained)h(b)o(y)e(the)h
(garbage)f(collector,)h(ev)o(en)g(though)f(the)h(con)o(tin)o(uation)g(ma)o(y)
f(only)h(use)g(some)151 2086 y(of)e(its)g(\014elds.)21 b(The)14
b(space-leak)h(a)o(v)o(oidance)f(mec)o(hanisms)h(describ)q(ed)h(in)f(Section)
g(9.3.3)d(cannot)i(b)q(e)151 2142 y(applied.)21 b(\(It)13 b(is)g(p)q(ossible)
h(to)e(rescue)i(the)e(space)h(b)q(eha)o(viour)h(b)o(y)f(compiling)h(a)f
(bitmask)f(to)g(indicate)151 2199 y(whic)o(h)k(\014elds)h(of)d(the)i(closure)
g(are)e(liv)o(e,)i(but)g(it)f(is)h(complicated.\))151 2274
y(Our)g(curren)o(t)f(p)q(olicy)i(is)e(to)g(a)o(v)o(oid)g(these)g
(di\016culties)j(b)o(y)d(sa)o(ving)g(all)h(v)m(ariables)h(individually)m(.)37
2397 y(When)h(sa)o(ving)f(a)f(v)m(ariable)j(in)e(a)g(stac)o(k,)f(w)o(e)h(can)
g(economise)h(on)e(stac)o(k)h(usage)f(b)o(y)h(re-using)h(stac)o(k)e(slots)37
2454 y(b)q(elonging)i(to)d(v)m(ariables)i(whic)o(h)f(are)f(no)o(w)g(dead.)22
b(There)16 b(is)g(also)f(a)h(useful)g(side)h(b)q(ene\014t:)22
b(the)15 b(structure)37 2510 y(p)q(oin)o(ted)21 b(to)d(b)o(y)i(dead)f(p)q
(oin)o(ters)h(in)g(the)f(stac)o(k)g(cannot)g(b)q(e)h(reclaimed)h(b)o(y)e(the)
g(garbage)g(collector,)h(so)37 2567 y(o)o(v)o(erwriting)f(suc)o(h)g(p)q(oin)o
(ters)g(with)g(liv)o(e)h(ones)e(helps)i(to)e(a)o(v)o(oid)g(space)h(leaks.)31
b(One)19 b(could)h(exp)q(erimen)o(t)37 2623 y(\(though)11 b(w)o(e)g(ha)o(v)o
(e)f(not)h(y)o(et)g(done)g(so\))f(with)i(generating)f(extra)f(instructions)i
(to)f(o)o(v)o(erwrite)f(dead)i(p)q(oin)o(ters)37 2679 y(whose)18
b(slots)g(are)f(not)g(to)h(b)q(e)g(reused,)g(sp)q(eci\014cally)j(in)e(order)e
(to)g(mak)o(e)g(their)i(space)f(reclaimable.)29 b(W)l(e)37
2736 y(call)17 b(this)e(\\stac)o(k)g(stubbing".)934 2921 y(61)p
eop
%%Page: 62 62
bop 37 199 a Fr(9.4.2)52 b(Constructor)17 b(application)q(s)37
315 y Ft(The)c(expression)f(scrutinised)i(b)o(y)e(a)f Fp(case)h
Ft(expression)g(m)o(ust)g(ev)o(en)o(tually)g(ev)m(aluate)h(either)g(to)e(a)h
(primitiv)o(e)37 371 y(v)m(alue)17 b(or)d(a)h(constructor)f(application.)22
b(W)l(e)15 b(deal)g(with)h(the)f(latter)g(case)g(in)g(this)h(section,)f
(deferring)h(the)37 428 y(primitiv)o(e)h(case)e(to)g(Section)h(9.5.)37
513 y(The)23 b(co)q(de)f(generated)g(for)f(a)h(constructor)f(application)j(m)
o(ust)d(return)h(con)o(trol)g(to)f(the)h(appropriate)37 570
y(alternativ)o(e)c(of)e(the)i Fp(case)e Ft(expression,)i(making)g(the)f
(argumen)o(t)f(of)h(the)g(application)i(a)o(v)m(ailable)f(to)f(the)37
626 y(alternativ)o(e.)i(This)12 b(is)g(just)f(what)g(is)h(done)g(b)o(y)f(the)
h(rules)g(for)f(constructors)f(in)i(the)g(op)q(erational)g(seman)o(tics)37
683 y(\(Rules)17 b(5,)d(6)h(and)h(7\).)37 769 y(F)l(or)f(example,)h(consider)
g(the)f(expression:)228 855 y Fp(let)324 911 y(hd)23 b(=)h({})g(\\n)f({xs})h
(->)f(case)h(xs)f(of)777 968 y(Cons)h({y,ys})f(->)g(y)h({})777
1024 y(Nil)g({})143 b(->)23 b(error)g({})324 1081 y(single)g(=)h({w,ws})f
(\\n)47 b({})24 b(->)f(Cons)h({w,)f(ws})228 1137 y(in)228 1194
y(hd)h({single})37 1280 y Ft(where)c Fp(w)e Ft(and)h Fp(ws)g
Ft(are)f(b)q(ound)i(b)o(y)e(some)h(enclosing)h(scop)q(e.)31
b(The)19 b(co)q(de)h(generated)e(for)h(the)f Fp(case)h Ft(ex-)37
1336 y(pression)d(in)f Fp(hd)f Ft(pushes)h(a)f(contin)o(uation)h(and)g(en)o
(ters)f(the)g(closure)h(for)f Fp(xs)p Ft(,)g(whic)o(h)h(is)g(b)q(ound)g(to)f
Fp(single)37 1392 y Ft(in)k(this)e(case.)23 b(The)17 b(co)q(de)f(for)g(the)g
(constructor)g(application)i Fp(Cons)23 b({w,ws})o Ft(,)16
b(in)h(the)f(b)q(o)q(dy)h(of)f Fp(single)o Ft(,)37 1449 y(should)g(return)f
(con)o(trol)g(to)f(the)h(appropriate)g(alternativ)o(e,)g(returning)g
Fp(w)g Ft(and)g Fp(ws)f Ft(in)i(some)e(agreed)h(w)o(a)o(y)l(.)37
1505 y(\(Remem)o(b)q(er)h(that)f(constructor)f(applications)j(in)f(the)f(STG)
g(language)g(are)g(alw)o(a)o(ys)g(saturated.\))37 1591 y(There)h(are)f(t)o(w)
o(o)f(main)h(asp)q(ects)h(to)e(consider:)106 1715 y Fo(\017)22
b Ft(There)16 b(ma)o(y)f(b)q(e)i(sev)o(eral)f(alternativ)o(es,)g(so)f(there)h
(is)h(the)f(question)g(of)g(ho)o(w)f(the)h(appropriate)g(one)151
1771 y(is)g(selected.)106 1865 y Fo(\017)22 b Ft(The)c(constructor)e(for)h(a)
g(particular)i(alternativ)o(e)e(ma)o(y)g(ha)o(v)o(e)g(argumen)o(ts,)g(in)h
(whic)o(h)g(case)g(these)151 1921 y(need)e(to)f(b)q(e)h(comm)o(unicated)f(to)
g(the)g(co)q(de)h(for)f(the)g(alternativ)o(e.)37 2045 y(These)h(t)o(w)o(o)e
(issues)i(are)f(no)o(w)g(discussed)h(in)g(turn.)37 2194 y Fr(9.4.3)52
b(Selecting)19 b(the)f(alternativ)o(e)37 2310 y Ft(The)e(simplest)h(p)q
(ossible)g(represen)o(tation)e(for)g(the)g(alternativ)o(es)h(is)g(a)f(single)
i(co)q(de)f(lab)q(el,)g(whic)o(h)h(w)o(e)e(call)37 2366 y(a)h
Fn(r)n(eturn)h(addr)n(ess)p Ft(,)f(pushed)h(on)f(the)g(B)g(stac)o(k.)22
b(Con)o(trol)16 b(is)g(returned)h(b)o(y)f(the)g(constructor)f(application)37
2423 y(to)g(the)g(lab)q(elled)j(co)q(de)e(when)g(ev)m(aluation)g(of)f(the)g
(scrutinised)i(ob)s(ject)e(is)g(completed.)37 2509 y(If)i(there)g(is)g(only)g
(one)g(mem)o(b)q(er)f(of)h(the)f(algebraic)i(data)d(t)o(yp)q(e)i(\(tuples,)g
(for)f(example\),)h(the)g(ev)m(aluation)37 2565 y(of)e(the)g(\(single\))g
(alternativ)o(e)g(can)g(pro)q(ceed)h(immediately)l(.)21 b(If)15
b(there)g(is)h(more)e(than)h(one)g(mem)o(b)q(er)g(of)f(the)37
2621 y(t)o(yp)q(e)k(\(lists,)h(for)e(example\),)h(the)g(tag)e(of)i(the)f(ob)s
(ject)g(is)i(put)e(in)o(to)h(a)f(particular)i(register)e Fp(RTag)p
Ft(,)g(and)h(a)37 2678 y(C)i Fp(switch)e Ft(statemen)o(t)g(is)i(generated)f
(to)g(p)q(erform)g(the)g(case)g(analysis)h(on)f Fp(RTag)p Ft(.)32
b(\(In)19 b(a)g(nativ)o(e-co)q(de)37 2734 y(generator,)14 b(this)i(m)o
(ulti-w)o(a)o(y)f(jump)h(can)f(b)q(e)h(compiled)h(using)f(a)f(tree)g(of)f
(conditionals)j(or)e(using)h(a)f(jump)934 2921 y(62)p eop
%%Page: 63 63
bop 270 324 300 4 v 420 549 252 4 v 630 547 a Fi(-)p 270 474
300 4 v 268 622 4 375 v 270 624 300 4 v 568 622 4 375 v 851
703 263 4 v 1072 701 a(-)p 851 553 V 1072 551 a(-)p 701 628
300 4 v 698 474 307 4 v 698 774 4 300 v 1001 774 V 698 777
307 4 v 192 152 1514 4 v 192 846 4 694 v 1702 846 V 192 849
1514 4 v 720 420 a Ft(Return)16 b(v)o(ector)345 247 y(B)f(stac)o(k)1136
570 y(Co)q(de)h(for)e(Nil)j(alternativ)o(e)1140 720 y(Co)q(de)e(for)g(Cons)g
(alternativ)o(e)691 945 y(Figure)g(6:)20 b(V)l(ectored)c(returns)37
1083 y(table,)f(dep)q(ending)i(on)e(the)g(sparsit)o(y)f(of)g(the)h
(alternativ)o(es,)g(but)f(using)i(C)e(as)h(our)f(target)f(co)q(de)j(allo)o
(ws)f(to)37 1139 y(delegate)h(this)g(c)o(hoice)g(to)f(the)g(C)g(compiler.\))
37 1225 y(This)21 b(is)f(not)g(the)g(only)g(p)q(ossible)i(represen)o(tation)d
(for)h(the)g(alternativ)o(es.)33 b(Another)20 b(p)q(ossibilit)o(y)i(is)f(to)
37 1282 y(represen)o(t)c(the)f(alternativ)o(es)h(b)o(y)f(a)g(p)q(oin)o(ter)h
(to)f(a)g(table)h(of)f(co)q(de)h(lab)q(els,)h(with)e(one)h(en)o(try)f(in)h
(the)g(table)37 1338 y(for)d(eac)o(h)h(constructor)e(in)j(the)e(data)g(t)o
(yp)q(e.)20 b(Figure)14 b(6)g(illustrates)i(the)e(situation)h(for)f(a)g
Fp(case)g Ft(expression)37 1394 y(whic)o(h)k(is)f(scrutinising)h(a)e(list.)24
b(A)17 b(p)q(oin)o(ter)g(to)f(this)g(table,)h(whic)o(h)h(w)o(e)e(call)h(a)f
Fn(r)n(eturn)i(ve)n(ctor)p Ft(,)e(is)h(pushed)37 1451 y(on)f(the)f(B)g(stac)o
(k)g(b)o(y)g(the)g(co)q(de)h(for)f(the)g Fp(case)g Ft(expression.)21
b(Then,)15 b(instead)h(of)f(loading)h Fp(RTag)o Ft(,)f(the)g(co)q(de)37
1507 y(for)j(the)g(constructor)g(application)h(can)g(transfer)e(con)o(trol)h
(directly)h(to)f(the)g(appropriate)g(destination,)37 1564 y(th)o(us)h(sa)o
(ving)f(a)g(jump.)29 b(W)l(e)18 b(call)i(this)e(a)g Fn(ve)n(ctor)n(e)n(d)h(r)
n(eturn)p Ft(,)f(and)h(the)f(p)q(oin)o(ter)h(to)e(the)i(return)f(v)o(ector)f
(a)37 1620 y Fn(ve)n(ctor)n(e)n(d)f(r)n(eturn)g(addr)n(ess)p
Ft(.)37 1706 y(The)j(imp)q(ortan)o(t)f(p)q(oin)o(t)h(to)f(note)h(is)g(that)e
Fn(the)j(r)n(eturn)f(c)n(onvention)f(c)n(an)h(b)n(e)g(chosen)f(indep)n
(endently)g(on)37 1763 y(a)i(datatyp)n(e)f(by)g(datatyp)n(e)h(b)n(asis)p
Ft(.)28 b(A)18 b(particular)h Fp(case)e Ft(expression)i(will)h(only)f
(scrutinise)g(ob)s(jects)f(of)f(a)37 1819 y(particular)i(t)o(yp)q(e.)28
b(In)18 b(practice,)h(w)o(e)e(\(somewhat)g(arbitrarily\))h(use)g(v)o(ectored)
g(returns)g(for)f(data)g(t)o(yp)q(es)37 1876 y(with)h(up)f(to)g(eigh)o(t)g
(constructors,)f(b)q(ecause)i(this)g(catc)o(hes)f(the)g(v)m(ast)f(ma)s(jorit)
o(y)g(of)h(data)f(t)o(yp)q(es)h(without)37 1932 y(risking)g(w)o(asting)d
(\(co)q(de\))h(space)h(on)f(large)g(sparsely-used)i(return)e(v)o(ectors.)37
2082 y Fr(9.4.4)52 b(Returning)18 b(the)g(constructor)g(argumen)o(ts)37
2197 y Ft(There)j(is)f(a)g(corresp)q(ondingly)h(simple)h(con)o(v)o(en)o(tion)
e(a)o(v)m(ailable)i(for)d(comm)o(unicating)i(the)f(constructor)37
2253 y(argumen)o(ts)11 b(to)h(the)f(alternativ)o(e:)19 b(mak)o(e)11
b(the)h Fp(Node)f Ft(register)h(p)q(oin)o(t)g(to)f(a)h(constructor)f(closure)
h(con)o(taining)37 2310 y(the)21 b(appropriate)f(v)m(alues.)37
b(The)20 b(co)q(de)h(for)f(the)g(alternativ)o(e)h(can)f(then)h(address)f(its)
h(comp)q(onen)o(ts)f(b)o(y)37 2366 y(indexing)e(from)c(the)h
Fp(Node)g Ft(register)g(as)g(usual.)37 2452 y(This)j(w)o(orks)e(\014ne,)i
(and)f(is)g(simple)i(enough,)e(but)g(a)g(m)o(uc)o(h)g(b)q(etter)g(alternativ)
o(e)g(is)g(readily)h(a)o(v)m(ailable:)25 b(if)37 2509 y(there)15
b(are)e(su\016cien)o(tly)i(few)f(argumen)o(ts,)f(return)h(them)g(in)h
(registers!)k(If)14 b(the)g(closure)h(b)q(eing)g(scrutinised)37
2565 y(is)i(already)f(a)f(constructor)g(then)h(not)g(m)o(uc)o(h)f(is)i
(gained;)f(indeed)h(something)f(ma)o(y)f(b)q(e)i(lost,)e(b)q(ecause)i(all)37
2622 y(its)g(comp)q(onen)o(ts)f(ma)o(y)g(b)q(e)h(loaded)g(in)o(to)f
(registers)g(when)g(p)q(erhaps)h(the)g(alternativ)o(e)f(only)h(requires)g
(one)37 2678 y(of)j(them.)33 b(But)20 b(there)f(is)i(a)e(terri\014c)h(gain)g
(when)g(a)f(th)o(unk)h(is)g(scrutinised,)i(b)q(ecause)f(it)f(ma)o(y)f(thereb)
o(y)37 2735 y(a)o(v)o(oid)14 b(ev)o(er)g(building)i(the)e(constructor)f(in)i
(the)e(heap.)20 b(The)14 b(most)f(critical)i(example)g(of)e(this)i(is)f
(ordinary)37 2791 y(in)o(teger)i(arithmetic.)k(Consider)c(the)f(follo)o(wing)
h(example:)934 2921 y(63)p eop
%%Page: 64 64
bop 228 199 a Fp(neg)24 b(=)g({})f(\\n)h({x})f(->)h(case)f(x)h(of)682
256 y(MkInt)f({x#})g(->)h(case)f(\(neg#)g({x#}\))h(of)1016
312 y(y#)f(->)h(MkInt)f({y#})37 398 y(neg)12 b Ft(is)g(the)h(function)f(whic)
o(h)h(negates)f(an)g(in)o(teger.)19 b(It)12 b(op)q(erates)f(b)o(y)h(ev)m
(aluating)h(the)f(in)o(teger)h Fp(x)e Ft(to)h(extract)37 455
y(its)g(primitiv)o(e)g(v)m(alue)g Fp(x#)p Ft(,)f(negating)g(it)g(to)f(giv)o
(e)h Fp(y#)p Ft(,)g(and)g(then)h(returning)f(the)g(in)o(teger)g
Fp(MkInt)23 b({y#})p Ft(.)18 b(No)o(w,)37 511 y(under)c(the)f(simple)i
(return)e(con)o(v)o(en)o(tion,)g(the)g(b)q(o)o(xed)g(v)m(alue)h
Fp(MkInt)24 b({y#})12 b Ft(w)o(ould)h(b)q(e)h(constructed)f(in)h(the)37
568 y(heap,)f Fp(Node)e Ft(w)o(ould)h(b)q(e)g(made)g(to)f(p)q(oin)o(t)h(to)f
(it,)i(and)f(con)o(trol)f(returned)h(to)f(the)h(contin)o(uation.)19
b(If,)13 b(instead,)37 624 y(the)j(comp)q(onen)o(t)g(of)f(the)h(constructor,)
e Fp(y#)i Ft(is)g(returned)g(in)g(a)f(register,)h(the)f(v)m(alue)i(need)g
(nev)o(er)e(b)q(e)i(built)37 680 y(in)f(the)e(heap,)h(except)f(as)g(result)h
(of)f(an)g(up)q(date)h(\(Section)g(10\).)j(It)d(turns)f(out)g(that)f(this)i
(has)f(a)g(big)h(e\013ect)37 737 y(on)h(p)q(erformance)f(.)37
823 y(As)h(b)q(efore,)g(the)g(imp)q(ortan)o(t)f(p)q(oin)o(t)h(is)g(that)f
Fn(the)i(r)n(eturn)g(c)n(onvention)e(c)n(an)h(b)n(e)g(chosen)g(on)h(a)g
(datatyp)n(e)g(by)37 879 y(datatyp)n(e)g(b)n(asis)p Ft(.)i(In)o(tegers)c(are)
f(not)g(a)h(sp)q(ecial)i(case.)i(F)l(or)14 b(example,)i(list)f(\\cons")g
(cells)h(can)f(b)q(e)h(returned)37 936 y(b)o(y)e(putting)h(the)f(head)h(and)f
(tail)g(v)m(alues)i(in)o(to)e(sp)q(eci\014c)i(registers.)j(\(Indep)q(enden)o
(tly)l(,)e(a)c(v)o(ectored)h(or)g(non-)37 992 y(v)o(ectored)19
b(return)f(con)o(v)o(en)o(tion)h(can)g(b)q(e)g(c)o(hosen.\))30
b(Ev)o(en)18 b(the)h(c)o(hoice)g(of)f(whic)o(h)i(registers)e(are)g(used)i(to)
37 1049 y(return)e(v)m(alues)h(can)f(also)g(b)q(e)g(made)g(indep)q(enden)o
(tly)j(for)c(eac)o(h)h(data)f(t)o(yp)q(e.)27 b(F)l(or)18 b(example,)g(a)g
(\015oating-)37 1105 y(p)q(oin)o(t)e(n)o(um)o(b)q(er)g(can)f(b)q(e)h
(returned)g(in)g(a)e(\015oating-p)q(oin)o(t)i(register.)37
1191 y(F)l(or)f(the)g(reason)f(giv)o(en)i(b)q(efore,)e(it)i(is)f(probably)h
(not)e(a)h(go)q(o)q(d)f(idea)i(to)e(return)h(constructors)f(with)h(man)o(y)37
1248 y(argumen)o(ts)k(en)o(tirely)i(in)f(registers.)33 b(W)l(e)19
b(therefore)g(mak)o(e)g(a)h(virtue)g(of)f(necessit)o(y)h(\(there)f(are)g
(only)h(a)37 1304 y(limited)h(n)o(um)o(b)q(er)d(of)g(registers\))g(and)h
(return)f(larger)g(constructors)g(b)o(y)g(allo)q(cating)i(them)e(in)h(the)g
(heap)37 1360 y(and)d(making)f Fp(Node)g Ft(p)q(oin)o(t)h(to)e(them.)37
1446 y(It)f(turns)g(out)g(that)f(the)h(return-in-registers)g(con)o(v)o(en)o
(tion)g(mak)o(es)g(up)q(dates)g(substan)o(tially)h(harder,)f(as)f(w)o(e)37
1503 y(shall)17 b(see,)e(but)g(the)h(gain)f(is)h(w)o(ell)g(w)o(orth)e(it.)37
1654 y Fm(9.5)56 b(Arithmetic)37 1770 y Ft(Supp)q(ose)16 b(that)e(the)g
(expression)h(scrutinised)h(b)o(y)f(a)f Fp(case)f Ft(turns)i(out)f(to)f(ev)m
(aluate)j(to)d(a)h(primitiv)o(e)i(v)m(alue;)37 1826 y(that)h(is,)i(either)f
(a)f(primitiv)o(e)i(literal)g(\(Rule)f(9\),)g(a)f(v)m(ariable)i(whose)e(v)m
(alue)i(is)f(primitiv)o(e)h(\(Rule)g(10\),)d(or)37 1882 y(an)e(arithmetic)h
(op)q(eration)f(whose)g(result)h(is)f(primitiv)o(e)i(\(Rule)f(14\).)k(All)c
(three)f(of)g(these)g(rules)h(en)o(ter)f(the)37 1939 y Fn(R)n(eturnInt)j
Ft(state,)c(whic)o(h)i(tak)o(es)d(action)i(dep)q(ending)i(on)d(the)h
(alternativ)o(es)g(stored)f(on)g(top)g(of)g(the)h(return)37
1995 y(stac)o(k.)37 2081 y(The)j(return)f(con)o(v)o(en)o(tion)h(for)e
(primitiv)o(e)j(v)m(alues)g(is)e(simple.)25 b(The)17 b(contin)o(uation)g(on)f
(top)g(of)g(the)g(return)37 2138 y(stac)o(k)i(is)g(alw)o(a)o(ys)f(a)g(return)
h(address,)g(p)q(oin)o(ting)h(directly)h(to)d(the)h(contin)o(uation)g(co)q
(de.)29 b(The)18 b(primitiv)o(e)37 2194 y(v)m(alue)e(itself)g(is)f(returned)h
(in)f(a)g(standard)f(return)h(register,)f(c)o(hosen)h(indep)q(enden)o(tly)j
(for)c(eac)o(h)h(primitiv)o(e)37 2251 y(data)h(t)o(yp)q(e.)23
b(F)l(or)15 b(example,)i(one)g(register)f(can)g(b)q(e)h(used)g(for)e(in)o
(tegers)i(and)f(another)g(for)f(\015oating)h(p)q(oin)o(t)37
2307 y(v)m(alues.)31 b(The)18 b(co)q(de)h(generated)f(for)g(a)g(primitiv)o(e)
i(literal)f(simply)h(loads)e(the)h(sp)q(eci\014ed)h(v)m(alue)g(in)o(to)e(the)
37 2364 y(appropriate)d(return)g(register,)g(p)q(ops)g(the)g(return)g
(address)g(from)f(the)h(B)g(stac)o(k)f(and)h(jumps)g(to)f(it.)20
b(Simi-)37 2420 y(larly)l(,)c(the)g(co)q(de)g(generated)f(for)g(a)g(primitiv)
o(e)i(v)m(ariable)g(just)e(loads)g(the)h(v)m(alue)g(of)f(the)h(v)m(ariable)h
(in)o(to)e(the)37 2476 y(return)h(register)f(and)g(returns;)g(and)g
(arithmetic)h(follo)o(ws)f(in)h(the)g(same)e(w)o(a)o(y)l(.)37
2562 y(The)i(co)q(de)g(generated)f(at)g(the)g(return)g(address)h(implemen)o
(ts)g(the)f(case)h(analysis)g(implied)h(b)o(y)e(the)h(alter-)37
2619 y(nativ)o(es)j(\(if)f(an)o(y\),)g(using)h(a)f(suitable)h(C)f
Fp(switch)g Ft(statemen)o(t.)27 b(Often)19 b(there)f(is)h(only)g(one)f
(alternativ)o(e,)37 2675 y(whic)o(h)g(binds)g(a)e(v)m(ariable)i(to)e(the)g(v)
m(alue)i(returned.)24 b(This)18 b(is)f(easily)g(done)g(b)o(y)g(binding)h(the)
f(v)m(ariable)h(to)37 2732 y(the)e(appropriate)f(return)g(register.)934
2921 y(64)p eop
%%Page: 65 65
bop 37 199 a Ft(There)16 b(is)g(a)f(v)o(ery)f(imp)q(ortan)o(t)h(sp)q(ecial)i
(case,)e(when)h(compiling)h(expressions)f(of)f(the)g(form:)754
296 y Fp(case)f Fn(v)885 303 y Fl(1)919 296 y Fo(\010)c Fn(v)985
303 y Fl(2)1024 296 y Fp(of)15 b Fn(alts)37 393 y Ft(for)f(built-in)j
(arithmetic)d(op)q(erations)h Fo(\010)p Ft(.)20 b(It)14 b(w)o(ould)g(b)q(e)h
(p)q(oin)o(tless)h(to)d(push)i(a)f(return)g(address,)g(ev)m(aluate)37
450 y Fn(v)58 457 y Fl(1)95 450 y Fo(\010)f Fn(v)164 457 y
Fl(2)187 450 y Ft(,)20 b(and)f(return)g(to)f(the)i(return)f(address!)31
b(These)20 b(op)q(erations)f(can)g(easily)h(b)q(e)g(short-circuited,)37
506 y(and)15 b(it)f(is)h(practically)h(essen)o(tial)f(to)e(do)i(so.)k(W)l(e)
14 b(can)h(express)f(this)h(equiv)m(alence)i(b)o(y)d(doing)h(some)e(simple)37
563 y(transformations)h(on)h(the)h(rules)g(to)e(giv)o(e)i(the)f(deriv)o(ed)h
(rules:)37 872 y(\(18\))p 133 607 1410 2 v 132 889 2 283 v
281 759 a Fn(Eval)395 613 y Fg(0)395 686 y(B)395 711 y(B)395
736 y(B)395 760 y(B)395 785 y(B)395 812 y(@)442 646 y Fp(case)24
b Fo(\010)i(f)p Fn(x)667 653 y Fl(1)690 646 y Fq(;)8 b Fn(x)732
653 y Fl(2)755 646 y Fo(g)15 b Fp(of)533 703 y Fn(k)554 710
y Fl(1)592 703 y Fp(->)g Fn(e)676 710 y Fl(1)699 703 y Fp(;)533
759 y Fq(:)8 b(:)g(:)533 816 y Fn(k)554 823 y Fl(n)592 816
y Fp(->)15 b Fn(e)676 823 y Fl(n)700 816 y Fp(;)533 872 y Fn(x)20
b Fp(->)15 b Fn(e)851 613 y Fg(1)851 686 y(C)851 711 y(C)851
736 y(C)851 760 y(C)851 785 y(C)851 812 y(A)910 759 y Fq(\032)942
687 y Fg(")976 731 y Fn(x)997 738 y Fl(1)1033 731 y Fo(7!)e
Fn(Int)18 b(i)1182 738 y Fl(1)976 788 y Fn(x)997 795 y Fl(2)1033
788 y Fo(7!)13 b Fn(Int)18 b(i)1182 795 y Fl(2)1216 687 y Fg(#)1261
759 y Fn(as)24 b(rs)h(us)f(h)h Fq(\033)p 1542 889 V 132 1002
2 113 v 144 968 a Ft(=)-8 b Fo(\))65 b Fn(Eval)19 b(e)g Fq(\032)p
Ft([)p Fn(x)e Fo(7!)c Fn(Int)19 b Ft(\()p Fn(i)670 975 y Fl(1)703
968 y Fo(\010)10 b Fn(i)762 975 y Fl(2)786 968 y Ft(\)])444
b Fn(as)24 b(rs)h(us)f(h)h Fq(\033)p 1542 1002 V 132 1115 V
144 1081 a Ft(where)c Fn(k)302 1088 y Fl(j)331 1081 y Fo(6)p
Ft(=)13 b Fn(i)393 1088 y Fl(1)427 1081 y Fo(\010)d Fn(i)486
1088 y Fl(2)601 1081 y Ft(\()p Fn(1)18 b Fo(\024)13 b Fn(j)19
b Fo(\024)13 b Fn(n)s Ft(\))p 1542 1115 V 133 1117 1410 2 v
37 1400 a(\(19\))p 133 1163 V 132 1389 2 226 v 281 1287 a Fn(Eval)395
1165 y Fg(0)395 1238 y(B)395 1263 y(B)395 1288 y(B)395 1315
y(@)442 1202 y Fp(case)24 b Fo(\010)i(f)p Fn(x)667 1209 y Fl(1)690
1202 y Fq(;)8 b Fn(x)732 1209 y Fl(2)755 1202 y Fo(g)15 b Fp(of)533
1259 y Fq(:)8 b(:)g(:)533 1315 y Fn(k)19 b Fp(->)c Fn(e)s Fp(;)533
1372 y Fq(:)8 b(:)g(:)851 1165 y Fg(1)851 1238 y(C)851 1263
y(C)851 1288 y(C)851 1315 y(A)910 1287 y Fq(\032)942 1215 y
Fg(")976 1259 y Fn(x)997 1266 y Fl(1)1033 1259 y Fo(7!)13 b
Fn(Int)18 b(i)1182 1266 y Fl(1)976 1315 y Fn(x)997 1322 y Fl(2)1033
1315 y Fo(7!)13 b Fn(Int)18 b(i)1182 1322 y Fl(2)1216 1215
y Fg(#)1261 1287 y Fn(as)24 b(rs)h(us)f(h)h Fq(\033)p 1542
1389 V 132 1501 2 113 v 144 1468 a Ft(=)-8 b Fo(\))65 b Fn(Eval)19
b(e)g Fq(\032)810 b Fn(as)24 b(rs)h(us)f(h)h Fq(\033)p 1542
1501 V 132 1614 V 144 1580 a Ft(where)c Fn(k)c Ft(=)c Fn(i)381
1587 y Fl(1)415 1580 y Fo(\010)d Fn(i)474 1587 y Fl(2)p 1542
1614 V 133 1616 1410 2 v 37 1692 a Ft(In)16 b(particular,)g(once)f(this)h
(optimisation)g(is)g(implemen)o(ted,)g(the)f(expression)685
1789 y Fp(case)24 b Fo(\010)i(f)p Fn(x)910 1796 y Fl(1)933
1789 y Fq(;)8 b Fn(x)975 1796 y Fl(2)998 1789 y Fo(g)15 b Fp(of)g
Fn(x)21 b Fp(->)14 b Fn(e)37 1886 y Ft(compiles)j(to)e(the)g(simple)i(C)e
(statemen)o(t:)128 1972 y Fp(x)24 b(=)g(x1)h Fo(\010)g Fp(x2)37
2058 y Ft(where)16 b Fp(x)p Ft(,)f Fp(x1)f Ft(and)i Fp(x2)f
Ft(are)g(the)g(C)g(lo)q(cal)h(v)m(ariables)h(used)e(to)g(hold)h(the)f(v)m
(alues)i(of)d Fn(x)5 b Ft(,)16 b Fn(x)1534 2065 y Fl(1)1572
2058 y Ft(and)g Fn(x)1682 2065 y Fl(2)1705 2058 y Ft(.)37 2230
y Fs(10)67 b(Adding)24 b(up)r(dates)37 2361 y Ft(So)14 b(far)f(ev)o(erything)
i(has)e(b)q(een)i(quite)g(tidy:)20 b(tree)13 b(reduction)i(is)f(nice)h(and)f
(easy)l(.)20 b(Sadly)l(,)14 b(graph)g(reduction)37 2417 y(is)h(harder,)f(and)
h(up)q(dates)f(are)g(quite)h(complicated.)21 b(This)14 b(is)h(m)o(uc)o(h)f
(the)h(tric)o(kiest)f(part)g(of)f(the)i(Spineless)37 2474 y(T)l(agless)h
(G-mac)o(hine.)k(Still,)d(w)o(e)e(b)q(egin)h(bra)o(v)o(ely)g(enough.)37
2624 y Fm(10.1)56 b(Represen)n(ting)18 b(up)r(date)g(frames)37
2740 y Ft(Recall)i(that)c(when)i(a)g(closure)g(is)g(en)o(tered)f(it)h(has)f
(the)h(opp)q(ortunit)o(y)g(to)e(push)j(an)e(up)q(date)h(frame)f(on)o(to)37
2796 y(the)f(up)q(date)g(stac)o(k.)j(An)c(up)q(date)h(frame)f(consists)g(of)
934 2921 y(65)p eop
%%Page: 66 66
bop 106 199 a Fo(\017)22 b Ft(A)15 b(p)q(oin)o(ter)h(to)f(the)g(closure)h(to)
e(b)q(e)i(up)q(dated.)106 293 y Fo(\017)22 b Ft(The)16 b(sa)o(v)o(ed)e
(argumen)o(t)h(and)g(return)g(stac)o(ks.)37 416 y(After)d(an)f(up)q(date)i
(frame)e(is)h(pushed,)h(execution)g(con)o(tin)o(ues)f(with)g(empt)o(y)f
(argumen)o(t)g(and)h(return)f(stac)o(ks.)37 502 y(Of)20 b(course,)g(w)o(e)e
(don't)h(actually)h(cop)o(y)f(the)g(argumen)o(t)f(and)i(return)f(stac)o(ks)f
(on)o(to)g(a)h(separate)f(up)q(date)37 559 y(stac)o(k!)23 b(Instead,)16
b(w)o(e)g(dedicate)i(t)o(w)o(o)d(registers,)h(called)h(the)g
Fn(stack)g(b)n(ase)f(r)n(e)n(gisters)p Ft(,)f(to)h(p)q(oin)o(t)g(just)g(b)q
(elo)o(w)37 615 y(the)h(b)q(ottom-most)e(w)o(ord)h(of)g(the)g(A)h(and)g(B)f
(stac)o(ks)g(resp)q(ectiv)o(ely)l(.)25 b(The)17 b(argumen)o(t)f(and)g(return)
h(stac)o(ks)37 672 y(can)e(no)o(w)f(b)q(e)h(\\sa)o(v)o(ed")f(and)h(then)g
(\\made)f(empt)o(y")g(merely)h(b)o(y)g(sa)o(ving)f(the)h(stac)o(k)e(base)i
(registers)f(in)i(the)37 728 y(up)q(date)g(frame,)f(and)g(making)g(them)g(p)q
(oin)o(t)h(to)f(the)g(curren)o(t)g(top)g(of)g(the)g(A)g(and)h(B)f(stac)o(ks.)
37 814 y(Where)i(is)h(the)f(up)q(date)g(stac)o(k)f(k)o(ept?)25
b(It)17 b(could)h(b)q(e)f(represen)o(ted)g(b)o(y)g(a)g(separate)f(stac)o(k)g
(all)i(of)e(its)h(o)o(wn,)37 871 y(but)g(w)o(e)g(ha)o(v)o(e)f(c)o(hosen)h(to)
f(merge)h(it)g(with)g(the)g(B)f(stac)o(k.)24 b(The)17 b(minor)g(reason)f(for)
g(this)i(is)f(to)f(a)o(v)o(oid)g(y)o(et)37 927 y(another)f(stac)o(k.)k(The)d
(ma)s(jor)d(reason)i(is)h(that)e(it)i(mak)o(es)e(a)o(v)m(ailable)j(an)e(imp)q
(ortan)o(t)g(optimisation)h(whic)o(h)37 984 y(w)o(e)f(discuss)i(b)q(elo)o(w)e
(\(Section)h(10.3\).)37 1070 y(T)l(o)f(conclude,)i(the)e(op)q(eration)h(of)e
(pushing)j(an)e(up)q(date)h(frame)e(\(Rule)j(15\))d(is)i(done)f(b)o(y:)106
1193 y Fo(\017)22 b Ft(Pushing)16 b(an)f(up)q(date)h(frame)f(on)o(to)f(the)h
(B)h(stac)o(k.)106 1287 y Fo(\017)22 b Ft(Setting)16 b(the)f(stac)o(k)f(base)
i(registers)f(to)f(p)q(oin)o(t)i(to)f(the)g(top)g(of)f(their)i(resp)q(ectiv)o
(e)g(stac)o(ks.)37 1410 y(\(The)f(alert)f(reader)h(will)h(ha)o(v)o(e)e(sp)q
(otted)g(that)g(a)g(p)q(oin)o(ter)h(\(to)e(the)i(closure)g(to)f(b)q(e)h(up)q
(dated\))g(has)f(thereb)o(y)37 1466 y(ended)j(up)e(on)h(the)f(B)g(stac)o(k.)k
(W)l(e)d(discuss)g(this)g(in)g(Section)g(10.7.\))37 1552 y(An)g(up)q(date)h
(is)f(triggered)f(in)i(one)f(of)f(t)o(w)o(o)f(w)o(a)o(ys:)20
b(either)c(a)f(function)i(\014nds)f(to)q(o)f(few)h(argumen)o(ts)e(on)i(the)37
1609 y(stac)o(k,)k(or)g(a)f(constructor)g(application)i(\014nds)g(an)f(empt)o
(y)f(return)h(stac)o(k.)33 b(These)20 b(t)o(w)o(o)e(situations)i(are)37
1665 y(discussed)d(in)f(the)g(follo)o(wing)f(sections.)37 1817
y Fm(10.2)56 b(P)n(artial)19 b(applications)37 1932 y Ft(When)14
b(a)f(closure)g(is)h(en)o(tered)f(whic)o(h)h(\014nds)g(to)q(o)e(few)h
(argumen)o(ts)f(on)h(the)g(stac)o(k,)f(an)h(up)q(date)h(is)f(triggered.)37
1988 y(This)g(is)f(describ)q(ed)i(b)o(y)d(Rules)j(17)d(and)h(17a.)18
b(The)12 b(c)o(hec)o(k)g(for)f(to)q(o)g(few)h(argumen)o(ts)e(is)j(called)g
(the)f Fn(ar)n(gument)37 2045 y(satisfaction)19 b(che)n(ck)p
Ft(,)e(and)i(o)q(ccurs)f(at)f(the)h(start)f(of)h(the)g(co)q(de)g(for)g(ev)o
(ery)g(closure)g(whic)o(h)h(tak)o(es)e(one)h(or)37 2101 y(more)d(argumen)o
(ts)g(\(cf)g(Section)h(9.3.2\).)37 2187 y(A)h(minor)g(complication)i(is)e
(that)f(the)h(argumen)o(ts)f(are)g(split)i(b)q(et)o(w)o(een)f(the)g(A)g(and)g
(B)g(stac)o(ks,)f(but)h(this)37 2244 y(presen)o(ts)e(little)h(di\016cult)o(y)
l(.)21 b(If)15 b(the)g Fn(last)f Ft(argumen)o(t)f(is)i(a)o(v)m(ailable)i
(then)e(certainly)g(all)h(the)e(others)g(will)j(b)q(e,)37 2300
y(so)e(the)h(c)o(hec)o(k)f(is)h(p)q(erformed)f(only)h(on)f(the)g(stac)o(k)g
(whic)o(h)h(con)o(tains)f(the)g(last)h(argumen)o(t.)37 2386
y(The)j(argumen)o(t)f(satisfaction)h(c)o(hec)o(k)g(is)g(p)q(erformed)g(b)o(y)
f(subtracting)h(the)g(stac)o(k)f(base)g(p)q(oin)o(ter)i(of)e(the)37
2443 y(appropriate)h(stac)o(k)f(from)f(the)i(corresp)q(onding)g(stac)o(k)f(p)
q(oin)o(ter,)h(giving)h(a)e(di\013erence)h(in)h(w)o(ords.)28
b(This)37 2499 y(is)17 b(compared)g(with)f(the)g(\(statically)h(calculated\))
g(n)o(um)o(b)q(er)g(of)f(w)o(ords)f(required)j(for)d(all)i(the)g(argumen)o
(ts)37 2556 y(whic)o(h)h(are)f(passed)g(on)g(that)f(stac)o(k.)24
b(If)17 b(to)q(o)f(few)h(w)o(ords)f(are)h(presen)o(t,)f(a)h(jump)g(is)g(tak)o
(en)g(to)f(a)h(run)o(time)37 2612 y(system)j(routine,)h Fp(UpdatePAP)n
Ft(,)g(whic)o(h)f(p)q(erforms)g(the)f(up)q(date.)34 b(Once)21
b(the)e(up)q(date)i(has)e(b)q(een)i(done,)37 2668 y Fp(UpdatePAP)g
Ft(concludes)i(b)o(y)e(re-en)o(tering)i(the)e(closure,)j(whic)o(h)e
Fp(Node)f Ft(should)i(b)q(e)f(p)q(oin)o(ting)g(to.)39 b(The)37
2725 y(argumen)o(t)13 b(satisfaction)h(c)o(hec)o(k)g(is)g(thereb)o(y)g(p)q
(erformed)g(again,)g(as)f(Rule)i(17)e(requires,)i(in)f(case)g(a)f(further)37
2781 y(up)q(date)j(is)g(needed.)934 2921 y(66)p eop
%%Page: 67 67
bop 37 199 a Ft(A)13 b(sp)q(ecial)i(case)d(is)i(required)f(for)f(top-lev)o
(el)i(closures,)g(b)q(ecause)f(the)g(co)q(de)g(en)o(tering)g(the)g(closure)g
(ma)o(y)f(not)37 256 y(ha)o(v)o(e)k(made)h Fp(Node)e Ft(p)q(oin)o(t)i(to)f
(it)g(\(Section)h(9.2.1\).)k(In)c(this)g(case,)f(just)g(b)q(efore)h(jumping)g
(to)f Fp(UpdatePAP)n Ft(,)37 312 y(the)i(argumen)o(t-satisfaction-c)o(hec)o
(k)g(co)q(de)g(loads)g(a)f(p)q(oin)o(ter)h(to)f(the)h(closure)g(in)o(to)g
Fp(Node)o Ft(.)28 b(\(Recall)19 b(that)37 369 y(top-lev)o(el)e(closures)f
(are)f(statically)h(allo)q(cated,)f(so)g(their)h(address)f(is)h(\014xed.\))37
455 y(What)f(do)q(es)h Fp(UpdatePAP)d Ft(do?)21 b(It)15 b(follo)o(ws)h(Rule)g
(17a:)93 573 y(1.)22 b(First,)11 b(it)h(builds)h(in)f(the)f(heap)g(a)g
(closure)h(represen)o(ting)f(the)h(partial)f(application,)i(whose)e
(structure)151 630 y(is)16 b(giv)o(en)g(b)q(elo)o(w.)93 722
y(2.)22 b(Next,)c(it)g(o)o(v)o(erwrites)g(the)g(closure)g(to)f(b)q(e)i(up)q
(dated)g(\(obtained)f(from)f(the)h(up)q(date)h(frame\))e(with)151
778 y(an)e(indirection)j(to)c(the)i(newly-constructed)g(closure.)93
870 y(3.)22 b(It)17 b(restores)f(the)h(v)m(alues)h(of)e(the)h(stac)o(k-base)f
(registers)h(from)f(their)i(v)m(alues)f(sa)o(v)o(ed)g(in)g(the)g(up)q(date)
151 926 y(frame.)93 1018 y(4.)22 b(It)15 b(remo)o(v)o(es)e(the)i(up)q(date)f
(frame)g(from)g(the)g(B)h(stac)o(k,)e(sliding)k(do)o(wn)d(the)g(p)q(ortion)h
(of)f(the)g(stac)o(k)g(\(if)151 1075 y(an)o(y\))h(whic)o(h)h(is)f(ab)q(o)o(v)
o(e)g(it.)93 1167 y(5.)22 b(Finally)l(,)17 b(it)e(re-en)o(ters)g(the)g
(closure)h(p)q(oin)o(ted)h(to)d(b)o(y)h Fp(Node)p Ft(.)37 1285
y(What)g(do)q(es)h(the)f(partial-application)i(closure)f(lo)q(ok)g(lik)o(e?)
22 b(In)15 b(the)h(most)e(general)i(case)f(it)g(con)o(tains:)106
1404 y Fo(\017)22 b Ft(The)16 b(info)f(p)q(oin)o(ter)h Fp(PAP_Info)o
Ft(.)106 1496 y Fo(\017)22 b Ft(The)c(total)e(size)j(of)d(the)i(closure,)g
(and)f(the)h(n)o(um)o(b)q(er)f(of)g(p)q(oin)o(ters)h(in)g(it.)26
b(As)18 b(w)o(ell)g(as)f(b)q(eing)h(used)151 1552 y(b)o(y)k(the)f(storage)g
(manager,)h(this)g(information)f(is)h(required)h(b)o(y)f(the)f(standard-en)o
(try)g(co)q(de)h(of)151 1609 y Fp(PAP_Info)14 b Ft(\(see)h(b)q(elo)o(w\).)106
1701 y Fo(\017)22 b Ft(The)16 b(p)q(oin)o(ter)f(to)g(the)g(function)h
(closure,)g(whic)o(h)g(is)f(in)h Fp(Node)p Ft(.)106 1793 y
Fo(\017)22 b Ft(The)16 b(con)o(ten)o(ts)e(of)h(the)g(A)g(stac)o(k)g(b)q(et)o
(w)o(een)g(the)h(top)e(of)h(stac)o(k)g(and)g(its)g(stac)o(k)g(base)g(p)q(oin)
o(ter.)106 1885 y Fo(\017)22 b Ft(The)16 b(con)o(ten)o(ts)e(of)h(the)g(B)h
(stac)o(k)e(b)q(et)o(w)o(een)h(the)h(top)f(of)f(stac)o(k)h(and)g(its)g(stac)o
(k)g(base)g(p)q(oin)o(ter.)37 2003 y(If)g(this)g(partial-application)i
(closure)e(is)g(en)o(tered,)g(the)f(standard-en)o(try)g(co)q(de)h(of)f
Fp(PAP_Info)g Ft(pushes)h(the)37 2060 y(sa)o(v)o(ed)20 b(stac)o(k)g(con)o
(ten)o(ts)g(on)o(to)f(their)i(resp)q(ectiv)o(e)h(stac)o(ks)d(\(using)i(the)f
(size)i(information)e(to)g(determine)37 2116 y(ho)o(w)c(man)o(y)f(w)o(ords)g
(to)h(mo)o(v)o(e)f(to)g(whic)o(h)i(stac)o(k\),)d(and)j(then)f(en)o(ters)f
(the)h(function)h(closure)g(sa)o(v)o(ed)e(in)i(the)37 2173
y(partial)g(application)g(closure.)23 b(Its)16 b(garbage-collection)h
(routines)f(use)h(the)f(size)h(information)f(stored)f(in)37
2229 y(the)h(closure)g(to)e(guide)i(their)g(w)o(ork.)37 2315
y(So)g(m)o(uc)o(h)g(for)g(the)g(general)g(case.)23 b(A)16 b(couple)h(of)f
(optimisations)g(are)g(readily)h(a)o(v)m(ailable.)24 b(Firstly)l(,)17
b(a)e(col-)37 2371 y(lection)g(of)e(sp)q(ecialised)k Fp(PAP_Info)12
b Ft(p)q(oin)o(ters)i(can)g(b)q(e)g(pro)o(vided)g(for)f(v)m(arious)h(com)o
(binations)h(of)e(n)o(um)o(b)q(ers)37 2428 y(of)20 b(p)q(oin)o(ter)h(and)f
(non-p)q(oin)o(ter)h(w)o(ords.)34 b(F)l(or)20 b(example,)h
Fp(PAP_Info_1_0)e Ft(is)i(used)f(when)h(there)f(is)h(one)37
2484 y(p)q(oin)o(ter)14 b(w)o(ord)e(and)h(no)g(non-p)q(oin)o(ters.)20
b(The)13 b(adv)m(an)o(tages)f(of)h(suc)o(h)g(sp)q(ecialised)j(info)d(p)q(oin)
o(ters)g(are:)19 b(there)37 2541 y(is)d(no)f(need)h(to)f(store)f(the)h
(\014eld)i(sizes)e(in)h(the)g(closure;)f(and)g(the)h(en)o(try)e(and)i
(garbage-collection)g(co)q(de)f(is)37 2597 y(faster)g(b)q(ecause)i(it)e(has)h
(no)f(in)o(terpretiv)o(e)h(lo)q(op.)21 b(There)16 b(is,)g(of)f(course,)g(a)g
(small)h(execution-time)h(cost)e(in)37 2654 y Fp(UpdatePAP)f
Ft(to)h(decide)i(whether)e(a)g(sp)q(ecial)i(case)e(applies.)37
2740 y(Secondly)l(,)j(if)f(the)g(new)f(closure)h(is)g(small)g(enough)g(it)f
(can)h(b)q(e)g(built)g(directly)h(on)e(top)g(of)g(the)h(closure)g(to)37
2796 y(b)q(e)f(up)q(dated.)934 2921 y(67)p eop
%%Page: 68 68
bop 37 199 a Fm(10.3)56 b(Constructors)37 315 y Ft(The)20 b(other)e(w)o(a)o
(y)g(in)i(whic)o(h)f(an)g(up)q(date)g(can)g(b)q(e)h(triggered)f(is)g(when)g
(a)g(constructor)f(\014nds)h(an)g(empt)o(y)37 371 y(return)12
b(stac)o(k.)18 b(It)12 b(lo)q(oks)f(as)h(though)f(the)h(co)q(de)g(for)f(a)g
(constructor)g(application)i(has)f(to)f(test)g(for)g(an)g(empt)o(y)37
428 y(return)18 b(stac)o(k;)g(indeed)h(this)f(is)g(just)f(what)g(is)h
(implied)i(b)o(y)d(Rule)i(16.)27 b(This)18 b(lo)q(oks)g(exp)q(ensiv)o(e,)h(b)
q(ecause)37 484 y(constructors)d(are)h(so)f(common.)25 b(F)l(urthermore,)16
b(the)h(return)g(stac)o(k)f(is)h(almost)f(alw)o(a)o(ys)g(non-empt)o(y)l(,)h
(so)37 540 y(the)f(test)f(is)g(in)i(v)m(ain.)k(Data)14 b(structures)h(are)g
(often)g(built)i(once)e(and)h(then)f(rep)q(eatedly)i(tra)o(v)o(ersed.)i(Eac)o
(h)37 597 y(time)i(pattern)f(matc)o(hing)g(is)h(p)q(erformed)f(on)g(a)g(data)
f(structure,)i(a)f(contin)o(uation)h(is)g(pushed)g(on)f(the)37
653 y(return)e(stac)o(k,)f(and)h(the)f(closure)i(represen)o(ting)f(the)f
(data)g(structure)h(is)g(en)o(tered.)27 b(Since)19 b(it)f(is)g(already)37
710 y(ev)m(aluated,)d(it)e(returns)g(immediately)h(\(p)q(erhaps)f(using)h(a)f
(v)o(ectored)f(return\),)h(but)g(it)g(m)o(ust)g(\014rst)f(p)q(erform)37
766 y(the)k(return-stac)o(k)e(test.)37 852 y(So)h(no)o(w)f(comes)g(the)g
(tric)o(ky)g(part.)19 b(Since)d(up)q(date)f(frames)f(and)g(contin)o(uations)h
(are)f(b)q(oth)h(stored)f(on)g(the)37 909 y(B)20 b(stac)o(k,)e(if)i(a)e
(return)h(address)g(is)g(not)g(on)g(top)f(of)h(the)g(stac)o(k,)g(then)g(an)g
(up)q(date)g(frame)f(m)o(ust)h(b)q(e.)32 b Fn(If)37 965 y(we)17
b(make)f(the)g(top)h(wor)n(d)f(of)g(e)n(ach)g(up)n(date)h(fr)n(ame)f(into)g
(a)g(c)n(o)n(de)g(lab)n(el,)e Fp(UpdateConstr)o Fn(,)i(the)g(c)n(onstructor)
37 1022 y(c)n(ould)21 b(just)g(r)n(eturn)f(without)i(making)e(any)g(test.)34
b Ft(In)20 b(the)g(common)g(case)f(where)h(there)g(is)h(no)e(up)q(date)37
1078 y(frame)14 b(this)g(do)q(es)h(just)e(what)h(w)o(e)f(w)o(an)o(t.)19
b(If)14 b(an)g(up)q(date)g(is)h(required)g(there)f(will)i(b)q(e)e(an)g(up)q
(date)h(frame)e(on)37 1134 y(top)k(of)f(the)h(B)g(stac)o(k,)e(so)i(the)f
(\\return")h(will)h(land)f(in)h(the)f Fp(UpdateConstr)e Ft(co)q(de,)i(whic)o
(h)g(can)g(p)q(erform)37 1191 y(the)d(up)q(date)g(and)g(then)g(return)f
(again,)h(p)q(erhaps)g(to)f(another)g(up)q(date)h(frame,)f(or)g(p)q(erhaps)i
(to)e(the)g(\\real")37 1247 y(contin)o(uation.)37 1333 y(Before)h(w)o(e)f
(examine)h(the)f(complications,)h(it)g(is)g(w)o(orth)e(lo)q(oking)i(at)e(the)
i(crude)g(costs)e(and)i(b)q(ene\014ts.)20 b(The)37 1390 y(cost)d(is)h(one)g
(extra)e(instruction)j(for)d(ev)o(ery)h(up)q(date)h(frame)f(pushed.)27
b(The)18 b(b)q(ene\014t)g(is)g(the)f(omission)h(of)37 1446
y(a)d(couple)h(of)f(instructions)h(\(one)f(of)f(them)h(a)g(conditional)i
(jump\))e(from)f(ev)o(ery)h(constructor)f(ev)m(aluation.)37
1503 y(If)19 b(data)f(structures)g(are)h(tra)o(v)o(ersed)e(rep)q(eatedly)l(,)
j(constructor)e(ev)m(aluations)i(will)g(o)q(ccur)f(substan)o(tially)37
1559 y(more)c(often)g(than)g(up)q(dates.)21 b(The)15 b(b)q(ene\014ts)h(lo)q
(ok)g(signi\014can)o(t.)37 1645 y(The)k(trouble)h(is)f(that)f(this)h(tric)o
(k)g(in)o(teracts)f(a)o(wkw)o(ardly)g(with)h(the)g(v)m(arious)g(return)g(con)
o(v)o(en)o(tions)g(for)37 1702 y(constructors)d(discussed)i(in)g(Sections)f
(9.4.3)e(and)i(9.4.4.)26 b(With)17 b(the)h(simple)h(return)f(con)o(v)o(en)o
(tions,)g(ev-)37 1758 y(erything)f(w)o(orks)d(\014ne.)22 b(The)16
b Fp(case)f Ft(alternativ)o(es)g(are)h(alw)o(a)o(ys)f(represen)o(ted)h(b)o(y)
f(a)g(simple)j(co)q(de)e(lab)q(el)h(on)37 1815 y(the)f(B)f(stac)o(k,)g(and)g
(the)h(result)g(is)f(returned)h(b)o(y)g(making)f Fp(Node)g
Ft(p)q(oin)o(t)h(to)e(the)i(constructor)f(closure.)21 b(All)37
1871 y Fp(UpdateConstr)15 b Ft(need)j(do)e(is)h(to)f(o)o(v)o(erwrite)f(the)i
(closure)g(to)f(b)q(e)h(up)q(dated)g(with)g(an)f(indirection)j(to)d(this)37
1927 y(constructor)f(closure,)g(restore)g(the)g(stac)o(k)g(base)g(registers,)
g(and)g(return)g(again.)37 2079 y Fm(10.4)56 b(V)-5 b(ectored)18
b(returns)37 2194 y Ft(Life)13 b(gets)e(more)g(complicated)h(when)g(w)o(e)f
(add)h(v)o(ectored)f(returns.)18 b(There)12 b(is)g(no)f(problem)h(with)g(pro)
o(viding)37 2250 y(a)f(v)o(ectored)f(form)f(of)h Fp(UpdateConstr)o
Ft(;)h(eac)o(h)g(en)o(try)f(in)h(its)f(return)h(v)o(ector)e(p)q(oin)o(ts)i
(to)f(co)q(de)h(whic)o(h)g(p)q(erforms)37 2307 y(the)k(up)q(date)h(and)e
(then)h(returns)g(in)g(its)g(turn)g(in)g(a)g(v)o(ectored)f(fashion.)20
b(The)15 b(di\016cult)o(y)h(is)f(that)f Fn(when)i(the)37 2363
y(up)n(date)i(fr)n(ame)f(is)f(cr)n(e)n(ate)n(d,)g(the)h(r)n(eturn)f(c)n
(onvention)f(is)i(not)f(known)p Ft(.)21 b(This)16 b(is)g(b)q(ecause)g(the)g
(t)o(yp)q(e)g(of)f(the)37 2420 y(expression)k(ma)o(y)e(b)q(e)h(p)q
(olymorphic.)29 b(Consider,)18 b(for)f(example,)h(the)g Fp(compose)f
Ft(function,)h(whic)o(h)h(lo)q(oks)37 2476 y(lik)o(e)e(this)e(in)i(the)e(STG)
g(language:)133 2562 y Fp(compose)23 b(=)h({})f(\\n)h({f,g,x})f(->)g(let)h
(gx)f(=)h({g,x})f(\\u)h({})f(->)h(g)g({x})777 2619 y(in)g(f)g({gx})37
2705 y Ft(The)15 b(co)q(de)g(for)f(the)h(closure)g Fp(gx)f
Ft(do)q(es)h(not)f(kno)o(w)g(its)h(t)o(yp)q(e.)20 b(Hence,)15
b(when)g(it)g(pushes)g(the)f(up)q(date)h(frame)37 2761 y(it)i(cannot)e(kno)o
(w)h(whether)g(a)f(v)o(ectored)h(return)g(is)g(to)f(b)q(e)i(exp)q(ected)g(or)
f(not.)21 b(In)c(short,)e Fp(UpdateConstr)934 2921 y Ft(68)p
eop
%%Page: 69 69
bop 300 309 274 4 v 439 515 244 4 v 641 513 a Fi(-)p 300 448
274 4 v 298 581 4 342 v 300 583 274 4 v 572 581 4 342 v 705
478 281 4 v 705 752 4 274 v 982 752 V 705 755 281 4 v 709 616
274 4 v 829 515 240 4 v 344 w(-)p 836 650 233 4 v 1027 648
a(-)p 709 549 15 4 v 738 549 V 766 549 V 795 549 V 824 549
V 853 549 V 882 549 V 910 549 V 939 549 V 968 549 V 709 684
V 738 684 V 766 684 V 795 684 V 824 684 V 853 684 V 882 684
V 910 684 V 939 684 V 968 684 V 832 583 237 4 v 1027 581 a(-)p
840 721 229 4 v 1027 719 a(-)p 248 152 1402 4 v 248 812 4 660
v 1646 812 V 248 815 1402 4 v 1087 528 a Ft(Co)q(de)16 b(for)e(Nil)j
(alternativ)o(e)1087 600 y(Co)q(de)f(to)e(up)q(date)i(with)g(Nil)1087
667 y(Co)q(de)g(for)e(Cons)h(alternativ)o(e)1087 735 y(Co)q(de)h(to)e(up)q
(date)i(with)g(Cons)746 446 y(Return)g(v)o(ector)368 240 y(B)f(stac)o(k)684
911 y(Figure)h(7:)j(V)l(ectored)d(up)q(dates)37 1049 y Fn(must)h(b)n(e)f
(able)g(to)g(c)n(op)n(e)g(with)h(either)f(a)h(ve)n(ctor)n(e)n(d)f(or)g(a)h
(non-ve)n(ctor)n(e)n(d)e(r)n(eturn)p Ft(.)37 1135 y(If)20 b(w)o(e)g(w)o(ere)f
(generating)h(mac)o(hine)h(co)q(de)f(this)g(w)o(ould)g(presen)o(t)g(little)h
(problem.)34 b(W)l(e)20 b(just)g(adopt)f(the)37 1191 y(con)o(v)o(en)o(tion)f
(that)f(the)g(p)q(oin)o(ter)h(to)f(a)g(v)o(ector)g(table)h(p)q(oin)o(ts)g
(just)f(after)g(the)h(end)g(of)f(the)g(table,)i(so)e(that)37
1248 y(the)k(table)g(is)g(accessed)g(b)o(y)g(indexing)h(bac)o(kw)o(ards)e
(from)g(the)g(p)q(oin)o(ter.)37 b(No)o(w)20 b Fp(UpdateConstr)e
Ft(lab)q(els)37 1304 y(ordinary)c(co)q(de)g(immediately)h(preceded)g(b)o(y)e
(its)h(v)o(ector)f(table.)19 b(Sadly)l(,)c(C)e(do)q(es)h(not)f(allo)o(w)g(us)
h(to)f(sp)q(ecify)37 1361 y(the)f(relativ)o(e)f(placemen)o(t)h(of)f(data)f
(and)i(co)q(de)f(in)h(this)g(w)o(a)o(y)l(,)f(so)f(instead)i(w)o(e)f(ha)o(v)o
(e)g(to)f(adopt)h(the)g(con)o(v)o(en)o(tion)37 1417 y(that)16
b(non-v)o(ectored)h(returns)f(b)q(eha)o(v)o(e)h(just)f(lik)o(e)i(v)o(ectored)
e(returns)g(through)g(a)g(v)o(ector)g(table)h(with)g(one)37
1474 y(en)o(try)e(\(cf)g(Section)h(7.6\).)j(This)d(imp)q(oses)g(an)f(extra)f
(indirection)k(on)d(non-v)o(ectored)g(returns.)37 1625 y Fm(10.5)56
b(Returning)18 b(v)m(alues)g(in)g(registers)37 1740 y Ft(Unfortunately)l(,)f
(matters)f(get)g(w)o(orse)g(when)h(w)o(e)f(consider)i(the)e(idea)i(of)e
(returning)h(constructor)f(v)m(alues)37 1797 y(in)e(registers.)19
b(No)o(w)12 b Fp(UpdateConstr)f Ft(has)h(no)h(w)o(a)o(y)e(to)h(\014gure)h
(out)f(ho)o(w)h(to)f(p)q(erform)g(the)h(up)q(date,)g(b)q(ecause)37
1853 y(it)19 b(has)f(no)h(w)o(a)o(y)e(to)h(tell)h(what)f(return)g(con)o(v)o
(en)o(tion)h(is)f(b)q(eing)i(used.)30 b(Can)18 b(the)h(closure)g(whic)o(h)g
(pushed)37 1910 y(the)g(up)q(date)h(frame)e(push)h(a)g(v)o(ersion)g(of)f
Fp(UpdateConstr)f Ft(appropriate)i(for)f(the)h(data)f(t)o(yp)q(e?)32
b(As)18 b(just)37 1966 y(discussed,)f(the)e(answ)o(er)g(is)g(no,)g(b)q
(ecause)h(of)f(p)q(olymorphism.)37 2052 y(This)h(lo)q(oks)g(lik)o(e)g(a)f
(rather)g(serious)g(problem.)21 b(There)15 b(is)h(a)f(w)o(a)o(y)f(round)h
(it,)g(but)h(it)f(is)h(rather)f(tric)o(ky)l(.)37 2138 y(The)e(idea)h(is)f
(this:)19 b(the)13 b(up)q(date)g(frame)f(ma)o(y)g(not)g(kno)o(w)g(the)h(t)o
(yp)q(e)g(of)f(the)h(v)m(alue)g(b)q(eing)h(returned,)f Fn(but)i(the)37
2194 y Fp(case)d Fn(expr)n(ession)f(which)i(c)n(ause)n(d)f(the)g(evaluation)h
(in)f(the)g(\014rst)g(plac)n(e)f(c)n(ertainly)h(do)n(es)p Ft(.)18
b(So)11 b Fp(UpdateConstr)37 2251 y Ft(do)q(es)18 b(not)e(p)q(erform)h(an)g
(up)q(date)g(at)g(all;)h(it)f(merely)h(records)f(that)f(an)h(up)q(date)g(is)h
(required,)g(b)o(y)f(placing)37 2307 y(a)g(p)q(oin)o(ter)f(to)g(the)h
(closure)g(to)e(b)q(e)i(up)q(dated)h(in)f(a)f(sp)q(ecial)i(register)e
Fp(UpdatePtr)o Ft(.)23 b(It)17 b(is)g(up)f(to)g(the)h Fp(case)37
2364 y Ft(expression)g(contin)o(uation)f(to)g(p)q(erform)f(the)h(up)q(date.)
22 b(Ho)o(w)15 b(do)q(es)h(the)g(contin)o(uation)g(\\kno)o(w")f(whether)37
2420 y(an)g(up)q(date)f(is)h(p)q(ending?)22 b(Simple:)f(eac)o(h)14
b(en)o(try)g(in)h(the)f Fp(case)p Ft(-expression's)h(return)f(v)o(ector)f(is)
i(expanded)37 2477 y(to)d(a)g(pair)h(of)f(co)q(de)h(lab)q(els)h(\(Figure)e
(7\).)18 b(The)13 b(\014rst)e(of)h(these)h(is)g(just)f(as)g(b)q(efore)g(\(ie)
h(the)f(co)q(de)h(for)f(the)g Fp(case)p Ft(-)37 2533 y(expression)h
(alternativ)o(e\);)f(the)g(other)f(p)q(erforms)g(an)h(up)q(date)g(on)g(the)f
(closure)i(p)q(oin)o(ted)f(to)f(b)o(y)h Fp(UpdatePtr)n Ft(,)37
2590 y(and)19 b(then)g(jumps)g(to)f(the)h(\014rst.)30 b(W)l(e)18
b(call)i(these)f(the)g Fn(normal)g(r)n(eturn)h(c)n(o)n(de)e
Ft(and)h Fn(up)n(date)h(r)n(eturn)f(c)n(o)n(de)37 2646 y Ft(resp)q(ectiv)o
(ely)l(.)j(All)14 b Fp(UpdateConstr)e Ft(has)h(to)g(do)g(to)g(precipitate)i
(the)e(up)q(date)h(is)g(to)f(return)g(to)g(the)g(up)q(date)37
2703 y(return)20 b(co)q(de)g(rather)f(than)h(the)g(normal)f(return)h(co)q
(de,)h(whic)o(h)g(it)e(can)h(do)g(merely)g(b)o(y)g(increasing)h(its)37
2759 y(o\013set)15 b(in)o(to)g(the)g(return)g(v)o(ector)g(b)o(y)g(one.)934
2921 y(69)p eop
%%Page: 70 70
bop 37 199 a Ft(The)15 b(costs)f(are)g(surprising)h(sligh)o(t.)20
b(There)15 b(is)g(a)f(static)g(space)h(cost,)e(as)h(eac)o(h)h(v)o(ector)e
(table)i(no)o(w)f(doubles)37 256 y(in)f(size.)19 b(The)12 b(extra)e(co)q(de)i
(to)f(p)q(erform)g(the)h(up)q(date)g(can)f(b)q(e)h(generated)f(once)h(only)g
(for)f(eac)o(h)g(constructor,)37 312 y(and)i(then)h(p)q(oin)o(ted)f(to)f
(from)h(all)g(the)g(return)g(v)o(ectors)f(for)g(its)h(data)f(t)o(yp)q(e.)19
b(This)14 b(p)q(er-constructor)e(up)q(date)37 369 y(co)q(de)20
b(can)f(still)i(\014nd)e(its)g(w)o(a)o(y)f(to)h(the)g(appropriate)g
Fp(case)f Ft(alternativ)o(e)h(pro)o(vided)h(the)f(p)q(oin)o(ter)h(to)e(the)37
425 y(return)e(v)o(ector)e(is)i(k)o(ept)f(handy)g(in)i(a)d(register.)37
511 y(One)j(ob)s(jection)f(remains,)g(whic)o(h)g(lo)q(oks)g(serious:)22
b(supp)q(ose)16 b(there)g(are)f(sev)o(eral)h(up)q(date)h(frames)e(on)g(top)37
568 y(of)i(eac)o(h)f(other)g(b)q(efore)h(the)f(\\real")h(contin)o(uation)g
(is)g(reac)o(hed?)24 b(This)17 b(can)g(arise)g(in)g(programs)e(lik)o(e)j(the)
37 624 y(follo)o(wing:)228 710 y Fp(let)24 b(x1)f(=)h(...)228
766 y(in)228 823 y(let)g(x2)f(=)h({x1})f(\\u)h({})g(->)f(x1)228
879 y(in)228 936 y(let)h(x3)f(=)h({x2})f(\\u)h({})g(->)f(x2)228
992 y(in)228 1049 y(...x3...)37 1135 y Ft(When)15 b Fp(x3)f
Ft(is)g(en)o(tered,)g(it)h(will)g(push)g(an)f(up)q(date)h(frame)e(and)h(then)
h(en)o(ter)f Fp(x2)o Ft(,)g(whic)o(h)h(will)h(push)e(another)37
1191 y(up)q(date)g(frame)d(and)i(en)o(ter)f Fp(x1)p Ft(.)19
b(When)13 b Fp(x1)f Ft(reac)o(hes)g(head)h(normal)g(form)e(it)i(will)h
(\014nd)f(t)o(w)o(o)f(up)q(date)h(frames)37 1248 y(on)k(top)f(of)g(the)g
(stac)o(k,)g(re\015ecting)h(the)f(fact)g(that)g(b)q(oth)g(the)h(closure)g
(for)e Fp(x2)i Ft(and)f(that)g(for)f Fp(x3)h Ft(m)o(ust)g(b)q(e)37
1304 y(up)q(dated)d(with)f Fp(x1)o Ft('s)f(v)m(alue.)20 b(This)12
b(lo)q(oks)g(lik)o(e)g(a)g(rather)e(sp)q(ecial)k(case,)e(but)f(it)h(do)q(es)g
(arise)f(in)i(practice:)18 b(an)o(y)37 1360 y(closure)g(whic)o(h)f(ma)o(y)f
(return)g(the)h(v)m(alue)h(of)e(another)g(closure)h(has)g(the)g(same)f(prop)q
(ert)o(y)l(.)24 b(F)l(or)15 b(example,)37 1417 y(the)h(de\014nition)h(of)e
Fp(x3)f Ft(could)j(b)q(e:)228 1503 y Fp(x3)24 b(=)g({x2,z})f(\\u)g({})h(case)
f(...)h(of)706 1559 y(Nil)f({})h(->)f(x2)706 1616 y(Cons)g({p,ps})g(->)h(p)37
1702 y Ft(The)18 b(problem)g(with)g(m)o(ultiple)h(up)q(date)f(frames)f(is)h
(that)e(the)i Fp(UpdatePtr)e Ft(register)h(can)h(only)g(p)q(oin)o(t)g(to)37
1758 y(one)h(closure!)29 b(F)l(ortunately)18 b(there)h(is)f(an)g(easy)g
(solution.)30 b(Recall)20 b(that)d(all)i(return)g(v)o(ectors)e
Fn(including)37 1815 y(that)e(for)f Fp(UpdateConstr)d Ft(consist)h(of)g
(paired)i(en)o(tries,)f(and)f(that)g Fp(UpdateConstr)f Ft(returns)h(to)g(the)
g Fn(up)n(date)37 1871 y(r)n(eturn)19 b(c)n(o)n(de)e Ft(rather)g(than)g(the)h
Fn(normal)g(r)n(eturn)g(c)n(o)n(de)f Ft(of)g(the)h(pair.)27
b(The)17 b(up)q(date)h(return)g(co)q(de)g(of)f(the)37 1928
y Fp(UpdateConstr)12 b Ft(v)o(ector)h(therefore)g(kno)o(ws)g(that)g(it)h(is)g
(not)f(the)h(\014rst)f(up)q(date)h(frame,)f(and)h(so)f Fp(UpdatePtr)37
1984 y Ft(is)k(already)f(in)h(use.)23 b(One)17 b(p)q(ossibilit)o(y)h(w)o
(ould)f(b)q(e)g(to)e(c)o(hain)i(together)e(all)i(the)g(closures)f(to)g(b)q(e)
g(up)q(dated,)37 2041 y(but)k(there)g(is)h(a)e(simpler)i(w)o(a)o(y:)28
b(the)20 b(second)g(\(and)g(subsequen)o(t\))g(up)q(date)g(frames)g(just)f(up)
q(date)h(their)37 2097 y(closures)e(with)f(an)f(indirection)j(to)d(the)g(one)
h(p)q(oin)o(ted)h(to)d(b)o(y)i Fp(UpdatePtr)o Ft(.)24 b(When)17
b(the)f(latter)g(is)i(\014nally)37 2153 y(up)q(dated)13 b(all)g(the)f(up)q
(dating)g(has)g(b)q(een)h(successfully)g(completed.)20 b(This)12
b(can)g(result)g(in)h(c)o(hains)f(of)g(at)f(most)37 2210 y(t)o(w)o(o)j
(indirections;)j(and)e(remem)o(b)q(er)g(that)g(indirections)i(are)d(all)i
(eliminated)h(b)o(y)e(the)g(garbage)g(collector.)37 2296 y(Finally)l(,)20
b(what)e(of)f(non-v)o(ectored)h(returns?)28 b(W)l(e)18 b(still)i(need)e(a)g
(pair)g(of)g(co)q(de)g(addresses)g(to)f(return)h(to,)37 2352
y(as)e(in)h(the)f(v)o(ectored)g(case.)22 b(If)16 b(the)g(results)g(are)g
(returned)g(in)h(a)f(heap-allo)q(cated)h(closure)g(p)q(oin)o(ted)g(to)e(b)o
(y)37 2409 y Fp(Node)f Ft(there)g(is)g(no)g(problem:)20 b(the)14
b(up)q(date)g(return)g(co)q(de)g(just)g(p)q(erforms)f(the)h(up)q(date)h(and)f
(jumps)g(to)f(the)37 2465 y(normal)18 b(return)g(co)q(de.)27
b(If)18 b(results)g(are)g(b)q(eing)h(returned)f(in)g(registers,)g(then)g(the)
g(up)q(date)g(return)f(co)q(de)37 2522 y(needs)g(to)e(p)q(erform)h(case)g
(analysis)g(on)g Fp(RTag)f Ft(to)g(\014gure)h(out)f(ho)o(w)h(to)f(p)q(erform)
g(the)h(up)q(date.)22 b(As)16 b(b)q(efore,)37 2578 y(there)g(need)g(b)q(e)g
(only)f(one)h(cop)o(y)f(of)g(this)g(up)q(date)h(return)f(co)q(de.)934
2921 y(70)p eop
%%Page: 71 71
bop 37 199 a Fm(10.6)56 b(Up)r(date)18 b(in)h(place)37 315
y Ft(The)e(up)q(date)h(tec)o(hnology)f(just)f(describ)q(ed)j(has)d(another)g
(v)o(ery)h(imp)q(ortan)o(t)f(b)q(ene\014t:)24 b Fn(it)18 b(al)r(lows)f(the)h
(up-)37 371 y(date)n(d)c(closur)n(e)f(to)h(b)n(e)f(overwritten)g(dir)n(e)n
(ctly)g(with)h(the)g(r)n(esult)f(\(if)g(it)g(is)g(smal)r(l)g(enough\),)h(r)n
(ather)g(than)f(b)n(eing)37 428 y(overwritten)k(with)g(an)f(indir)n(e)n
(ction)f(to)h(the)h(r)n(esult)p Ft(.)37 513 y(Up)f(to)e(no)o(w,)g(our)h
(uniform)g(return)g(con)o(v)o(en)o(tion)g(has)g(mean)o(t)g(that)f(closures)i
(are)e(only)i(ev)o(er)f(o)o(v)o(erwritten)37 570 y(b)o(y)g(indirections,)i
(ev)o(en)e(though)g(it)g(is)g(often)g(the)f(case)h(that)f(it)h(is)h(in)f
(principle)j(p)q(ossible)e(to)f(o)o(v)o(erwrite)f(it)37 626
y(directly)k(with)e(the)g(result.)22 b(Not)16 b(only)g(do)q(es)g(this)h(in)o
(tro)q(duce)g(extra)e(indirections)j(but,)e(more)f(seriously)l(,)37
683 y(it)j(giv)o(es)f(rise)h(to)e(a)h(lot)g(of)f(extra)h(memory)f(allo)q
(cation.)27 b(Kieburtz)18 b(and)f(Agapiev)h(sp)q(eci\014cally)i(iden)o(tify)
37 739 y(and)c(quan)o(tify)f(this)h(shortcoming)f(\(Kieburtz)h(&)f(Agapiev)h
([1988]\).)37 825 y(If)f(the)g(dual-return)h(mec)o(hanism)f(of)f(the)h
(previous)g(section)g(is)h(used,)f(ho)o(w)o(ev)o(er,)e(then)i(this)g
(shortcoming)37 882 y(can)j(easily)h(b)q(e)g(o)o(v)o(ercome.)26
b(The)18 b(co)q(de)g(p)q(erforming)h(the)e(up)q(date)i(kno)o(ws)e(exactly)h
(ho)o(w)f(the)h(closure)g(is)37 938 y(laid)j(out)e(so,)g(if)g(it)h(is)f
(small)h(enough,)g(it)g(can)f(directly)h(o)o(v)o(erwrite)f(the)g(closure)h
(to)e(b)q(e)i(up)q(dated.)33 b(F)l(or)37 995 y(example,)16
b(here)g(is)f(the)h(co)q(de)g(to)e(p)q(erform)h(up)q(dates)h(for)e(a)h(list)h
Fp(Cons)f Ft(cell:)228 1081 y Fp(ConsUpd\(\))23 b({)419 1137
y(UpdatePtr[0])g(=)g(Cons_Info;)419 1194 y(UpdatePtr[1])g(=)g(Head;)419
1250 y(UpdatePtr[2])g(=)g(Tail;)419 1306 y(JUMP\()g(ReturnVector[2])f(\);)228
1363 y(})37 1449 y Ft(Here)14 b(w)o(e)e(are)h(assuming)g(that)g(the)g
Fp(Cons)f Ft(constructor)g(returns)h(its)g(head)h(in)f(a)g(register)g
Fp(Head)f Ft(and)i(tail)f(in)37 1505 y Fp(Tail)p Ft(.)20 b
Fp(Cons_Info)13 b Ft(is)i(the)f(info)h(table)g(for)f(the)g
Fp(Cons)g Ft(constructor.)19 b(The)14 b(address)h(of)f(the)g(return)h(v)o
(ector)37 1562 y(is)j(assumed)e(to)g(b)q(e)i(in)f(a)f(register)h
Fp(ReturnVector)n Ft(.)24 b(The)17 b(o\013set)f(of)g(2)g(pic)o(ks)i(the)e
(\014rst)h(co)q(de)g(address)f(of)37 1618 y(the)g(pair)f(for)g
Fp(Cons)o Ft(.)37 1704 y(F)l(or)d(larger)g(constructors,)f(the)h(new)g(ob)s
(ject)g(cannot)g(b)q(e)g(built)i(directly)f(on)f(top)g(of)f(the)h(old)h(one,)
f(so)g(a)g(new)37 1761 y(ob)s(ject)h(m)o(ust)f(b)q(e)i(built)h(in)f(the)f
(heap)g(and)g(the)h(old)f(one)g(up)q(dated)h(with)g(an)f(indirection)i(to)d
(it.)20 b(The)13 b(usual)37 1817 y(heap-exhaustion)19 b(c)o(hec)o(k)e(m)o
(ust)g(b)q(e)h(made,)f(and)g(garbage)g(collection)i(triggered)e(if)g(no)h
(space)f(remains.)37 1874 y(The)d(up)q(date)h(routine)f(m)o(ust)f(then)h(b)q
(e)h(careful)f(to)f(sa)o(v)o(e)g(an)o(y)h(p)q(oin)o(ters)g(b)q(eing)h
(returned)f(in)g(registers)g(in)o(to)37 1930 y(a)h(place)i(where)e(the)g
(garbage)g(collector)h(will)g(\014nd)g(them.)37 2016 y(Ho)o(w)h(do)q(es)h
(the)f(up)q(dating)h(co)q(de)g(kno)o(w)f(if)h(the)f(closure)h(to)e(b)q(e)i
(up)q(dated)g(is)g(large)g(enough?)27 b(There)17 b(are)37 2072
y(t)o(w)o(o)d(main)i(p)q(ossibilities:)106 2191 y Fo(\017)22
b Ft(W)l(e)11 b(can)g(establish)h(a)f(global)g(con)o(v)o(en)o(tion)g(for)g
(the)g(minim)o(um)h(size)g(of)e(up)q(datable)i(closures;)h(making)151
2247 y(them)22 b(all)g(large)g(enough)g(\(b)o(y)f(padding)i(if)f(necessary\))
g(to)f(con)o(tain)h(a)f(list)h(cons)g(cell)i(seems)d(a)151
2304 y(plausible)16 b(guess.)j(There)14 b(is)g(scop)q(e)g(for)f(another)g
(small)i(optimisation)f(here:)19 b(if)14 b(a)f(closure)i(is)f(b)q(eing)151
2360 y(allo)q(cated)g(whose)f(t)o(yp)q(e)f(is)i(\(sa)o(y\))d
Fp(Int)p Ft(,)i(then)g(it)g(cannot)f(p)q(ossibly)j(b)q(e)e(up)q(dated)h(b)o
(y)e(an)o(ything)h(other)151 2417 y(than)i(an)g(in)o(teger,)g(so)g(it)h(do)q
(es)f(not)g(need)h(to)f(b)q(e)g(padded)i(out)d(to)h(cons-cell)i(size.)106
2508 y Fo(\017)22 b Ft(The)14 b(up)q(dating)g(co)q(de)g(can)f(lo)q(ok)h(in)g
(the)f(closure's)h(info)g(table)f(to)g(\014nd)h(its)g(size,)g(and)f(either)h
(up)q(date)151 2565 y(in)k(place)f(or)g(use)g(an)f(indirection,)j(dep)q
(ending)g(on)e(what)f(it)h(\014nds.)25 b(This)18 b(costs)e(more)g(time)h
(than)151 2621 y(the)h(unconditional)h(sc)o(heme,)g(but)e(has)h(the)f(merit)h
(that)f(it)h(will)h(succeed)g(in)f(up)q(dating)h(in)f(place)151
2678 y(more)d(often.)k(This)d(is)g(another)f(asp)q(ect)g(of)g(the)g(design)h
(whic)o(h)g(w)o(e)f(plan)h(to)f(quan)o(tify)l(.)37 2796 y(Up)q(date)j(in)f
(place)h(is)f(not)f(alw)o(a)o(ys)g(desirable.)26 b(Supp)q(ose)17
b(that)f(the)h(v)m(alue)h(of)e(the)h(th)o(unk)f(turned)h(out)g(to)934
2921 y(71)p eop
%%Page: 72 72
bop 37 199 a Ft(b)q(e)14 b(an)f Fn(alr)n(e)n(ady-existing)f
Ft(constructor)g(whic)o(h)i(returns)e(its)h(comp)q(onen)o(ts)g(in)h
(registers.)19 b(Then)13 b(up)q(date-in-)37 256 y(place)j(will)g(o)o(v)o
(erwrite)d(the)i(th)o(unk)f(with)g(a)g Fn(c)n(opy)h Ft(of)f(the)g
(constructor.)19 b(No)14 b(w)o(ork)f(is)i(duplicated)h(thereb)o(y)l(,)37
312 y(but)c(there)g(is)g(a)g(p)q(oten)o(tial)g(loss)g(of)f(space)h(if)g(b)q
(oth)g(copies)g(sta)o(y)f(liv)o(e)i(for)e(a)g(while.)21 b(A)o(t)11
b(w)o(orst,)f(a)i(great)e(man)o(y)37 369 y(copies)16 b(of)f(the)g(same)g(ob)s
(ject)g(could)h(b)q(e)f(built)i(in)f(this)f(w)o(a)o(y)l(,)f(substan)o(tially)
i(increasing)h(the)e(space)g(usage)37 425 y(of)f(the)g(program.)k(The)c(p)q
(oin)o(t)g(is)g(this:)20 b(once)14 b(copied,)h(there)f(is)g(no)f(c)o(heap)i
(mec)o(hanism)f(for)f(\\commoning)37 482 y(up")j(the)f(original)h(with)g(the)
f(cop)o(y)l(.)37 568 y(Our)e(preliminary)h(measuremen)o(ts)d(suggest)h(that)f
(up)i(to)e(10\045)g(of)h(all)h(up)q(dates)g(cop)o(y)f(an)f(already-existing)
37 624 y(constructor,)j(though)g(the)g(\014gure)h(can)f(o)q(ccasionally)i(b)q
(e)f(m)o(uc)o(h)g(higher)g(\(for)e(the)h(program)g(rep)q(orted)g(b)o(y)37
680 y(Runciman)21 b(&)f(W)l(ak)o(eling)g([1992])d(it)j(is)g(47\045\).)31
b(W)l(e)19 b(plan)h(to)f(mak)o(e)g(more)g(careful)h(measuremen)o(ts)f(to)37
737 y(see)e(ho)o(w)f(imp)q(ortan)o(t)f(this)i(e\013ect)f(is.)23
b(If)16 b(it)h(turns)f(out)f(to)h(b)q(e)h(signi\014can)o(t)g(w)o(e)e(will)j
(implemen)o(t)g(a)d(simple)37 793 y(extension)j(of)e(the)h
(dual-return-address)h(sc)o(heme)f(outlined)h(in)g(Section)f(10.5,)f(whereb)o
(y)g(eac)o(h)h(elemen)o(t)37 850 y(of)f(the)g(return)g(v)o(ector)g(is)g(a)g
Fn(triple)g Ft(of)g(return)g(addresses.)23 b(W)l(e)16 b(omit)g(the)g
(details,)h(but)f(the)h(sc)o(heme)f(has)37 906 y(the)g(e\013ect)f(of)f(alw)o
(a)o(ys)h(up)q(dating)h(a)e(th)o(unk)i(with)f(an)g(indirection)i(whenev)o(er)
f(the)f(v)m(alue)h(of)f(the)g(th)o(unk)g(is)37 963 y(an)h(already-existing)g
(heap)g(ob)s(ject.)37 1110 y Fm(10.7)56 b(Up)r(date)18 b(frames)g(and)h
(garbage)g(collection)37 1226 y Ft(Up)q(date)14 b(frames,)e(whic)o(h)i
(include)i(a)c(p)q(oin)o(ter)i(to)e(the)h(closure)h(to)e(b)q(e)i(up)q(dated,)
g(are)e(k)o(ept)h(on)g(the)g(B)g(stac)o(k.)37 1282 y(A)o(t)g(\014rst)g(this)h
(lo)q(oks)f(rather)g(a)o(wkw)o(ard,)e(b)q(ecause)k(the)e(garbage)f(collector)
i(exp)q(ects)g(all)g(p)q(oin)o(ters)g(to)e(b)q(e)i(on)37 1339
y(the)k(p)q(oin)o(ter)f(stac)o(k,)f(but)h(it)g(actually)h(turns)f(out)g(to)f
(b)q(e)i(quite)f(con)o(v)o(enien)o(t,)h(b)q(ecause)g(of)e(the)h(follo)o(wing)
37 1395 y(observ)m(ation:)k Fn(if)16 b(the)g(only)g(p)n(ointer)g(to)g(a)g
(closur)n(e)g(is)g(fr)n(om)g(an)g(up)n(date)h(fr)n(ame,)f(then)g(the)g
(closur)n(e)g(c)n(an)g(b)n(e)37 1452 y(r)n(e)n(claime)n(d,)g(and)g(the)h(up)n
(date)g(fr)n(ame)f(disc)n(ar)n(de)n(d)p Ft(.)37 1538 y(W)l(e)g(can)g(tak)o(e)
f(adv)m(an)o(tage)h(of)f(this)h(during)h(garbage)e(collection)j(in)e(the)g
(follo)o(wing)h(w)o(a)o(y)l(.)k(First)15 b(p)q(erform)37 1594
y(garbage)d(collection)i(as)d(usual,)i(but)g(without)f(using)g(the)h(p)q(oin)
o(ters)f(from)f(up)q(date)i(frames)e(as)h(ro)q(ots.)18 b(No)o(w,)37
1651 y(lo)q(ok)e(at)f(eac)o(h)g(up)q(date)h(frame)f(and)g(see)h(if)g(it)f(p)q
(oin)o(ts)h(to)f(a)g(closure)h(whic)o(h)g(has)f(b)q(een)i(mark)o(ed)d(as)h
(liv)o(e.)22 b(If)37 1707 y(so,)16 b(and)g(a)g(cop)o(ying)g(collector)h(is)f
(b)q(eing)i(used,)e(adjust)g(the)g(p)q(oin)o(ter)g(to)f(p)q(oin)o(t)i(to)e
(the)h(new)g(cop)o(y)g(of)g(the)37 1763 y(closure.)21 b(If)16
b(not,)e(squeeze)i(the)f(up)q(date)h(frame)f(out)g(of)f(the)i(B)f(stac)o(k)f
(altogether.)37 1849 y(It)g(is)h(easy)e(to)h(\014nd)g(all)h(the)f(up)q(date)g
(frames,)f(b)q(ecause)i(the)f(stac)o(k)f(base)h(register)g(for)f(the)h(B)g
(stac)o(k)f(alw)o(a)o(ys)37 1906 y(p)q(oin)o(ts)g(to)f(the)g(topmost)f(w)o
(ord)h(of)g(the)g(topmost)f(up)q(date)i(frame;)f(and)h(the)f(sa)o(v)o(ed)g
(stac)o(k)f(base)h(register)h(for)37 1962 y(the)h(B)f(stac)o(k)g(p)q(oin)o
(ts)h(to)e(the)i(next)f(up)q(date)h(frame,)f(and)g(so)g(on.)19
b(This)14 b(giv)o(es)g(a)f(top-to-b)q(ottom)e(tra)o(v)o(ersal,)37
2019 y(but)i(it)g(turns)g(out)f(that)g(a)g(b)q(ottom-to-top)f(tra)o(v)o
(ersal)h(mak)o(es)g(the)h(\\squeezing-out")g(pro)q(cess)g(m)o(uc)o(h)f(more)
37 2075 y(e\016cien)o(t,)k(for)f(t)o(w)o(o)e(reasons:)106 2180
y Fo(\017)22 b Ft(Since)15 b(the)f(squeeze)g(m)o(ust)f(mo)o(v)o(e)g(data)f
(to)o(w)o(ards)g(the)i(b)q(ottom)f(of)g(the)g(stac)o(k)g(\(otherwise)g(the)h
(stac)o(k)151 2237 y(w)o(ould)h(creep)g(up)h(in)f(memory!\),)e(w)o(orking)h
(from)g(b)q(ottom)g(to)g(top)g(means)h(that)f(eac)o(h)h(w)o(ord)f(of)g(the)
151 2293 y(B)h(stac)o(k)g(is)h(mo)o(v)o(ed)e(only)i(once.)106
2379 y Fo(\017)22 b Ft(When)17 b(an)g(up)q(date)h(frame)e(is)i(remo)o(v)o
(ed,)e(the)h(stac)o(k-base)f(p)q(oin)o(ters)i(for)e(the)h(next)g(up)q(date)h
(frame)151 2436 y(ab)q(o)o(v)o(e)d(it)g(need)h(to)f(b)q(e)h(adjusted.)k(This)
c(is)f(easy)g(to)g(do)g(when)h(w)o(orking)f(b)q(ottom)f(to)g(top.)37
2541 y(Happily)l(,)22 b(it)e(is)g(easy)f(to)f(mak)o(e)h(a)g(top-to-b)q(ottom)
f(tra)o(v)o(ersal,)h(rev)o(ersing)g(all)h(the)g(p)q(oin)o(ters,)g(and)g(then)
37 2597 y(mak)o(e)15 b(the)g(b)q(ottom-to-top)f(tra)o(v)o(ersal)g(to)h(do)g
(the)g(w)o(ork.)37 2683 y(The)k(result)g(of)f(all)h(this)g(is)g(that)e(the)i
(garbage)e(collector)i(reclaims)g(redundan)o(t)g(up)q(date)g(frames.)29
b(The)37 2740 y(main)16 b(b)q(ene\014t)g(is)g(the)f(sa)o(ving)g(in)h(up)q
(dates)f(p)q(erformed.)41 b(This)15 b(optimisation)h(w)o(as)e(p)q(erformed,)h
(but)g(not)37 2796 y(do)q(cumen)o(ted,)h(in)g(F)l(airbairn)g(and)f(W)l(ra)o
(y's)f(original)j(TIM)e(implemen)o(tation.)934 2921 y(72)p
eop
%%Page: 73 73
bop 37 199 a Fm(10.8)56 b(Global)18 b(up)r(datable)h(closures)37
315 y Ft(As)d(previously)g(discussed)h(\(Section)f(9.1\),)d(eac)o(h)i
(globally-de\014ned)j(v)m(ariable)f(is)f(b)q(ound)g(to)e(a)h(statically-)37
371 y(allo)q(cated)g(closure.)k(Since)c(suc)o(h)e(closures)h(ha)o(v)o(e)f(no)
g(free)g(v)m(ariables)h(\(except)g(of)e(course)h(other)g(statically-)37
428 y(allo)q(cated)j(closures\),)f(there)g(is)g(no)g(need)g(to)g(treat)e
(them)i(as)f(a)h(source)g(of)f(ro)q(ots)g(during)h(garbage)f(collec-)37
484 y(tion.)37 570 y(But)j(some)f(of)g(these)g(global)h(closures)g(ma)o(y)f
(ha)o(v)o(e)g(no)g(argumen)o(ts,)g(and)g(hence)h(b)q(e)g(up)q(datable:)24
b(w)o(e)16 b(call)37 626 y(suc)o(h)g(suc)o(h)f(argumen)o(t-less)g(top-lev)o
(el)h(closures)g Fn(c)n(onstant)f(applic)n(ative)h(forms)f
Ft(or)g(CAFs.)k(F)l(or)14 b(example,)37 683 y Fp(ints)h Ft(is)h(a)f(CAF)f
(whose)i(v)m(alue)g(is)g(the)f(in\014nite)i(list)f(of)f(in)o(tegers:)228
769 y Fp(ints)24 b(=)f({})h(\\u)g({})f(from)h({zero})228 825
y(zero)g(=)f({})h(\\n)g({})f(MkInt)g({0#})37 911 y Ft(where)16
b Fp(from)f Ft(is)g(a)g(function)h(returning)g(the)f(in\014nite)i(list)f(of)f
(in)o(tegers)g(starting)g(from)f(its)i(argumen)o(t.)37 997
y(There)g(are)f(t)o(w)o(o)f(di\016culties:)93 1106 y(1.)22
b(If)14 b(suc)o(h)h(a)f(CAF)f(is)i(up)q(dated,)f(there)h(will)g(b)q(e)g(p)q
(oin)o(ters)f(from)g(the)g(static)g(space)g(in)o(to)g(the)g(dynamic)151
1162 y(heap.)20 b(The)c(question)g(is:)k(ho)o(w)15 b(is)g(the)h(garbage)e
(collector)i(to)f(\014nd)g(all)i(suc)o(h)e(p)q(oin)o(ters?)93
1250 y(2.)22 b(With)15 b(the)g(garbage-collection)h(tec)o(hniques)g(describ)q
(ed)g(in)g(Section)g(7.3)d(closures)j(in)f(static)g(space)151
1307 y(need)22 b(di\013eren)o(t)f(garbage-collection)h(co)q(de)f(from)f
(those)h(in)g(the)g(dynamically-allo)q(cated)j(heap.)151 1363
y(The)17 b(t)o(w)o(o)f(are)h(readily)h(distinguishable)i(\(b)o(y)d(address\))
g(but)g(it)g(is)h(unfortunate)f(if)g Fn(every)g Ft(up)q(date)151
1420 y(is)f(slo)o(w)o(ed)f(do)o(wn)g(b)o(y)g(a)g(test)g(when)g(the)h(v)m(ast)
f(ma)s(jorit)o(y)e(of)i(up)q(dates)h(are)f(to)f(dynamic)i(closures.)37
1528 y(There)f(is)f(more)g(than)g(one)g(w)o(a)o(y)g(to)f(solv)o(e)h(this)h
(problem,)f(but)h(the)f(one)g(w)o(e)g(ha)o(v)o(e)g(adopted)g(is)h(as)e(follo)
o(ws.)37 1585 y(The)j(idea)g(is)g(to)e(arrange)h(that:)93 1694
y(1.)22 b(CAFs)16 b(whic)o(h)i(are)e(b)q(eing)i(ev)m(aluated,)f(or)g(whose)f
(ev)m(aluation)i(is)f(complete,)g(are)f(link)o(ed)j(together)151
1750 y(on)o(to)14 b(the)i Fn(CAF)f(list)p Ft(,)f(whic)o(h)i(is)g(kno)o(wn)f
(to)g(the)g(garbage)g(collector.)21 b(This)15 b(solv)o(es)h(the)f(\014rst)g
(of)g(the)151 1807 y(ab)q(o)o(v)o(e)g(problems.)93 1894 y(2.)22
b(All)16 b(up)q(date)f(frames)e(p)q(oin)o(t)i(to)f(closures)g(in)i(the)e
(dynamic)h(heap,)g(th)o(us)f(solving)h(the)f(second)h(prob-)151
1951 y(lem.)37 2060 y(W)l(e)e(ac)o(hiev)o(e)g(these)f(goals)g(b)o(y)g(adding)
h(a)f(little)i(extra)d(co)q(de)i(to)f(the)g(start)f(of)h(the)g(standard-en)o
(try)g(co)q(de)h(for)37 2116 y(a)i(CAF)g(\(Figure)f(8\).)20
b(The)15 b(extra)f(co)q(de)h(do)q(es)h(the)f(follo)o(wing:)20
b(it)15 b(allo)q(cates)h(a)e(blac)o(k)i(hole)g(closure)f(in)h(the)37
2173 y(heap)g(whose)f(purp)q(ose)g(is)h(to)e(receiv)o(e)i(the)f(subsequen)o
(t)h(up)q(date;)f(it)g(pushes)h(an)f(up)q(date)g(frame)g(p)q(oin)o(ting)37
2229 y(to)h(this)h(blac)o(k)g(hole;)h(and)e(it)h(o)o(v)o(erwrites)f(the)g
(static)g(CAF)g(closure)h(with)g(a)f(three-w)o(ord)g Fp(CAFlist)g
Ft(cell,)37 2285 y(p)q(oin)o(ting)h(to)d(the)i(blac)o(k)f(hole)h(in)g(the)g
(heap,)f(and)g(link)o(ed)i(on)o(to)d(the)i(CAF)e(list.)37 2371
y(In)i(the)e(example)i(sho)o(wn)e(in)i(Figure)f(8,)f(the)g(CAFs)h
Fp(p)o Ft(,)g Fp(q)f Ft(and)h Fp(r)f Ft(ha)o(v)o(e)h(all)g(b)q(een)h(en)o
(tered,)f(and)g(hence)g(are)37 2428 y(link)o(ed)j(on)o(to)e(the)g(CAF)g(list)
h(\(w)o(e)f(use)h Fp(CL)f Ft(to)f(abbreviate)i(the)g(info)f(p)q(oin)o(ter)h
(for)f(a)g Fp(CAFList)f Ft(cell\).)25 b(The)37 2484 y(ev)m(aluation)15
b(of)f Fp(p)f Ft(is)h(not)g(y)o(et)f(complete,)h(so)g(it)g(still)h(p)q(oin)o
(ts)f(to)f(a)g(blac)o(k)h(hole)h(in)f(the)g(dynamic)h(heap)f(\(info)37
2541 y(p)q(oin)o(ter)k Fp(BH)p Ft(\).)24 b(The)17 b(ev)m(aluation)h(of)f
Fp(q)g Ft(has)f(b)q(een)i(completed,)g(and)f(the)g(blac)o(k)h(hole)f(has)g(b)
q(een)h(up)q(dated)37 2597 y(with)g(an)g(indirection)h(\(info)f(p)q(oin)o
(ter)f Fp(I)p Ft(\))g(to)g(its)h(v)m(alue.)27 b Fp(s)18 b Ft(has)f(not)g(b)q
(een)h(en)o(tered,)g(so)f(it)h(consists)f(of)g(a)37 2654 y(info)f(p)q(oin)o
(ter)g(\()p Fp(S)o Ft(\))f(only)l(.)37 2740 y(A)j Fp(CAFList)f
Ft(cell)j(lo)q(oks)e(lik)o(e)h(an)o(y)f(other)f(closure.)29
b(If)18 b(en)o(tered,)g(it)h(simply)g(en)o(ters)e(the)h(heap-allo)q(cated)37
2796 y(closure)j(to)d(whic)o(h)j(it)e(p)q(oin)o(ts,)i(b)q(eha)o(ving)f(just)f
(lik)o(e)i(an)e(indirection.)35 b(The)20 b(garbage)e(collector)j(kno)o(ws)934
2921 y(73)p eop
%%Page: 74 74
bop 638 276 195 4 v 638 343 4 68 v 829 343 V 638 346 195 4
v 956 276 V 956 343 4 68 v 1147 343 V 956 346 195 4 v 229 313
94 4 v 281 311 a Fi(-)p 484 313 158 4 v 277 w(-)p 825 594 198
4 v 825 654 4 60 v 1020 654 V 825 657 198 4 v 1144 594 V 1144
654 4 60 v 1338 654 V 1144 657 198 4 v 510 594 V 510 654 4
60 v 705 654 V 510 657 198 4 v 414 626 4 315 v 416 628 98 4
v 472 626 a(-)p 733 626 4 315 v 735 628 94 4 v 273 w(-)p 1052
626 4 315 v 1053 628 79 4 v 262 w(-)p 385 345 4 68 v 448 345
V 703 345 V 767 345 V 1018 345 V 1082 345 V 1337 345 V 1083
345 a(\000)1108 321 y(\000)p 37 470 1508 4 v 576 656 4 60 v
639 656 V 891 656 V 958 656 V 1016 786 390 4 v 1016 846 4 60
v 1402 846 V 1016 849 390 4 v 924 817 4 192 v 926 819 94 4
v 978 817 a(-)p 34 152 1514 4 v 34 909 4 758 v 1545 909 V 34
912 1514 4 v 319 276 198 4 v 319 343 4 68 v 514 343 V 319 346
198 4 v 1260 276 195 4 v 1260 343 4 68 v 1451 343 V 1260 346
195 4 v 795 313 162 4 v 915 311 a(-)322 247 y Fy(p)311 b(q)297
b(r)i(s)334 326 y Fc(CL)268 b(CL)97 319 y Fu(Caf)13 b(List)847
633 y Fc(I)1282 322 y(S)71 210 y Fy(ST)m(A)m(TIC)g(SP)m(A)o(CE)67
521 y(D)o(YNAMIC)h(HEAP)967 322 y Fc(CL)521 637 y(BH)706 1009
y Ft(Figure)h(8:)20 b(Global)15 b(up)q(dates)37 1146 y(ab)q(out)i(the)f(CAF)h
(list,)g(and)f(w)o(alks)h(it)g(iterativ)o(ely)l(,)g(ev)m(acuating)g(the)g
(heap-allo)q(cated)h(closure)f(to)f(whic)o(h)37 1203 y(eac)o(h)21
b(cell)g(p)q(oin)o(ts,)h(and)e(up)q(dating)h(the)f(cell)i(appropriately)l(.)
36 b(This)20 b(is)h(sligh)o(tly)g(p)q(essimistic,)i(since)f(it)37
1259 y(holds)d(on)o(to)f(the)g(v)m(alue)h(of)f(ev)o(ery)g(CAF)g(ev)o(en)g
(though)g(the)g(program)f(ma)o(y)h(nev)o(er)g(reference)h(it)f(again,)37
1316 y(but)e(there)f(is)h(no)f(a)o(v)o(oiding)h(this)f(unless)h(the)g
(garbage)e(collector)i(tra)o(v)o(erses)e(the)h(co)q(de)h(as)f(w)o(ell.)37
1489 y Fs(11)67 b(Status)23 b(and)f(pro\014ling)j(results)37
1619 y Ft(W)l(e)c(ha)o(v)o(e)f(built)h(a)f(compiler)i(for)d(Hask)o(ell)i
(whose)g(bac)o(k)f(end)h(is)f(based)h(on)f(the)g(STG)g(mac)o(hine,)i(just)37
1676 y(as)g(describ)q(ed)j(ab)q(o)o(v)o(e.)40 b(The)23 b(whole)g(implemen)o
(tation)g(has)f(b)q(een)i(constructed)e(rather)g(carefully)h(so)37
1732 y(that)g(it)h(ma)o(y)e(b)q(e)i(used)g(as)f(a)g(\\motherb)q(oard")f(in)o
(to)h(whic)o(h)h(other)f(implemen)o(tors)h(ma)o(y)f(\\plug)g(in")37
1789 y(their)16 b(optimisation)h(passes.)j(All)d(the)e(source)h(co)q(de)g(is)
g(a)o(v)m(ailable)h(b)o(y)e(anon)o(ymous)g(FTP)g(b)o(y)g(con)o(tacting)37
1845 y Fp(haskell-request@dcs.glasgow.ac)o(.uk)m Ft(.)37 1931
y(Apart)10 b(from)g(the)g(STG)g(mac)o(hine)i(tec)o(hnology)e(describ)q(ed)i
(in)g(the)e(curren)o(t)g(pap)q(er,)i(the)e(ma)s(jor)f(inno)o(v)m(ations)37
1988 y(of)15 b(the)h(compiler)g(are:)106 2111 y Fo(\017)22
b Ft(The)16 b(systematic)f(use)g(of)g(un)o(b)q(o)o(xed)h(v)m(alues)g(to)f
(implemen)o(t)h(built-in)i(data)c(t)o(yp)q(es.)106 2205 y Fo(\017)22
b Ft(A)14 b(new)h(approac)o(h)e(to)h(input/output)h(based)f(on)g(monads,)g
(whic)o(h)h(allo)o(ws)f(the)g(en)o(tire)h(I/O)f(system)151
2261 y(to)i(b)q(e)g(written)g(in)h(Hask)o(ell)g(\(Hammond,)f(P)o(eyton)f
(Jones)i(&)f(W)l(adler)h([1992]\).)j(This)d(is)f(done)h(via)151
2318 y(a)g(general-purp)q(ose)h(mec)o(hanism)f(whic)o(h)h(allo)o(ws)f
(arbitrary)f(calls)i(to)e(b)q(e)i(made)f(from)f(Hask)o(ell)i(to)151
2374 y(C.)c(As)h(a)f(result)i(the)f(I/O)g(system)f(can)h(b)q(e)g(readily)h
(extended)g(without)f(mo)q(difying)h(the)f(compiler)151 2431
y(or)g(its)g(run)o(time)h(system.)106 2525 y Fo(\017)22 b Ft(The)c(Core)e
(language,)i(whic)o(h)g(serv)o(es)f(as)g(the)g(main)h(in)o(termediate)g(data)
e(t)o(yp)q(e)i(in)g(the)f(compiler,)151 2581 y(is)f(actually)h(based)f(on)f
(the)h(second-order)g(lam)o(b)q(da)g(calculus,)h(complete)g(with)f(t)o(yp)q
(e)f(abstraction)151 2637 y(and)e(application.)21 b(This)13
b(p)q(ermits)g(us)f(to)g(main)o(tain)h(complete)h(t)o(yp)q(e)e(information)h
(in)g(the)g(presence)151 2694 y(of)h(extensiv)o(e)h(program)e
(transformation,)f(as)i(w)o(ell)h(as)f(accommo)q(dating)g(other)f(fron)o(t)g
(ends)i(whose)151 2750 y(t)o(yp)q(e)g(system)g(is)h(more)f(expressiv)o(e)h
(than)f(Hask)o(ell's.)934 2921 y(74)p eop
%%Page: 75 75
bop 37 199 a Ft(The)18 b(implemen)o(tation)h(co)o(v)o(ers)e(almost)g(the)h
(whole)g(language,)g(but)g(virtually)h(no)e(optimisations)h(ha)o(v)o(e)37
256 y(y)o(et)i(b)q(een)h(implemen)o(ted.)36 b(As)20 b(a)f(result,)j(w)o(e)d
(ha)o(v)o(e)h(not)f(compared)h(its)g(absolute)h(p)q(erformance)f(with)37
312 y(other)g(compilers.)34 b(\(This)20 b(omission)g(is)g(an)g(imp)q(ortan)o
(t)f(shortcoming)g(of)h(this)g(pap)q(er,)h(whic)o(h)f(will)h(b)q(e)37
369 y(recti\014ed)c(b)o(y)e(a)g(follo)o(w-up)h(pap)q(er.\))37
455 y(W)l(e)j(ha)o(v)o(e)e(b)q(egun)i(to)f(gather)f(simple)i(dynamic)g
(statistics,)g(ho)o(w)o(ev)o(er.)27 b(Figure)18 b(9)g(sho)o(ws)f(some)h
(output)37 511 y(tak)o(en)i(from)f(a)g(run)h(of)g(a)f(simple)i(t)o(yp)q
(e-inference)h(program.)32 b(This)20 b(program)f(tak)o(es)g(some)g(600)g
(lines)37 568 y(of)h(Hask)o(ell)h(source)f(co)q(de)g(\(apart)f(from)g
(functions)i(used)f(from)g(the)f(Prelude\),)j(and)e(the)g(sample)h(run)37
624 y(allo)q(cated)c(ab)q(out)e(10)f(megab)o(ytes)h(of)g(heap.)20
b(The)15 b(pro\014le)h(has)f(the)h(follo)o(wing)g(main)f(headings:)37
747 y Fr(Allo)q(cations,)25 b Ft(split)c(in)o(to)e(v)m(arious)h(categories.)
32 b(Most)18 b(allo)q(cation)i(is)g(for)f(th)o(unks.)32 b(The)20
b(prop)q(ortion)151 804 y(of)d(data-v)m(alue)g(allo)q(cation)h(seems)f
(surprisingly)i(lo)o(w,)e(b)q(ecause)h(most)e(data)g(v)m(alues)i(are)f(built)
h(b)o(y)151 860 y(up)q(dating)24 b(a)e(th)o(unk,)i(rather)e(than)h(b)o(y)f(p)
q(erforming)h(new)g(allo)q(cation)h(in)f(a)f Fp(let\(rec\))o
Ft(.)42 b(This)151 917 y(program)14 b(uses)i(monads)f(hea)o(vily)l(,)h(so)f
(quite)g(a)g(lot)h(of)e(function-v)m(alued)k(closures)e(are)f(allo)q(cated.)
37 1010 y Fr(Stac)o(k)j(high-w)o(ater)g(marks)k Ft(are)14 b(self)i
(explanatory)l(.)37 1104 y Fr(En)o(ters,)22 b Ft(with)16 b(a)g
(classi\014cation)i(of)d(what)h(kind)h(of)e(closure)i(is)f(b)q(eing)i(en)o
(tered.)k(In)17 b(this)f(case,)g(a)g(rather)151 1161 y(lo)o(w)j(prop)q
(ortion)g(of)f(function)i(calls)g(\(34\045\))e(b)o(ypass)g(the)h(argumen)o(t)
f(satisfaction)h(c)o(hec)o(k,)h(again)151 1217 y(due)c(to)f(the)g(v)o(ery)g
(higher-order)h(nature)f(of)f(the)i(program.)37 1311 y Fr(Returns,)22
b Ft(whic)o(h)f(giv)o(e)g(information)f(ab)q(out)g(the)g(data-v)m(alue)g
(returns)g(whic)o(h)h(to)q(ok)f(place.)35 b(In)21 b(this)151
1367 y(run,)c(almost)f(all)h(w)o(ere)f(v)o(ectored)h(and)f(in)i(registers.)23
b(The)17 b(third)g(classi\014cation)h(tells)f(ho)o(w)f(man)o(y)151
1424 y(returns)i(w)o(ere)f(from)g(en)o(tering)i(an)e(already-ev)m(aluated)j
(constructor)d(\(some)g(50\045)g(in)h(this)h(case\).)151 1480
y(In)d(the)f(cell)i(mo)q(del,)f(the)f(en)o(ter/return)g(sequence)h(w)o(ould)g
(not)f(b)q(e)g(p)q(erformed)h(for)e(these)i(cases.)37 1574
y Fr(Up)q(date)j(frames)j Ft(classi\014es)d(v)m(arious)g(forms)d(of)i(up)q
(date)g(frame,)g(whic)o(h)g(is)h(rather)e(uninformativ)o(e)h(in)151
1631 y(this)e(case.)37 1724 y Fr(Up)q(dates.)24 b Ft(The)13
b(\014fth)g(line)i(coun)o(ts)e(the)g(n)o(um)o(b)q(er)g(of)g(times)g(t)o(w)o
(o)f(or)g(more)h(up)q(date)g(frames)g(w)o(ere)g(stac)o(k)o(ed)151
1781 y(directly)j(on)e(top)g(of)h(one)f(another.)19 b(The)c(last)g(line)h
(coun)o(ts)e(the)g(n)o(um)o(b)q(er)h(of)f(up)q(dates)h(in)h(whic)o(h)f(an)151
1837 y(already-existing)i(v)m(alue)f(w)o(as)f(copied)h(b)o(y)f(an)g(up)q
(dates)h(\(Section)g(10.6\).)37 2010 y Fs(Ac)n(kno)n(wledgemen)n(ts)37
2141 y Ft(This)k(pap)q(er)f(has)g(b)q(een)h(a)e(long)h(time)g(in)h
(gestation.)30 b(I)19 b(w)o(ould)g(lik)o(e)h(to)e(thank)g(those)h(who)f(ha)o
(v)o(e)h(b)q(een)37 2198 y(kind)i(enough)f(to)e(giv)o(e)i(me)g(help)g(and)g
(guidance)g(in)h(impro)o(ving)f(it.)32 b(Andrew)20 b(App)q(el)h(made)e
(detailed)37 2254 y(commen)o(ts)e(ab)q(out)g(the)g(relationship)i(of)d(this)i
(w)o(ork)e(to)g(his.)26 b(Geo\013)16 b(Burn,)i(Cordy)e(Hall,)i(Denis)g(Ho)o
(w)o(e,)37 2310 y(Rishiyur)k(Nikhil,)f(Chris)f(Ok)m(asaki,)g(Julian)h(Sew)o
(ard,)f(and)f(the)g(t)o(w)o(o)f(anon)o(ymous)h(referees)g(ga)o(v)o(e)f(v)o
(ery)37 2367 y(useful)g(feedbac)o(k.)23 b(The)16 b(implemen)o(tation)h(of)f
(the)g(compiler)i(itself)f(o)o(w)o(es)e(m)o(uc)o(h)h(to)f(the)i(w)o(ork)e(of)
g(Cordy)37 2423 y(Hall)i(and)e(Will)i(P)o(artain.)37 2509 y(Sadly)l(,)g(m)o
(y)e(friend)h(and)g(colleague)g(Jon)g(Salkild,)h(who)e(co-authored)h(the)f
(\014rst)g(STG)g(pap)q(er,)h(died)h(most)37 2566 y(suddenly)g(in)f(1991.)934
2921 y(75)p eop
%%Page: 76 76
bop 37 157 1698 2 v 37 2707 2 2551 v 52 201 a Fp(ALLOCATIONS:)22
b(73920)h(\(231212)g(words)g(total:)147 257 y(70387)g(admin,)g(136489)g
(goods,)g(24336)h(slop\))52 313 y(avg)f(#words)g(of:)h(admin)f(goods)g(slop)
99 370 y(14426)h(\()f(19.5\045\))g(function)g(values)g(1.0)h(1.7)f(0.1)99
426 y(45131)h(\()f(61.1\045\))g(thunks)g(1.0)h(1.7)f(0.5)123
483 y(9609)h(\()f(13.0\045\))g(data)h(values)f(1.0)g(1.7)h(0.0)195
539 y(0)g(\()47 b(0.0\045\))23 b(big)h(tuples)195 596 y(0)g(\()47
b(0.0\045\))23 b(partial)g(applications)147 652 y(407)h(\()47
b(0.6\045\))23 b(black-hole)g(closures)g(3.0)g(0.0)g(0.0)123
709 y(4341)h(\()47 b(5.9\045\))23 b(partial-application)f(updates)g(0.0)i
(4.4)f(0.0)195 765 y(6)h(\()47 b(0.0\045\))23 b(data-value)g(updates)g(0.0)g
(4.5)h(0.0)52 878 y(Total)f(storage-manager)f(allocations:)g(49594)h
(\(235559)g(words\))52 991 y(STACK)g(USAGE:)52 1047 y(A)g(stack)h(max.)f
(depth:)g(222)g(words)52 1104 y(B)g(stack)h(max.)f(depth:)g(446)g(words)52
1217 y(ENTERS:)g(142737,)f(of)i(which)f(41914)g(\(29.4\045\))g(direct)g(to)h
(the)f(entry)h(code)99 1273 y([the)g(rest)f(indirected)f(via)i(Node's)f(info)
g(ptr])99 1330 y(35626)h(\()f(25.0\045\))g(thunks)99 1386 y(24713)h(\()f
(17.3\045\))g(data)h(values)99 1443 y(64346)g(\()f(45.1\045\))g(function)g
(values)99 1499 y([of)h(which)f(21604)g(\(33.6\045\))g(bypassed)g
(arg-satisfaction)f(chk])123 1555 y(4788)i(\()47 b(3.4\045\))23
b(partial)g(applications)99 1612 y(13264)h(\()47 b(9.3\045\))23
b(indirections)52 1725 y(RETURNS:)f(49212)99 1781 y(48991)i(\()f(99.6\045\))g
(in)h(registers)f([the)g(rest)g(in)h(the)f(heap])99 1838 y(49210)h
(\(100.0\045\))e(vectored)h([the)g(rest)h(unvectored])99 1894
y(24499)g(\()f(49.8\045\))g(from)h(entering)e(a)i(new)g(constructor)99
1951 y([the)g(rest)f(from)g(entering)g(an)h(existing)e(constructor])52
2064 y(UPDATE)h(FRAMES:)g(35626)g(\(0)g(omitted)g(from)h(thunks\))99
2120 y(35626)g(\(100.0\045\))e(standard)h(frames)195 2177 y(0)h(\()47
b(0.0\045\))23 b(constructor)g(frames)195 2233 y(0)h(\()47
b(0.0\045\))23 b(black-hole)g(frames)52 2346 y(UPDATES:)f(35626)99
2402 y(25788)i(\()f(72.4\045\))g(data)h(values)99 2459 y([25781)f(in)h
(place,)f(6)h(allocated)e(new)i(space,)f(1)h(with)f(Node])123
2515 y(4349)h(\()f(12.2\045\))g(partial)g(applications)99 2572
y([8)h(in)g(place,)f(4341)g(allocated)g(new)g(space])123 2628
y(5489)h(\()f(15.4\045\))g(updates)g(followed)g(immediately)123
2685 y(2594)h(\()f(10.1\045\))g(in-place)g(updates)g(copied)p
1733 2707 V 37 2709 1698 2 v 365 2786 a Ft(Figure)16 b(9:)j(Example)d(output)
f(of)g(dynamic)h(pro\014ling)g(information)934 2921 y(76)p
eop
%%Page: 77 77
bop 37 199 a Fs(Bibliograph)n(y)37 330 y Ft(R)22 b(Alv)o(erson,)f(D)f
(Callahan,)h(D)g(Cummings,)g(B)g(Koblenz,)h(A)f(p)q(orter\014eld)h(&)f(B)g
(Smith)8 b([June)22 b(1990],)187 387 y(\\The)16 b(T)l(era)g(computer)h
(system,")e(in)i Fb(Pro)q(c)g(In)o(ternational)g(Conference)f(on)h(Sup)q
(ercomputing,)187 443 y(Amsterdam)p Ft(.)37 542 y(A)-5 b(W)14
b(App)q(el)9 b([1987],)i(\\Garbage)i(collection)i(can)f(b)q(e)g(faster)f
(than)g(stac)o(k)g(allo)q(cation,")h Fb(Info)g(Pro)q(c)f(Lett)c
Ft(25,)187 598 y(275{279.)37 696 y(A)-5 b(W)15 b(App)q(el)10
b([1992],)j Fb(Compiling)j(with)g(con)o(tin)o(uations)p Ft(,)f(Cam)o(bridge)g
(Univ)o(ersit)o(y)h(Press.)37 795 y(A)-5 b(W)15 b(App)q(el)10
b([F)l(eb)15 b(1989],)e(\\Simple)j(generational)g(garbage)e(collection)j(and)
f(fast)e(allo)q(cation,")h Fb(Soft)o(w)o(are)187 851 y({)g(Practice)g(and)h
(Exp)q(erience)c Ft(19,)i(171{183.)37 950 y(A)-5 b(W)16 b(App)q(el)i(&)f(T)f
(Jim)8 b([Jan)16 b(1989],)e(\\Con)o(tin)o(uation-passing,)j(closure-passing)g
(st)o(yle,")f(in)h Fb(Pro)q(c)f(A)o(CM)187 1006 y(Conference)g(on)f
(Principles)i(of)e(Programming)f(Languages)r Ft(,)h(A)o(CM,)f(293{302.)37
1105 y(ZM)21 b(Ariola)h(&)f(Arvind)9 b([June)22 b(1991],)d(\\A)i(syn)o
(tactic)g(approac)o(h)g(to)g(program)f(transformations,")f(in)187
1161 y Fb(Symp)q(osium)14 b(on)f(P)o(artial)f(Ev)m(aluation)i(and)f(Seman)o
(tics-Based)h(Program)d(Manipulation,)j(Y)l(ale)s Ft(.)37 1260
y(L)h(Augustsson)7 b([1987],)12 b(\\Compiling)j(lazy)f(functional)h
(languages,)f(part)f(I)q(I,")h(PhD)g(thesis,)g(Dept)f(Comp)187
1316 y(Sci,)j(Chalmers)f(Univ)o(ersit)o(y)l(,)h(Sw)o(eden.)37
1414 y(L)d(Augustsson)g(&)g(T)f(Johnsson)c([Sept)13 b(1989],)d(\\P)o(arallel)
k(graph)e(reduction)h(with)g(the)g(<n)o(u,G>-mac)o(hine,")187
1471 y(in)18 b Fb(Pro)q(c)e(IFIP)i(Conference)f(on)g(F)l(unctional)h
(Programming)e(Languages)g(and)i(Computer)e(Ar-)187 1527 y(c)o(hitecture,)g
(London)p Ft(,)f(A)o(CM.)37 1626 y(Henry)g(Bak)o(er)7 b([Apr)14
b(1978],)f(\\List)h(pro)q(cessing)i(in)f(real)f(time)h(on)f(a)g(serial)h
(computer,")f Fb(CA)o(CM)e Ft(21,)h(280{)187 1682 y(294.)37
1781 y(JF)k(Bartlett)7 b([Jan)16 b(1989],)f(\\SCHEME)g(to)h(C:)g(a)g(p)q
(ortable)h(Sc)o(heme-to-C)f(compiler,")h(DEC)f(WRL)h(RR)187
1837 y(89/1.)37 1936 y(A)22 b(Bloss,)g(P)f(Hudak)h(&)g(J)g(Y)l(oung)8
b([1988],)19 b(\\Co)q(de)j(optimizations)h(for)e(lazy)h(ev)m(aluation,")g
Fb(Lisp)h(and)187 1992 y(Sym)o(b)q(olic)17 b(Computation)7
b Ft(1,)14 b(147{164.)37 2091 y(Geo\013)e(Burn,)g(SL)h(P)o(eyton)e(Jones)i(&)
f(John)h(Robson)8 b([July)13 b(1988],)d(\\The)j(Spineless)h(G-mac)o(hine,")e
(in)h Fb(Pro)q(c)187 2147 y(A)o(CM)h(Conference)i(on)f(Lisp)i(and)e(F)l
(unctional)h(Programming,)e(Sno)o(wbird)r Ft(,)i(244{258.)37
2245 y(C)i(Consel)g(&)h(O)f(Dan)o(vy)7 b([Sept)17 b(1991],)f(\\F)l(or)h(a)h
(b)q(etter)f(supp)q(ort)h(of)g(static)f(data)g(\015o)o(w,")g(in)i
Fb(F)l(unctional)187 2302 y(Programming)i(Languages)h(and)g(Computer)f(Arc)o
(hitecture,)i(Boston)p Ft(,)e(Hughes,)h(ed.,)f(LNCS)187 2358
y(523,)14 b(Springer)i(V)l(erlag,)f(496{519.)37 2457 y(EC)g(Co)q(op)q(er)f(&)
g(JG)h(Morrisett)6 b([Dec)14 b(1990],)f(\\Adding)i(threads)f(to)g(Standard)g
(ML,")g(CMU-CS-90-186,)187 2513 y(Dept)h(Comp)g(Sci,)h(Carnegie)f(Mellon)h
(Univ.)37 2612 y(AJT)j(Da)o(vie)f(&)g(DJ)g(McNally)8 b([1989],)16
b(\\CASE)i(-)g(a)f(lazy)i(v)o(ersion)f(of)f(an)h(SECD)g(mac)o(hine)g(with)h
(a)e(\015at)187 2668 y(en)o(vironmen)o(t,")e(in)h Fb(Pro)q(c)f(IEEE)g
(TENCON,)g(Bom)o(ba)o(y)t Ft(.)934 2921 y(77)p eop
%%Page: 78 78
bop 37 199 a Ft(Jon)17 b(F)l(airbairn)f(&)g(Stuart)f(W)l(ra)o(y)7
b([Sept)16 b(1987],)e(\\TIM)h(-)h(a)f(simple)j(lazy)e(abstract)f(mac)o(hine)h
(to)f(execute)187 256 y(sup)q(ercom)o(binators,")i(in)g Fb(Pro)q(c)g(IFIP)h
(conference)g(on)f(F)l(unctional)h(Programming)e(Languages)187
312 y(and)11 b(Computer)f(Arc)o(hitecture,)h(P)o(ortland)r
Ft(,)f(G)h(Kahn,)g(ed.,)f(Springer)i(V)l(erlag)f(LNCS)g(274,)f(34{45.)37
411 y(AJ)16 b(Field)h(&)e(PG)g(Harrison)7 b([1988],)13 b(in)j
Fb(F)l(unctional)h(programming)t Ft(,)d(Addison)i(W)l(esley.)37
509 y(P)d(F)l(radet)f(&)h(D)f(Le)h(Meta)o(y)o(er)7 b([Jan)12
b(1991],)f(\\Compilation)i(of)f(functional)i(languages)f(b)o(y)f(program)f
(trans-)187 565 y(formation,")j Fb(A)o(CM)g(T)l(ransactions)h(on)g
(Programming)g(Languages)g(and)g(Systems)9 b Ft(13.)37 664
y(K)21 b(Hammond,)f(SL)h(P)o(eyton)f(Jones)h(&)g(PL)f(W)l(adler)8
b([F)l(eb)21 b(1992],)d(\\A)j(new)f(input/output)h(mo)q(del)h(for)187
720 y(purely-functional)c(languages,")c(Dept)h(of)g(Computing)g(Science,)i
(Univ)o(ersit)o(y)f(of)f(Glasgo)o(w.)37 819 y(P)e(Henderson)8
b([1980],)j Fb(F)l(unctional)i(programming:)f(application)i(and)f(implemen)o
(tation)p Ft(,)g(Pren)o(tice)g(Hall.)37 917 y(R)19 b(Hieb,)h(RK)f(Dyb)o(vig)g
(&)f(C)h(Bruggeman)7 b([June)19 b(1990],)e(\\Represen)o(ting)j(con)o(trol)e
(in)h(the)g(presence)g(of)187 974 y(\014rst-class)c(con)o(tin)o(uations,")g
(in)h Fb(Pro)q(c)g(Conference)f(on)h(Programming)e(Language)h(Design)h(and)
187 1030 y(Implemen)o(tation)g(\(PLDI)g(90\))q Ft(.)37 1129
y(P)g(Hudak,)f(SL)h(P)o(eyton)f(Jones,)h(PL)g(W)l(adler,)f(Arvind,)h(B)g
(Boutel,)g(J)f(F)l(airbairn,)h(J)g(F)l(asel,)f(M)g(Guzman,)187
1185 y(K)f(Hammond,)f(J)g(Hughes,)h(T)f(Johnsson,)h(R)g(Kieburtz,)g(RS)g
(Nikhil,)i(W)d(P)o(artain)g(&)h(J)g(P)o(eterson)187 1242 y([Ma)o(y)h(1992],)g
(\\Rep)q(ort)i(on)f(the)h(functional)h(programming)e(language)h(Hask)o(ell,)g
(V)l(ersion)h(1.2,")187 1298 y Fb(SIGPLAN)e(Notices)10 b Ft(27.)37
1396 y(John)k(Hughes)8 b([Apr)13 b(1989],)f(\\Wh)o(y)g(functional)j
(programming)d(matters,")g Fb(The)h(Computer)g(Journal)d Ft(32,)187
1453 y(98{107.)37 1551 y(PZ)15 b(Ingerman)8 b([1961],)13 b(\\Th)o(unks,")i
Fb(Comm)f(A)o(CM)e Ft(4,)i(55{58.)37 1650 y(E)23 b(Ireland)9
b([Jan)22 b(1992],)f(\\The)i(Lazy)g(F)l(unctional)h(Abstract)e(Mac)o(hine,")g
(in)i Fb(Pro)q(c)e(15th)g(Australian)187 1706 y(Computer)15
b(Science)i(Conference,)e(Hobart)q Ft(,)f(W)l(orld)i(Scien)o(ti\014c)h
(Publishing.)37 1805 y(Thomas)k(Johnsson)8 b([1985],)19 b(\\Lam)o(b)q(da)i
(lifting:)h(transforming)e(programs)g(to)g(recursiv)o(e)i(equations,")187
1861 y(in)f Fb(Pro)q(c)f(IFIP)g(Conference)h(on)f(F)l(unctional)h
(Programming)e(and)h(Computer)g(Arc)o(hitecture)s Ft(,)187
1918 y(Jouannaud,)c(ed.,)e(LNCS)i(201,)e(Springer)i(V)l(erlag,)f(190{205.)37
2016 y(Thomas)d(Johnsson)c([1987],)h(\\Compiling)k(lazy)f(functional)h
(languages,")f(PhD)f(thesis,)h(PMG,)f(Chalmers)187 2072 y(Univ)o(ersit)o(y)l
(,)16 b(Goteb)q(org,)d(Sw)o(eden.)37 2171 y(Thomas)j(Johnsson)8
b([June)16 b(1984],)e(\\E\016cien)o(t)i(compilation)h(of)f(lazy)g(ev)m
(aluation,")h(in)f Fb(Pro)q(c)g(SIGPLAN)187 2227 y(Symp)q(osium)g(on)f
(Compiler)h(Construction,)f(Mon)o(treal)r Ft(.)37 2326 y(R)e(Jones)8
b([Marc)o(h)i(1991],)g(\\T)l(ail)j(recursion)f(without)g(space)g(leaks,")f
(Departmen)o(t)g(of)g(Computer)g(Science,)187 2382 y(Univ)o(ersit)o(y)16
b(of)f(Ken)o(t.)37 2481 y(R)d(Kelsey)d([Ma)o(y)h(1989],)f(\\Compilation)i(b)o
(y)g(program)f(transformation,")f(Y)l(ALEU/DCS/RR-702,)i(PhD)187
2537 y(thesis,)k(Departmen)o(t)g(of)f(Computer)h(Science,)i(Y)l(ale)f(Univ)o
(ersit)o(y.)37 2636 y(RB)g(Kieburtz)9 b([Oct)15 b(1987],)e(\\A)h(RISC)i(arc)o
(hitecture)g(for)e(sym)o(b)q(olic)i(computation,")e(in)i Fb(Pro)q(c)f(ASPLOS)
187 2692 y(I)q(I)5 b Ft(.)934 2921 y(78)p eop
%%Page: 79 79
bop 37 199 a Ft(RB)18 b(Kieburtz)g(&)f(B)g(Agapiev)9 b([Sept)17
b(1988],)e(\\Optimising)j(the)f(ev)m(aluation)h(of)f(susp)q(ensions,")g(in)h
Fb(Pro)q(c)187 256 y(w)o(orkshop)c(on)h(implemen)o(tation)i(of)e(lazy)g
(functional)i(languages,)e(Asp)q(enas)r Ft(.)37 354 y(H)22
b(Kingdon,)g(D)f(Lester)h(&)f(GL)h(Burn)8 b([1991],)19 b(\\The)i(HDG-mac)o
(hine:)h(a)f(highly)h(distributed)h(graph)187 411 y(reducer)16
b(for)e(a)h(transputer)g(net)o(w)o(ork,")e Fb(Computer)i(Journal)10
b Ft(34,)15 b(290{302.)37 509 y(PWM)e(Ko)q(opman)8 b([1990],)k(\\F)l
(unctional)i(programs)f(as)g(executable)i(sp)q(eci\014cations,")g(PhD)e
(thesis,)h(Uni-)187 565 y(v)o(ersit)o(y)h(of)g(Nijmegen.)37
664 y(D)o(A)10 b(Kranz)e([Ma)o(y)h(1988],)f(\\ORBIT)j(-)g(an)f(optimising)h
(compiler)h(for)d(Sc)o(heme,")h(PhD)g(thesis,)h(Departmen)o(t)187
720 y(of)k(Computer)f(Science,)j(Y)l(ale)f(Univ)o(ersit)o(y.)37
819 y(PJ)c(Landin)d([Marc)o(h)i(1965],)e(\\A)i(corresp)q(ondence)i(b)q(et)o
(w)o(een)f(Algol)g(60)e(and)i(Ch)o(urc)o(h's)f(lam)o(b)q(da)h(calculus,")187
875 y Fb(Comm)i(A)o(CM)e Ft(8,)j(158{165.)37 974 y(D)g(Lester)8
b([Apr)15 b(1989],)e(\\Com)o(binator)i(graph)f(reduction:)i(a)f(congruence)h
(and)g(its)f(applications,")h(PhD)187 1030 y(Thesis,)f(Programming)g(Researc)
o(h)g(Group,)g(Oxford.)37 1129 y(Erik)f(Meijer)8 b([Sept)13
b(1988],)f(\\Generalised)i(expression)g(ev)m(aluation,")g(in)g
Fb(Pro)q(c)f(w)o(orkshop)g(on)g(implemen-)187 1185 y(tation)i(of)g(lazy)g
(functional)i(languages,)e(Asp)q(enas)r Ft(.)37 1283 y(E)h(Miranda)8
b([Apr)16 b(1991],)e(\\Ho)o(w)h(to)g(do)h(mac)o(hine-indep)q(endent)i(fast)d
(threaded)h(co)q(de,")g(Dept)g(of)f(Com-)187 1340 y(puter)g(Science,)i(Queen)
f(Mary)f(and)g(W)l(est\014eld)h(College,)g(London.)37 1438
y(SL)h(P)o(eyton)e(Jones)8 b([1987],)14 b Fb(The)i(implemen)o(tation)h(of)f
(functional)h(programming)e(languages)p Ft(,)g(Pren)o(tice)187
1495 y(Hall.)37 1593 y(SL)e(P)o(eyton)f(Jones)c([1988],)i(\\FLIC)i(-)h(a)e
(functional)j(language)e(in)o(termediate)h(co)q(de,")g Fb(SIGPLAN)g(Notices)
187 1650 y Ft(23.)37 1748 y(SL)k(P)o(eyton)f(Jones,)g(C)g(Clac)o(k)g(&)g(J)g
(Salkild)10 b([June)17 b(1989],)d(\\High-p)q(erformance)j(parallel)g(graph)f
(reduc-)187 1805 y(tion,")i(in)h Fb(Pro)q(c)g(P)o(arallel)g(Arc)o(hitectures)
g(and)g(Languages)g(Europ)q(e)g(\(P)l(ARLE\))q Ft(,)f(E)g(Odijk,)h(M)187
1861 y(Rem)d(&)f(J-C)h(Syre,)f(eds.,)f(LNCS)i(365,)e(Springer)i(V)l(erlag,)f
(193{206.)37 1960 y(SL)22 b(P)o(eyton)e(Jones)g(&)h(J)g(Launc)o(h)o(bury)8
b([Sept)21 b(1991],)d(\\Un)o(b)q(o)o(xed)j(v)m(alues)h(as)e(\014rst)g(class)h
(citizens,")g(in)187 2016 y Fb(F)l(unctional)j(Programming)d(Languages)h(and)
h(Computer)f(Arc)o(hitecture,)g(Boston)p Ft(,)g(Hughes,)187
2072 y(ed.,)15 b(LNCS)h(523,)d(Springer)k(V)l(erlag.)37 2171
y(SL)h(P)o(eyton)d(Jones)i(&)g(D)f(Lester)8 b([Ma)o(y)15 b(1991],)f(\\A)j(mo)
q(dular)f(fully-lazy)j(lam)o(b)q(da)e(lifter)g(in)g Fa(Haskell)p
Ft(,")187 2227 y Fb(Soft)o(w)o(are)d({)h(Practice)g(and)g(Exp)q(erience)e
Ft(21.)37 2326 y(SL)i(P)o(eyton)e(Jones)h(&)g(DR)f(Lester)8
b([1992],)j Fb(Implemen)o(ting)16 b(functional)e(languages:)g(a)f(tutorial)p
Ft(,)g(Pren)o(tice)187 2382 y(Hall.)37 2481 y(SL)h(P)o(eyton)e(Jones)h(&)f
(Jon)h(Salkild)d([Sept)i(1989],)f(\\The)h(Spineless)j(T)l(agless)e(G-mac)o
(hine,")f(in)i Fb(F)l(unctional)187 2537 y(Programming)22 b(Languages)g(and)h
(Computer)f(Arc)o(hitecture)s Ft(,)h(D)f(MacQueen,)i(ed.,)e(Addison)187
2594 y(W)l(esley.)37 2692 y(C)c(Runciman)i(&)f(D)f(W)l(ak)o(eling)8
b([April)19 b(1992],)d(\\Heap)i(pro\014ling)i(of)e(lazy)g(functional)i
(programs,")c(De-)187 2748 y(partmen)o(t)e(of)h(Computer)g(Science,)i(Univ)o
(ersit)o(y)e(of)g(Y)l(ork.)934 2921 y(79)p eop
%%Page: 80 80
bop 37 199 a Ft(P)24 b(Sansom)8 b([Aug)23 b(1991],)f(\\Com)o(bining)j(cop)o
(ying)f(and)g(compacting)g(garbage)f(collection,")i(in)g Fb(Pro)q(c)187
256 y(F)l(ourth)g(Ann)o(ual)i(Glasgo)o(w)e(W)l(orkshop)g(on)h(F)l(unctional)h
(Programming)t Ft(,)d(Springer)j(V)l(erlag)187 312 y(W)l(orkshops)15
b(in)h(Computer)e(Science.)37 411 y(Mark)h(Sc)o(heev)o(el)9
b([Aug)15 b(1986],)f(\\NORMA)i(-)f(a)g(graph)g(reduction)i(pro)q(cessor,")d
Fb(Pro)q(c)i(A)o(CM)e(Conference)187 467 y(on)h(Lisp)h(and)g(F)l(unctional)g
(Programming)t Ft(.)37 565 y(S)d(Smetsers,)e(E)i(No)q(c)o(k)o(er,)e(J)h(v)m
(an)h(Groningen)g(&)f(R)h(Plasmeijer)8 b([Sept)k(1991],)e(\\Generating)i
(e\016cien)o(t)h(co)q(de)187 622 y(for)h(lazy)g(functional)i(languages,")e
(in)h Fb(F)l(unctional)g(Programming)f(Languages)g(and)g(Computer)187
678 y(Arc)o(hitecture,)h(Boston)p Ft(,)g(Hughes,)g(ed.,)g(LNCS)h(523,)e
(Springer)i(V)l(erlag.)37 777 y(RM)c(Stallman)d([F)l(eb)i(1992],)f(\\Using)i
(and)g(p)q(orting)g(Gn)o(u)g(CC,)f(V)l(ersion)h(2.0,")f(F)l(ree)g(Soft)o(w)o
(are)g(F)l(oundation)187 833 y(Inc.)37 932 y(GL)17 b(Steele)9
b([1978],)14 b(\\Rabbit:)j(a)f(compiler)h(for)f(Sc)o(heme,")h(AI-TR-474,)f
(MIT)g(Lab)h(for)f(Computer)g(Sci-)187 988 y(ence.)37 1087
y(William)f(Sto)o(y)o(e,)c(Thomas)h(Clark)o(e)g(&)h(Arth)o(ur)f(Norman)7
b([August)12 b(1984],)f(\\Some)h(practical)h(metho)q(ds)g(for)187
1143 y(rapid)k(com)o(binator)f(reduction,")h(in)h Fb(Pro)q(c)f(1984)e(A)o(CM)
h(symp)q(osium)h(on)g(Lisp)h(and)f(functional)187 1200 y(programming)t
Ft(,)d(159{166.)37 1298 y(D)g(T)l(arditi,)g(A)g(Ac)o(hary)o(a)f(&)h(P)g(Lee)9
b([Marc)o(h)j(1991],)g(\\No)i(assem)o(bly)g(required:)g(compiling)i(Standard)
e(ML)187 1354 y(to)g(C,")h(Sc)o(ho)q(ol)h(of)f(Computer)f(Science,)j
(Carnegie)f(Mellon)g(Univ)o(ersit)o(y.)37 1453 y(AP)h(T)l(olmac)o(h)h(&)f(A)
-5 b(W)17 b(App)q(el)9 b([June)18 b(1990],)d(\\Debugging)i(Standard)g(ML)g
(without)g(rev)o(erse)g(engineer-)187 1509 y(ing,")e(in)h Fb(Pro)q(c)f(A)o
(CM)g(Conference)g(on)g(Lisp)i(and)e(F)l(unctional)i(Programming,)c(Nice)s
Ft(,)j(A)o(CM.)37 1608 y(D)o(A)22 b(T)l(urner)8 b([1979],)20
b(\\A)h(new)i(implemen)o(tation)g(tec)o(hnique)g(for)e(applicativ)o(e)j
(languages,")d Fb(Soft)o(w)o(are)187 1664 y(Practice)15 b(and)h(Exp)q
(erience)c Ft(9,)i(31{49.)37 1763 y(P)g(W)l(adler)8 b([1987],)j(\\E\016cien)o
(t)j(compilation)g(of)f(pattern)g(matc)o(hing,")g(in)h Fb(The)g(implemen)o
(tation)g(of)f(func-)187 1819 y(tional)j(programming)e(languages)r
Ft(,)h(SL)h(P)o(eyton)f(Jones,)g(ed.,)g(Pren)o(tice)g(Hall,)h(78{103.)934
2921 y(80)p eop
%%Page: 81 81
bop 37 199 a Ft(PR)25 b(Wilson,)g(MS)f(Lam)g(&)h(TG)f(Moher)7
b([Jan)24 b(1992],)e(\\Cac)o(hing)j(considerations)g(for)e(generational)187
256 y(garbage)14 b(collection,")j(Departmen)o(t)d(of)h(Computer)f(Science,)j
(Univ)o(ersit)o(y)f(of)f(T)l(exas.)37 428 y Fs(A)68 b(The)22
b(gory)g(details)37 559 y Ft(This)15 b(app)q(endix)g(con)o(tains)f(gory)f
(implemen)o(tation-sp)q(eci\014c)k(notes)d(for)f(the)h(Glasgo)o(w)e(Hask)o
(ell)j(compiler.)37 645 y Fn(T)m(oDo:)21 b(add)c(some)f(stu\013)h(ab)n(out)f
(stack)g(stubbing.)37 797 y Fm(A.1)56 b(Up)r(date)19 b(\015ags)37
912 y Ft(There)d(are)f(really)h(three)f(kinds)h(of)f(up)q(date)h(\015ag:)106
1035 y Fo(\017)22 b Fn(Up)n(datable.)e Ft(Up)q(date)c(me)f(with)h(m)o(y)e
(normal)i(form.)106 1129 y Fo(\017)22 b Fn(Single-entry.)d
Ft(Don't)13 b(up)q(date)j(me)e(with)i(m)o(y)e(normal)h(form,)e(but)i(y)o(ou)g
(can)f(o)o(v)o(erwrite)g(me)h(with)g(a)151 1186 y(blac)o(k)h(hole)g(to)e
(prev)o(en)o(t)h(a)g(space)h(leak.)k(I)c(promise)f(I)h(will)h(b)q(e)e(en)o
(tered)h(at)f(most)f(once.)106 1279 y Fo(\017)22 b Fn(R)n(e)n(entr)n(ant.)32
b Ft(Don't)19 b(up)q(date)h(me)f(with)h(m)o(y)f(normal)h(form,)f(or)h(with)f
(a)h(blac)o(k)g(hole.)33 b(I)20 b(ma)o(y)f(b)q(e)151 1336 y(en)o(tered)11
b(\(and)f(re-ev)m(aluated\))h(more)f(than)g(once.)18 b(Manifest)11
b(functions,)g(constructors,)f(and)h(partial)151 1392 y(applications)i(are)e
(alw)o(a)o(ys)f(reen)o(tran)o(t.)18 b(Note)11 b(that)f(the)i(latter)e(t)o(w)o
(o)g(ha)o(v)o(e)h(zero)g(argumen)o(ts,)g(so)g(zero-)151 1449
y(arg)k(things)g(ma)o(y)g(b)q(e)h(reen)o(tran)o(t.)37 1600
y Fm(A.2)56 b(Blac)n(k)19 b(holes)37 1715 y Ft(There)d(are)f(three)g(reasons)
g(for)f(o)o(v)o(erwriting)h(a)g(th)o(unk)g(with)h(a)f(blac)o(k)h(hole)g
(immediately)g(it)g(is)g(en)o(tered:)106 1839 y Fo(\017)22
b Ft(T)l(o)15 b(prev)o(en)o(t)g(space)h(leaks.)106 1933 y Fo(\017)22
b Ft(T)l(o)15 b(giv)o(e)g(a)g(b)q(etter)h(error)e(message)h(when)h(there's)e
(an)h(in\014nite)j(lo)q(op.)106 2026 y Fo(\017)k Ft(T)l(o)15
b(do)g(thread)g(sync)o(hronisation)h(in)g(a)f(parallel)i(system.)37
2150 y(The)g(\014rst)f(t)o(w)o(o)f(can)h(b)q(e)h(dealt)g(with)f(in)h(a)f
(di\013eren)o(t)h(w)o(a)o(y)e(b)o(y)h(the)g(garbage)g(collector.)23
b(Space)17 b(leaks)g(can)37 2206 y(b)q(e)h(prev)o(en)o(ted)e(b)o(y)h(blac)o
(k-holing)h(the)f(things)f(on)h(the)f(up)q(date)h(stac)o(k)f
Fn(at)i(GC)f(time)p Ft(.)24 b(In\014nite)18 b(lo)q(ops)f(can)37
2263 y(b)q(e)i(detected)f(b)o(y)f(a)g(p)q(ost-mortem)f(on)i(the)f(up)q(date)h
(stac)o(k,)f(follo)o(wing)h(a)f(stac)o(k)f(o)o(v)o(er\015o)o(w.)25
b(So)18 b(un)o(til)g(w)o(e)37 2319 y(need)f(parallelism,)f(blac)o(k-holing)h
(is)f(a)f(w)o(aste)f(of)h(instructions.)37 2470 y Fm(A.3)56
b(Adding)19 b(\014llers)37 2586 y Ft(The)d(great)f(in)o(v)m(arian)o(t)i(is)f
(this:)21 b(if)c(a)e(closure)h(is)h(to)e(b)q(e)h(mo)q(di\014ed,)h(either)g(b)
o(y)e(b)q(eing)i(o)o(v)o(erwritten)e(with)h(a)37 2642 y(blac)o(k)g(hole,)f
(or)f(b)o(y)h(up)q(dating,)h(a)e(\014ller)j(is)e(written)g(o)o(v)o(er)f(the)h
(\\tail")g(of)f(the)h(closure,)g(so)g(that)f(the)h(initial)37
2699 y(segmen)o(t)g(is)h(exactly)g Fp(FIXED_HDR_SIZE)n Ft(+)p
Fp(MIN_UPD_SIZE)d Ft(w)o(ords)i(long.)934 2921 y(81)p eop
%%Page: 82 82
bop 37 199 a Fp(MIN_UPD_SIZE)17 b Ft(is)j(at)e(least)g(2,)h(to)f(allo)o(w)h
(for)f(cons)h(cells)h(and)f(link)o(ed)h(indirections.)32 b(Another)19
b(truth:)37 256 y Fp(GEN)14 b Ft(ob)s(jects)f(are)h(alw)o(a)o(ys)g(bigger)g
(than)g Fp(FIXED_HDR_SIZE)n Ft(+)p Fp(MIN_UPD_SIZE)o Ft(+2;)g(that)f(lea)o(v)
o(es)h(ro)q(om)g(for)37 312 y(a)h Fp(GEN)g Ft(\014ller)i(follo)o(wing)f(a)f
(min-size)i(closure)e(slot.)37 398 y(That)c(means)g(that)g(the)g(blac)o(k)g
(hole)h(and)g(up)q(date)f(co)q(de)h(ha)o(v)o(e)f(a)g(w)o(ell-de\014ned)i
(\014xed-size)g(thing)f(to)f(mo)q(dify)l(.)37 484 y(All)17
b(suc)o(h)f(closures)f(are)g(th)o(unks,)g(of)g(either)h Fp(SPEC)e
Ft(or)h Fp(GEN)g Ft(form.)k(If)c(the)h(latter,)e(the)h(\014ller)i(is)f(set)f
(with)228 570 y Fp(SET_GEN_FILLER\()22 b(Node,)h(slop)h(\))37
656 y Ft(where)16 b Fp(slop)f Ft(is)g(the)h(size)g(of)e(the)i(closure)g
(\(excl)f(\014xed)h(hdr,)f(of)g(course\))g Fo(\000)h Fp(MIN_UPD_SIZE)n
Ft(.)37 742 y(If)c(the)e(closure)i(is)f(of)f Fp(SPEC)h Ft(form,)f(and)h
(there)g(are)f(more)h(than)f Fp(MIN_UPD_SIZE)g Ft(w)o(ords)g(of)g(ptrs)g(+)h
(non-ptrs,)37 799 y(the)16 b(\014ller)g(is)g(set)f(with)228
885 y Fp(SET_SPEC_FILLER\()22 b(Node,)h(slop)h(\))37 970 y
Ft(where)16 b Fp(slop)e Ft(is)h(the)g(size)h(of)e(the)h(closure)g(-)g
Fp(MIN_UPD_SIZE)o Ft(.)k(In)d(the)f Fp(SPEC)f Ft(case,)g(the)h(slop)g
(argumen)o(t)f(is)37 1027 y(guaran)o(teed)j(to)g(b)q(e)h(an)f(in)o(teger,)h
(so)f(can)g(b)q(e)h(used)g(in)g(building)i(a)d(lab)q(el.)28
b(\(Remem)o(b)q(er,)18 b Fp(SPEC)e Ft(closures)37 1083 y(ha)o(v)o(e)d(no)g(v)
m(ariable)h(header,)f(so)g(the)g(size)h(is)f(just)g(ptrs)f(+)i(non-ptrs,)f
(whic)o(h)g(the)g(compiler)h(can)f(calculate.\))37 1169 y(All)j(this)e(is)g
(done)g(at)f(the)h(end)g(of)g(the)g(basic)g(blo)q(c)o(k,)g(just)g(b)q(efore)g
Fp(Node)f Ft(is)h(discarded)h(\(or)e(assigned\).)20 b(But)37
1226 y(if)c Fp(Node)f Ft(is)g(b)q(eing)i(loaded)f(from)e(the)i(closure)g
(itself)g(w)o(e)f(ha)o(v)o(e)f(to)h(go)f(via)i(a)f(temp)q(orary)l(,)f(so)h(w)
o(e)g(need:)228 1312 y Fp(SET_GEN_FILLER_AND_LOAD_NODE\()20
b(Node,)j(final_node,)g(size)g(\))228 1368 y(SET_SPEC_FILLER_AND_LOAD_NODE)o
(\()e(Node,)i(final_node,)g(size)g(\))37 1454 y Ft(If)14 b(one-space)h
(collection)g(isn't)f(b)q(eing)h(done,)f(these)g(\014ller)h(macros)e
(generate)h(nothing)g(\(except)g(of)f(course)37 1511 y(the)j
Fp(LOAD_NODE)e Ft(v)m(arian)o(ts)h(still)h(load)g Fp(Node)o
Ft(\).)37 1659 y Fm(A.4)56 b(P)n(erforming)18 b(up)r(dates)37
1775 y Ft(The)e(up)q(date-p)q(erforming)g(co)q(de)g(b)q(eha)o(v)o(es)g(as)e
(follo)o(ws:)106 1883 y Fo(\017)22 b Fn(If)16 b(the)g(new)g(closur)n(e)g(do)n
(esn)-5 b('t)16 b(\014t)g(in)g(a)g(min-size)f(closur)n(e)h(slot:)533
1978 y Fp(Allocate)23 b(the)g(new)h(object)f(from)g(the)g(heap)533
2035 y(UPD_IND\()g(&Hp[-xxx],)f(HeapCheck_xxxLive)g(\))106
2186 y Fo(\017)g Fn(If)16 b(the)g(new)g(closur)n(e)g(\014ts)g(in)f(a)i
(min-size)e(closur)n(e)h(slot:)533 2281 y Fp(UPD_INPLACE\()22
b(UpdPtr,)h(HeapCheck_xxxLive)f(\))533 2338 y(Fill)h(in)h(UpdPtr[0...])533
2394 y(if)g(incompletely)e(filled,)h(use)g(SET_UPD_FILLER\()f(UpdPtr,)h(slop)
g(\))151 2546 y Ft(In)11 b(generational)g(GC)f(the)h Fp(UPD_INPLACE)e
Ft(co)q(de)i(c)o(hec)o(ks)g(for)f(a)g(old-gen)i(up)q(date,)f(and)g(if)g(so)f
(allo)q(cates)151 2602 y(a)17 b(min-size)h(closure)g(in)g(new-space,)f(up)q
(dates)h(the)f(old-gen)h(thing)f(with)g(a)g(p)q(oin)o(ter)g(to)g(the)g(new-)
151 2659 y(space)f(thing,)f(and)g(mak)o(es)g(Up)q(dPtr)g(p)q(oin)o(t)h(to)f
(it.)151 2731 y(The)h Fp(SET_UPD_FILLER)e Ft(\014lls)j(in)g(an)o(y)e
(remaining)i(slop.)22 b(The)16 b Fp(slop)f Ft(argumen)o(t)g(is)h(guaran)o
(teed)g(to)151 2787 y(b)q(e)g(an)f(in)o(teger.)934 2921 y(82)p
eop
%%Page: 83 83
bop 37 199 a Fm(A.5)56 b(Lam)n(b)r(da-form)17 b(info)37 315
y Ft(No)o(w)e(w)o(e)h(are)f(ready)h(to)f(summarise)g(the)h(\(remark)m(ably)g
(subtle\))g(questions)g(of)f(en)o(try)h(and)f(up)q(date)i(con-)37
371 y(v)o(en)o(tions.)p 37 406 1760 2 v 36 463 2 57 v 386 463
V 412 446 a(Reen)o(tran)o(t)p 796 463 V 212 w(Up)q(datable)p
1296 463 V 294 w(Single-en)o(try)p 1796 463 V 37 465 1760 2
v 36 690 2 226 v 62 504 a(No)q(de)100 b(m)o(ust)62 560 y(p)q(oin)o(t)16
b(to)f(it)p 386 690 V 412 504 a(If)24 b(has)g(fvs;)j(or)d(ar-)412
560 y(it)o(y=0)36 b(and)g(using)412 617 y(cost)20 b(cen)o(tres)g(\(note)412
673 y(9,12\))p 796 690 V 822 504 a(Y)l(es)c(\(note)e(6\))p
1296 690 V 257 w(If)e(has)g(fvs)g(or)f(using)i(cost-)1322 560
y(cen)o(tres)i(\(note)g(9\))p 1796 690 V 37 692 1760 2 v 36
805 2 113 v 62 731 a(Can)32 b(jump)g(di-)62 788 y(rect)15 b(to)g(co)q(de)p
386 805 V 412 731 a(Y)l(es)h(\(note)e(8\))p 796 805 V 167 w(No)p
1296 805 V 443 w(Y)l(es)p 1796 805 V 37 807 1760 2 v 36 919
2 113 v 62 846 a(Push)64 b(up)q(date)62 903 y(frame)p 386 919
V 412 846 a(No)p 796 919 V 353 w(Y)l(es)16 b(\(note)e(5\))p
1296 919 V 257 w(No)p 1796 919 V 37 921 1760 2 v 36 1034 2
113 v 62 961 a(Blac)o(k)31 b(hole)g(on)62 1017 y(en)o(try)15
b(\(note)g(7\))p 386 1034 V 412 961 a(No)p 796 1034 V 353 w(Optional)h
(\(notes)f(2,3\))p 1296 1034 V 97 w(i\013)g(has)g(fvs)g(\(notes)g(4\))p
1796 1034 V 36 1090 2 57 v 386 1090 V 796 1090 V 822 1074 a
Fp(UPD_BH_UPDATABLE)p 1296 1090 V 116 w(UPD_BH_SINGLE_ENTRY)p
1796 1090 V 37 1092 1760 2 v 36 1205 2 113 v 62 1132 a Ft(Use)k(\014ller)g
(\(if)g(1s)62 1188 y(gc\))p 386 1205 V 412 1132 a(No)p 796
1205 V 353 w(Y)l(es,)13 b(unless)g(static)f(\(note)822 1188
y(11\))p 1296 1205 V 1322 1132 a(I\013)j(has)g(fvs)g(\(note)g(10\))p
1796 1205 V 36 1262 2 57 v 386 1262 V 796 1262 V 822 1245 a
Fp(SET_xxx_FILLER)p 1296 1262 V 164 w Ft(ditto)p 1796 1262
V 37 1263 1760 2 v 37 1366 a Fr(Note)j(1.)23 b Ft(W)l(e)14
b(NO)h(LONGER)h(assume)e(that)g(an)o(y)g(closure)h(with)g(no)f(free)h(v)m
(ariables)h(is)f(allo)q(cated)g(stati-)151 1422 y(cally)l(.)21
b(Ho)o(w)o(ev)o(er,)14 b(w)o(e)h(do)g(assume)g(that)g(\(HAS)g(FVS)g(implies)j
(NOT)d(ST)l(A)l(TIC\).)37 1516 y Fr(Note)j(2.)23 b Ft(W)l(e)12
b(nev)o(er)g(blac)o(k-hole)h(an)f(up)q(datable)i(static)d(closure.)20
b(Instead,)13 b(it)f(will)i(b)q(e)e(o)o(v)o(erwritten)g(with)151
1573 y(a)j(CAFList)g(cell)i(p)q(oin)o(ting)g(to)d(a)h(newly)h(allo)q(cated)g
(blac)o(k)g(hole.)37 1666 y Fr(Note)i(3.)23 b Ft(Blac)o(k-holing)e(can)e(b)q
(e)i(done)e(b)o(y)h(the)f(garbage)g(collector)h(\(b)o(y)f(running)i(do)o(wn)e
(the)g(up)q(date)151 1723 y(stac)o(k)f(and)h(blac)o(k-holing)h(an)o(y)e(p)q
(ending)i(up)q(datees\);)g(and)f(in\014nite)h(lo)q(ops)f(detected)g(b)o(y)g
(a)f(p)q(ost-)151 1779 y(mortem)c(on)i(the)f(up)q(date)h(stac)o(k.)37
1873 y Fr(Note)i(4.)23 b Ft(A)18 b(single-en)o(try)h(closure)g(whic)o(h)f
(has)g(free)g(v)m(ars)g(is)h(*alw)o(a)o(ys*)e(blac)o(k-holed,)j(to)d(a)o(v)o
(oid)h(space)151 1929 y(leaks.)23 b(The)17 b(tric)o(k)f(men)o(tioned)h(in)g
(Note)f(3)g(do)q(esn't)g(w)o(ork)f(for)g(them)i(b)q(ecause)g(they)f(don't)g
(sit)g(on)151 1986 y(the)f(up)q(date)h(stac)o(k.)151 2061 y(One)j(could)f
(argue)f(that)g(space)h(leaks)g(from)f(omitting)h(the)g(blac)o(k-hole)h(for)e
(single-en)o(try)i(things)151 2118 y(are)c(similar)h(to)f(other)g(una)o(v)o
(oidable)h(space)f(leaks,)h(but)f(w)o(e)g(don't;)f(w)o(e)h(blac)o(k-hole)i
(them.)151 2193 y(A)f(single-en)o(try)g(closure)g(with)g(no)f(fvs)h(is)f
(*nev)o(er*)g(blac)o(k-holed;)i(it)f(cannot)f(giv)o(e)h(rise)g(to)f(a)g
(space)151 2249 y(leak,)24 b(and)e(w)o(e)g(trust)g(the)g(single-en)o(try)h
(\015ag)f(whic)o(h)h(should)g(mean)f(it)g(can't)g(form)f(part)h(of)f(a)151
2306 y(lo)q(op.)28 b(\(Ev)o(en)18 b(if)g(that's)f(not)h(true,)g(the)f(up)q
(date)i(stac)o(k)e(p)q(ost-mortem)g(w)o(ould)h(rev)o(eal)g(the)g(lo)q(op.\))
151 2362 y(Notice)g(that)f(this)h(means)g(that)e(static)i(single-en)o(try)h
(closures)f(\(whic)o(h)g(ha)o(v)o(e)f(no)h(fvs\))f(are)g(nev)o(er)151
2418 y(blac)o(k-holed.)37 2512 y Fr(Note)h(5.)23 b Ft(F)l(or)18
b(up)q(datable)h(static)g(closures,)h(the)e(up)q(date)i(frame)e(will)i(p)q
(oin)o(t)f(to)f(the)h(newly-allo)q(cated)151 2569 y(blac)o(k)d(hole.)37
2663 y Fr(Note)i(6.)23 b Ft(If)18 b(a)g(closure)g(is)h(up)q(datable,)h(No)q
(de)e(m)o(ust)g(b)q(e)g(made)h(to)e(p)q(oin)o(t)h(to)g(it,)h(ev)o(en)f(if)h
(it)f(is)g(a)g(static)151 2719 y(no-fv)h(closure.)31 b(Reason:)c(it)19
b(ma)o(y)f(ha)o(v)o(e)g(b)q(een)i(up)q(dated)f(with)g(a)g(CAF)f(indirection.)
33 b(W)l(e)18 b(ha)o(v)o(e)151 2775 y(to)g(indirect)h(via)f(the)h(closure)f
(to)g(get)f(the)h(en)o(try)g(co)q(de)h(an)o(yw)o(a)o(y)d(\(b)q(ecause)j(it)f
(migh)o(t)g(ha)o(v)o(e)g(b)q(een)934 2921 y(83)p eop
%%Page: 84 84
bop 151 199 a Ft(up)q(dated\),)20 b(so)e(it)h(is)h(no)e(big)i(deal)f(to)f
(load)i(No)q(de)f(to)q(o.)30 b(In)19 b(theory)g(w)o(e)f(could)i(ha)o(v)o(e)e
(a)h(di\013eren)o(t)151 256 y(CAF)13 b(indirection)j(co)q(de)e(for)e(eac)o(h)
i(CAF,)e(whic)o(h)i("kno)o(ws")f(the)g(closure)h(address,)f(but)h(it)f(sa)o
(v)o(es)g(no)151 312 y(time.)37 399 y Fr(Note)18 b(7.)23 b
Ft(The)17 b(no)q(de-m)o(ust-p)q(oin)o(t-to-it)h(conditions)h(ensure)f(that)f
(No)q(de)g(alw)o(a)o(ys)g(p)q(oin)o(ts)h(to)e(a)h(closure)151
456 y(whic)o(h)f(is)g(to)e(b)q(e)i(blac)o(k-holed.)37 543 y
Fr(Note)i(8.)23 b Ft(F)l(or)15 b(reen)o(tran)o(t)f(things)i(with)g(arit)o(y)g
(>)g(0,)f(there)g(is)i(still)g(a)e(c)o(hoice)i(as)e(to)g(whether)h(to)f(jump)
h(to)151 600 y(the)f(fast)g(or)f(slo)o(w)h(en)o(try)g(p)q(oin)o(t,)h(dep)q
(ending)h(on)e(ho)o(w)g(man)o(y)g(args)f(the)h(thing)h(is)g(applied)h(to.)37
687 y Fr(Note)h(9.)23 b Ft(When)16 b(cost-cen)o(tre)g(pro\014ling,)g(No)q(de)
h(m)o(ust)e(p)q(oin)o(t)i(to)e(an)o(ything)h(whic)o(h)h(isn't)f(a)f(HNF)h
(\(ev)o(en)151 743 y(if)g(it)f(has)g(no)g(fvs\))g(,)g(so)g(that)f(the)h(cost)
g(cen)o(tre)g(can)h(b)q(e)g(extracted)e(from)h(the)g(closure.)37
831 y Fr(Note)j(10.)23 b Ft(Single-en)o(try)c(closures)g(only)f(need)h(a)e
(\014ller)j(if)e(they)g(ha)o(v)o(e)f(b)q(een)i(blac)o(k-holed.)30
b(Hence)19 b(the)151 887 y(condition.)i(\(NB)15 b(fvs)g(implies)j(not)c
(static.\))37 974 y Fr(Note)k(11.)23 b Ft(Static)18 b(up)q(datable)h
(closures)f(don't)f(need)i(a)f(\014ller,)h(b)q(ecause)g(the)f(blac)o(k)g
(hole)h(freshly)f(allo-)151 1031 y(cated)d(for)g(them)g(is)h(already)f(the)h
(standard)e(size.)37 1118 y Fr(Note)k(12.)23 b Ft(This)c(rule)g(sa)o(ys)e
(that)h(No)q(de)h(do)q(esn't)f(need)h(to)f(p)q(oin)o(t)h(to)e(no-fv)i
(closures)f(with)h(arit)o(y)f(>)h(0.)151 1175 y(But)c(that)g(could)h(b)q(e)g
(a)f(problem)g(b)q(ecause)i(suc)o(h)e(things)h(ha)o(v)o(e)e(an)i(argumen)o
(t-satisfaction)e(c)o(hec)o(k,)151 1231 y(whic)o(h)20 b(needs)g(to)f(kno)o(w)
f(where)i(the)f(closure)h(is.)32 b(W)l(e)19 b(solv)o(e)h(this)f(b)o(y)h(allo)
q(cating)g(suc)o(h)f(closures)151 1288 y(statically:)i(this)15
b(can't)f(result)i(in)f(a)g(space)g(leak)g(b)q(ecause)h(they)f(are)g(HNFs)f
(already)h(and)h(ha)o(v)o(e)e(no)151 1344 y(fvs;)h(nor)g(can)g(it)g(result)h
(in)g(loss)f(of)g(laziness.)37 1451 y(Imp)q(orted)i(things)g(whic)o(h)g(w)o
(e)e(kno)o(w)h(nothing)h(ab)q(out)f(are)f(en)o(tered)i(as)f(if)g(they)g(w)o
(ere)g(up)q(datable)i(things)37 1508 y(with)e(no)f(free)g(v)m(ars.)37
1656 y Fm(A.6)56 b(Stac)n(k)19 b(stubbing)37 1771 y Ft(Blac)o(k)h(holing)g
(closures)f(is)h(a)e(w)o(a)o(y)g(to)h(a)o(v)o(oid)f(space)i(leaks,)f(but)g
(there)g(is)h(another)e(imp)q(ortan)o(t)h(source)37 1828 y(whic)o(h)i(is)e
(not)g(caugh)o(t)g(thereb)o(y)l(,)h(namely)g(p)q(oin)o(ters)f(on)h(the)f
(stac)o(k)f(whic)o(h)i(happ)q(en)h(to)d(b)q(e)i(dead.)33 b(F)l(or)37
1884 y(example)228 1970 y Fp(f)24 b(x)g(=)g(case)f(x)h(of)f(...not)g
(involving)g(x...)37 2056 y Ft(Here)16 b Fp(x)f Ft(is)h(passed)f(to)g
Fp(f)g Ft(on)g(the)g(stac)o(k,)f(but)h(is)h(dead)g(as)f(so)q(on)g(as)f(it)i
(is)g(en)o(tered.)37 2142 y(The)g(simplest)g(solution)g(is:)106
2249 y Fo(\017)22 b Ft(Just)e(b)q(efore)g(ev)o(ery)f(tail)h(call,)i(o)o(v)o
(erwrite)d(an)o(y)g(stac)o(k-held)h(ptrs)g(whic)o(h)g(are)f(no)o(w)g(dead)h
(with)g(a)151 2305 y(p)q(oin)o(ter)c(to)f(a)g(sp)q(ecial)j
Fp(Stub)d Ft(closure.)21 b Fp(Stub)15 b Ft(is)h(a)f(static)h(closure)g(with)g
(no)f(p)q(oin)o(ters)h(inside)i(it,)d(so)151 2362 y(it)h(plugs)g(an)o(y)e
(space)i(leak.)151 2434 y(The)g(en)o(try)f(co)q(de)h(for)f
Fp(Stub)g Ft(elicits)i(an)f(error)e(message,)h(b)q(ecause)h(the)g(stac)o(k)f
(slot)g(is)h(supp)q(osed)h(to)151 2490 y(b)q(e)f(dead.)37 2597
y(Ho)o(w)d(do)g(w)o(e)g(kno)o(w)g(whic)o(h)h(slots)f(are)g(dead?)21
b(Because)14 b(they)f(are)g(b)q(ound)h(to)f(v)m(ariables)h(whic)o(h)g(aren't)
f(free)37 2654 y(in)k(the)e(con)o(tin)o(uation.)37 2740 y(Unfortunately)l(,)
20 b(this)g(stac)o(k-stubbing)f(tak)o(es)f(instructions)i(to)e(p)q(erform.)31
b(W)l(e)19 b(can)g(impro)o(v)o(e)g(matters)37 2796 y(somewhat:)934
2921 y(84)p eop
%%Page: 85 85
bop 106 199 a Fo(\017)22 b Ft(Use)17 b(dead)g(stac)o(k)e(slots)i(to)f(sa)o(v)
o(e)f(v)o(olatile)j(v)m(ariables)g(in)f(for)f(a)g Fp(case)g
Ft(expression.)25 b(Not)16 b(only)h(do)q(es)151 256 y(this)f(mean)f(that)f
(few)o(er)h(slots)g(need)h(to)f(b)q(e)h(stubb)q(ed,)g(but)f(it)g(also)h
(reduces)g(stac)o(k)e(gro)o(wth.)37 379 y(There)e(is)g(one)g(w)o(a)o(y)f(of)g
(a)o(v)o(oiding)h(the)f(remaining)i(stac)o(k-stubbing)f(instructions,)h
(namely)f(b)o(y)f(attac)o(hing)g(a)37 436 y(bit-mask)j(to)f(return)h(\(v)o
(ector\))e(addresses)i(pushed)g(on)g(the)f(B)h(stac)o(k,)f(whic)o(h)h(iden)o
(tify)h(the)f(dead)f(A-stac)o(k)37 492 y(p)q(oin)o(ters.)29
b(This)18 b(is)g(quite)h(a)e(bit)i(more)e(w)o(ork,)g(so)h(w)o(e)f(don't)g(do)
h(it)g(at)f(presen)o(t)h(|)g(but)g(w)o(e)g(coun)o(t)f(ho)o(w)37
548 y(man)o(y)e(stubbing)h(instructions)g(w)o(e)f(execute.)37
698 y Fr(A.6.1)52 b(Implemen)o(tation)37 813 y Ft(W)l(e)16
b(need)g(to)e(k)o(eep)i(extra)e(information)i(in)g(the)f(co)q(de)h(generator)
e(state:)93 937 y(1.)22 b(W)l(e)16 b(need)g(to)f(k)o(eep)h(trac)o(k)f(of)g
(whic)o(h)h(A-stac)o(k)f(slots)h(are)f(used)h(for)f(what)g(purp)q(ose;)h(in)h
(particular,)151 993 y(whic)o(h)f(slots)f(are)g(used)h(to)e(store)h(whic)o(h)
h(v)m(ariables.)151 1068 y(This)f(info)g(is)g(used)g(when)g(sa)o(ving)g(v)o
(olatile)g(v)m(ariables)h(\(at)d(a)h Fp(case)g Ft(expression\),)h(to)f(iden)o
(tify)i(dead)151 1125 y(slots,)f(and)g(at)g(a)g(tail)g(call)i(to)d(iden)o
(tify)j(slots)e(whic)o(h)h(m)o(ust)e(b)q(e)i(stubb)q(ed.)151
1200 y(W)l(e)j(can)g(do)g(this)g(just)f(b)o(y)h(adding)h(an)e(extra)g(comp)q
(onen)o(t)h(to)g(the)f(co)q(de)i(generator)e(state,)g(car-)151
1256 y(ried)g(around)g(b)o(y)f(the)g(monad,)h(and)f(making)h(sure)f(w)o(e)g
(k)o(eep)h(it)g(up)g(to)e(date)i(when)f(w)o(e)h(alter)f(the)151
1313 y(en)o(vironmen)o(t.)93 1407 y(2.)22 b(When)f(compiling)h(a)e(tail)g
(call)i(w)o(e)d(need)i(to)f(kno)o(w)g(whic)o(h)h(v)m(ariables,)h(if)f(an)o(y)
e(are)h(used)h(in)g(the)151 1463 y(con)o(tin)o(uation)e(\(if)g(an)o(y\))f(so)
g(that)g(an)o(y)g(others)h(o)q(ccup)o(ying)h(stac)o(k)d(slots)i(b)q(elo)o(w)g
(the)g(tail-call)h Fp(SpA)151 1519 y Ft(can)15 b(b)q(e)h(stubb)q(ed.)151
1595 y(This)f(is)h(easy)e(to)q(o:)19 b(just)14 b(add)h(a)f(piece)i(of)f
(inherited)h(information)f(to)f(the)h(monad)f(rather)g(lik)o(e)i(the)151
1651 y(set-\014ller)g(stu\013.)j(The)c(di\013erence)h(is)f(that)f(at)f(a)i
Fp(case)f Ft(expression)h(the)g(needed-v)m(ar)h(info)f(go)q(es)f(in)o(to)151
1708 y(the)h(case)h Fn(br)n(anches)e Ft(rather)h(than)g(in)o(to)g(the)g
Fn(scrutine)n(e)p Ft(.)37 1831 y(The)h(sc)o(heme)f(so)g(far)g(is)h(sligh)o
(tly)g(p)q(essimistic.)22 b(Consider)16 b(the)f(expresion)228
1917 y Fp(f)24 b(x)g(=)g(let)f(y)h(=)f(...)h(in)372 1973 y(case)f(x)h(of)419
2030 y(...y...)37 2116 y Ft(The)16 b(co)q(de)g(generated)f(for)g(this)g(is:)
228 2202 y Fp(Allocate)23 b(y)228 2258 y(Save)h(y)f(on)h(the)f(stack)228
2315 y(Push)h(the)f(continuation)228 2371 y(Enter)h(x)37 2457
y Ft(No)o(w,)17 b(since)h Fp(x)e Ft(is)i(still)g(liv)o(e)g(at)e(the)h(p)q
(oin)o(t)g(w)o(e)g(sa)o(v)o(e)f Fp(y)p Ft(,)h(w)o(e)f(will)j(allo)q(cate)e(a)
g(new)g(stac)o(k)f(slot)h(for)f Fp(y)p Ft(,)h(and)37 2514 y(ha)o(v)o(e)h(to)e
(stub)i(the)f Fp(x)h Ft(slot)f(just)g(b)q(efore)h(en)o(tering)g
Fp(x)o Ft(.)27 b(It)17 b(w)o(ould)h(b)q(e)g(b)q(etter)g(to)e(sa)o(v)o(e)h
Fp(y)g Ft(in)i Fp(x)o Ft('s)e(slot.)27 b(W)l(e)37 2570 y(can)19
b(sp)q(ot)f(this)h(as)f(a)g(sp)q(ecial)i(case,)f(p)q(erhaps)g(including)i
(the)e(sligh)o(tly)g(more)f(general)h(case)f(where)h(the)37
2626 y(scrutinee)e(is)f(a)e(function)i(application.)934 2921
y(85)p eop
%%Page: 86 86
bop 37 264 a Fs(Index)37 354 y Fo(h)p Fq(\027;)8 b Fn(G)t Fo(i)p
Ft(-mac)o(hine,)16 b(14,)e(15)37 452 y(A-stac)o(k,)h(51)37
509 y(ABC)h(mac)o(hine,)f(5,)g(14)37 565 y(Abstract)g(C,)g(8,)f(52)37
622 y(activ)m(ation)i(frame,)f(15,)f(31)37 678 y(address,)h(32,)g(45)37
735 y(algebraic)i(data)d(t)o(yp)q(e,)h(29)37 791 y(allo)q(cation,)h(58)37
847 y(argumen)o(t)f(satisfaction)g(c)o(hec)o(k,)g(38,)f(58,)h(66)37
904 y(argumen)o(t)g(stac)o(k,)f(32,)g(50)37 960 y(arithmetic,)i(28,)e(64)37
1058 y(B-stac)o(k,)h(51)37 1115 y(blac)o(k)h(holes,)g(12,)e(59)37
1171 y(built-in)k(op)q(eration,)d(52)37 1269 y(cac)o(he,)h(15)37
1326 y(CAF)f(list,)h(73)37 1382 y(CAFs,)f(73)37 1439 y Fp(call/cc)p
Ft(,)f(15)37 1495 y Fp(case)h Ft(expression,)h(16)37 1551 y
Fp(case)f Ft(expressions,)h(19)37 1608 y(cell)h(mo)q(del,)f(11)37
1664 y(closure,)g(9)37 1721 y(closure)g(mo)q(de,)f(12)37 1777
y(closures,)h(12,)e(32,)g(45)121 1834 y(en)o(tering,)h(10,)f(45,)g(55)121
1890 y(static,)g(47,)g(48)37 1947 y(co)q(de,)i(33)37 2003 y(co)q(de)g(p)q
(oin)o(ter,)g(10)37 2060 y(contin)o(uation,)g(38)37 2116 y(constan)o(t)f
(applicativ)o(e)i(form,)d Fn(se)n(e)j Ft(CAFs)37 2172 y(constructors,)d(16,)h
(24)121 2229 y(niladic,)i(33)121 2285 y(standard,)d(26,)g(52,)g(53)37
2342 y(con)o(tin)o(uation,)i(60)37 2398 y(con)o(tin)o(uation-passing)h(st)o
(yle,)e Fn(se)n(e)i Ft(CPS)37 2455 y(Core)e(language,)g(8)37
2511 y(CPS,)g(21,)g(30)37 2568 y(currying,)h(14,)e(31)37 2666
y(data)h(structures,)g(16)37 2722 y(data)g(v)m(alues,)h(9)37
2779 y(debugging,)g(45)1029 354 y(direct-en)o(try)g(p)q(oin)o(t,)f(56)1029
451 y Fn(Enter)5 b Ft(,)14 b(33)1029 507 y(en)o(tering,)h Fn(se)n(e)j
Ft(closures)1029 564 y(en)o(vironmen)o(t)d(p)q(oin)o(ter,)h(10)1029
620 y(ev)m(acuation,)g(47)1029 677 y Fn(Eval)5 b Ft(,)14 b(33)1029
733 y(ev)m(al-apply)j(mo)q(del,)f(14)1029 789 y(ev)m(aluation)g(stac)o(k,)e
(15,)h(31)1029 886 y(forcing,)g Fn(se)n(e)j Ft(th)o(unks)1029
942 y(forw)o(arding)c(p)q(oin)o(ter,)i(48)1029 999 y(frame,)e(10)1029
1055 y(frame)h(p)q(oin)o(ter,)g(44)1029 1112 y(free)g(v)m(ariables,)h(22)1029
1168 y(full)g(laziness,)h(27)1029 1225 y(function)f(application,)g(14,)f(31,)
f(34,)g(55)1029 1281 y(function)i(v)m(alues,)g(9,)e(10)1029
1378 y(G-mac)o(hine,)h(14)1029 1434 y(garbage)f(collection,)j(47,)d(72)1029
1491 y(generational)i(garbage)e(collection,)j(15,)d(49)1029
1547 y(global)i(en)o(vironmen)o(t,)f(33)1029 1603 y(globals,)g(21,)g(29,)f
(47,)g(53,)g(73)1029 1660 y(graph)h(reduction,)h(14)1029 1756
y(Hask)o(ell,)g(7)1029 1813 y(head)f(normal)h(forms,)e(9)1029
1869 y(heap,)h(32)1029 1926 y(heap)g(o)o(v)o(er\015o)o(w)f(c)o(hec)o(k,)h(58)
1029 2022 y(indirection,)i(12)1029 2079 y(indirections,)g(46,)d(70)1029
2135 y(info)i(p)q(oin)o(ter,)f(45)1029 2192 y(info)h(table,)f(45,)f(50,)g(52)
1029 2248 y(initial)j(state,)d(34,)g(53)1029 2305 y(input/output,)h(74)1029
2361 y(in)o(tegers)1112 2417 y(small,)g(48)1029 2514 y(lam)o(b)q(da)h
(lifting,)g(21,)e(27)1029 2570 y(lam)o(b)q(da-form,)h(21)1029
2627 y(laziness,)h(11)1029 2683 y(lo)q(cal)g(en)o(vironmen)o(t,)f(33)1112
2740 y(sa)o(ving,)g(61)1029 2796 y(lo)q(calit)o(y)l(,)h(15)934
2921 y(86)p eop
%%Page: 87 87
bop 37 199 a Ft(lo)q(cally-de\014ne)q(d)18 b(functions,)e(56)37
256 y(lo)q(cals,)g(21)37 352 y Fp(main)p Ft(,)f(21,)f(34)37
409 y(manifest)i(functions,)f(24)37 465 y(monads,)g(74)37 562
y(non-up)q(datable,)i(21)37 619 y(normal)f(forms,)e(9)37 675
y(normal)i(return)f(co)q(de,)g(69)37 772 y(op)q(erational)h(seman)o(tics,)f
(32)37 869 y(paging,)h(15)37 925 y Fp(PAP_Info)o Ft(,)f(67)37
982 y(parallel)i(execution,)f(13)37 1038 y(partial)g(applications,)g(24,)f
(40,)f(67)37 1094 y(pattern)h(matc)o(hing,)g(16,)f(19,)h(60)37
1151 y(p)q(oin)o(ter,)h(45)37 1207 y(primitiv)o(e)h(data)e(t)o(yp)q(e,)g(29)
37 1264 y(primitiv)o(e)i(v)m(alues,)f(37)37 1320 y(pro\014ling,)h(74)37
1377 y(push-en)o(ter)f(mo)q(del,)g(14)37 1474 y(\\queue)g(me",)f(13,)f(60)37
1570 y(reduction,)i(11)37 1627 y(reen)o(tran)o(t,)e(81)37 1683
y(register)i(sa)o(v)o(es,)e(44)37 1740 y(return)i(address,)f(62)37
1796 y(return)h(con)o(v)o(en)o(tion,)f(17,)f(63)37 1853 y(return)i(stac)o(k,)
e(36,)g(50)37 1909 y(return)i(v)o(ector,)e(63)37 1965 y Fn(R)n(eturnCon)s
Ft(,)h(33,)f(36)37 2022 y Fn(R)n(eturnInt)t Ft(,)h(33,)f(36,)g(37,)g(64)37
2119 y(sca)o(v)o(enging,)h(48)37 2175 y(SECD)g(mac)o(hine,)h(14)37
2232 y(second-order)g(lam)o(b)q(da)g(calculus,)g(74)37 2288
y(self-up)q(dating)h(mo)q(del,)f(11)37 2345 y(sequences,)g(32)37
2401 y(single-en)o(try)l(,)h(81)37 2457 y(space)f(leak,)f(10,)g(59,)f(61)37
2514 y(stac)o(k)h(base)g(registers,)g(66)37 2570 y(stac)o(k)g(o)o(v)o
(er\015o)o(w)f(c)o(hec)o(k,)h(58)37 2627 y(stac)o(k)g(stubbing,)h(61)37
2683 y(stac)o(ks,)e(50)37 2740 y(standard)h(constructors,)f
Fn(se)n(e)k Ft(constructors)37 2796 y(standard-en)o(try)d(co)q(de,)h(45,)e
(58)1029 199 y(state)g(transition)i(system,)e(32)1029 256 y(status)g(\015ag,)
h(11)1029 312 y(STG)g(language,)g(8,)f(19)1029 369 y(strictness)h(analysis,)h
(8)1029 425 y(sup)q(ercom)o(binator,)f(27)1029 482 y(susp)q(ension,)h(9)1029
579 y(T-co)q(de,)f(7)1029 636 y(tag)f(big,)i(51)1029 692 y(tagless,)e(12)1029
749 y(target)g(language,)h(41)1029 805 y(threads,)g(15)1029
862 y(Three)g(Instruction)h(Mac)o(hine,)g Fn(se)n(e)h Ft(TIM)1029
918 y(th)o(unks,)e(9,)f(24)1112 975 y(forcing,)h(11,)f(16)1112
1031 y(represen)o(ting,)h(11)1029 1088 y(TIM,)g(10,)f(14)1029
1186 y(un)o(b)q(o)o(xed)i(v)m(alues,)g(8,)e(28)1029 1242 y(uniform)h
(represen)o(tation,)g(12)1029 1298 y(up)q(datable,)h(21,)e(81)1029
1355 y(up)q(date)i(\015ag,)e(20,)g(23)1112 1411 y(reen)o(tran)o(t,)g(60)1112
1468 y(single-en)o(try)l(,)i(60)1029 1524 y(up)q(date)g(frame,)e(38,)g(59,)g
(65,)h(68)1029 1581 y(up)q(date)h(return)f(co)q(de,)g(69)1029
1637 y(up)q(date)h(stac)o(k,)e(38,)g(50)1029 1694 y Fp(UpdatePAP)o
Ft(,)g(66)1029 1750 y(up)q(dates,)h(11,)f(12,)h(23,)f(38)1112
1807 y(in)i(place,)g(71)1029 1905 y(v)m(alues,)g(9,)e(32)1029
1961 y(v)o(ectored)h(return,)g(63,)f(68)1029 2017 y(v)o(ectored)h(returns,)g
(17)934 2921 y(87)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
